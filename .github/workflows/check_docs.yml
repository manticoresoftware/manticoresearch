name: ðŸ“– Check docs
run-name: ðŸ“– Check docs ${{ github.sha }}

on:
  pull_request:
    paths:
      - 'manual/**'
    branches:
      - master
      - maintenance-release
      - manticore-*

jobs:
  docs_check:
    runs-on: ubuntu-22.04
    defaults:
      run:
        shell: bash
    container:
      image: manticoresearch/docs_autodeploy:latest
      env:
        CACHEB: "../cache"
        DOCKER_HOST: tcp://docker:2375/
        DOCKER_DRIVER: overlay2
        COMMIT_DIR: manual
        DOCS_ERRORS_DIR: build/docs/

        CI_COMMIT_SHA: ${{ github.sha }}
        PREV_COMMIT_SHA: ${{ github.event.before }}
    steps:
      - name: Install fresh git
        run: |
          echo 'APT::Key::Assert-Pubkey-Algo ">=rsa1024";' > /etc/apt/apt.conf.d/99weakkey-warning
          apt-get update --allow-releaseinfo-change
          add-apt-repository -y ppa:git-core/ppa
          apt-get update
          apt-get install -y git
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 2
      - name: Get changed files
        id: changed-files
        run: |
          echo $CI_COMMIT_SHA
          echo $PREV_COMMIT_SHA
          git diff-tree --no-commit-id --name-only -r HEAD^1 HEAD
          echo "Doc check passed successfully "
          