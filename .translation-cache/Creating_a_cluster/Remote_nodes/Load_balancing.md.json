{
    "a81401714279f51352c3d72bc76842740c17d965f801d225afde5f086051be82": {
        "original": "# Load balancing\n\nLoad balancing is turned on by default for any [distributed table](../../Creating_a_table/Creating_a_distributed_table/Creating_a_distributed_table.md) that uses [mirroring](../../Creating_a_cluster/Remote_nodes/Mirroring.md). By default, queries are distributed randomly among the mirrors. You can change this behavior by using the [ha_strategy](../../Creating_a_cluster/Remote_nodes/Load_balancing.md).\n\n## ha_strategy\n\nCODE_BLOCK_0\n\nThe mirror selection strategy for load balancing is optional and is set to `random` by default.\n\nThe strategy used for mirror selection, or in other words, choosing a specific [agent mirror](../../Creating_a_cluster/Remote_nodes/Mirroring.md#Agent-mirrors) in a distributed table, is controlled by this directive. Essentially, this directive controls how master performs the load balancing between the configured mirror agent nodes. The following strategies are implemented:\n\n### Simple random balancing\n\n<!-- example conf balancing 1 -->\nThe default balancing mode is simple linear random distribution among the mirrors. This means that equal selection probabilities are assigned to each mirror. This is similar to round-robin (RR), but does not impose a strict selection order.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\nCODE_BLOCK_1\n<!-- end -->\n\n### Adaptive randomized balancing\n\nThe default simple random strategy does not take into account the status of mirrors, error rates, and most importantly, actual response latencies. To address heterogeneous clusters and temporary spikes in agent node load, there are a group of balancing strategies that dynamically adjust the probabilities based on the actual query latencies observed by the master.\n\nThe adaptive strategies based on **latency-weighted probabilities**  work as follows:\n\n1. Latency stats are accumulated in blocks of ha_period_karma seconds.\n2. Latency-weighted probabilities are recomputed once per karma period.\n3. The \"dead or alive\" flag is adjusted once per request, including ping requests.\n\nInitially, the probabilities are equal. On every step, they are scaled by the inverse of the latencies observed during the last karma period, and then renormalized. For example, if during the first 60 seconds after the master startup, 4 mirrors had latencies of 10 ms, 5 ms, 30 ms, and 3 ms respectively, the first adjustment step would go as follows:\n\n1. Initial percentages: 0.25, 0.25, 0.25, 0.25.\n2. Observed latencies: 10 ms, 5 ms, 30 ms, 3 ms.\n3. Inverse latencies: 0.1, 0.2, 0.0333, 0.333.\n4. Scaled percentages: 0.025, 0.05, 0.008333, 0.0833.\n5. Renormalized percentages: 0.15, 0.30, 0.05, 0.50.\n\nThis means that the first mirror would have a 15% chance of being chosen during the next karma period, the second one a 30% chance, the third one (slowest at 30 ms) only a 5% chance, and the fourth and fastest one (at 3 ms) a 50% chance. After that period, the second adjustment step would update those chances again, and so on.\n\nThe idea is that once the  **observed latencies** stabilize, the **latency weighted probabilities** will stabilize as well. All these adjustment iterations are meant to converge at a point where the average latencies are roughly equal across all mirrors.\n\n<!-- example conf balancing 2 -->\n#### nodeads\nLatency-weighted probabilities, but dead mirrors are excluded from the selection. A \"dead\" mirror is defined as a mirror that has resulted in multiple hard errors (e.g. network failure, or no answer, etc) in a row.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\nCODE_BLOCK_2\n<!-- end -->\n\n<!-- example conf balancing 3 -->\n#### noerrors\n\nLatency-weighted probabilities, but mirrors with a worse error/success ratio are excluded from selection.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\n\nCODE_BLOCK_3\n<!-- end -->\n\n### Round-robin balancing\n\n<!-- example conf balancing 4 -->\nSimple round-robin selection, that is, selecting the first mirror in the list, then the second one, then the third one, etc, and then repeating the process once the last mirror in the list is reached. Unlike with the randomized strategies, RR imposes a strict querying order (1, 2, 3, ..., N-1, N, 1, 2, 3, ..., and so on) and *guarantees* that no two consecutive queries will be sent to the same mirror.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\nCODE_BLOCK_4\n<!-- end -->\n\n## Instance-wide options\n\n### ha_period_karma\n\nCODE_BLOCK_5\n\n`ha_period_karma` defines the size of the agent mirror statistics window, in seconds (or a time suffix). Optional, the default is 60.\n\nFor a distributed table with agent mirrors, the server tracks several different per-mirror counters. These counters are then used for failover and balancing. (The server picks the best mirror to use based on the counters.) Counters are accumulated in blocks of `ha_period_karma` seconds.\n\nAfter beginning a new block, the master may still use the accumulated values from the previous one until the new one is half full. Thus, any previous history stops affecting the mirror choice after at most 1.5 times ha_period_karma seconds.\n\nAlthough at most 2 blocks are used for mirror selection, up to 15 last blocks are actually stored for instrumentation purposes. They can be inspected using the `SHOW AGENT STATUS` statement.\n\n### ha_ping_interval\n\nCODE_BLOCK_6\n\n`ha_ping_interval` directive defines the interval between pings sent to the agent mirrors, in milliseconds (or with a time suffix). This option is optional and its default value is 1000.\n\nFor a distributed table with agent mirrors, the server sends all mirrors a ping command during idle periods to track their current status (whether they are alive or dead, network roundtrip time, etc.). The interval between pings is determined by the ha_ping_interval setting.\n\nIf you want to disable pings, set ha_ping_interval to 0.\n\n<!-- proofread -->\n\n",
        "translations": {
            "chinese": "# \u8d1f\u8f7d\u5747\u8861\n\n\u5bf9\u4e8e\u4f7f\u7528[\u955c\u50cf](../../Creating_a_cluster/Remote_nodes/Mirroring.md)\u7684[\u5206\u5e03\u5f0f\u8868](../../Creating_a_table/Creating_a_distributed_table/Creating_a_distributed_table.md)\uff0c\u9ed8\u8ba4\u5f00\u542f\u8d1f\u8f7d\u5747\u8861\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u67e5\u8be2\u4f1a\u968f\u673a\u5206\u5e03\u5230\u5404\u4e2a\u955c\u50cf\u4e0a\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528[ha_strategy](../../Creating_a_cluster/Remote_nodes/Load_balancing.md)\u6765\u66f4\u6539\u6b64\u884c\u4e3a\u3002\n\n## ha_strategy\n\nCODE_BLOCK_0\n\n\u8d1f\u8f7d\u5747\u8861\u7684\u955c\u50cf\u9009\u62e9\u7b56\u7565\u662f\u53ef\u9009\u7684\uff0c\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a `random`\u3002\n\n\u7528\u4e8e\u955c\u50cf\u9009\u62e9\u7684\u7b56\u7565\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u5728\u5206\u5e03\u5f0f\u8868\u4e2d\u9009\u62e9\u7279\u5b9a\u7684[\u4ee3\u7406\u955c\u50cf](../../Creating_a_cluster/Remote_nodes/Mirroring.md#Agent-mirrors)\uff0c\u7531\u6b64\u6307\u4ee4\u63a7\u5236\u3002\u5b9e\u8d28\u4e0a\uff0c\u8be5\u6307\u4ee4\u63a7\u5236\u4e3b\u8282\u70b9\u5982\u4f55\u5728\u914d\u7f6e\u7684\u955c\u50cf\u4ee3\u7406\u8282\u70b9\u95f4\u6267\u884c\u8d1f\u8f7d\u5747\u8861\u3002\u5b9e\u73b0\u4e86\u4ee5\u4e0b\u51e0\u79cd\u7b56\u7565\uff1a\n\n### \u7b80\u5355\u968f\u673a\u5747\u8861\n\n<!-- example conf balancing 1 -->\n\u9ed8\u8ba4\u7684\u5747\u8861\u6a21\u5f0f\u662f\u5728\u7ebf\u6027\u968f\u673a\u5206\u5e03\u4e2d\u7b80\u5355\u5730\u5728\u955c\u50cf\u95f4\u5206\u914d\u3002\u8fd9\u610f\u5473\u7740\u6bcf\u4e2a\u955c\u50cf\u88ab\u8d4b\u4e88\u76f8\u7b49\u7684\u9009\u62e9\u6982\u7387\u3002\u8fd9\u7c7b\u4f3c\u4e8e\u8f6e\u8be2\uff08RR\uff09\uff0c\u4f46\u4e0d\u5f3a\u5236\u6267\u884c\u4e25\u683c\u7684\u9009\u62e9\u987a\u5e8f\u3002\n\n<!-- intro -->\n##### \u793a\u4f8b\uff1a\n\n<!-- request Example -->\nCODE_BLOCK_1\n<!-- end -->\n\n### \u81ea\u9002\u5e94\u968f\u673a\u5747\u8861\n\n\u9ed8\u8ba4\u7684\u7b80\u5355\u968f\u673a\u7b56\u7565\u6ca1\u6709\u8003\u8651\u955c\u50cf\u7684\u72b6\u6001\u3001\u9519\u8bef\u7387\uff0c\u6700\u91cd\u8981\u7684\u662f\u5b9e\u9645\u54cd\u5e94\u5ef6\u8fdf\u3002\u4e3a\u4e86\u89e3\u51b3\u5f02\u6784\u96c6\u7fa4\u548c\u4ee3\u7406\u8282\u70b9\u8d1f\u8f7d\u7684\u4e34\u65f6\u5cf0\u503c\uff0c\u5b58\u5728\u4e00\u7ec4\u57fa\u4e8e\u4e3b\u8282\u70b9\u5b9e\u9645\u89c2\u5bdf\u5230\u7684\u67e5\u8be2\u5ef6\u8fdf\u52a8\u6001\u8c03\u6574\u6982\u7387\u7684\u5747\u8861\u7b56\u7565\u3002\n\n\u57fa\u4e8e**\u5ef6\u8fdf\u52a0\u6743\u6982\u7387**\u7684\u81ea\u9002\u5e94\u7b56\u7565\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\uff1a\n\n1. \u5ef6\u8fdf\u7edf\u8ba1\u4ee5 ha_period_karma \u79d2\u4e3a\u5355\u4f4d\u7d2f\u79ef\u3002\n2. \u5ef6\u8fdf\u52a0\u6743\u6982\u7387\u6bcf\u4e2a karma \u5468\u671f\u91cd\u65b0\u8ba1\u7b97\u4e00\u6b21\u3002\n3. \u201c\u5b58\u6d3b\u6216\u6b7b\u4ea1\u201d\u6807\u5fd7\u6bcf\u6b21\u8bf7\u6c42\uff0c\u5305\u62ec ping \u8bf7\u6c42\u65f6\u8c03\u6574\u3002\n\n\u521d\u59cb\u65f6\u6982\u7387\u76f8\u7b49\u3002\u6bcf\u4e00\u6b65\u6982\u7387\u6309\u4e0a\u4e00\u4e2a karma \u5468\u671f\u5185\u89c2\u5bdf\u5230\u7684\u5ef6\u8fdf\u7684\u5012\u6570\u8fdb\u884c\u7f29\u653e\uff0c\u7136\u540e\u5f52\u4e00\u5316\u3002\u4f8b\u5982\uff0c\u5728\u4e3b\u8282\u70b9\u542f\u52a8\u540e\u524d 60 \u79d2\u5185\uff0c4 \u4e2a\u955c\u50cf\u7684\u5ef6\u8fdf\u5206\u522b\u4e3a 10 \u6beb\u79d2\u30015 \u6beb\u79d2\u300130 \u6beb\u79d2\u548c 3 \u6beb\u79d2\uff0c\u7b2c\u4e00\u6b21\u8c03\u6574\u6b65\u9aa4\u5982\u4e0b\uff1a\n\n1. \u521d\u59cb\u767e\u5206\u6bd4\uff1a0.25, 0.25, 0.25, 0.25\u3002\n2. \u89c2\u5bdf\u5230\u7684\u5ef6\u8fdf\uff1a10 ms, 5 ms, 30 ms, 3 ms\u3002\n3. \u5ef6\u8fdf\u5012\u6570\uff1a0.1, 0.2, 0.0333, 0.333\u3002\n4. \u7f29\u653e\u540e\u7684\u767e\u5206\u6bd4\uff1a0.025, 0.05, 0.008333, 0.0833\u3002\n5. \u5f52\u4e00\u5316\u767e\u5206\u6bd4\uff1a0.15, 0.30, 0.05, 0.50\u3002\n\n\u8fd9\u610f\u5473\u7740\uff0c\u5728\u4e0b\u4e00\u4e2a karma \u5468\u671f\u5185\uff0c\u7b2c\u4e00\u4e2a\u955c\u50cf\u88ab\u9009\u4e2d\u7684\u6982\u7387\u4e3a 15%\uff0c\u7b2c\u4e8c\u4e2a\u4e3a 30%\uff0c\u7b2c\u4e09\u4e2a\uff08\u6700\u6162\uff0c30 \u6beb\u79d2\uff09\u4ec5\u4e3a 5%\uff0c\u7b2c\u56db\u4e2a\uff08\u6700\u5feb\uff0c3 \u6beb\u79d2\uff09\u4e3a 50%\u3002\u4e4b\u540e\uff0c\u7b2c\u4e8c\u6b21\u8c03\u6574\u6b65\u9aa4\u4f1a\u518d\u6b21\u66f4\u65b0\u8fd9\u4e9b\u6982\u7387\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002\n\n\u5176\u601d\u60f3\u662f\uff0c\u4e00\u65e6**\u89c2\u5bdf\u5230\u7684\u5ef6\u8fdf**\u7a33\u5b9a\uff0c**\u5ef6\u8fdf\u52a0\u6743\u6982\u7387**\u4e5f\u4f1a\u7a33\u5b9a\u3002\u6240\u6709\u8fd9\u4e9b\u8c03\u6574\u8fed\u4ee3\u65e8\u5728\u6536\u655b\u5230\u4e00\u4e2a\u70b9\uff0c\u4f7f\u5f97\u6240\u6709\u955c\u50cf\u7684\u5e73\u5747\u5ef6\u8fdf\u5927\u81f4\u76f8\u7b49\u3002\n\n<!-- example conf balancing 2 -->\n#### nodeads\n\u5ef6\u8fdf\u52a0\u6743\u6982\u7387\uff0c\u4f46\u6392\u9664\u201c\u6b7b\u4ea1\u201d\u7684\u955c\u50cf\u3002\u201c\u6b7b\u4ea1\u201d\u955c\u50cf\u5b9a\u4e49\u4e3a\u8fde\u7eed\u53d1\u751f\u591a\u6b21\u786c\u9519\u8bef\uff08\u5982\u7f51\u7edc\u6545\u969c\u6216\u65e0\u54cd\u5e94\u7b49\uff09\u7684\u955c\u50cf\u3002\n\n<!-- intro -->\n##### \u793a\u4f8b\uff1a\n\n<!-- request Example -->\nCODE_BLOCK_2\n<!-- end -->\n\n<!-- example conf balancing 3 -->\n#### noerrors\n\n\u5ef6\u8fdf\u52a0\u6743\u6982\u7387\uff0c\u4f46\u6392\u9664\u9519\u8bef\u7387\u8f83\u9ad8\u7684\u955c\u50cf\u3002\n\n<!-- intro -->\n##### \u793a\u4f8b\uff1a\n\n<!-- request Example -->\n\nCODE_BLOCK_3\n<!-- end -->\n\n### \u8f6e\u8be2\u5747\u8861\n\n<!-- example conf balancing 4 -->\n\u7b80\u5355\u8f6e\u8be2\u9009\u62e9\uff0c\u5373\u4f9d\u6b21\u9009\u62e9\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u955c\u50cf\u3001\u7b2c\u4e8c\u4e2a\u955c\u50cf\u3001\u7b2c\u4e09\u4e2a\u955c\u50cf\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u6700\u540e\u4e00\u4e2a\u955c\u50cf\uff0c\u7136\u540e\u91cd\u590d\u8be5\u8fc7\u7a0b\u3002\u4e0e\u968f\u673a\u7b56\u7565\u4e0d\u540c\uff0c\u8f6e\u8be2\u65bd\u52a0\u4e25\u683c\u7684\u67e5\u8be2\u987a\u5e8f\uff081, 2, 3, ..., N-1, N, 1, 2, 3, ...\uff09\uff0c\u5e76*\u4fdd\u8bc1*\u4e0d\u4f1a\u8fde\u7eed\u5c06\u4e24\u4e2a\u67e5\u8be2\u53d1\u9001\u81f3\u540c\u4e00\u4e2a\u955c\u50cf\u3002\n\n<!-- intro -->\n##### \u793a\u4f8b\uff1a\n\n<!-- request Example -->\nCODE_BLOCK_4\n<!-- end -->\n\n## \u5b9e\u4f8b\u7ea7\u9009\u9879\n\n### ha_period_karma\n\nCODE_BLOCK_5\n\n`ha_period_karma` \u5b9a\u4e49\u4ee3\u7406\u955c\u50cf\u7edf\u8ba1\u7a97\u53e3\u7684\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3a\u79d2\uff08\u6216\u5e26\u65f6\u95f4\u540e\u7f00\uff09\u3002\u53ef\u9009\uff0c\u9ed8\u8ba4\u503c\u4e3a 60\u3002\n\n\u5bf9\u4e8e\u5e26\u4ee3\u7406\u955c\u50cf\u7684\u5206\u5e03\u5f0f\u8868\uff0c\u670d\u52a1\u5668\u4f1a\u8ddf\u8e2a\u591a\u4e2a\u4e0d\u540c\u7684\u6bcf\u955c\u50cf\u8ba1\u6570\u5668\u3002\u670d\u52a1\u5668\u57fa\u4e8e\u8fd9\u4e9b\u8ba1\u6570\u5668\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\u548c\u8d1f\u8f7d\u5747\u8861\u3002\uff08\u670d\u52a1\u5668\u6839\u636e\u8ba1\u6570\u5668\u9009\u62e9\u6700\u4f73\u955c\u50cf\u4f7f\u7528\u3002\uff09\u8ba1\u6570\u5668\u5728 `ha_period_karma` \u79d2\u7684\u533a\u5757\u4e2d\u7d2f\u79ef\u3002\n\n\u5f00\u59cb\u65b0\u8ba1\u6570\u5757\u540e\uff0c\u4e3b\u8282\u70b9\u53ef\u80fd\u5728\u65b0\u5757\u586b\u5145\u5230\u4e00\u534a\u4e4b\u524d\u4ecd\u4f7f\u7528\u4e4b\u524d\u5757\u4e2d\u7d2f\u79ef\u7684\u503c\u3002\u56e0\u6b64\uff0c\u4efb\u4f55\u5148\u524d\u7684\u5386\u53f2\u6700\u591a\u5728 1.5 \u500d ha_period_karma \u79d2\u540e\u4e0d\u518d\u5f71\u54cd\u955c\u50cf\u9009\u62e9\u3002\n\n\u867d\u7136\u6700\u591a\u4f7f\u7528\u4e24\u4e2a\u533a\u5757\u8fdb\u884c\u955c\u50cf\u9009\u62e9\uff0c\u4f46\u5b9e\u9645\u4e0a\u6700\u591a\u5b58\u50a8\u6700\u8fd1 15 \u4e2a\u533a\u5757\u4ee5\u652f\u6301\u5de5\u5177\u5206\u6790\u3002\u53ef\u901a\u8fc7 `SHOW AGENT STATUS` \u8bed\u53e5\u67e5\u770b\u3002\n\n### ha_ping_interval\n\nCODE_BLOCK_6\n\n`ha_ping_interval` \u6307\u4ee4\u5b9a\u4e49\u53d1\u9001\u7ed9\u4ee3\u7406\u955c\u50cf\u7684 ping \u95f4\u9694\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\uff08\u6216\u5e26\u65f6\u95f4\u540e\u7f00\uff09\u3002\u8be5\u9009\u9879\u53ef\u9009\uff0c\u9ed8\u8ba4\u503c\u4e3a 1000\u3002\n\n\u5bf9\u4e8e\u5e26\u4ee3\u7406\u955c\u50cf\u7684\u5206\u5e03\u5f0f\u8868\uff0c\u670d\u52a1\u5668\u5728\u7a7a\u95f2\u671f\u95f4\u5411\u6240\u6709\u955c\u50cf\u53d1\u9001 ping \u547d\u4ee4\u4ee5\u8ddf\u8e2a\u5176\u5f53\u524d\u72b6\u6001\uff08\u662f\u5426\u5b58\u6d3b\u3001\u7f51\u7edc\u5f80\u8fd4\u65f6\u95f4\u7b49\uff09\u3002ping \u53d1\u9001\u95f4\u9694\u7531 ha_ping_interval \u914d\u7f6e\u51b3\u5b9a\u3002\n\n\u5982\u679c\u60f3\u7981\u7528 ping\uff0c\u53ef\u5c06 ha_ping_interval \u8bbe\u7f6e\u4e3a 0\u3002\n\n<!-- proofread -->",
            "russian": "# \u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438\n\n\u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0434\u043b\u044f \u043b\u044e\u0431\u043e\u0439 [\u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b](../../Creating_a_table/Creating_a_distributed_table/Creating_a_distributed_table.md), \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0449\u0435\u0439 [\u0437\u0435\u0440\u043a\u0430\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435](../../Creating_a_cluster/Remote_nodes/Mirroring.md). \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u044e\u0442\u0441\u044f \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043c\u0435\u0436\u0434\u0443 \u0437\u0435\u0440\u043a\u0430\u043b\u0430\u043c\u0438. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u044d\u0442\u043e \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f [ha_strategy](../../Creating_a_cluster/Remote_nodes/Load_balancing.md).\n\n## ha_strategy\n\nCODE_BLOCK_0\n\n\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u0437\u0435\u0440\u043a\u0430\u043b\u0430 \u0434\u043b\u044f \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0438 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u0432 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 `random`.\n\n\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u0437\u0435\u0440\u043a\u0430\u043b\u0430, \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u0432\u044b\u0431\u043e\u0440\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e [\u0437\u0435\u0440\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0430\u0433\u0435\u043d\u0442\u0430](../../Creating_a_cluster/Remote_nodes/Mirroring.md#Agent-mirrors) \u0432 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u0435, \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u044d\u0442\u043e\u0439 \u0434\u0438\u0440\u0435\u043a\u0442\u0438\u0432\u043e\u0439. \u041f\u043e \u0441\u0443\u0442\u0438, \u044d\u0442\u0430 \u0434\u0438\u0440\u0435\u043a\u0442\u0438\u0432\u0430 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0442\u0435\u043c, \u043a\u0430\u043a \u043c\u0430\u0441\u0442\u0435\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0443 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043c\u0435\u0436\u0434\u0443 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u043c\u0438 \u0437\u0435\u0440\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u0430\u0433\u0435\u043d\u0442\u0441\u043a\u0438\u043c\u0438 \u0443\u0437\u043b\u0430\u043c\u0438. \u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u044b \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438:\n\n### \u041f\u0440\u043e\u0441\u0442\u0430\u044f \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u0430\u044f \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430\n\n<!-- example conf balancing 1 -->\n\u0420\u0435\u0436\u0438\u043c \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u2014 \u043f\u0440\u043e\u0441\u0442\u043e\u0435 \u043b\u0438\u043d\u0435\u0439\u043d\u043e\u0435 \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u043e\u0435 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u0437\u0435\u0440\u043a\u0430\u043b\u0430\u043c\u0438. \u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u0437\u0435\u0440\u043a\u0430\u043b\u0443 \u043d\u0430\u0437\u043d\u0430\u0447\u0430\u044e\u0442\u0441\u044f \u0440\u0430\u0432\u043d\u044b\u0435 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u0438 \u0432\u044b\u0431\u043e\u0440\u0430. \u042d\u0442\u043e \u043f\u043e\u0445\u043e\u0436\u0435 \u043d\u0430 \u043a\u0440\u0443\u0433\u043e\u0432\u043e\u0439 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c (round-robin, RR), \u043d\u043e \u043d\u0435 \u043d\u0430\u043a\u043b\u0430\u0434\u044b\u0432\u0430\u0435\u0442 \u0441\u0442\u0440\u043e\u0433\u0438\u0439 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0432\u044b\u0431\u043e\u0440\u0430.\n\n<!-- intro -->\n##### \u041f\u0440\u0438\u043c\u0435\u0440:\n\n<!-- request Example -->\nCODE_BLOCK_1\n<!-- end -->\n\n### \u0410\u0434\u0430\u043f\u0442\u0438\u0432\u043d\u0430\u044f \u0440\u0430\u043d\u0434\u043e\u043c\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430\n\n\u041f\u0440\u043e\u0441\u0442\u0430\u044f \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u043e\u0433\u043e \u0432\u044b\u0431\u043e\u0440\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u043d\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0441\u0442\u0430\u0442\u0443\u0441 \u0437\u0435\u0440\u043a\u0430\u043b, \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043e\u0448\u0438\u0431\u043e\u043a \u0438, \u0447\u0442\u043e \u0432\u0430\u0436\u043d\u0435\u0435 \u0432\u0441\u0435\u0433\u043e, \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438 \u043e\u0442\u043a\u043b\u0438\u043a\u0430. \u0427\u0442\u043e\u0431\u044b \u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c\u0441\u044f \u0441 \u043d\u0435\u043e\u0434\u043d\u043e\u0440\u043e\u0434\u043d\u044b\u043c\u0438 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430\u043c\u0438 \u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u043c\u0438 \u043f\u0438\u043a\u0430\u043c\u0438 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043d\u0430 \u0430\u0433\u0435\u043d\u0442\u0441\u043a\u0438\u0435 \u0443\u0437\u043b\u044b, \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u0430 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0439 \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u044e\u0442 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u0438 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0437\u0430\u0434\u0435\u0440\u0436\u0435\u043a \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432, \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0435\u043c\u044b\u0445 \u043c\u0430\u0441\u0442\u0435\u0440\u043e\u043c.\n\n\u0410\u0434\u0430\u043f\u0442\u0438\u0432\u043d\u044b\u0435 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438, \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043d\u0430 **\u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u044f\u0445, \u0432\u0437\u0432\u0435\u0448\u0435\u043d\u043d\u044b\u0445 \u043f\u043e \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430\u043c**, \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c:\n\n1. \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0437\u0430\u0434\u0435\u0440\u0436\u0435\u043a \u043d\u0430\u043a\u0430\u043f\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u043b\u043e\u043a\u0430\u043c\u0438 \u043f\u043e ha_period_karma \u0441\u0435\u043a\u0443\u043d\u0434.\n2. \u0412\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u0438, \u0432\u0437\u0432\u0435\u0448\u0435\u043d\u043d\u044b\u0435 \u043f\u043e \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430\u043c, \u043f\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u0437\u0430 \u043f\u0435\u0440\u0438\u043e\u0434 \u043a\u0430\u0440\u043c\u044b.\n3. \u0424\u043b\u0430\u0433 \"\u0436\u0438\u0432\u043e\u0439 \u0438\u043b\u0438 \u043c\u0451\u0440\u0442\u0432\u044b\u0439\" \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441, \u0432\u043a\u043b\u044e\u0447\u0430\u044f ping-\u0437\u0430\u043f\u0440\u043e\u0441\u044b.\n\n\u0418\u0437\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0432\u043d\u044b. \u041d\u0430 \u043a\u0430\u0436\u0434\u043e\u043c \u0448\u0430\u0433\u0435 \u043e\u043d\u0438 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u043e\u0431\u0440\u0430\u0442\u043d\u044b\u043c\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 \u0437\u0430\u0434\u0435\u0440\u0436\u0435\u043a, \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0435\u043c\u044b\u0445 \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430 \u043a\u0430\u0440\u043c\u044b, \u0430 \u0437\u0430\u0442\u0435\u043c \u043d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u0443\u044e\u0442\u0441\u044f \u0437\u0430\u043d\u043e\u0432\u043e. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u0432 \u043f\u0435\u0440\u0432\u044b\u0435 60 \u0441\u0435\u043a\u0443\u043d\u0434 \u043f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u043c\u0430\u0441\u0442\u0435\u0440\u0430 4 \u0437\u0435\u0440\u043a\u0430\u043b\u0430 \u043f\u043e\u043a\u0430\u0437\u0430\u043b\u0438 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438 10 \u043c\u0441, 5 \u043c\u0441, 30 \u043c\u0441 \u0438 3 \u043c\u0441 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u0448\u0430\u0433 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0431\u0443\u0434\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c:\n\n1. \u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u044b: 0.25, 0.25, 0.25, 0.25.\n2. \u041d\u0430\u0431\u043b\u044e\u0434\u0430\u0435\u043c\u044b\u0435 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438: 10 \u043c\u0441, 5 \u043c\u0441, 30 \u043c\u0441, 3 \u043c\u0441.\n3. \u041e\u0431\u0440\u0430\u0442\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u0434\u0435\u0440\u0436\u0435\u043a: 0.1, 0.2, 0.0333, 0.333.\n4. \u041c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u044b: 0.025, 0.05, 0.008333, 0.0833.\n5. \u041d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u044b: 0.15, 0.30, 0.05, 0.50.\n\n\u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0435\u0440\u0432\u043e\u0435 \u0437\u0435\u0440\u043a\u0430\u043b\u043e \u0431\u0443\u0434\u0435\u0442 \u0438\u043c\u0435\u0442\u044c 15% \u0448\u0430\u043d\u0441 \u0431\u044b\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u043c \u0432 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434 \u043a\u0430\u0440\u043c\u044b, \u0432\u0442\u043e\u0440\u043e\u0435 \u2014 30%, \u0442\u0440\u0435\u0442\u044c\u0435 (\u0441\u0430\u043c\u043e\u0435 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e\u0435, \u0441 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u043e\u0439 30 \u043c\u0441) \u2014 \u0442\u043e\u043b\u044c\u043a\u043e 5%, \u0430 \u0447\u0435\u0442\u0432\u0451\u0440\u0442\u043e\u0435 \u0438 \u0441\u0430\u043c\u043e\u0435 \u0431\u044b\u0441\u0442\u0440\u043e\u0435 (3 \u043c\u0441) \u2014 50%. \u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430 \u0432\u0442\u043e\u0440\u043e\u0439 \u0448\u0430\u0433 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0441\u043d\u043e\u0432\u0430 \u043e\u0431\u043d\u043e\u0432\u0438\u0442 \u044d\u0442\u0438 \u0448\u0430\u043d\u0441\u044b \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435.\n\n\u0418\u0434\u0435\u044f \u0437\u0430\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u043a\u0430\u043a \u0442\u043e\u043b\u044c\u043a\u043e **\u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0435\u043c\u044b\u0435 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438** \u0441\u0442\u0430\u0431\u0438\u043b\u0438\u0437\u0438\u0440\u0443\u044e\u0442\u0441\u044f, **\u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u0438, \u0432\u0437\u0432\u0435\u0448\u0435\u043d\u043d\u044b\u0435 \u043f\u043e \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430\u043c**, \u0442\u0430\u043a\u0436\u0435 \u0441\u0442\u0430\u0431\u0438\u043b\u0438\u0437\u0438\u0440\u0443\u044e\u0442\u0441\u044f. \u0412\u0441\u0435 \u044d\u0442\u0438 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0438 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043f\u0440\u0438\u0437\u0432\u0430\u043d\u044b \u0441\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u0442\u043e\u0447\u043a\u0443, \u0433\u0434\u0435 \u0441\u0440\u0435\u0434\u043d\u0438\u0435 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438 \u043f\u0440\u0438\u043c\u0435\u0440\u043d\u043e \u0440\u0430\u0432\u043d\u044b \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0437\u0435\u0440\u043a\u0430\u043b.\n\n<!-- example conf balancing 2 -->\n#### nodeads\n\u0412\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u0438, \u0432\u0437\u0432\u0435\u0448\u0435\u043d\u043d\u044b\u0435 \u043f\u043e \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430\u043c, \u043d\u043e \"\u043c\u0451\u0440\u0442\u0432\u044b\u0435\" \u0437\u0435\u0440\u043a\u0430\u043b\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u044e\u0442\u0441\u044f \u0438\u0437 \u0432\u044b\u0431\u043e\u0440\u0430. \"\u041c\u0451\u0440\u0442\u0432\u044b\u043c\" \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u0437\u0435\u0440\u043a\u0430\u043b\u043e, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0432\u044b\u0437\u0432\u0430\u043b\u043e \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0436\u0435\u0441\u0442\u043a\u0438\u0445 \u043e\u0448\u0438\u0431\u043e\u043a (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0441\u0431\u043e\u0439 \u0441\u0435\u0442\u0438 \u0438\u043b\u0438 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u043e\u0442\u0432\u0435\u0442\u0430 \u0438 \u0442. \u043f.).\n\n<!-- intro -->\n##### \u041f\u0440\u0438\u043c\u0435\u0440:\n\n<!-- request Example -->\nCODE_BLOCK_2\n<!-- end -->\n\n<!-- example conf balancing 3 -->\n#### noerrors\n\n\u0412\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u0438, \u0432\u0437\u0432\u0435\u0448\u0435\u043d\u043d\u044b\u0435 \u043f\u043e \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430\u043c, \u043d\u043e \u0437\u0435\u0440\u043a\u0430\u043b\u0430 \u0441 \u0445\u0443\u0434\u0448\u0438\u043c \u0441\u043e\u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u0435\u043c \u043e\u0448\u0438\u0431\u043e\u043a \u043a \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u044e\u0442\u0441\u044f \u0438\u0437 \u0432\u044b\u0431\u043e\u0440\u0430.\n\n<!-- intro -->\n##### \u041f\u0440\u0438\u043c\u0435\u0440:\n\n<!-- request Example -->\n\nCODE_BLOCK_3\n<!-- end -->\n\n### \u041a\u0440\u0443\u0433\u043e\u0432\u0430\u044f \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430 (Round-robin)\n\n<!-- example conf balancing 4 -->\n\u041f\u0440\u043e\u0441\u0442\u043e\u0439 \u0432\u044b\u0431\u043e\u0440 \u043a\u0440\u0443\u0433\u043e\u0432\u044b\u043c \u0441\u043f\u043e\u0441\u043e\u0431\u043e\u043c: \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u043f\u0435\u0440\u0432\u043e\u0435 \u0437\u0435\u0440\u043a\u0430\u043b\u043e \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430, \u0437\u0430\u0442\u0435\u043c \u0432\u0442\u043e\u0440\u043e\u0435, \u0437\u0430\u0442\u0435\u043c \u0442\u0440\u0435\u0442\u044c\u0435 \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435, \u043f\u043e\u0441\u043b\u0435 \u0447\u0435\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442\u0441\u044f \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u043f\u0438\u0441\u043a\u0430. \u0412 \u043e\u0442\u043b\u0438\u0447\u0438\u0435 \u043e\u0442 \u0440\u0430\u043d\u0434\u043e\u043c\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0439, RR \u043d\u0430\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u0442 \u0441\u0442\u0440\u043e\u0433\u0438\u0439 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 (1, 2, 3, ..., N-1, N, 1, 2, 3, ..., \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435) \u0438 *\u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442*, \u0447\u0442\u043e \u0434\u0432\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u044b \u043d\u0430 \u043e\u0434\u043d\u043e \u0438 \u0442\u043e \u0436\u0435 \u0437\u0435\u0440\u043a\u0430\u043b\u043e.\n\n<!-- intro -->\n##### \u041f\u0440\u0438\u043c\u0435\u0440:\n\n<!-- request Example -->\nCODE_BLOCK_4\n<!-- end -->\n\n## \u041e\u043f\u0446\u0438\u0438 \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0430\n\n### ha_period_karma\n\nCODE_BLOCK_5\n\n`ha_period_karma` \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u0440\u0430\u0437\u043c\u0435\u0440 \u043e\u043a\u043d\u0430 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0430\u0433\u0435\u043d\u0442\u0441\u043a\u0438\u0445 \u0437\u0435\u0440\u043a\u0430\u043b, \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445 (\u0438\u043b\u0438 \u0441 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438). \u041e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e, \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 60.\n\n\u0414\u043b\u044f \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0441 \u0430\u0433\u0435\u043d\u0442\u0441\u043a\u0438\u043c\u0438 \u0437\u0435\u0440\u043a\u0430\u043b\u0430\u043c\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u0441\u0447\u0451\u0442\u0447\u0438\u043a\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0437\u0435\u0440\u043a\u0430\u043b\u0430. \u042d\u0442\u0438 \u0441\u0447\u0451\u0442\u0447\u0438\u043a\u0438 \u0437\u0430\u0442\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u0444\u0435\u0439\u043b\u043e\u0432\u0435\u0440\u0430 \u0438 \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0438. (\u0421\u0435\u0440\u0432\u0435\u0440 \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u043b\u0443\u0447\u0448\u0435\u0435 \u0437\u0435\u0440\u043a\u0430\u043b\u043e \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u044d\u0442\u0438\u0445 \u0441\u0447\u0451\u0442\u0447\u0438\u043a\u043e\u0432.) \u0421\u0447\u0451\u0442\u0447\u0438\u043a\u0438 \u043d\u0430\u043a\u0430\u043f\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0431\u043b\u043e\u043a\u0430\u043c\u0438 \u043f\u043e `ha_period_karma` \u0441\u0435\u043a\u0443\u043d\u0434.\n\n\u041f\u043e\u0441\u043b\u0435 \u043d\u0430\u0447\u0430\u043b\u0430 \u043d\u043e\u0432\u043e\u0433\u043e \u0431\u043b\u043e\u043a\u0430 \u043c\u0430\u0441\u0442\u0435\u0440 \u0432\u0441\u0451 \u0435\u0449\u0451 \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438\u0437 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0433\u043e \u0431\u043b\u043e\u043a\u0430, \u043f\u043e\u043a\u0430 \u043d\u043e\u0432\u044b\u0439 \u0431\u043b\u043e\u043a \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0441\u044f \u043d\u0430\u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0443. \u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u043b\u044e\u0431\u043e\u0435 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0430\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0451\u0442 \u0432\u043b\u0438\u044f\u0442\u044c \u043d\u0430 \u0432\u044b\u0431\u043e\u0440 \u0437\u0435\u0440\u043a\u0430\u043b\u0430 \u0441\u043f\u0443\u0441\u0442\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 1.5 \u043f\u0435\u0440\u0438\u043e\u0434\u0430 `ha_period_karma`.\n\n\u0425\u043e\u0442\u044f \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u0437\u0435\u0440\u043a\u0430\u043b\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043d\u0435 \u0431\u043e\u043b\u0435\u0435 2 \u0431\u043b\u043e\u043a\u043e\u0432, \u0434\u043b\u044f \u0446\u0435\u043b\u0435\u0439 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0434\u043e 15 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u0431\u043b\u043e\u043a\u043e\u0432. \u0418\u0445 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 `SHOW AGENT STATUS`.\n\n### ha_ping_interval\n\nCODE_BLOCK_6\n\n\u0414\u0438\u0440\u0435\u043a\u0442\u0438\u0432\u0430 `ha_ping_interval` \u0437\u0430\u0434\u0430\u0451\u0442 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u043c\u0435\u0436\u0434\u0443 ping-\u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c\u0438, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u043c\u0438 \u0430\u0433\u0435\u043d\u0442\u0441\u043a\u0438\u043c \u0437\u0435\u0440\u043a\u0430\u043b\u0430\u043c, \u0432 \u043c\u0438\u043b\u043b\u0438\u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445 (\u0438\u043b\u0438 \u0441 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438). \u042d\u0442\u0430 \u043e\u043f\u0446\u0438\u044f \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439, \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0440\u0430\u0432\u043d\u043e 1000.\n\n\u0414\u043b\u044f \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0441 \u0430\u0433\u0435\u043d\u0442\u0441\u043a\u0438\u043c\u0438 \u0437\u0435\u0440\u043a\u0430\u043b\u0430\u043c\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u0448\u043b\u0451\u0442 \u0432\u0441\u0435\u043c \u0437\u0435\u0440\u043a\u0430\u043b\u0430\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 ping \u0432 \u043f\u0435\u0440\u0438\u043e\u0434\u044b \u043f\u0440\u043e\u0441\u0442\u043e\u044f, \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0442\u044c \u0438\u0445 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 (\u0436\u0438\u0432\u044b \u043e\u043d\u0438 \u0438\u043b\u0438 \u043c\u0435\u0440\u0442\u0432\u044b, \u0432\u0440\u0435\u043c\u044f \u0441\u0435\u0442\u0435\u0432\u043e\u0433\u043e \u043e\u0442\u043a\u043b\u0438\u043a\u0430 \u0438 \u0442. \u043f.). \u0418\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u043c\u0435\u0436\u0434\u0443 ping-\u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c\u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u043e\u0439 `ha_ping_interval`.\n\n\u0415\u0441\u043b\u0438 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c ping-\u0437\u0430\u043f\u0440\u043e\u0441\u044b, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0435 `ha_ping_interval` \u0432 0.\n\n<!-- proofread -->"
        },
        "is_code_or_comment": false,
        "model": "openai:gpt-4.1-mini",
        "updated_at": 1766339810
    },
    "__meta": {
        "source_text": "# Load balancing\n\nLoad balancing is turned on by default for any [distributed table](../../Creating_a_table/Creating_a_distributed_table/Creating_a_distributed_table.md) that uses [mirroring](../../Creating_a_cluster/Remote_nodes/Mirroring.md). By default, queries are distributed randomly among the mirrors. You can change this behavior by using the [ha_strategy](../../Creating_a_cluster/Remote_nodes/Load_balancing.md).\n\n## ha_strategy\n\n```ini\nha_strategy = {random|nodeads|noerrors|roundrobin}\n```\n\nThe mirror selection strategy for load balancing is optional and is set to `random` by default.\n\nThe strategy used for mirror selection, or in other words, choosing a specific [agent mirror](../../Creating_a_cluster/Remote_nodes/Mirroring.md#Agent-mirrors) in a distributed table, is controlled by this directive. Essentially, this directive controls how master performs the load balancing between the configured mirror agent nodes. The following strategies are implemented:\n\n### Simple random balancing\n\n<!-- example conf balancing 1 -->\nThe default balancing mode is simple linear random distribution among the mirrors. This means that equal selection probabilities are assigned to each mirror. This is similar to round-robin (RR), but does not impose a strict selection order.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\n```ini\nha_strategy = random\n```\n<!-- end -->\n\n### Adaptive randomized balancing\n\nThe default simple random strategy does not take into account the status of mirrors, error rates, and most importantly, actual response latencies. To address heterogeneous clusters and temporary spikes in agent node load, there are a group of balancing strategies that dynamically adjust the probabilities based on the actual query latencies observed by the master.\n\nThe adaptive strategies based on **latency-weighted probabilities**  work as follows:\n\n1. Latency stats are accumulated in blocks of ha_period_karma seconds.\n2. Latency-weighted probabilities are recomputed once per karma period.\n3. The \"dead or alive\" flag is adjusted once per request, including ping requests.\n\nInitially, the probabilities are equal. On every step, they are scaled by the inverse of the latencies observed during the last karma period, and then renormalized. For example, if during the first 60 seconds after the master startup, 4 mirrors had latencies of 10 ms, 5 ms, 30 ms, and 3 ms respectively, the first adjustment step would go as follows:\n\n1. Initial percentages: 0.25, 0.25, 0.25, 0.25.\n2. Observed latencies: 10 ms, 5 ms, 30 ms, 3 ms.\n3. Inverse latencies: 0.1, 0.2, 0.0333, 0.333.\n4. Scaled percentages: 0.025, 0.05, 0.008333, 0.0833.\n5. Renormalized percentages: 0.15, 0.30, 0.05, 0.50.\n\nThis means that the first mirror would have a 15% chance of being chosen during the next karma period, the second one a 30% chance, the third one (slowest at 30 ms) only a 5% chance, and the fourth and fastest one (at 3 ms) a 50% chance. After that period, the second adjustment step would update those chances again, and so on.\n\nThe idea is that once the  **observed latencies** stabilize, the **latency weighted probabilities** will stabilize as well. All these adjustment iterations are meant to converge at a point where the average latencies are roughly equal across all mirrors.\n\n<!-- example conf balancing 2 -->\n#### nodeads\nLatency-weighted probabilities, but dead mirrors are excluded from the selection. A \"dead\" mirror is defined as a mirror that has resulted in multiple hard errors (e.g. network failure, or no answer, etc) in a row.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\n```ini\nha_strategy = nodeads\n```\n<!-- end -->\n\n<!-- example conf balancing 3 -->\n#### noerrors\n\nLatency-weighted probabilities, but mirrors with a worse error/success ratio are excluded from selection.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\n\n```ini\nha_strategy = noerrors\n```\n<!-- end -->\n\n### Round-robin balancing\n\n<!-- example conf balancing 4 -->\nSimple round-robin selection, that is, selecting the first mirror in the list, then the second one, then the third one, etc, and then repeating the process once the last mirror in the list is reached. Unlike with the randomized strategies, RR imposes a strict querying order (1, 2, 3, ..., N-1, N, 1, 2, 3, ..., and so on) and *guarantees* that no two consecutive queries will be sent to the same mirror.\n\n<!-- intro -->\n##### Example:\n\n<!-- request Example -->\n```ini\nha_strategy = roundrobin\n```\n<!-- end -->\n\n## Instance-wide options\n\n### ha_period_karma\n\n```ini\nha_period_karma = 2m\n```\n\n`ha_period_karma` defines the size of the agent mirror statistics window, in seconds (or a time suffix). Optional, the default is 60.\n\nFor a distributed table with agent mirrors, the server tracks several different per-mirror counters. These counters are then used for failover and balancing. (The server picks the best mirror to use based on the counters.) Counters are accumulated in blocks of `ha_period_karma` seconds.\n\nAfter beginning a new block, the master may still use the accumulated values from the previous one until the new one is half full. Thus, any previous history stops affecting the mirror choice after at most 1.5 times ha_period_karma seconds.\n\nAlthough at most 2 blocks are used for mirror selection, up to 15 last blocks are actually stored for instrumentation purposes. They can be inspected using the `SHOW AGENT STATUS` statement.\n\n### ha_ping_interval\n\n```ini\nha_ping_interval = 3s\n```\n\n`ha_ping_interval` directive defines the interval between pings sent to the agent mirrors, in milliseconds (or with a time suffix). This option is optional and its default value is 1000.\n\nFor a distributed table with agent mirrors, the server sends all mirrors a ping command during idle periods to track their current status (whether they are alive or dead, network roundtrip time, etc.). The interval between pings is determined by the ha_ping_interval setting.\n\nIf you want to disable pings, set ha_ping_interval to 0.\n\n<!-- proofread -->\n\n",
        "updated_at": 1768530797,
        "source_md5": "1ac08d68495cf725aa2c8a68a43ecb51"
    }
}