{
  "ea5c0af3371bf8efb6103bab057d1f37fd379cd90a4dd86438b0410b30eba2de": {
    "original": "# Mirroring\n\n[Agent](../../Creating_a_table/Creating_a_distributed_table/Remote_tables.md#agent) mirrors can be used interchangeably when processing a search query. The Manticore instance(s) hosting the distributed table where the mirrored agents are defined keeps track of mirror status (alive or dead) and response times, and performs automatic failover and load balancing based on this information.\n\n## Agent mirrors\n\nCODE_BLOCK_0\n\nThe above example declares that `node1:9312`, `node2:9312`, and `node3:9312` all have a table called shard2, and can be used as interchangeable mirrors. If any of these servers go down, the queries will be distributed between the remaining two. When the server comes back online, the master will detect it and begin routing queries to all three nodes again.\n\nA mirror may also include an individual table list, as follows:\n\nCODE_BLOCK_1\n\nThis works similarly to the previous example, but different table names will be used when querying different servers. For example, node1shard2 will be used when querying node1:9312, and node2shard will be used when querying node2:9312.\n\nBy default, all queries are routed to the best of the mirrors. The best mirror is selected based on recent statistics, as controlled by the [ha_period_karma](../../Server_settings/Searchd.md#ha_period_karma) config directive. The master stores metrics (total query count, error count, response time, etc.) for each agent and groups these by time spans. The karma is the length of the time span. The best agent mirror is then determined dynamically based on the last two such time spans. The specific algorithm used to pick a mirror can be configured with the [ha_strategy](../../Creating_a_cluster/Remote_nodes/Load_balancing.md#ha_strategy) directive.\n\nThe karma period is in seconds and defaults to 60 seconds. The master stores up to 15 karma spans with per-agent statistics for instrumentation purposes (see `SHOW AGENT STATUS` statement). However, only the last two spans out of these are used for HA/LB logic.\n\nWhen there are no queries, the master sends a regular ping command every  [ha_ping_interval](../../Creating_a_cluster/Remote_nodes/Load_balancing.md#ha_ping_interval) milliseconds in order to collect statistics and check if the remote host is still alive. The ha_ping_interval defaults to 1000 msec. Setting it to 0 disables pings, and statistics will only be accumulated based on actual queries.\n\nExample:\n\nCODE_BLOCK_2\n\n<!-- proofread -->",
    "translations": {
      "chinese": "# 镜像\n\n[Agent](../../Creating_a_table/Creating_a_distributed_table/Remote_tables.md#agent) 镜像在处理搜索查询时可以互换使用。托管分布式表（定义了镜像代理）的 Manticore 实例会跟踪镜像状态（存活或宕机）和响应时间，并基于这些信息执行自动故障转移和负载均衡。\n\n## Agent 镜像\n\nCODE_BLOCK_0\n\n上述示例声明 `node1:9312`、`node2:9312` 和 `node3:9312` 都有一个名为 shard2 的表，可以作为可互换的镜像使用。如果这些服务器中的任何一个宕机，查询将分配到剩余的两个服务器。当服务器重新上线时，主节点会检测到并开始将查询路由到所有三个节点。\n\n镜像也可以包含单独的表列表，如下所示：\n\nCODE_BLOCK_1\n\n这与前面的示例类似，但查询不同服务器时会使用不同的表名。例如，查询 node1:9312 时使用 node1shard2，查询 node2:9312 时使用 node2shard。\n\n默认情况下，所有查询都会路由到最佳镜像。最佳镜像基于最近的统计数据选择，由配置指令 [ha_period_karma](../../Server_settings/Searchd.md#ha_period_karma) 控制。主节点存储每个代理的指标（总查询数、错误数、响应时间等），并按时间段分组。karma 是时间段的长度。最佳代理镜像根据最近两个时间段动态确定。选择镜像的具体算法可以通过 [ha_strategy](../../Creating_a_cluster/Remote_nodes/Load_balancing.md#ha_strategy) 指令配置。\n\nkarma 周期以秒为单位，默认值为 60 秒。主节点存储最多 15 个 karma 时间段的每代理统计数据用于监控（参见 `SHOW AGENT STATUS` 语句）。但只有最近的两个时间段用于 HA/LB 逻辑。\n\n当没有查询时，主节点每隔 [ha_ping_interval](../../Creating_a_cluster/Remote_nodes/Load_balancing.md#ha_ping_interval) 毫秒发送一次常规 ping 命令，以收集统计数据并检查远程主机是否仍然存活。ha_ping_interval 默认值为 1000 毫秒。设置为 0 则禁用 ping，统计数据仅基于实际查询累积。\n\n示例：\n\nCODE_BLOCK_2\n\n<!-- proofread -->",
      "russian": "# Зеркалирование\n\n[Агенты](../../Creating_a_table/Creating_a_distributed_table/Remote_tables.md#agent) зеркал могут использоваться взаимозаменяемо при обработке поискового запроса. Экземпляр(ы) Manticore, хранящий распределённую таблицу, где определены зеркальные агенты, отслеживает статус зеркал (активно или неактивно) и время отклика, а также выполняет автоматическое переключение при сбоях и балансировку нагрузки на основе этой информации.\n\n## Зеркала агентов\n\nCODE_BLOCK_0\n\nПриведённый выше пример объявляет, что `node1:9312`, `node2:9312` и `node3:9312` все имеют таблицу с именем shard2 и могут использоваться как взаимозаменяемые зеркала. Если какой-либо из этих серверов выходит из строя, запросы будут распределяться между оставшимися двумя. Когда сервер снова становится доступен, мастер обнаружит это и начнёт направлять запросы ко всем трём узлам снова.\n\nЗеркало также может включать индивидуальный список таблиц, как показано ниже:\n\nCODE_BLOCK_1\n\nЭто работает аналогично предыдущему примеру, но при запросах к разным серверам будут использоваться разные имена таблиц. Например, node1shard2 будет использоваться при запросах к node1:9312, а node2shard — при запросах к node2:9312.\n\nПо умолчанию все запросы направляются к лучшему из зеркал. Лучшее зеркало выбирается на основе последних статистических данных, контролируемых директивой конфигурации [ha_period_karma](../../Server_settings/Searchd.md#ha_period_karma). Мастер хранит метрики (общее количество запросов, количество ошибок, время отклика и т.д.) для каждого агента и группирует их по временным интервалам. Карма — это длина временного интервала. Лучшее зеркало агента определяется динамически на основе последних двух таких интервалов. Конкретный алгоритм выбора зеркала можно настроить с помощью директивы [ha_strategy](../../Creating_a_cluster/Remote_nodes/Load_balancing.md#ha_strategy).\n\nПериод кармы задаётся в секундах и по умолчанию равен 60 секундам. Мастер хранит до 15 интервалов кармы с статистикой по каждому агенту для целей инструментирования (см. оператор `SHOW AGENT STATUS`). Однако для логики HA/LB используются только последние два интервала.\n\nКогда запросов нет, мастер отправляет регулярную команду ping каждые [ha_ping_interval](../../Creating_a_cluster/Remote_nodes/Load_balancing.md#ha_ping_interval) миллисекунд, чтобы собирать статистику и проверять, жив ли удалённый хост. По умолчанию ha_ping_interval равен 1000 мс. Установка значения 0 отключает пинги, и статистика будет накапливаться только на основе фактических запросов.\n\nПример:\n\nCODE_BLOCK_2\n\n<!-- proofread -->"
    },
    "is_code_or_comment": false
  }
}
