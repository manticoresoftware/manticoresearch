{
    "ba4f93265520944908afb753ae38c3a79d3a34c48715ab9e49838c464944ce48": {
        "original": "# Execution of fetch queries\n\nWith all the SQL drivers, building a plain table generally works as follows.\n\n* A connection to the database is established.\n* The `sql_query_pre_all` queries are executed to perform any necessary initial setup, such as setting per-connection encoding with MySQL. These queries run before the entire indexing process, and also after a reconnect for indexing MVA attributes and joined fields.\n* The `sql_query_pre` pre-query is executed to perform any necessary initial setup, such as setting up temporary tables or maintaining counter tables. These queries run once for the entire indexing process.\n* Pre-queries as `sql_query_pre` is executed to perform any necessary initial setup, such as setting up temporary\n  tables, or maintaining counter table. These queries run once per whole indexing.\n* Main query as `sql_query` is executed and the rows it returns are processed.\n* Post-query as `sql_query_post` is executed to perform some necessary cleanup.\n* The connection to the database is closed.\n* Indexer does the sorting phase (to be pedantic, table-type specific post-processing).\n* A connection to the database is established again.\n* Post-processing query as `sql_query_post_index` is executed to perform some necessary final cleanup.\n* The connection to the database is closed again.\n\nExample of a source fetching data from MYSQL:\n\nCODE_BLOCK_0\n\n## sql_query\n\nThis is the query used to retrieve documents from a SQL server. There can be only one sql_query declared, and it's mandatory to have one. See also [Processing fetched data](../../../Data_creation_and_modification/Adding_data_from_external_storages/Fetching_from_databases/Processing_fetched_data.md#Processing-fetched-data)\n\n## sql_query_pre\n\nPre-fetch query or pre-query. This is a multi-value, optional setting, with the default being an empty list of queries. The pre-queries are executed before the sql_query in the order they appear in the configuration file. The results of the pre-queries are ignored.\n\nPre-queries are useful in many ways. They can be used to set up encoding, mark records that are going to be indexed, update internal counters, set various per-connection SQL server options and variables, and so on.\n\nPerhaps the most frequent use of pre-query is to specify the encoding that the server will use for the rows it returns. Note that Manticore accepts only UTF-8 text. Two MySQL specific examples of setting the encoding are:\n\nCODE_BLOCK_1\n\nAlso, specific to MySQL sources, it is useful to disable query cache (for indexer connection only) in pre-query, because indexing queries are not going to be re-run frequently anyway, and there's no sense in caching their results.\nThat could be achieved with:\n\nCODE_BLOCK_2\n\n## sql_query_post\n\nPost-fetch query. This is an optional setting, with the default value being empty.\n\nThis query is executed immediately after sql_query completes successfully. When the post-fetch query produces errors, they are reported as warnings, but indexing is not terminated. Its result set is ignored. Note that indexing is not yet completed at the point when this query gets executed, and further indexing may still fail. Therefore, any permanent updates should not be done from here. For instance, updates on a helper table that permanently change the last successfully indexed ID should not be run from the `sql_query_post` query; they should be run from the `sql_query_post_index` query instead.\n\n## sql_query_post_index\n\nPost-processing query. This is an optional setting, with the default value being empty.\n\nThis query is executed when indexing is fully and successfully completed. If this query produces errors, they are reported as warnings, but indexing is not terminated. Its result set is ignored. The `$maxid` macro can be used in its text; it will be expanded to the maximum document ID that was actually fetched from the database during indexing. If no documents were indexed, `$maxid` will be expanded to 0.\n\nExample:\nCODE_BLOCK_3\n\nThe difference between `sql_query_post` and `sql_query_post_index` is that `sql_query_post` is run immediately when Manticore receives all the documents, but further indexing may still fail for some other reason. On the contrary, by the time the `sql_query_post_index` query gets executed, it is guaranteed that the table was created successfully. Database connection is dropped and re-established because sorting phase can be very lengthy and would just time out otherwise.\n\n<!-- proofread -->\n\n",
        "translations": {
            "chinese": "# \u6267\u884c fetch \u67e5\u8be2\n\n\u4f7f\u7528\u6240\u6709 SQL \u9a71\u52a8\u7a0b\u5e8f\uff0c\u6784\u5efa\u4e00\u4e2a\u666e\u901a\u8868\u901a\u5e38\u6309\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u3002\n\n* \u5efa\u7acb\u4e0e\u6570\u636e\u5e93\u7684\u8fde\u63a5\u3002\n* \u6267\u884c `sql_query_pre_all` \u67e5\u8be2\u4ee5\u8fdb\u884c\u4efb\u4f55\u5fc5\u8981\u7684\u521d\u59cb\u8bbe\u7f6e\uff0c\u4f8b\u5982\u4f7f\u7528 MySQL \u8bbe\u7f6e\u6bcf\u4e2a\u8fde\u63a5\u7684\u7f16\u7801\u3002\u8fd9\u4e9b\u67e5\u8be2\u5728\u6574\u4e2a\u7d22\u5f15\u8fc7\u7a0b\u4e4b\u524d\u6267\u884c\uff0c\u4e5f\u5728\u91cd\u65b0\u8fde\u63a5\u540e\u6267\u884c\uff0c\u4ee5\u7d22\u5f15 MVA \u5c5e\u6027\u548c\u8054\u63a5\u5b57\u6bb5\u3002\n* \u6267\u884c `sql_query_pre` \u9884\u67e5\u8be2\u4ee5\u8fdb\u884c\u4efb\u4f55\u5fc5\u8981\u7684\u521d\u59cb\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e34\u65f6\u8868\u6216\u7ef4\u62a4\u8ba1\u6570\u5668\u8868\u3002\u8fd9\u4e9b\u67e5\u8be2\u5728\u6574\u4e2a\u7d22\u5f15\u8fc7\u7a0b\u53ea\u6267\u884c\u4e00\u6b21\u3002\n* \u6267\u884c `sql_query_pre` \u7684\u9884\u67e5\u8be2\u4ee5\u8fdb\u884c\u4efb\u4f55\u5fc5\u8981\u7684\u521d\u59cb\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e34\u65f6\n  \u8868\uff0c\u6216\u7ef4\u62a4\u8ba1\u6570\u5668\u8868\u3002\u8fd9\u4e9b\u67e5\u8be2\u5728\u6574\u4e2a\u7d22\u5f15\u8fc7\u7a0b\u4e2d\u53ea\u6267\u884c\u4e00\u6b21\u3002\n* \u6267\u884c\u4e3b\u67e5\u8be2 `sql_query`\uff0c\u5e76\u5904\u7406\u5b83\u8fd4\u56de\u7684\u884c\u3002\n* \u6267\u884c\u540e\u67e5\u8be2 `sql_query_post` \u4ee5\u8fdb\u884c\u5fc5\u8981\u7684\u6e05\u7406\u3002\n* \u5173\u95ed\u4e0e\u6570\u636e\u5e93\u7684\u8fde\u63a5\u3002\n* \u7d22\u5f15\u5668\u6267\u884c\u6392\u5e8f\u9636\u6bb5\uff08\u4e25\u683c\u6765\u8bf4\uff0c\u662f\u8868\u7c7b\u578b\u7279\u5b9a\u7684\u540e\u5904\u7406\uff09\u3002\n* \u518d\u6b21\u5efa\u7acb\u4e0e\u6570\u636e\u5e93\u7684\u8fde\u63a5\u3002\n* \u6267\u884c\u540e\u5904\u7406\u67e5\u8be2 `sql_query_post_index` \u4ee5\u8fdb\u884c\u5fc5\u8981\u7684\u6700\u7ec8\u6e05\u7406\u3002\n* \u518d\u6b21\u5173\u95ed\u4e0e\u6570\u636e\u5e93\u7684\u8fde\u63a5\u3002\n\n\u4ece MYSQL \u83b7\u53d6\u6570\u636e\u7684\u793a\u4f8b\uff1a\n\nCODE_BLOCK_0\n\n## sql_query\n\n\u8fd9\u662f\u7528\u4e8e\u4ece SQL \u670d\u52a1\u5668\u68c0\u7d22\u6587\u6863\u7684\u67e5\u8be2\u3002\u53ea\u80fd\u58f0\u660e\u4e00\u4e2a sql_query\uff0c\u4e14\u5fc5\u987b\u6709\u4e00\u4e2a\u3002\u53e6\u89c1 [Processing fetched data](../../../Data_creation_and_modification/Adding_data_from_external_storages/Fetching_from_databases/Processing_fetched_data.md#Processing-fetched-data)\n\n## sql_query_pre\n\n\u9884\u53d6\u67e5\u8be2\u6216\u9884\u67e5\u8be2\u3002\u8fd9\u662f\u4e00\u4e2a\u591a\u503c\u7684\u53ef\u9009\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u662f\u4e00\u4e2a\u7a7a\u7684\u67e5\u8be2\u5217\u8868\u3002\u9884\u67e5\u8be2\u5728 sql_query \u4e4b\u524d\u6309\u5176\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u987a\u5e8f\u6267\u884c\u3002\u9884\u67e5\u8be2\u7684\u7ed3\u679c\u4f1a\u88ab\u5ffd\u7565\u3002\n\n\u9884\u67e5\u8be2\u7528\u9014\u591a\u6837\u3002\u5b83\u4eec\u53ef\u7528\u4e8e\u8bbe\u7f6e\u7f16\u7801\u3001\u6807\u8bb0\u5c06\u8981\u88ab\u7d22\u5f15\u7684\u8bb0\u5f55\u3001\u66f4\u65b0\u5185\u90e8\u8ba1\u6570\u5668\u3001\u8bbe\u7f6e\u5404\u79cd\u6bcf\u8fde\u63a5\u7684 SQL \u670d\u52a1\u5668\u9009\u9879\u548c\u53d8\u91cf\uff0c\u7b49\u7b49\u3002\n\n\u9884\u67e5\u8be2\u6700\u5e38\u89c1\u7684\u7528\u9014\u53ef\u80fd\u662f\u6307\u5b9a\u670d\u52a1\u5668\u8fd4\u56de\u884c\u6240\u7528\u7684\u7f16\u7801\u3002\u6ce8\u610f Manticore \u53ea\u63a5\u53d7 UTF-8 \u6587\u672c\u3002\u8bbe\u5b9a\u7f16\u7801\u7684\u4e24\u4e2a MySQL \u7279\u5b9a\u793a\u4f8b\u5982\u4e0b\uff1a\n\nCODE_BLOCK_1\n\n\u6b64\u5916\uff0c\u7279\u5b9a\u4e8e MySQL \u6e90\uff0c\u7981\u7528\u67e5\u8be2\u7f13\u5b58\uff08\u4ec5\u9650\u7d22\u5f15\u5668\u8fde\u63a5\uff09\u5728\u9884\u67e5\u8be2\u4e2d\u5f88\u6709\u7528\uff0c\u56e0\u4e3a\u7d22\u5f15\u67e5\u8be2\u4e0d\u4f1a\u9891\u7e41\u91cd\u8dd1\uff0c\u7f13\u5b58\u5b83\u4eec\u7684\u7ed3\u679c\u6ca1\u6709\u610f\u4e49\u3002\n\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\uff1a\n\nCODE_BLOCK_2\n\n## sql_query_post\n\n\u540e\u53d6\u67e5\u8be2\u3002\u6b64\u4e3a\u53ef\u9009\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u503c\u4e3a\u7a7a\u3002\n\n\u6b64\u67e5\u8be2\u5728 sql_query \u6210\u529f\u5b8c\u6210\u540e\u7acb\u5373\u6267\u884c\u3002\u540e\u53d6\u67e5\u8be2\u5982\u679c\u51fa\u73b0\u9519\u8bef\uff0c\u4f1a\u4ee5\u8b66\u544a\u65b9\u5f0f\u62a5\u544a\uff0c\u4f46\u4e0d\u4f1a\u7ec8\u6b62\u7d22\u5f15\u3002\u5b83\u7684\u7ed3\u679c\u96c6\u4f1a\u88ab\u5ffd\u7565\u3002\u6ce8\u610f\u6b64\u65f6\u7d22\u5f15\u5c1a\u672a\u5b8c\u6210\uff0c\u540e\u7eed\u7d22\u5f15\u4ecd\u53ef\u80fd\u5931\u8d25\u3002\u56e0\u6b64\uff0c\u4e0d\u5e94\u4ece\u8fd9\u91cc\u6267\u884c\u4efb\u4f55\u6c38\u4e45\u66f4\u65b0\u3002\u4f8b\u5982\uff0c\u6c38\u4e45\u6539\u53d8\u6700\u540e\u6210\u529f\u7d22\u5f15 ID \u7684\u8f85\u52a9\u8868\u66f4\u65b0\uff0c\u4e0d\u5e94\u4ece `sql_query_post` \u67e5\u8be2\u8fd0\u884c\uff0c\u800c\u5e94\u4ece `sql_query_post_index` \u67e5\u8be2\u8fd0\u884c\u3002\n\n## sql_query_post_index\n\n\u540e\u5904\u7406\u67e5\u8be2\u3002\u6b64\u4e3a\u53ef\u9009\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u503c\u4e3a\u7a7a\u3002\n\n\u6b64\u67e5\u8be2\u5728\u7d22\u5f15\u5b8c\u5168\u4e14\u6210\u529f\u5b8c\u6210\u65f6\u6267\u884c\u3002\u5982\u679c\u6b64\u67e5\u8be2\u51fa\u73b0\u9519\u8bef\uff0c\u4f1a\u4ee5\u8b66\u544a\u65b9\u5f0f\u62a5\u544a\uff0c\u4f46\u4e0d\u4f1a\u7ec8\u6b62\u7d22\u5f15\u3002\u5b83\u7684\u7ed3\u679c\u96c6\u4f1a\u88ab\u5ffd\u7565\u3002\u6587\u672c\u4e2d\u53ef\u4ee5\u4f7f\u7528 `$maxid` \u5b8f\uff1b\u5b83\u5c06\u88ab\u5c55\u5f00\u4e3a\u7d22\u5f15\u671f\u95f4\u5b9e\u9645\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u7684\u6700\u5927\u6587\u6863 ID\u3002\u5982\u679c\u6ca1\u6709\u7d22\u5f15\u4efb\u4f55\u6587\u6863\uff0c`$maxid` \u5c06\u88ab\u5c55\u5f00\u4e3a 0\u3002\n\n\u793a\u4f8b\uff1a\nCODE_BLOCK_3\n\n`sql_query_post` \u548c `sql_query_post_index` \u7684\u533a\u522b\u5728\u4e8e\uff0c`sql_query_post` \u5728 Manticore \u63a5\u6536\u5230\u6240\u6709\u6587\u6863\u65f6\u7acb\u5373\u8fd0\u884c\uff0c\u4f46\u540e\u7eed\u7d22\u5f15\u53ef\u80fd\u56e0\u5176\u4ed6\u539f\u56e0\u5931\u8d25\u3002\u76f8\u53cd\uff0c\u5728\u6267\u884c `sql_query_post_index` \u67e5\u8be2\u65f6\uff0c\u8868\u5df2\u786e\u4fdd\u6210\u529f\u521b\u5efa\u3002\u6570\u636e\u5e93\u8fde\u63a5\u4f1a\u65ad\u5f00\u91cd\u5efa\uff0c\u56e0\u4e3a\u6392\u5e8f\u9636\u6bb5\u53ef\u80fd\u975e\u5e38\u957f\uff0c\u5426\u5219\u4f1a\u8d85\u65f6\u3002\n\n<!-- proofread -->",
            "russian": "# \u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432\u044b\u0431\u043e\u0440\u043a\u0438\n\n\u0414\u043b\u044f \u0432\u0441\u0435\u0445 SQL-\u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u043a\u0430\u043a \u043f\u0440\u0430\u0432\u0438\u043b\u043e, \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c.\n\n* \u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0431\u0430\u0437\u043e\u0439 \u0434\u0430\u043d\u043d\u044b\u0445.\n* \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u044b `sql_query_pre_all` \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0439 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0439 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0438 \u043d\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0432 MySQL. \u042d\u0442\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u0434\u043e \u0432\u0441\u0435\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 MVA \u0438 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439.\n* \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 `sql_query_pre` \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0439 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0439 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 \u0438\u043b\u0438 \u0432\u0435\u0434\u0435\u043d\u0438\u044f \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u043e\u0432. \u042d\u0442\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u0437\u0430 \u0432\u0435\u0441\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f.\n* \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 `sql_query_pre` \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0439 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0439 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445\n  \u0442\u0430\u0431\u043b\u0438\u0446 \u0438\u043b\u0438 \u0432\u0435\u0434\u0435\u043d\u0438\u044f \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u043e\u0432. \u042d\u0442\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u0437\u0430 \u0432\u0435\u0441\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f.\n* \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 `sql_query`, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f.\n* \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u0442-\u0437\u0430\u043f\u0440\u043e\u0441 `sql_query_post` \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0439 \u043e\u0447\u0438\u0441\u0442\u043a\u0438.\n* \u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0431\u0430\u0437\u043e\u0439 \u0434\u0430\u043d\u043d\u044b\u0445 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f.\n* \u0418\u043d\u0434\u0435\u043a\u0441\u0430\u0442\u043e\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0444\u0430\u0437\u0443 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 (\u0442\u043e\u0447\u043d\u0435\u0435 \u0433\u043e\u0432\u043e\u0440\u044f, \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0434\u043b\u044f \u0442\u0438\u043f\u0430 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u043e\u0441\u0442\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443).\n* \u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0431\u0430\u0437\u043e\u0439 \u0434\u0430\u043d\u043d\u044b\u0445 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0441\u043d\u043e\u0432\u0430.\n* \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u0440\u043e\u0441 \u043f\u043e\u0441\u0442\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 `sql_query_post_index` \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0439 \u043e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u043e\u0447\u0438\u0441\u0442\u043a\u0438.\n* \u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0431\u0430\u0437\u043e\u0439 \u0434\u0430\u043d\u043d\u044b\u0445 \u0441\u043d\u043e\u0432\u0430 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f.\n\n\u041f\u0440\u0438\u043c\u0435\u0440 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430, \u0432\u044b\u0431\u0438\u0440\u0430\u044e\u0449\u0435\u0433\u043e \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 MYSQL:\n\nCODE_BLOCK_0\n\n## sql_query\n\n\u042d\u0442\u043e \u0437\u0430\u043f\u0440\u043e\u0441, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0439 \u0434\u043b\u044f \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0438\u0437 SQL-\u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0431\u044a\u044f\u0432\u043b\u0435\u043d \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u0438\u043d sql_query, \u0438 \u0435\u0433\u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e. \u0421\u043c. \u0442\u0430\u043a\u0436\u0435 [\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445](../../../Data_creation_and_modification/Adding_data_from_external_storages/Fetching_from_databases/Processing_fetched_data.md#Processing-fetched-data)\n\n## sql_query_pre\n\n\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u0431\u043e\u0440\u043a\u0438 \u0438\u043b\u0438 pre-query. \u042d\u0442\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0441 \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c, \u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430\u044f, \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u2013 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432. \u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043f\u0435\u0440\u0435\u0434 sql_query \u0432 \u0442\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435, \u0432 \u043a\u0430\u043a\u043e\u043c \u043e\u043d\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u044b \u0432 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u043c \u0444\u0430\u0439\u043b\u0435. \u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u044e\u0442\u0441\u044f.\n\n\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043f\u043e\u043b\u0435\u0437\u043d\u044b \u0432\u043e \u043c\u043d\u043e\u0433\u0438\u0445 \u0441\u043b\u0443\u0447\u0430\u044f\u0445. \u041e\u043d\u0438 \u043c\u043e\u0433\u0443\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0438, \u043e\u0442\u043c\u0435\u0442\u043a\u0438 \u0437\u0430\u043f\u0438\u0441\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u044b, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0445 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u043e\u0432, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 SQL-\u0441\u0435\u0440\u0432\u0435\u0440\u0430, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u0441 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435\u043c, \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435.\n\n\u0412\u0435\u0440\u043e\u044f\u0442\u043d\u043e, \u043d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u0447\u0430\u0441\u0442\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u2013 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0441\u0435\u0440\u0432\u0435\u0440 \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0445 \u0441\u0442\u0440\u043e\u043a. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e Manticore \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u0435\u043a\u0441\u0442 \u0432 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0435 UTF-8. \u0414\u0432\u0430 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0434\u043b\u044f MySQL \u043f\u0440\u0438\u043c\u0435\u0440\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0438:\n\nCODE_BLOCK_1\n\n\u0422\u0430\u043a\u0436\u0435, \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u043e \u0434\u043b\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u043e\u0432 MySQL, \u043f\u043e\u043b\u0435\u0437\u043d\u043e \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u044d\u0448 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 (\u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0442\u043e\u0440\u0430) \u0432 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u0435, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0432\u0441\u0435 \u0440\u0430\u0432\u043d\u043e \u0447\u0430\u0441\u0442\u043e \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c\u0441\u044f \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e, \u0438 \u043d\u0435\u0442 \u0441\u043c\u044b\u0441\u043b\u0430 \u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b.\n\u042d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0441\u0434\u0435\u043b\u0430\u043d\u043e \u0442\u0430\u043a:\n\nCODE_BLOCK_2\n\n## sql_query_post\n\n\u041f\u043e\u0441\u0442-\u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u0431\u043e\u0440\u043a\u0438. \u042d\u0442\u0430 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430, \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u2013 \u043f\u0443\u0441\u0442\u043e\u0435.\n\n\u042d\u0442\u043e\u0442 \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441\u0440\u0430\u0437\u0443 \u043f\u043e\u0441\u043b\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f sql_query. \u0415\u0441\u043b\u0438 \u043f\u0440\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0438 \u043f\u043e\u0441\u0442-\u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u044e\u0442 \u043e\u0448\u0438\u0431\u043a\u0438, \u043e\u043d\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u043a\u0430\u043a \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u044f, \u043d\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f. \u0415\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u043d\u0430\u0431\u043e\u0440 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u044d\u0442\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0435\u0449\u0435 \u043d\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e, \u0438 \u043e\u043d\u043e \u0432\u0441\u0435 \u0435\u0449\u0435 \u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u043e\u0439. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043d\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0432\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0435\u0440\u043c\u0430\u043d\u0435\u043d\u0442\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u044f\u044e\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 ID, \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c\u0441\u044f \u0438\u0437 `sql_query_post`; \u0432\u043c\u0435\u0441\u0442\u043e \u044d\u0442\u043e\u0433\u043e \u043e\u043d\u0438 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c\u0441\u044f \u0438\u0437 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 `sql_query_post_index`.\n\n## sql_query_post_index\n\n\u0417\u0430\u043f\u0440\u043e\u0441 \u043f\u043e\u0441\u0442\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438. \u042d\u0442\u0430 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430, \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u2013 \u043f\u0443\u0441\u0442\u043e\u0435.\n\n\u042d\u0442\u043e\u0442 \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f, \u043a\u043e\u0433\u0434\u0430 \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0438 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438, \u043e\u043d\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u043a\u0430\u043a \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u044f, \u043d\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f. \u0415\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u043d\u0430\u0431\u043e\u0440 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f. \u0412 \u0442\u0435\u043a\u0441\u0442\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u043a\u0440\u043e\u0441 `$maxid`; \u043e\u043d \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d \u0434\u043e \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e ID \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u044b\u043b \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d \u0438\u0437 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u0415\u0441\u043b\u0438 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b \u043d\u0435 \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c, `$maxid` \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d \u0434\u043e 0.\n\n\u041f\u0440\u0438\u043c\u0435\u0440:\nCODE_BLOCK_3\n\n\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 `sql_query_post` \u0438 `sql_query_post_index` \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e `sql_query_post` \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441\u0440\u0430\u0437\u0443 \u043f\u043e\u0441\u043b\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f Manticore \u0432\u0441\u0435\u0445 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u043e\u0434\u043d\u0430\u043a\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u0441\u0435 \u0435\u0449\u0435 \u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c\u0441\u044f \u043d\u0435\u0443\u0434\u0430\u0447\u0435\u0439 \u043f\u043e \u0434\u0440\u0443\u0433\u043e\u0439 \u043f\u0440\u0438\u0447\u0438\u043d\u0435. \u041d\u0430\u043f\u0440\u043e\u0442\u0438\u0432, \u043a \u043c\u043e\u043c\u0435\u043d\u0442\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f `sql_query_post_index` \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u0442\u0430\u0431\u043b\u0438\u0446\u0430 \u0431\u044b\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0430. \u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0431\u0430\u0437\u043e\u0439 \u0434\u0430\u043d\u043d\u044b\u0445 \u0440\u0430\u0437\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0438 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0437\u0430\u043d\u043e\u0432\u043e, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0444\u0430\u0437\u0430 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0447\u0435\u043d\u044c \u0434\u043e\u043b\u0433\u043e\u0439 \u0438 \u0432 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0440\u0435\u0440\u0432\u0435\u0442\u0441\u044f \u043f\u043e \u0442\u0430\u0439\u043c-\u0430\u0443\u0442\u0443.\n\n<!-- proofread -->"
        },
        "is_code_or_comment": false,
        "model": "openai:gpt-4.1-mini",
        "updated_at": 1766339895
    },
    "__meta": {
        "source_text": "# Execution of fetch queries\n\nWith all the SQL drivers, building a plain table generally works as follows.\n\n* A connection to the database is established.\n* The `sql_query_pre_all` queries are executed to perform any necessary initial setup, such as setting per-connection encoding with MySQL. These queries run before the entire indexing process, and also after a reconnect for indexing MVA attributes and joined fields.\n* The `sql_query_pre` pre-query is executed to perform any necessary initial setup, such as setting up temporary tables or maintaining counter tables. These queries run once for the entire indexing process.\n* Pre-queries as `sql_query_pre` is executed to perform any necessary initial setup, such as setting up temporary\n  tables, or maintaining counter table. These queries run once per whole indexing.\n* Main query as `sql_query` is executed and the rows it returns are processed.\n* Post-query as `sql_query_post` is executed to perform some necessary cleanup.\n* The connection to the database is closed.\n* Indexer does the sorting phase (to be pedantic, table-type specific post-processing).\n* A connection to the database is established again.\n* Post-processing query as `sql_query_post_index` is executed to perform some necessary final cleanup.\n* The connection to the database is closed again.\n\nExample of a source fetching data from MYSQL:\n\n```ini\nsource mysource {\n  type             = mysql\n  path             = /path/to/realtime\n  sql_host         = localhost\n  sql_user         = myuser\n  sql_pass         = mypass\n  sql_db           = mydb\n  sql_query_pre    = SET CHARACTER_SET_RESULTS=utf8\n  sql_query_pre    = SET NAMES utf8\n  sql_query        =  SELECT id, title, description, category_id  FROM mytable\n  sql_query_post   = DROP TABLE view_table\n  sql_query_post_index = REPLACE INTO counters ( id, val ) \\\n    VALUES ( 'max_indexed_id', $maxid )\n  sql_attr_uint    = category_id\n  sql_field_string = title\n }\n\ntable mytable {\n  type   = plain\n  source = mysource\n  path   = /path/to/mytable\n  ...\n }\n```\n\n## sql_query\n\nThis is the query used to retrieve documents from a SQL server. There can be only one sql_query declared, and it's mandatory to have one. See also [Processing fetched data](../../../Data_creation_and_modification/Adding_data_from_external_storages/Fetching_from_databases/Processing_fetched_data.md#Processing-fetched-data)\n\n## sql_query_pre\n\nPre-fetch query or pre-query. This is a multi-value, optional setting, with the default being an empty list of queries. The pre-queries are executed before the sql_query in the order they appear in the configuration file. The results of the pre-queries are ignored.\n\nPre-queries are useful in many ways. They can be used to set up encoding, mark records that are going to be indexed, update internal counters, set various per-connection SQL server options and variables, and so on.\n\nPerhaps the most frequent use of pre-query is to specify the encoding that the server will use for the rows it returns. Note that Manticore accepts only UTF-8 text. Two MySQL specific examples of setting the encoding are:\n\n```ini\nsql_query_pre = SET CHARACTER_SET_RESULTS=utf8\nsql_query_pre = SET NAMES utf8\n```\n\nAlso, specific to MySQL sources, it is useful to disable query cache (for indexer connection only) in pre-query, because indexing queries are not going to be re-run frequently anyway, and there's no sense in caching their results.\nThat could be achieved with:\n\n```ini\nsql_query_pre = SET SESSION query_cache_type=OFF\n```\n\n## sql_query_post\n\nPost-fetch query. This is an optional setting, with the default value being empty.\n\nThis query is executed immediately after sql_query completes successfully. When the post-fetch query produces errors, they are reported as warnings, but indexing is not terminated. Its result set is ignored. Note that indexing is not yet completed at the point when this query gets executed, and further indexing may still fail. Therefore, any permanent updates should not be done from here. For instance, updates on a helper table that permanently change the last successfully indexed ID should not be run from the `sql_query_post` query; they should be run from the `sql_query_post_index` query instead.\n\n## sql_query_post_index\n\nPost-processing query. This is an optional setting, with the default value being empty.\n\nThis query is executed when indexing is fully and successfully completed. If this query produces errors, they are reported as warnings, but indexing is not terminated. Its result set is ignored. The `$maxid` macro can be used in its text; it will be expanded to the maximum document ID that was actually fetched from the database during indexing. If no documents were indexed, `$maxid` will be expanded to 0.\n\nExample:\n```ini\nsql_query_post_index = REPLACE INTO counters ( id, val ) \\\n    VALUES ( 'max_indexed_id', $maxid )\n```\n\nThe difference between `sql_query_post` and `sql_query_post_index` is that `sql_query_post` is run immediately when Manticore receives all the documents, but further indexing may still fail for some other reason. On the contrary, by the time the `sql_query_post_index` query gets executed, it is guaranteed that the table was created successfully. Database connection is dropped and re-established because sorting phase can be very lengthy and would just time out otherwise.\n\n<!-- proofread -->\n\n",
        "updated_at": 1768530797,
        "source_md5": "dec84b49bbe3a6375763f663a640cfec"
    }
}