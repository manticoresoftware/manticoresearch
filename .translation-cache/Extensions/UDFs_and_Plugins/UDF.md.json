{
    "e001d0d1c6b82e206d64a36fb046848302766ee9cfc02508b1639342c0cceed3": {
        "original": "CODE_BLOCK_3\n\nNote how `testfunc_init()` also receives the call arguments structure. By the time it is called, it does not receive any actual values, so the `args->arg_values` will be NULL. But the argument names and types are known and will be passed. You can check them in the initialization function and return an error if they are of an unsupported type.\n\n\n## SPH_UDF_ARGS types\n\nUDFs can receive arguments of pretty much any valid internal Manticore type. Refer to the `sphinx_udf_argtype` enumeration in `sphinxudf.h` for a full list. Most of the types map straightforwardly to the respective C types.\n\nThe most notable type is the `SPH_UDF_TYPE_FACTORS` argument type. You get that type by calling your UDF with a [PACKEDFACTOR()](../../Functions/Searching_and_ranking_functions#PACKEDFACTORS()) argument. Its data is a binary blob in a certain internal format, and to extract individual ranking signals from that blob, you need to use either of the two `sphinx_factors_XXX()` or `sphinx_get_YYY_factor()` families of functions.\n\n### sphinx_factors_XXX() functions\n\nThis family consists of 3 functions.\n\n* `sphinx_factors_init()` initializes the unpacked `SPH_UDF_FACTORS` structure\n* `sphinx_factors_unpack()` unpacks a binary blob into `SPH_UDF_FACTORS` structure\n* `sphinx_factors_deinit()` cleans up and deallocates the `SPH_UDF_FACTORS`.\n\nFirst, you need to call `init()` and `unpack()`, then you can use the `SPH_UDF_FACTORS` fields, and finally, you need to clean up with `deinit()`.\n\nThis approach is simple but may result in a bunch of memory allocations for each processed document, which could be slow.\n\n### sphinx_get_YYY_factor() functions\n\nThe other interface, consisting of a bunch of `sphinx_get_YYY_factor()` functions, is a bit more verbose to use but accesses the blob data directly and guarantees no allocations. For top-notch ranking UDF performance, you'll want to use this approach.\n\n## Return types of UDF\n\nAs for the return types, UDFs can currently return a single INTEGER, BIGINT, FLOAT, or STRING value. The C function return type should be `sphinx_int64_t`, `sphinx_int64_t`, `double`, or `char*` respectively. In the last case, you **must** use the `args->fn_malloc` function to allocate space for returned string values. Internally in your UDF, you can use whatever you want, so the `testfunc_init()` example above is correct code even though it uses malloc() directly: you manage that pointer yourself, it gets freed up using a matching free() call, and all is well. However, the returned strings values are managed by Manticore, and we have our own allocator, so for the return values specifically, you need to use it too.\n\nDepending on how your UDFs are used in the query, the main function call (`testfunc()` in our example) might be called in a rather different volume and order. Specifically,\n\n* UDFs referenced in WHERE, ORDER BY, or GROUP BY clauses must and will be evaluated for every matched document. They will be called in the natural matching order.\n* without subselects, UDFs that can be evaluated at the very last stage over the final result set will be evaluated that way, but before applying the `LIMIT` clause. They will be called in the result set order.\n* with subselects, such UDFs will also be evaluated after applying the inner `LIMIT` clause.\n\nThe calling sequence of the other functions is fixed, though. Namely,\n\n* `testfunc_init()` is called once when initializing the query. It can return a non-zero code to indicate a failure; in that case, the query will be terminated, and the error message from the `error_message` buffer will be returned.\n* `testfunc()` is called for every eligible row (see above), whenever Manticore needs to compute the UDF value. It can also indicate an (internal) failure error by writing a non-zero byte value to `error_flag`. In that case, it is guaranteed that it will not be called for subsequent rows, and a default return value of 0 will be substituted. Manticore might or might not choose to terminate such queries early; neither behavior is currently guaranteed.\n* `testfunc_deinit()` is called once when the query processing (in a given table shard) ends.\n\n<!-- proofread -->\n\n",
        "translations": {
            "chinese": "CODE_BLOCK_3\n\n\u6ce8\u610f `testfunc_init()` \u4e5f\u63a5\u6536\u8c03\u7528\u53c2\u6570\u7ed3\u6784\u4f53\u3002\u5728\u5b83\u88ab\u8c03\u7528\u65f6\uff0c\u4e0d\u4f1a\u63a5\u6536\u5230\u5b9e\u9645\u7684\u503c\uff0c\u56e0\u6b64 `args->arg_values` \u5c06\u4e3a NULL\u3002\u4f46\u53c2\u6570\u540d\u79f0\u548c\u7c7b\u578b\u662f\u5df2\u77e5\u7684\uff0c\u5e76\u4f1a\u88ab\u4f20\u5165\u3002\u4f60\u53ef\u4ee5\u5728\u521d\u59cb\u5316\u51fd\u6570\u4e2d\u68c0\u67e5\u5b83\u4eec\uff0c\u5982\u679c\u5b83\u4eec\u662f\u4e00\u4e2a\u4e0d\u652f\u6301\u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u8fd4\u56de\u9519\u8bef\u3002\n\n\n## SPH_UDF_ARGS \u7c7b\u578b\n\nUDF \u53ef\u4ee5\u63a5\u6536\u51e0\u4e4e\u4efb\u4f55\u6709\u6548\u7684\u5185\u90e8 Manticore \u7c7b\u578b\u7684\u53c2\u6570\u3002\u5b8c\u6574\u5217\u8868\u8bf7\u53c2\u89c1 `sphinxudf.h` \u4e2d\u7684 `sphinx_udf_argtype` \u679a\u4e3e\u3002\u5927\u591a\u6570\u7c7b\u578b\u53ef\u4ee5\u76f4\u63a5\u6620\u5c04\u5230\u76f8\u5e94\u7684 C \u7c7b\u578b\u3002\n\n\u6700\u663e\u8457\u7684\u7c7b\u578b\u662f `SPH_UDF_TYPE_FACTORS` \u53c2\u6570\u7c7b\u578b\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4f20\u5165\u4e00\u4e2a [PACKEDFACTOR()](../../Functions/Searching_and_ranking_functions#PACKEDFACTORS()) \u53c2\u6570\u8c03\u7528\u4f60\u7684 UDF \u6765\u83b7\u5f97\u8be5\u7c7b\u578b\u3002\u5176\u6570\u636e\u662f\u67d0\u79cd\u5185\u90e8\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u5757\uff0c\u8981\u4ece\u8be5\u4e8c\u8fdb\u5236\u5757\u4e2d\u63d0\u53d6\u5355\u4e2a\u6392\u540d\u4fe1\u53f7\uff0c\u5219\u9700\u8981\u4f7f\u7528\u4e24\u4e2a `sphinx_factors_XXX()` \u6216 `sphinx_get_YYY_factor()` \u51fd\u6570\u7cfb\u5217\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u3002\n\n### sphinx_factors_XXX() \u51fd\u6570\n\n\u8be5\u51fd\u6570\u7cfb\u5217\u5305\u542b 3 \u4e2a\u51fd\u6570\u3002\n\n* `sphinx_factors_init()` \u521d\u59cb\u5316\u89e3\u5305\u540e\u7684 `SPH_UDF_FACTORS` \u7ed3\u6784\u4f53\n* `sphinx_factors_unpack()` \u5c06\u4e8c\u8fdb\u5236\u5757\u89e3\u5305\u5230 `SPH_UDF_FACTORS` \u7ed3\u6784\u4f53\u4e2d\n* `sphinx_factors_deinit()` \u6e05\u7406\u5e76\u91ca\u653e `SPH_UDF_FACTORS`\u3002\n\n\u9996\u5148\uff0c\u9700\u8981\u8c03\u7528 `init()` \u548c `unpack()`\uff0c\u7136\u540e\u624d\u80fd\u4f7f\u7528 `SPH_UDF_FACTORS` \u5b57\u6bb5\uff0c\u6700\u540e\u9700\u8981\u7528 `deinit()` \u8fdb\u884c\u6e05\u7406\u3002\n\n\u8fd9\u79cd\u65b9\u6cd5\u7b80\u5355\uff0c\u4f46\u53ef\u80fd\u5bfc\u81f4\u6bcf\u4e2a\u5904\u7406\u7684\u6587\u6863\u90fd\u6709\u5927\u91cf\u5185\u5b58\u5206\u914d\uff0c\u901f\u5ea6\u53ef\u80fd\u8f83\u6162\u3002\n\n### sphinx_get_YYY_factor() \u51fd\u6570\n\n\u53e6\u4e00\u79cd\u63a5\u53e3\u7531\u4e00\u7cfb\u5217 `sphinx_get_YYY_factor()` \u51fd\u6570\u7ec4\u6210\uff0c\u4f7f\u7528\u65f6\u7a0d\u663e\u5570\u55e6\uff0c\u4f46\u5b83\u76f4\u63a5\u8bbf\u95ee\u4e8c\u8fdb\u5236\u5757\u6570\u636e\uff0c\u5e76\u4fdd\u8bc1\u65e0\u5185\u5b58\u5206\u914d\u3002\u5bf9\u4e8e\u9876\u7ea7\u7684\u6392\u540d UDF \u6027\u80fd\uff0c\u5efa\u8bae\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u3002\n\n## UDF \u7684\u8fd4\u56de\u7c7b\u578b\n\n\u81f3\u4e8e\u8fd4\u56de\u7c7b\u578b\uff0cUDF \u5f53\u524d\u53ef\u4ee5\u8fd4\u56de\u5355\u4e2a INTEGER\u3001BIGINT\u3001FLOAT \u6216 STRING \u503c\u3002C \u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u5e94\u5206\u522b\u662f `sphinx_int64_t`\u3001`sphinx_int64_t`\u3001`double` \u6216 `char*`\u3002\u5728\u6700\u540e\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c**\u5fc5\u987b**\u4f7f\u7528 `args->fn_malloc` \u51fd\u6570\u4e3a\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u503c\u5206\u914d\u7a7a\u95f4\u3002\u5728\u4f60\u7684 UDF \u5185\u90e8\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u65b9\u5f0f\uff0c\u56e0\u6b64\u4e0a\u9762 `testfunc_init()` \u7684\u4f8b\u5b50\u867d\u7136\u76f4\u63a5\u4f7f\u7528\u4e86 malloc()\uff0c\u4f46\u4ee3\u7801\u662f\u6b63\u786e\u7684\uff1a\u4f60\u81ea\u5df1\u7ba1\u7406\u90a3\u4e2a\u6307\u9488\uff0c\u4f1a\u7528\u76f8\u5e94\u7684 free() \u91ca\u653e\uff0c\u4e00\u5207\u6b63\u5e38\u3002\u7136\u800c\uff0c\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u503c\u7531 Manticore \u7ba1\u7406\uff0c\u6211\u4eec\u6709\u81ea\u5df1\u7684\u5206\u914d\u5668\uff0c\u6240\u4ee5\u9488\u5bf9\u8fd4\u56de\u503c\u5fc5\u987b\u4f7f\u7528\u5b83\u3002\n\n\u6839\u636e\u4f60\u7684 UDF \u5728\u67e5\u8be2\u4e2d\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u4e3b\u51fd\u6570\u8c03\u7528\uff08\u6211\u4eec\u4f8b\u5b50\u4e2d\u7684 `testfunc()`\uff09\u53ef\u80fd\u4ee5\u4e0d\u540c\u7684\u6570\u91cf\u548c\u987a\u5e8f\u88ab\u8c03\u7528\u3002\u5177\u4f53\u6765\u8bf4\uff1a\n\n* \u5728 WHERE\u3001ORDER BY \u6216 GROUP BY \u5b50\u53e5\u4e2d\u5f15\u7528\u7684 UDF \u5fc5\u987b\u4e14\u4f1a\u9488\u5bf9\u6bcf\u4e2a\u5339\u914d\u7684\u6587\u6863\u8fdb\u884c\u8ba1\u7b97\u3002\u5b83\u4eec\u4f1a\u6309\u81ea\u7136\u5339\u914d\u987a\u5e8f\u8c03\u7528\u3002\n* \u5728\u6ca1\u6709\u5b50\u67e5\u8be2\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u6700\u7ec8\u7ed3\u679c\u96c6\u7684\u6700\u540e\u9636\u6bb5\u8ba1\u7b97\u7684 UDF \u4f1a\u8fd9\u6837\u8ba1\u7b97\uff0c\u4f46\u5728\u5e94\u7528 `LIMIT` \u5b50\u53e5\u4e4b\u524d\u3002\u5b83\u4eec\u4f1a\u6309\u7ed3\u679c\u96c6\u987a\u5e8f\u8c03\u7528\u3002\n* \u6709\u5b50\u67e5\u8be2\u65f6\uff0c\u8fd9\u7c7b UDF \u4e5f\u4f1a\u5728\u5e94\u7528\u5185\u90e8 `LIMIT` \u5b50\u53e5\u540e\u8ba1\u7b97\u3002\n\n\u5176\u4ed6\u51fd\u6570\u7684\u8c03\u7528\u987a\u5e8f\u662f\u56fa\u5b9a\u7684\u3002\u5177\u4f53\u4e3a\uff1a\n\n* `testfunc_init()` \u5728\u521d\u59cb\u5316\u67e5\u8be2\u65f6\u53ea\u8c03\u7528\u4e00\u6b21\u3002\u5b83\u53ef\u4ee5\u8fd4\u56de\u975e\u96f6\u503c\u8868\u793a\u5931\u8d25\uff1b\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u67e5\u8be2\u7ec8\u6b62\u5e76\u8fd4\u56de `error_message` \u7f13\u51b2\u533a\u4e2d\u7684\u9519\u8bef\u4fe1\u606f\u3002\n* `testfunc()` \u5728\u6bcf\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u884c\u4e0a\u88ab\u8c03\u7528\uff08\u89c1\u4e0a\u6587\uff09\uff0c\u5f53 Manticore \u9700\u8981\u8ba1\u7b97 UDF \u503c\u65f6\u8c03\u7528\u3002\u5b83\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5411 `error_flag` \u5199\u5165\u975e\u96f6\u5b57\u8282\u8868\u793a\uff08\u5185\u90e8\uff09\u5931\u8d25\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4fdd\u8bc1\u4e0d\u4f1a\u4e3a\u540e\u7eed\u884c\u8c03\u7528\uff0c\u5e76\u4ee5\u9ed8\u8ba4\u8fd4\u56de\u503c 0 \u66ff\u4ee3\u3002Manticore \u53ef\u80fd\u4f1a\u6216\u53ef\u80fd\u4e0d\u4f1a\u63d0\u524d\u7ec8\u6b62\u6b64\u7c7b\u67e5\u8be2\uff1b\u4e24\u79cd\u884c\u4e3a\u76ee\u524d\u90fd\u4e0d\u4fdd\u8bc1\u3002\n* `testfunc_deinit()` \u5728\u67e5\u8be2\u5904\u7406\uff08\u9488\u5bf9\u7ed9\u5b9a\u6570\u636e\u8868\u5206\u7247\uff09\u7ed3\u675f\u65f6\u8c03\u7528\u4e00\u6b21\u3002\n\n<!-- proofread -->",
            "russian": "CODE_BLOCK_3\n\n\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e `testfunc_init()` \u0442\u0430\u043a\u0436\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0441 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430\u043c\u0438 \u0432\u044b\u0437\u043e\u0432\u0430. \u041a \u043c\u043e\u043c\u0435\u043d\u0442\u0443 \u0435\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430 \u043e\u043d \u043d\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 `args->arg_values` \u0431\u0443\u0434\u0435\u0442 NULL. \u041d\u043e \u0438\u043c\u0435\u043d\u0430 \u0438 \u0442\u0438\u043f\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b \u0438 \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u044b. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0438\u0445 \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0443, \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0438\u043c\u0435\u044e\u0442 \u043d\u0435\u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0439 \u0442\u0438\u043f.\n\n\n## \u0422\u0438\u043f\u044b SPH_UDF_ARGS\n\nUDF \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043b\u044e\u0431\u043e\u0433\u043e \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0433\u043e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u0442\u0438\u043f\u0430 Manticore. \u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0440\u0438\u0432\u0435\u0434\u0451\u043d \u0432 \u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0438 `sphinx_udf_argtype` \u0432 \u0444\u0430\u0439\u043b\u0435 `sphinxudf.h`. \u0411\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u0442\u0438\u043f\u043e\u0432 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0441 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c\u0438 \u0442\u0438\u043f\u0430\u043c\u0438 C.\n\n\u0421\u0430\u043c\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0442\u0438\u043f \u2014 \u044d\u0442\u043e \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0442\u0438\u043f\u0430 `SPH_UDF_TYPE_FACTORS`. \u0412\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u044d\u0442\u043e\u0442 \u0442\u0438\u043f \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 \u0432\u0430\u0448\u0435\u0433\u043e UDF \u0441 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u043c [PACKEDFACTOR()](../../Functions/Searching_and_ranking_functions#PACKEDFACTORS()). \u0415\u0433\u043e \u0434\u0430\u043d\u043d\u044b\u0435 \u2014 \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 \u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u043c \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435, \u0438 \u0447\u0442\u043e\u0431\u044b \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0438\u0433\u043d\u0430\u043b\u044b \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0431\u043e\u0440\u0430, \u0432\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u043d\u0443 \u0438\u0437 \u0434\u0432\u0443\u0445 \u0441\u0435\u043c\u0435\u0439\u0441\u0442\u0432\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 `sphinx_factors_XXX()` \u0438\u043b\u0438 `sphinx_get_YYY_factor()`.\n\n### \u0424\u0443\u043d\u043a\u0446\u0438\u0438 sphinx_factors_XXX()\n\n\u0412 \u044d\u0442\u043e \u0441\u0435\u043c\u0435\u0439\u0441\u0442\u0432\u043e \u0432\u0445\u043e\u0434\u044f\u0442 3 \u0444\u0443\u043d\u043a\u0446\u0438\u0438.\n\n* `sphinx_factors_init()` \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_FACTORS`\n* `sphinx_factors_unpack()` \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u044b\u0432\u0430\u0435\u0442 \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 \u0432 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_FACTORS`\n* `sphinx_factors_deinit()` \u043e\u0447\u0438\u0449\u0430\u0435\u0442 \u0438 \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0430\u0435\u0442 `SPH_UDF_FACTORS`.\n\n\u0421\u043d\u0430\u0447\u0430\u043b\u0430 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u0437\u0432\u0430\u0442\u044c `init()` \u0438 `unpack()`, \u0437\u0430\u0442\u0435\u043c \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u043b\u044f `SPH_UDF_FACTORS`, \u0430 \u0432 \u043a\u043e\u043d\u0446\u0435 \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043e\u0447\u0438\u0441\u0442\u043a\u0443 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e `deinit()`.\n\n\u042d\u0442\u043e\u0442 \u043f\u043e\u0434\u0445\u043e\u0434 \u043f\u0440\u043e\u0441\u0442, \u043d\u043e \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u043a \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u044f\u043c \u043f\u0430\u043c\u044f\u0442\u0438, \u0447\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e.\n\n### \u0424\u0443\u043d\u043a\u0446\u0438\u0438 sphinx_get_YYY_factor()\n\n\u0414\u0440\u0443\u0433\u043e\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441, \u0441\u043e\u0441\u0442\u043e\u044f\u0449\u0438\u0439 \u0438\u0437 \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 `sphinx_get_YYY_factor()`, \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0431\u043e\u043b\u0435\u0435 \u0433\u0440\u043e\u043c\u043e\u0437\u0434\u043e\u043a \u0432 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438, \u043d\u043e \u043e\u0431\u0440\u0430\u0449\u0430\u044e\u0442\u0441\u044f \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u043a \u0434\u0430\u043d\u043d\u044b\u043c \u043d\u0430\u0431\u043e\u0440\u0430 \u0438 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u044e\u0442 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043f\u0430\u043c\u044f\u0442\u0438. \u0414\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f UDF \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u043e\u0442 \u043f\u043e\u0434\u0445\u043e\u0434.\n\n## \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0442\u0438\u043f\u044b UDF\n\n\u0427\u0442\u043e \u043a\u0430\u0441\u0430\u0435\u0442\u0441\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0445 \u0442\u0438\u043f\u043e\u0432, UDF \u043f\u043e\u043a\u0430 \u043c\u043e\u0433\u0443\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u043e\u0434\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0438\u043f\u0430 INTEGER, BIGINT, FLOAT \u0438\u043b\u0438 STRING. \u0422\u0438\u043f C-\u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e `sphinx_int64_t`, `sphinx_int64_t`, `double` \u0438\u043b\u0438 `char*`. \u0412 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0432\u044b **\u0434\u043e\u043b\u0436\u043d\u044b** \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e `args->fn_malloc` \u0434\u043b\u044f \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u043e\u0434 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f. \u0412\u043d\u0443\u0442\u0440\u0438 \u0432\u0430\u0448\u0435\u0433\u043e UDF \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0447\u0442\u043e \u0443\u0433\u043e\u0434\u043d\u043e, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u0438\u0432\u0435\u0434\u0451\u043d\u043d\u044b\u0439 \u0432\u044b\u0448\u0435 \u043f\u0440\u0438\u043c\u0435\u0440 `testfunc_init()` \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0435\u043d, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043e\u043d \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 malloc() \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e: \u0432\u044b \u0441\u0430\u043c\u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0435 \u044d\u0442\u0438\u043c \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c, \u043e\u043d \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u0437\u043e\u0432\u043e\u043c free(), \u0438 \u0432\u0441\u0451 \u0445\u043e\u0440\u043e\u0448\u043e. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f Manticore, \u0438 \u0443 \u043d\u0430\u0441 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0430\u043b\u043b\u043e\u043a\u0430\u0442\u043e\u0440, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0434\u043b\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0435\u0433\u043e \u043d\u0443\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u0436\u0435.\n\n\u0412 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0432\u0430\u0448\u0438 UDF \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0435, \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0432\u044b\u0437\u043e\u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 (`testfunc()` \u0432 \u043d\u0430\u0448\u0435\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435) \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0440\u0430\u0437\u043d\u043e\u043c \u043e\u0431\u044a\u0451\u043c\u0435 \u0438 \u043f\u043e\u0440\u044f\u0434\u043a\u0435. \u0412 \u0447\u0430\u0441\u0442\u043d\u043e\u0441\u0442\u0438,\n\n* UDF, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0435 \u0432 WHERE, ORDER BY \u0438\u043b\u0438 GROUP BY, \u0434\u043e\u043b\u0436\u043d\u044b \u0438 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430. \u041e\u043d\u0438 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0435\u0441\u0442\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u0430.\n* \u0431\u0435\u0437 \u043f\u043e\u0434\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432, UDF, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u044b \u043d\u0430 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u043d\u0430\u0434 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0438\u0440\u0443\u044e\u0449\u0438\u043c \u043d\u0430\u0431\u043e\u0440\u043e\u043c, \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u044b \u0438\u043c\u0435\u043d\u043d\u043e \u0442\u0430\u043a, \u043d\u043e \u043f\u0435\u0440\u0435\u0434 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435\u043c \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 `LIMIT`. \u041e\u043d\u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0438\u0440\u0443\u044e\u0449\u0435\u0433\u043e \u043d\u0430\u0431\u043e\u0440\u0430.\n* \u0441 \u043f\u043e\u0434\u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c\u0438 \u0442\u0430\u043a\u0438\u0435 UDF \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 `LIMIT`.\n\n\u041f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0432\u044b\u0437\u043e\u0432\u0430 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0430. \u0410 \u0438\u043c\u0435\u043d\u043d\u043e,\n\n* `testfunc_init()` \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u043f\u0440\u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430. \u041e\u043d\u0430 \u043c\u043e\u0436\u0435\u0442 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043d\u0435\u043d\u0443\u043b\u0435\u0432\u043e\u0439 \u043a\u043e\u0434 \u0434\u043b\u044f \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043e\u0448\u0438\u0431\u043a\u0438; \u0432 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0435\u0440\u0432\u0430\u043d, \u0438 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435 \u0438\u0437 \u0431\u0443\u0444\u0435\u0440\u0430 `error_message`.\n* `testfunc()` \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 (\u0441\u043c. \u0432\u044b\u0448\u0435), \u043a\u043e\u0433\u0434\u0430 Manticore \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 UDF. \u041e\u043d\u0430 \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u0435\u0442 \u0441\u0438\u0433\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431 (\u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0439) \u043e\u0448\u0438\u0431\u043a\u0435, \u0437\u0430\u043f\u0438\u0441\u0430\u0432 \u0432 `error_flag` \u043d\u0435\u043d\u0443\u043b\u0435\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0431\u0430\u0439\u0442\u0430. \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u043e\u043d\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u0432\u0430\u043d\u0430 \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0441\u0442\u0440\u043e\u043a, \u0430 \u0432\u043c\u0435\u0441\u0442\u043e \u044d\u0442\u043e\u0433\u043e \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u0438\u0442\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 0. Manticore \u043c\u043e\u0436\u0435\u0442 \u043b\u0438\u0431\u043e \u043f\u0440\u0435\u043a\u0440\u0430\u0442\u0438\u0442\u044c \u0442\u0430\u043a\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u0441\u0440\u043e\u0447\u043d\u043e, \u043b\u0438\u0431\u043e \u043d\u0435\u0442; \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u043d\u0435 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f.\n* `testfunc_deinit()` \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u043f\u0440\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 (\u0432 \u0434\u0430\u043d\u043d\u043e\u043c \u0448\u0430\u0440\u0434\u043e\u0432\u043e\u043c \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b).\n\n<!-- proofread -->"
        },
        "is_code_or_comment": false,
        "model": "openai:gpt-4.1-mini",
        "updated_at": 1766339851
    },
    "a3dc61399d82331de88f46c8f3655b8bed5dc3ecb4f7a80c58f0cc4152f571c7": {
        "original": "# UDF\n\nUDFs are stored in external dynamic libraries (.so files on UNIX and .dll on Windows systems). Library files must be placed in a trusted folder specified by the [plugin_dir](../../Server_settings/Common.md#plugin_dir) directive for security reasons: it's easier to secure a single folder than to allow anyone to install arbitrary code into `searchd`. You can dynamically load and unload UDFs into searchd using [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md) and [DROP FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Deleting_a_function.md) SQL statements, respectively. Additionally, you can seamlessly reload UDFs (and other plugins) with the [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md) statement. Manticore keeps track of currently loaded functions; every time you create or drop a UDF, `searchd` updates its state in the [sphinxql_state](../../Server_settings/Searchd.md#sphinxql_state) file as a plain SQL script.\n\nUDFs are local. To use them on a cluster, you must place the same library on all nodes and run CREATE statements on each node as well. This process may change in future versions.\n\nOnce you successfully load a UDF, you can use it in your SELECT or other statements just like any built-in function:\n\nCODE_BLOCK_0\n\nMultiple UDFs (and other plugins) can reside in a single library. The library will only be loaded once and is automatically unloaded once all the UDFs and plugins within it are dropped.\n\nIn theory, you can write a UDF in any language, as long as its compiler can import standard C headers and emit standard dynamic libraries with properly exported functions. However, writing in C++ or plain C is the path of least resistance. We provide an example UDF library written in plain C that implements several functions (demonstrating various techniques) alongside our source code, found at [src/udfexample.c](https://github.com/manticoresoftware/manticore/blob/master/src/udfexample.c). This example includes the [src/sphinxudf.h](https://github.com/manticoresoftware/manticore/blob/master/src/sphinxudf.h) header file, which contains definitions of several UDF-related structures and types. For most UDFs and plugins, simply using `#include \"sphinxudf.h\"` as shown in the example should be sufficient. However, if you're writing a ranking function and need to access ranking signals (factors) data from within the UDF, you'll also need to compile and link with `src/sphinxudf.c` (available in our source code), as the *implementations* of functions that let you access signal data from within the UDF reside in that file.\n\nBoth the `sphinxudf.h` header and `sphinxudf.c` are standalone, so you can copy those files individually; they don't depend on any other parts of Manticore's source code.\n\nWithin your UDF, you **must** implement and export only a couple of functions. First, for UDF interface version control, you **must** define a function `int LIBRARYNAME_ver()`, where LIBRARYNAME is the name of your library file, and you must return `SPH_UDF_VERSION` (a value defined in `sphinxudf.h`) from it. Here's an example.\n\nCODE_BLOCK_1\n\nThis precaution protects you from accidentally loading a library with a mismatching UDF interface version into a newer or older `searchd`. Secondly, you **must** implement the actual function as well.\n\nCODE_BLOCK_2\n\nUDF function names in SQL are case-insensitive. However, the respective C function names are not; they need to be all *lower-case*, or the UDF will not load. More importantly, it is crucial that:\n\n1. the calling convention is C (aka __cdecl),\n2. the arguments list matches the plugin system expectations exactly, and\n3. the return type matches the one you specify in `CREATE FUNCTION`.\n\nUnfortunately, there is no (easy) way for us to check for these mistakes when loading the function, and they could crash the server and/or result in unexpected results. Last but not least, all the C functions you implement need to be thread-safe.\n\nThe first argument, a pointer to `SPH_UDF_INIT` structure, is essentially a pointer to our function state. It is optional. In the example just above, the function is stateless, as it simply returns 123 every time it gets called. So, we do not have to define an initialization function, and we can simply ignore that argument.\nThis argument serves one more purpose. Since a single query can be executed on multiple threads (see [pseudo-sharding](../../Server_settings/Searchd.md#pseudo_sharding)), the daemon tries to determine whether a UDF is stateful or stateless by checking this argument. If the argument is initialized, parallel execution will be disabled. So, if your UDF is stateful but you don't use this argument, it will be called from multiple threads, and your code needs to be aware of that.\n\nThe second argument, a pointer to `SPH_UDF_ARGS`, is the most important one. All the actual call arguments are passed to your UDF via this structure; it contains the call argument count, names, types, etc. So, whether your function gets called like `SELECT id, testfunc(1)` or like `SELECT id, testfunc('abc', 1000*id+gid, WEIGHT())` or any other way, it will receive the very same `SPH_UDF_ARGS` structure in all of these cases. However, the data passed in the `args` structure will be different. In the first example, `args->arg_count` will be set to 1, in the second example it will be set to 3, and the `args->arg_types` array will contain different type data, and so on.\n\nFinally, the third argument is an error flag. A UDF can raise it to indicate that some kind of internal error occurred, the UDF cannot continue, and the query should terminate early. You should **not** use this for argument type checks or for any other error reporting that is likely to happen during normal use. This flag is designed to report sudden critical runtime errors, such as running out of memory.\n\nIf we wanted to, say, allocate temporary storage for our function to use, or check upfront whether the arguments are of the supported types, then we would need to add two more functions, for UDF initialization and deinitialization, respectively.",
        "translations": {
            "chinese": "# UDF\n\nUDF \u5b58\u50a8\u5728\u5916\u90e8\u52a8\u6001\u5e93\u4e2d\uff08UNIX \u7cfb\u7edf\u4e0a\u4e3a .so \u6587\u4ef6\uff0cWindows \u7cfb\u7edf\u4e0a\u4e3a .dll \u6587\u4ef6\uff09\u3002\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u5e93\u6587\u4ef6\u5fc5\u987b\u653e\u7f6e\u5728\u7531 [plugin_dir](../../Server_settings/Common.md#plugin_dir) \u6307\u4ee4\u6307\u5b9a\u7684\u53d7\u4fe1\u4efb\u6587\u4ef6\u5939\u4e2d\uff1a\u4fdd\u62a4\u5355\u4e2a\u6587\u4ef6\u5939\u6bd4\u5141\u8bb8\u4efb\u4f55\u4eba\u5411 `searchd` \u5b89\u88c5\u4efb\u610f\u4ee3\u7801\u8981\u5bb9\u6613\u5f97\u591a\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md) \u548c [DROP FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Deleting_a_function.md) SQL \u8bed\u53e5\u52a8\u6001\u52a0\u8f7d\u548c\u5378\u8f7d searchd \u4e2d\u7684 UDF\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md) \u8bed\u53e5\u65e0\u7f1d\u91cd\u65b0\u52a0\u8f7d UDF\uff08\u53ca\u5176\u4ed6\u63d2\u4ef6\uff09\u3002Manticore \u4f1a\u8ddf\u8e2a\u5f53\u524d\u52a0\u8f7d\u7684\u51fd\u6570\uff1b\u6bcf\u6b21\u521b\u5efa\u6216\u5220\u9664 UDF \u65f6\uff0c`searchd` \u4f1a\u5c06\u5176\u72b6\u6001\u66f4\u65b0\u5230 [sphinxql_state](../../Server_settings/Searchd.md#sphinxql_state) \u6587\u4ef6\u4e2d\uff0c\u4f5c\u4e3a\u7eaf SQL \u811a\u672c\u3002\n\nUDF \u662f\u672c\u5730\u7684\u3002\u8981\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528\u5b83\u4eec\uff0c\u5fc5\u987b\u5728\u6240\u6709\u8282\u70b9\u4e0a\u653e\u7f6e\u76f8\u540c\u7684\u5e93\uff0c\u5e76\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c CREATE \u8bed\u53e5\u3002\u6b64\u6d41\u7a0b\u5728\u672a\u6765\u7248\u672c\u4e2d\u53ef\u80fd\u4f1a\u6709\u6240\u53d8\u5316\u3002\n\n\u4e00\u65e6\u6210\u529f\u52a0\u8f7d UDF\uff0c\u60a8\u53ef\u4ee5\u50cf\u4f7f\u7528\u4efb\u4f55\u5185\u7f6e\u51fd\u6570\u4e00\u6837\u5728 SELECT \u6216\u5176\u4ed6\u8bed\u53e5\u4e2d\u4f7f\u7528\u5b83\uff1a\n\nCODE_BLOCK_0\n\n\u591a\u4e2a UDF\uff08\u53ca\u5176\u4ed6\u63d2\u4ef6\uff09\u53ef\u4ee5\u5171\u5b58\u5728\u540c\u4e00\u4e2a\u5e93\u4e2d\u3002\u8be5\u5e93\u53ea\u4f1a\u88ab\u52a0\u8f7d\u4e00\u6b21\uff0c\u5e76\u5728\u5176\u5185\u6240\u6709 UDF \u548c\u63d2\u4ef6\u90fd\u88ab\u5220\u9664\u540e\u81ea\u52a8\u5378\u8f7d\u3002\n\n\u7406\u8bba\u4e0a\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u8bed\u8a00\u7f16\u5199 UDF\uff0c\u53ea\u8981\u5176\u7f16\u8bd1\u5668\u80fd\u591f\u5bfc\u5165\u6807\u51c6 C \u5934\u6587\u4ef6\u5e76\u751f\u6210\u5e26\u6709\u6b63\u786e\u5bfc\u51fa\u51fd\u6570\u7684\u6807\u51c6\u52a8\u6001\u5e93\u3002\u7136\u800c\uff0c\u4f7f\u7528 C++ \u6216\u7eaf C \u662f\u6700\u5c11\u963b\u529b\u7684\u8def\u5f84\u3002\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u7eaf C \u7f16\u5199\u7684\u793a\u4f8b UDF \u5e93\uff0c\u5b9e\u73b0\u5728\u591a\u4e2a\u51fd\u6570\u4e2d\u5c55\u793a\u5404\u79cd\u6280\u672f\uff0c\u6e90\u4ee3\u7801\u4f4d\u4e8e [src/udfexample.c](https://github.com/manticoresoftware/manticore/blob/master/src/udfexample.c)\u3002\u8be5\u793a\u4f8b\u5305\u542b\u5934\u6587\u4ef6 [src/sphinxudf.h](https://github.com/manticoresoftware/manticore/blob/master/src/sphinxudf.h)\uff0c\u5176\u4e2d\u5305\u542b\u82e5\u5e72 UDF \u76f8\u5173\u7ed3\u6784\u548c\u7c7b\u578b\u7684\u5b9a\u4e49\u3002\u5bf9\u4e8e\u5927\u591a\u6570 UDF \u548c\u63d2\u4ef6\uff0c\u53ea\u9700\u50cf\u793a\u4f8b\u4e2d\u90a3\u6837\u4f7f\u7528 `#include \"sphinxudf.h\"` \u5373\u53ef\u3002\u7136\u800c\uff0c\u5982\u679c\u60a8\u7f16\u5199\u6392\u540d\u51fd\u6570\u4e14\u9700\u8981\u5728 UDF \u5185\u8bbf\u95ee\u6392\u540d\u4fe1\u53f7\uff08\u56e0\u7d20\uff09\u6570\u636e\uff0c\u5219\u8fd8\u9700\u8981\u7f16\u8bd1\u5e76\u94fe\u63a5 `src/sphinxudf.c`\uff08\u53ef\u5728\u6211\u4eec\u7684\u6e90\u7801\u4e2d\u83b7\u5f97\uff09\uff0c\u56e0\u4e3a\u5141\u8bb8\u60a8\u4ece UDF \u5185\u8bbf\u95ee\u4fe1\u53f7\u6570\u636e\u7684\u51fd\u6570\u5b9e\u73b0\u4f4d\u4e8e\u8be5\u6587\u4ef6\u3002\n\n`sphinxudf.h` \u5934\u6587\u4ef6\u548c `sphinxudf.c` \u662f\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5355\u72ec\u590d\u5236\u8fd9\u4e9b\u6587\u4ef6\uff1b\u5b83\u4eec\u4e0d\u4f9d\u8d56 Manticore \u6e90\u7801\u7684\u5176\u4ed6\u90e8\u5206\u3002\n\n\u5728\u60a8\u7684 UDF \u4e2d\uff0c\u60a8**\u5fc5\u987b**\u53ea\u5b9e\u73b0\u5e76\u5bfc\u51fa\u51e0\u4e2a\u51fd\u6570\u3002\u9996\u5148\uff0c\u4e3a\u4e86 UDF \u63a5\u53e3\u7248\u672c\u63a7\u5236\uff0c\u60a8**\u5fc5\u987b**\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570 `int LIBRARYNAME_ver()`\uff0c\u5176\u4e2d LIBRARYNAME \u662f\u60a8\u5e93\u6587\u4ef6\u7684\u540d\u5b57\uff0c\u5e76\u4e14\u6b64\u51fd\u6570\u5fc5\u987b\u8fd4\u56de `SPH_UDF_VERSION`\uff08\u5b9a\u4e49\u5728 `sphinxudf.h` \u4e2d\uff09\u3002\u793a\u4f8b\u5982\u4e0b\u3002\n\nCODE_BLOCK_1\n\n\u6b64\u9884\u9632\u63aa\u65bd\u53ef\u907f\u514d\u60a8\u610f\u5916\u52a0\u8f7d\u4e0e `searchd` \u7684 UDF \u63a5\u53e3\u7248\u672c\u4e0d\u5339\u914d\u7684\u5e93\u3002\u4e0d\u8bba\u662f\u8f83\u65b0\u8fd8\u662f\u8f83\u65e7\u7248\u672c\u3002\u5176\u6b21\uff0c\u60a8**\u5fc5\u987b**\u5b9e\u73b0\u5b9e\u9645\u7684\u51fd\u6570\u3002\n\nCODE_BLOCK_2\n\nSQL \u4e2d\u7684 UDF \u51fd\u6570\u540d\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u3002\u4f46\u5bf9\u5e94\u7684 C \u51fd\u6570\u540d\u533a\u5206\u5927\u5c0f\u5199\uff1b\u5b83\u4eec\u5fc5\u987b\u5168\u90e8\u4e3a\u5c0f\u5199\uff0c\u5426\u5219 UDF \u5c06\u65e0\u6cd5\u52a0\u8f7d\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u4ee5\u4e0b\u51e0\u70b9\u81f3\u5173\u91cd\u8981\uff1a\n\n1. \u8c03\u7528\u7ea6\u5b9a\u5fc5\u987b\u662f C\uff08\u5373 __cdecl\uff09\uff0c\n2. \u53c2\u6570\u5217\u8868\u5fc5\u987b\u5b8c\u5168\u7b26\u5408\u63d2\u4ef6\u7cfb\u7edf\u7684\u671f\u671b\uff0c\n3. \u8fd4\u56de\u7c7b\u578b\u5fc5\u987b\u4e0e\u60a8\u5728 `CREATE FUNCTION` \u4e2d\u6307\u5b9a\u7684\u7c7b\u578b\u5339\u914d\u3002\n\n\u4e0d\u5e78\u7684\u662f\uff0c\u6211\u4eec\u65e0\u6cd5\uff08\u8f7b\u677e\u5730\uff09\u5728\u52a0\u8f7d\u51fd\u6570\u65f6\u68c0\u67e5\u8fd9\u4e9b\u9519\u8bef\uff0c\u5b83\u4eec\u53ef\u80fd\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u5d29\u6e83\u548c/\u6216\u4ea7\u751f\u610f\u5916\u7ed3\u679c\u3002\u6700\u540e\u4f46\u540c\u6837\u91cd\u8981\u7684\u662f\uff0c\u60a8\u5b9e\u73b0\u7684\u6240\u6709 C \u51fd\u6570\u90fd\u5fc5\u987b\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\n\n\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u662f\u6307\u5411 `SPH_UDF_INIT` \u7ed3\u6784\u7684\u6307\u9488\uff0c\u672c\u8d28\u4e0a\u662f\u6307\u5411\u6211\u4eec\u7684\u51fd\u6570\u72b6\u6001\u7684\u6307\u9488\u3002\u5b83\u662f\u53ef\u9009\u7684\u3002\u5c31\u5982\u4e0a\u9762\u793a\u4f8b\u4e2d\uff0c\u8be5\u51fd\u6570\u65e0\u72b6\u6001\uff0c\u6bcf\u6b21\u8c03\u7528\u90fd\u8fd4\u56de 123\u3002\u56e0\u6b64\u6211\u4eec\u4e0d\u9700\u8981\u5b9a\u4e49\u521d\u59cb\u5316\u51fd\u6570\uff0c\u53ef\u4ee5\u5ffd\u7565\u8be5\u53c2\u6570\u3002\n\u6b64\u53c2\u6570\u8fd8\u6709\u53e6\u4e00\u4e2a\u76ee\u7684\u3002\u7531\u4e8e\u5355\u4e2a\u67e5\u8be2\u53ef\u4ee5\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\uff08\u53c2\u89c1 [pseudo-sharding](../../Server_settings/Searchd.md#pseudo_sharding)\uff09\uff0c\u5b88\u62a4\u8fdb\u7a0b\u4f1a\u901a\u8fc7\u68c0\u67e5\u6b64\u53c2\u6570\u6765\u5224\u65ad\u4e00\u4e2a UDF \u662f\u6709\u72b6\u6001\u8fd8\u662f\u65e0\u72b6\u6001\u3002\u5982\u679c\u8be5\u53c2\u6570\u88ab\u521d\u59cb\u5316\uff0c\u5e73\u884c\u6267\u884c\u5c06\u88ab\u7981\u7528\u3002\u56e0\u6b64\uff0c\u5982\u679c\u60a8\u7684 UDF \u662f\u6709\u72b6\u6001\u7684\u4f46\u672a\u4f7f\u7528\u6b64\u53c2\u6570\uff0c\u5219\u5b83\u5c06\u7531\u591a\u4e2a\u7ebf\u7a0b\u8c03\u7528\uff0c\u60a8\u7684\u4ee3\u7801\u9700\u8981\u5bf9\u6b64\u6709\u6240\u610f\u8bc6\u3002\n\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u662f\u6307\u5411 `SPH_UDF_ARGS` \u7ed3\u6784\u7684\u6307\u9488\uff0c\u662f\u6700\u91cd\u8981\u7684\u53c2\u6570\u3002\u6240\u6709\u5b9e\u9645\u8c03\u7528\u53c2\u6570\u90fd\u901a\u8fc7\u6b64\u7ed3\u6784\u4f20\u9012\uff1b\u5b83\u5305\u542b\u8c03\u7528\u53c2\u6570\u7684\u6570\u91cf\u3001\u540d\u79f0\u3001\u7c7b\u578b\u7b49\u4fe1\u606f\u3002\u6240\u4ee5\u65e0\u8bba\u51fd\u6570\u662f\u4ee5 `SELECT id, testfunc(1)` \u8fd8\u662f `SELECT id, testfunc('abc', 1000*id+gid, WEIGHT())` \u6216\u5176\u4ed6\u8bed\u53e5\u8c03\u7528\uff0c\u5b83\u63a5\u6536\u5230\u7684\u90fd\u662f\u540c\u4e00\u4e2a `SPH_UDF_ARGS` \u7ed3\u6784\u3002\u4f46 `args` \u7ed3\u6784\u4e2d\u4f20\u9012\u7684\u6570\u636e\u4f1a\u4e0d\u540c\u3002\u5728\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u4e2d\uff0c`args->arg_count` \u88ab\u8bbe\u7f6e\u4e3a 1\uff1b\u5728\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u4e2d\u88ab\u8bbe\u7f6e\u4e3a 3\uff0c`args->arg_types` \u6570\u7ec4\u4f1a\u5305\u542b\u4e0d\u540c\u7684\u7c7b\u578b\u6570\u636e\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002\n\n\u6700\u540e\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u9519\u8bef\u6807\u5fd7\u3002UDF \u53ef\u8bbe\u7f6e\u6b64\u6807\u5fd7\u4ee5\u8868\u660e\u53d1\u751f\u67d0\u79cd\u5185\u90e8\u9519\u8bef\uff0cUDF \u65e0\u6cd5\u7ee7\u7eed\u6267\u884c\uff0c\u67e5\u8be2\u5e94\u63d0\u524d\u7ec8\u6b62\u3002\u60a8**\u4e0d\u5e94\u8be5**\u7528\u6b64\u6807\u5fd7\u8fdb\u884c\u53c2\u6570\u7c7b\u578b\u68c0\u67e5\u6216\u7528\u4e8e\u4efb\u4f55\u53ef\u80fd\u5728\u6b63\u5e38\u4f7f\u7528\u4e2d\u53d1\u751f\u7684\u9519\u8bef\u62a5\u544a\u3002\u8be5\u6807\u5fd7\u8bbe\u8ba1\u7528\u4e8e\u62a5\u544a\u7a81\u7136\u7684\u4e25\u91cd\u8fd0\u884c\u65f6\u9519\u8bef\uff0c\u4f8b\u5982\u5185\u5b58\u8017\u5c3d\u3002\n\n\u5982\u679c\u6211\u4eec\u60f3\u4e3a\u51fd\u6570\u5206\u914d\u4e34\u65f6\u5b58\u50a8\u533a\u6216\u9884\u5148\u68c0\u67e5\u53c2\u6570\u662f\u5426\u4e3a\u652f\u6301\u7684\u7c7b\u578b\uff0c\u5219\u9700\u8981\u6dfb\u52a0\u4e24\u4e2a\u989d\u5916\u51fd\u6570\uff0c\u5206\u522b\u7528\u4e8e UDF \u521d\u59cb\u5316\u548c\u53cd\u521d\u59cb\u5316\u3002",
            "russian": "# UDF\n\nUDF \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432\u043e \u0432\u043d\u0435\u0448\u043d\u0438\u0445 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0430\u0445 (.so \u0444\u0430\u0439\u043b\u044b \u0432 UNIX \u0438 .dll \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0430\u0445 Windows). \u0424\u0430\u0439\u043b\u044b \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u044b \u0432 \u0434\u043e\u0432\u0435\u0440\u0435\u043d\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0435, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0432 \u0434\u0438\u0440\u0435\u043a\u0442\u0438\u0432\u0435 [plugin_dir](../../Server_settings/Common.md#plugin_dir) \u043f\u043e \u0441\u043e\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438: \u043b\u0435\u0433\u0447\u0435 \u0437\u0430\u0449\u0438\u0442\u0438\u0442\u044c \u043e\u0434\u043d\u0443 \u043f\u0430\u043f\u043a\u0443, \u0447\u0435\u043c \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442\u044c \u043a\u043e\u043c\u0443 \u0443\u0433\u043e\u0434\u043d\u043e \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u0434 \u0432 `searchd`. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0438 \u0432\u044b\u0433\u0440\u0443\u0436\u0430\u0442\u044c UDF \u0432 searchd \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e SQL-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md) \u0438 [DROP FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Deleting_a_function.md) \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e. \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043c\u043e\u0436\u043d\u043e \u0431\u0435\u0441\u0448\u043e\u0432\u043d\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c UDF (\u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u043f\u043b\u0430\u0433\u0438\u043d\u044b) \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043a\u043e\u043c\u0430\u043d\u0434\u044b [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md). Manticore \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438; \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u0432\u044b \u0441\u043e\u0437\u0434\u0430\u0451\u0442\u0435 \u0438\u043b\u0438 \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0435 UDF, `searchd` \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0441\u0432\u043e\u0451 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0432 \u0444\u0430\u0439\u043b\u0435 [sphinxql_state](../../Server_settings/Searchd.md#sphinxql_state) \u0432 \u0432\u0438\u0434\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0433\u043e SQL-\u0441\u043a\u0440\u0438\u043f\u0442\u0430.\n\nUDF \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438. \u0427\u0442\u043e\u0431\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u0445 \u0432 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435, \u0432\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0440\u0430\u0437\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0443\u0437\u043b\u0430\u0445 \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c CREATE-\u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u043c \u0443\u0437\u043b\u0435. \u0412 \u0431\u0443\u0434\u0443\u0449\u0438\u0445 \u0432\u0435\u0440\u0441\u0438\u044f\u0445 \u044d\u0442\u043e\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043c\u043e\u0436\u0435\u0442 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c\u0441\u044f.\n\n\u041f\u043e\u0441\u043b\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0439 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 UDF, \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0451 \u0432 \u0441\u0432\u043e\u0438\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u0445 SELECT \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u0445 \u0442\u0430\u043a \u0436\u0435, \u043a\u0430\u043a \u0438 \u043b\u044e\u0431\u0443\u044e \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e:\n\nCODE_BLOCK_0\n\n\u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e UDF (\u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432) \u043c\u043e\u0433\u0443\u0442 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u0439 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0435. \u0411\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u0438 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0432\u044b\u0433\u0440\u0443\u0437\u0438\u0442\u0441\u044f, \u043a\u043e\u0433\u0434\u0430 \u0432\u0441\u0435 UDF \u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u0432 \u043d\u0435\u0439 \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043b\u0435\u043d\u044b.\n\n\u0412 \u0442\u0435\u043e\u0440\u0438\u0438, \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c UDF \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u044f\u0437\u044b\u043a\u0435, \u0435\u0441\u043b\u0438 \u0435\u0433\u043e \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440 \u043c\u043e\u0436\u0435\u0442 \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 C \u0438 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 \u0441 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c\u0438. \u041e\u0434\u043d\u0430\u043a\u043e \u043f\u0438\u0441\u0430\u0442\u044c \u043d\u0430 C++ \u0438\u043b\u0438 \u043f\u0440\u043e\u0441\u0442\u043e\u043c C \u2014 \u0441\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u0443\u0442\u044c. \u041c\u044b \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u043c \u043f\u0440\u0438\u043c\u0435\u0440 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 UDF, \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u043e\u0439 \u043d\u0430 \u043f\u0440\u043e\u0441\u0442\u043e\u043c C, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u0439 (\u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0438\u0440\u0443\u044f \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0435 \u0442\u0435\u0445\u043d\u0438\u043a\u0438) \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u043d\u0430\u0448\u0438\u043c \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u043c \u043a\u043e\u0434\u043e\u043c, \u043d\u0430\u0445\u043e\u0434\u044f\u0449\u0438\u043c\u0441\u044f \u043f\u043e \u0430\u0434\u0440\u0435\u0441\u0443 [src/udfexample.c](https://github.com/manticoresoftware/manticore/blob/master/src/udfexample.c). \u0412 \u0441\u0432\u043e\u0451\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0432\u043a\u043b\u044e\u0447\u0451\u043d \u0442\u0430\u043a\u0436\u0435 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b [src/sphinxudf.h](https://github.com/manticoresoftware/manticore/blob/master/src/sphinxudf.h), \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440 \u0438 \u0442\u0438\u043f\u043e\u0432, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u0441 UDF. \u0414\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u0430 UDF \u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c `#include \"sphinxudf.h\"`, \u043a\u0430\u043a \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u043e \u0432 \u043f\u0440\u0438\u043c\u0435\u0440\u0435. \u041e\u0434\u043d\u0430\u043a\u043e \u0435\u0441\u043b\u0438 \u0432\u044b \u043f\u0438\u0448\u0435\u0442\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0438\u0433\u043d\u0430\u043b\u043e\u0432 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (\u0444\u0430\u043a\u0442\u043e\u0440\u043e\u0432) \u0432\u043d\u0443\u0442\u0440\u0438 UDF, \u0432\u0430\u043c \u0442\u0430\u043a\u0436\u0435 \u043d\u0443\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0441\u043a\u043e\u043c\u043f\u0438\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u0441\u0432\u044f\u0437\u0430\u0442\u044c \u0441 `src/sphinxudf.c` (\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u043c \u0432 \u043d\u0430\u0448\u0435\u043c \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u043c \u043a\u043e\u0434\u0435), \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 *\u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438* \u0444\u0443\u043d\u043a\u0446\u0438\u0439, \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0449\u0438\u0445 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0434\u0430\u043d\u043d\u044b\u043c \u0441\u0438\u0433\u043d\u0430\u043b\u043e\u0432 \u0438\u0437 UDF, \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 \u044d\u0442\u043e\u043c \u0444\u0430\u0439\u043b\u0435.\n\n\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b `sphinxudf.h` \u0438 `sphinxudf.c` \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u043d\u043e\u043c\u043d\u044b\u043c\u0438, \u0442\u0430\u043a \u0447\u0442\u043e \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u0438 \u0444\u0430\u0439\u043b\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e; \u043e\u043d\u0438 \u043d\u0435 \u0437\u0430\u0432\u0438\u0441\u044f\u0442 \u043e\u0442 \u0434\u0440\u0443\u0433\u0438\u0445 \u0447\u0430\u0441\u0442\u0435\u0439 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u043a\u043e\u0434\u0430 Manticore.\n\n\u0412\u043d\u0443\u0442\u0440\u0438 \u0432\u0430\u0448\u0435\u0439 UDF \u0432\u044b **\u0434\u043e\u043b\u0436\u043d\u044b** \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0438 \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0430\u0440\u0443 \u0444\u0443\u043d\u043a\u0446\u0438\u0439. \u0412\u043e-\u043f\u0435\u0440\u0432\u044b\u0445, \u0434\u043b\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044f \u0432\u0435\u0440\u0441\u0438\u0438 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 UDF \u0432\u044b **\u0434\u043e\u043b\u0436\u043d\u044b** \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e `int LIBRARYNAME_ver()`, \u0433\u0434\u0435 LIBRARYNAME \u2014 \u044d\u0442\u043e \u0438\u043c\u044f \u0432\u0430\u0448\u0435\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438, \u0438 \u043e\u043d\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c `SPH_UDF_VERSION` (\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0435 \u0432 `sphinxudf.h`). \u0412\u043e\u0442 \u043f\u0440\u0438\u043c\u0435\u0440.\n\nCODE_BLOCK_1\n\n\u042d\u0442\u0430 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u043e\u0440\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0437\u0430\u0449\u0438\u0449\u0430\u0435\u0442 \u0432\u0430\u0441 \u043e\u0442 \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u043e\u0439 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 \u0441 \u043d\u0435\u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0449\u0435\u0439 \u0432\u0435\u0440\u0441\u0438\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 UDF \u0432 \u0431\u043e\u043b\u0435\u0435 \u043d\u043e\u0432\u044b\u0439 \u0438\u043b\u0438 \u0431\u043e\u043b\u0435\u0435 \u0441\u0442\u0430\u0440\u044b\u0439 `searchd`. \u0412\u043e-\u0432\u0442\u043e\u0440\u044b\u0445, \u0432\u044b **\u0434\u043e\u043b\u0436\u043d\u044b** \u0442\u0430\u043a\u0436\u0435 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0430\u043c\u0443 \u0444\u0443\u043d\u043a\u0446\u0438\u044e.\n\nCODE_BLOCK_2\n\n\u0418\u043c\u0435\u043d\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 UDF \u0432 SQL \u043d\u0435\u0447\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b \u043a \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0443. \u041e\u0434\u043d\u0430\u043a\u043e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 C-\u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0432 \u043d\u0438\u0436\u043d\u0435\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0435, \u0438\u043d\u0430\u0447\u0435 UDF \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0441\u044f. \u0411\u043e\u043b\u0435\u0435 \u0442\u043e\u0433\u043e, \u043a\u0440\u0430\u0439\u043d\u0435 \u0432\u0430\u0436\u043d\u043e, \u0447\u0442\u043e\u0431\u044b:\n\n1. \u0441\u043e\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435 \u043e \u0432\u044b\u0437\u043e\u0432\u0435 \u0431\u044b\u043b\u043e C (aka __cdecl),\n2. \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0442\u043e\u0447\u043d\u043e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u043b \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f\u043c \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432, \u0438\n3. \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0439 \u0442\u0438\u043f \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u043b \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u0432 `CREATE FUNCTION`.\n\n\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, (\u043b\u0435\u0433\u043a\u043e) \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u044d\u0442\u0438 \u043e\u0448\u0438\u0431\u043a\u0438 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043d\u0435\u043b\u044c\u0437\u044f, \u0438 \u043e\u043d\u0438 \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u043a \u043f\u0430\u0434\u0435\u043d\u0438\u044e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438/\u0438\u043b\u0438 \u043d\u0435\u043f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u044b\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430\u043c. \u0418 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435, \u0432\u0441\u0435 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0432\u0430\u043c\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043d\u0430 C \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u043f\u043e\u0442\u043e\u043a\u043e\u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u043c\u0438.\n\n\u041f\u0435\u0440\u0432\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u2014 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043d\u0430 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_INIT` \u2014 \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043d\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043d\u0430\u0448\u0435\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438. \u041e\u043d \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u0435\u043d. \u0412 \u043f\u0440\u0438\u0432\u0435\u0434\u0451\u043d\u043d\u043e\u043c \u0432\u044b\u0448\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043d\u0435 \u0445\u0440\u0430\u043d\u0438\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u0442\u0430\u043a \u043a\u0430\u043a \u043f\u0440\u043e\u0441\u0442\u043e \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 123. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u043c\u044b \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438, \u0438 \u043c\u043e\u0436\u0435\u043c \u043f\u0440\u043e\u0441\u0442\u043e \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u043e\u0442 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442.\n\u042d\u0442\u043e\u0442 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0441\u043b\u0443\u0436\u0438\u0442 \u0438 \u0435\u0449\u0451 \u043e\u0434\u043d\u043e\u0439 \u0446\u0435\u043b\u0438. \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c\u0441\u044f \u0432 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043f\u043e\u0442\u043e\u043a\u0430\u0445 (\u0441\u043c. [pseudo-sharding](../../Server_settings/Searchd.md#pseudo_sharding)), \u0434\u0435\u043c\u043e\u043d \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043b\u0438 UDF \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044e\u0449\u0435\u0439 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u043b\u0438 \u043d\u0435\u0442, \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u044f \u044d\u0442\u043e\u0442 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d, \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0431\u0443\u0434\u0435\u0442 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e. \u0422\u0430\u043a \u0447\u0442\u043e \u0435\u0441\u043b\u0438 \u0432\u0430\u0448\u0430 UDF \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043d\u043e \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u044d\u0442\u043e\u0442 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442, \u043e\u043d\u0430 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u0432\u0430\u043d\u0430 \u0438\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432, \u0438 \u0432\u0430\u0448 \u043a\u043e\u0434 \u0434\u043e\u043b\u0436\u0435\u043d \u044d\u0442\u043e \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c.\n\n\u0412\u0442\u043e\u0440\u043e\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u2014 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043d\u0430 `SPH_UDF_ARGS` \u2014 \u0441\u0430\u043c\u044b\u0439 \u0432\u0430\u0436\u043d\u044b\u0439. \u0412\u0441\u0435 \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b \u0432\u044b\u0437\u043e\u0432\u0430 \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u0432 \u0432\u0430\u0448\u0443 UDF \u0447\u0435\u0440\u0435\u0437 \u044d\u0442\u0443 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443; \u043e\u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u0438\u043c\u0435\u043d\u0430, \u0442\u0438\u043f\u044b \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435. \u0417\u043d\u0430\u0447\u0438\u0442, \u0431\u0443\u0434\u044c \u0432\u044b\u0437\u043e\u0432 \u0442\u0438\u043f\u0430 `SELECT id, testfunc(1)` \u0438\u043b\u0438 `SELECT id, testfunc('abc', 1000*id+gid, WEIGHT())` \u0438\u043b\u0438 \u043b\u044e\u0431\u043e\u0439 \u0434\u0440\u0443\u0433\u043e\u0439, UDF \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_ARGS`. \u041e\u0434\u043d\u0430\u043a\u043e \u0434\u0430\u043d\u043d\u044b\u0435, \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u044b\u0435 \u0432 `args`, \u0431\u0443\u0434\u0443\u0442 \u0440\u0430\u0437\u043b\u0438\u0447\u0430\u0442\u044c\u0441\u044f. \u0412 \u043f\u0435\u0440\u0432\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 `args->arg_count` \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u043d\u043e 1, \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c \u2014 3, \u043c\u0430\u0441\u0441\u0438\u0432 `args->arg_types` \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u0438\u043f\u044b \u0440\u0430\u0437\u043d\u044b\u0445 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0438 \u0442. \u0434.\n\n\u041d\u0430\u043a\u043e\u043d\u0435\u0446, \u0442\u0440\u0435\u0442\u0438\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u2014 \u044d\u0442\u043e \u0444\u043b\u0430\u0433 \u043e\u0448\u0438\u0431\u043a\u0438. UDF \u043c\u043e\u0436\u0435\u0442 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0435\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u0443\u043a\u0430\u0437\u0430\u0442\u044c, \u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044f\u044f \u043e\u0448\u0438\u0431\u043a\u0430, UDF \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443, \u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c\u0441\u044f \u043f\u0440\u0435\u0436\u0434\u0435\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e. \u0412\u044b **\u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u044b** \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u043e\u0442 \u0444\u043b\u0430\u0433 \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0442\u0438\u043f\u043e\u0432 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u043e\u0448\u0438\u0431\u043e\u043a, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0442\u044c \u043f\u0440\u0438 \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438. \u042d\u0442\u043e\u0442 \u0444\u043b\u0430\u0433 \u043f\u0440\u0435\u0434\u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d \u0434\u043b\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e \u0432\u043d\u0435\u0437\u0430\u043f\u043d\u044b\u0445 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043e\u0448\u0438\u0431\u043a\u0430\u0445 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0438\u0441\u0447\u0435\u0440\u043f\u0430\u043d\u0438\u0438 \u043f\u0430\u043c\u044f\u0442\u0438.\n\n\u0415\u0441\u043b\u0438 \u0431\u044b \u043c\u044b \u0445\u043e\u0442\u0435\u043b\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u0435\u0439, \u0438\u043b\u0438 \u0437\u0430\u0440\u0430\u043d\u0435\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u043b\u0438 \u0442\u0438\u043f\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u043d\u0430\u043c \u043f\u0440\u0438\u0448\u043b\u043e\u0441\u044c \u0431\u044b \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0435\u0449\u0451 \u0434\u0432\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u2014 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0434\u0435\u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 UDF \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e."
        },
        "is_code_or_comment": false,
        "model": "openai:gpt-4.1-mini",
        "updated_at": 1766339860
    },
    "18d70abe042653fc9c17607f8ee1c1a1f45c633bb6f79aa4dc27b32c051901f7": {
        "original": "CODE_BLOCK_3\n\nNote how `testfunc_init()` also receives the call arguments structure. By the time it is called, it does not receive any actual values, so the `args->arg_values` will be NULL. But the argument names and types are known and will be passed. You can check them in the initialization function and return an error if they are of an unsupported type.\n\n## SPH_UDF_ARGS types\n\nUDFs can receive arguments of pretty much any valid internal Manticore type. Refer to the `sphinx_udf_argtype` enumeration in `sphinxudf.h` for a full list. Most of the types map straightforwardly to the respective C types.\n\nThe most notable type is the `SPH_UDF_TYPE_FACTORS` argument type. You get that type by calling your UDF with a [PACKEDFACTOR()](../../Functions/Searching_and_ranking_functions#PACKEDFACTORS()) argument. Its data is a binary blob in a certain internal format, and to extract individual ranking signals from that blob, you need to use either of the two `sphinx_factors_XXX()` or `sphinx_get_YYY_factor()` families of functions.\n\n### sphinx_factors_XXX() functions\n\nThis family consists of 3 functions.\n\n* `sphinx_factors_init()` initializes the unpacked `SPH_UDF_FACTORS` structure\n* `sphinx_factors_unpack()` unpacks a binary blob into `SPH_UDF_FACTORS` structure\n* `sphinx_factors_deinit()` cleans up and deallocates the `SPH_UDF_FACTORS`.\n\nFirst, you need to call `init()` and `unpack()`, then you can use the `SPH_UDF_FACTORS` fields, and finally, you need to clean up with `deinit()`.\n\nThis approach is simple but may result in a bunch of memory allocations for each processed document, which could be slow.\n\n### sphinx_get_YYY_factor() functions\n\nThe other interface, consisting of a bunch of `sphinx_get_YYY_factor()` functions, is a bit more verbose to use but accesses the blob data directly and guarantees no allocations. For top-notch ranking UDF performance, you'll want to use this approach.\n\n## Return types of UDF\n\nAs for the return types, UDFs can currently return a single INTEGER, BIGINT, FLOAT, or STRING value. The C function return type should be `sphinx_int64_t`, `sphinx_int64_t`, `double`, or `char*` respectively. In the last case, you **must** use the `args->fn_malloc` function to allocate space for returned string values. Internally in your UDF, you can use whatever you want, so the `testfunc_init()` example above is correct code even though it uses malloc() directly: you manage that pointer yourself, it gets freed up using a matching free() call, and all is well. However, the returned strings values are managed by Manticore, and we have our own allocator, so for the return values specifically, you need to use it too.\n\nDepending on how your UDFs are used in the query, the main function call (`testfunc()` in our example) might be called in a rather different volume and order. Specifically,\n\n* UDFs referenced in WHERE, ORDER BY, or GROUP BY clauses must and will be evaluated for every matched document. They will be called in the natural matching order.\n* without subselects, UDFs that can be evaluated at the very last stage over the final result set will be evaluated that way, but before applying the `LIMIT` clause. They will be called in the result set order.\n* with subselects, such UDFs will also be evaluated after applying the inner `LIMIT` clause.\n\nThe calling sequence of the other functions is fixed, though. Namely,\n\n* `testfunc_init()` is called once when initializing the query. It can return a non-zero code to indicate a failure; in that case, the query will be terminated, and the error message from the `error_message` buffer will be returned.\n* `testfunc()` is called for every eligible row (see above), whenever Manticore needs to compute the UDF value. It can also indicate an (internal) failure error by writing a non-zero byte value to `error_flag`. In that case, it is guaranteed that it will not be called for subsequent rows, and a default return value of 0 will be substituted. Manticore might or might not choose to terminate such queries early; neither behavior is currently guaranteed.\n* `testfunc_deinit()` is called once when the query processing (in a given table shard) ends.\n\n<!-- proofread -->\n\n",
        "translations": {
            "chinese": "CODE_BLOCK_3\n\n\u6ce8\u610f `testfunc_init()` \u4e5f\u63a5\u6536\u8c03\u7528\u53c2\u6570\u7ed3\u6784\u3002\u5728\u8c03\u7528\u65f6\uff0c\u5b83\u4e0d\u4f1a\u63a5\u6536\u4efb\u4f55\u5b9e\u9645\u503c\uff0c\u56e0\u6b64 `args->arg_values` \u5c06\u4e3a NULL\u3002\u4f46\u662f\uff0c\u53c2\u6570\u540d\u79f0\u548c\u7c7b\u578b\u662f\u5df2\u77e5\u7684\uff0c\u5e76\u4f1a\u88ab\u4f20\u9012\u3002\u4f60\u53ef\u4ee5\u5728\u521d\u59cb\u5316\u51fd\u6570\u4e2d\u68c0\u67e5\u5b83\u4eec\uff0c\u5982\u679c\u5b83\u4eec\u662f\u4e0d\u652f\u6301\u7684\u7c7b\u578b\uff0c\u5219\u8fd4\u56de\u9519\u8bef\u3002\n\n## SPH_UDF_ARGS \u7c7b\u578b\n\nUDFs \u53ef\u4ee5\u63a5\u6536\u51e0\u4e4e\u4efb\u4f55\u6709\u6548\u7684\u5185\u90e8 Manticore \u7c7b\u578b\u7684\u53c2\u6570\u3002\u53c2\u89c1 `sphinx_udf_argtype` \u679a\u4e3e\u5728 `sphinxudf.h` \u4e2d\u7684\u5b8c\u6574\u5217\u8868\u3002\u5927\u591a\u6570\u7c7b\u578b\u90fd\u76f4\u63a5\u6620\u5c04\u5230\u76f8\u5e94\u7684 C \u7c7b\u578b\u3002\n\n\u6700\u503c\u5f97\u6ce8\u610f\u7684\u7c7b\u578b\u662f `SPH_UDF_TYPE_FACTORS` \u53c2\u6570\u7c7b\u578b\u3002\u5f53\u4f60\u7528 [PACKEDFACTOR()](../../Functions/Searching_and_ranking_functions#PACKEDFACTORS()) \u53c2\u6570\u8c03\u7528 UDF \u65f6\uff0c\u4f60\u4f1a\u5f97\u5230\u8fd9\u79cd\u7c7b\u578b\u3002\u5b83\u7684\u6570\u636e\u662f\u4ee5\u67d0\u79cd\u5185\u90e8\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u5757\uff0c\u8981\u4ece\u4e2d\u63d0\u53d6\u5355\u72ec\u7684\u6392\u540d\u4fe1\u53f7\uff0c\u4f60\u9700\u8981\u4f7f\u7528 `sphinx_factors_XXX()` \u6216 `sphinx_get_YYY_factor()` \u5bb6\u65cf\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u51fd\u6570\u3002\n\n### sphinx_factors_XXX() \u51fd\u6570\n\n\u8fd9\u4e2a\u5bb6\u65cf\u7531 3 \u4e2a\u51fd\u6570\u7ec4\u6210\u3002\n\n* `sphinx_factors_init()` \u521d\u59cb\u5316\u672a\u6253\u5305\u7684 `SPH_UDF_FACTORS` \u7ed3\u6784\n* `sphinx_factors_unpack()` \u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u5757\u89e3\u5305\u5230 `SPH_UDF_FACTORS` \u7ed3\u6784\n* `sphinx_factors_deinit()` \u6e05\u7406\u5e76\u91ca\u653e `SPH_UDF_FACTORS`\u3002\n\n\u9996\u5148\uff0c\u4f60\u9700\u8981\u8c03\u7528 `init()` \u548c `unpack()`\uff0c\u7136\u540e\u4f60\u53ef\u4ee5\u4f7f\u7528 `SPH_UDF_FACTORS` \u5b57\u6bb5\uff0c\u6700\u540e\uff0c\u4f60\u9700\u8981\u8c03\u7528 `deinit()` \u8fdb\u884c\u6e05\u7406\u3002\n\n\u8fd9\u79cd\u65b9\u6cd5\u7b80\u5355\u4f46\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6bcf\u4e2a\u5904\u7406\u6587\u6863\u90fd\u4ea7\u751f\u5927\u91cf\u5185\u5b58\u5206\u914d\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f88\u6162\u3002\n\n### sphinx_get_YYY_factor() \u51fd\u6570\n\n\u53e6\u4e00\u79cd\u63a5\u53e3\uff0c\u7531\u591a\u4e2a `sphinx_get_YYY_factor()` \u51fd\u6570\u7ec4\u6210\uff0c\u4f7f\u7528\u8d77\u6765\u7a0d\u5fae\u7e41\u7410\u4e00\u4e9b\uff0c\u4f46\u5b83\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5757\uff0c\u5e76\u4fdd\u8bc1\u4e0d\u4f1a\u8fdb\u884c\u5206\u914d\u3002\u4e3a\u4e86\u83b7\u5f97\u9876\u7ea7\u6392\u540d UDF \u7684\u6700\u4f73\u6027\u80fd\uff0c\u4f60\u5c06\u5e0c\u671b\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u3002\n\n## UDF \u7684\u8fd4\u56de\u7c7b\u578b\n\n\u81f3\u4e8e\u8fd4\u56de\u7c7b\u578b\uff0cUDFs \u76ee\u524d\u53ef\u4ee5\u8fd4\u56de\u5355\u4e2a INTEGER\u3001BIGINT\u3001FLOAT \u6216 STRING \u503c\u3002C \u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u5e94\u5206\u522b\u4e3a `sphinx_int64_t`\u3001`sphinx_int64_t`\u3001`double` \u6216 `char*`\u3002\u5728\u6700\u540e\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60 **\u5fc5\u987b** \u4f7f\u7528 `args->fn_malloc` \u51fd\u6570\u4e3a\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u503c\u5206\u914d\u7a7a\u95f4\u3002\u5728\u4f60\u7684 UDF \u5185\u90e8\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u4f60\u60f3\u8981\u7684\uff0c\u56e0\u6b64\u4e0a\u9762\u7684 `testfunc_init()` \u793a\u4f8b\u662f\u6b63\u786e\u7684\u4ee3\u7801\uff0c\u5373\u4f7f\u5b83\u76f4\u63a5\u4f7f\u7528\u4e86 malloc()\uff1a\u4f60\u81ea\u884c\u7ba1\u7406\u90a3\u4e2a\u6307\u9488\uff0c\u5b83\u4f1a\u5728\u5339\u914d\u7684 free() \u8c03\u7528\u4e2d\u88ab\u91ca\u653e\uff0c\u4e00\u5207\u90fd\u5f88\u987a\u5229\u3002\u4f46\u662f\uff0c\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u503c\u7531 Manticore \u7ba1\u7406\uff0c\u6211\u4eec\u6709\u81ea\u5df1\u7684\u5206\u914d\u5668\uff0c\u56e0\u6b64\u5bf9\u4e8e\u8fd4\u56de\u503c\uff0c\u4f60\u9700\u8981\u4f7f\u7528\u5b83\u3002\n\n\u6839\u636e\u4f60\u7684 UDF \u5728\u67e5\u8be2\u4e2d\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u4e3b\u8981\u51fd\u6570\u8c03\u7528\uff08\u4f8b\u5982\u6211\u4eec\u793a\u4f8b\u4e2d\u7684 `testfunc()`\uff09\u53ef\u80fd\u4f1a\u4ee5\u4e0d\u540c\u7684\u6570\u91cf\u548c\u987a\u5e8f\u88ab\u8c03\u7528\u3002\u5177\u4f53\u6765\u8bf4\uff0c\n\n* \u5728 WHERE\u3001ORDER BY \u6216 GROUP BY \u5b50\u53e5\u4e2d\u5f15\u7528\u7684 UDF \u5fc5\u987b\u5e76\u4e14\u4f1a\u88ab\u4e3a\u6bcf\u4e2a\u5339\u914d\u7684\u6587\u6863\u8bc4\u4f30\u3002\u5b83\u4eec\u5c06\u4ee5\u81ea\u7136\u5339\u914d\u987a\u5e8f\u88ab\u8c03\u7528\u3002\n* \u6ca1\u6709\u5b50\u67e5\u8be2\u65f6\uff0c\u53ef\u4ee5\u5728\u6700\u7ec8\u7ed3\u679c\u96c6\u7684\u6700\u540e\u4e00\u4e2a\u9636\u6bb5\u8bc4\u4f30 UDF\uff0c\u4f46\u5728\u5e94\u7528 `LIMIT` \u5b50\u53e5\u4e4b\u524d\u3002\u5b83\u4eec\u5c06\u4ee5\u7ed3\u679c\u96c6\u987a\u5e8f\u88ab\u8c03\u7528\u3002\n* \u6709\u5b50\u67e5\u8be2\u65f6\uff0c\u8fd9\u6837\u7684 UDF \u4e5f\u4f1a\u5728\u5e94\u7528\u5185\u90e8\u7684 `LIMIT` \u5b50\u53e5\u4e4b\u540e\u8fdb\u884c\u8bc4\u4f30\u3002\n\n\u5176\u4ed6\u51fd\u6570\u7684\u8c03\u7528\u987a\u5e8f\u662f\u56fa\u5b9a\u7684\u3002\u5177\u4f53\u6765\u8bf4\uff0c\n\n* `testfunc_init()` \u5728\u521d\u59cb\u5316\u67e5\u8be2\u65f6\u88ab\u8c03\u7528\u4e00\u6b21\u3002\u5b83\u53ef\u4ee5\u8fd4\u56de\u975e\u96f6\u4ee3\u7801\u4ee5\u6307\u793a\u5931\u8d25\uff1b\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u67e5\u8be2\u5c06\u7ec8\u6b62\uff0c\u5e76\u8fd4\u56de `error_message` \u7f13\u51b2\u533a\u4e2d\u7684\u9519\u8bef\u6d88\u606f\u3002\n* `testfunc()` \u4e3a\u6bcf\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u884c\uff08\u89c1\u4e0a\u6587\uff09\u88ab\u8c03\u7528\uff0c\u6bcf\u5f53 Manticore \u9700\u8981\u8ba1\u7b97 UDF \u503c\u65f6\u3002\u5b83\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5c06\u975e\u96f6\u5b57\u8282\u503c\u5199\u5165 `error_flag` \u6765\u6307\u793a\uff08\u5185\u90e8\uff09\u5931\u8d25\u9519\u8bef\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u5c06\u4e0d\u4f1a\u88ab\u8c03\u7528\u540e\u7eed\u884c\uff0c\u5e76\u5c06\u4f7f\u7528\u9ed8\u8ba4\u8fd4\u56de\u503c 0\u3002Manticore \u53ef\u80fd\u6216\u53ef\u80fd\u4e0d\u4f1a\u9009\u62e9\u63d0\u524d\u7ec8\u6b62\u6b64\u7c7b\u67e5\u8be2\uff1b\u76ee\u524d\u6ca1\u6709\u4fdd\u8bc1\u8fd9\u79cd\u884c\u4e3a\u3002\n* `testfunc_deinit()` \u5728\u67e5\u8be2\u5904\u7406\uff08\u5728\u7ed9\u5b9a\u8868\u5206\u7247\u4e2d\uff09\u7ed3\u675f\u65f6\u88ab\u8c03\u7528\u4e00\u6b21\u3002\n\n<!-- \u8bf7\u6821\u5bf9 -->",
            "russian": "CODE_BLOCK_3\n\n\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e `testfunc_init()` \u0442\u0430\u043a\u0436\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0432\u044b\u0437\u043e\u0432\u0430. \u041a \u043c\u043e\u043c\u0435\u043d\u0442\u0443 \u0435\u0451 \u0432\u044b\u0437\u043e\u0432\u0430 \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0435\u0449\u0451 \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u044b, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 `args->arg_values` \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u0435\u043d NULL. \u041e\u0434\u043d\u0430\u043a\u043e \u0438\u043c\u0435\u043d\u0430 \u0438 \u0442\u0438\u043f\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0443\u0436\u0435 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b \u0438 \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u044b. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0438\u0445 \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0443, \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0438\u043c\u0435\u044e\u0442 \u043d\u0435\u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0439 \u0442\u0438\u043f.\n\n## \u0422\u0438\u043f\u044b SPH_UDF_ARGS\n\nUDF \u043c\u043e\u0433\u0443\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043b\u044e\u0431\u043e\u0433\u043e \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0433\u043e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u0442\u0438\u043f\u0430 Manticore. \u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u0432 \u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0438 `sphinx_udf_argtype` \u0432 \u0444\u0430\u0439\u043b\u0435 `sphinxudf.h`. \u0411\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u0442\u0438\u043f\u043e\u0432 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c \u0442\u0438\u043f\u0430\u043c C.\n\n\u041d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u0438\u043c\u0435\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0442\u0438\u043f\u043e\u043c \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0442\u0438\u043f \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 `SPH_UDF_TYPE_FACTORS`. \u0412\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 \u044d\u0442\u043e\u0442 \u0442\u0438\u043f, \u0432\u044b\u0437\u044b\u0432\u0430\u044f \u0432\u0430\u0448\u0443 UDF \u0441 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u043c [PACKEDFACTOR()](../../Functions/Searching_and_ranking_functions#PACKEDFACTORS()). \u0415\u0433\u043e \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u0441\u043e\u0431\u043e\u0439 \u0431\u0438\u043d\u0430\u0440\u043d\u044b\u0439 \u0431\u043b\u043e\u043a \u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u043c \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435, \u0438 \u0434\u043b\u044f \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u044f \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0445 \u0441\u0438\u0433\u043d\u0430\u043b\u043e\u0432 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u0431\u043b\u043e\u043a\u0430 \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u043d\u0443 \u0438\u0437 \u0434\u0432\u0443\u0445 \u0441\u0435\u043c\u0435\u0439\u0441\u0442\u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0439: `sphinx_factors_XXX()` \u0438\u043b\u0438 `sphinx_get_YYY_factor()`.\n\n### \u0424\u0443\u043d\u043a\u0446\u0438\u0438 sphinx_factors_XXX()\n\n\u042d\u0442\u043e \u0441\u0435\u043c\u0435\u0439\u0441\u0442\u0432\u043e \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u0438\u0437 3 \u0444\u0443\u043d\u043a\u0446\u0438\u0439.\n\n* `sphinx_factors_init()` \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_FACTORS`\n* `sphinx_factors_unpack()` \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u044b\u0432\u0430\u0435\u0442 \u0431\u0438\u043d\u0430\u0440\u043d\u044b\u0439 \u0431\u043b\u043e\u043a \u0432 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_FACTORS`\n* `sphinx_factors_deinit()` \u043e\u0447\u0438\u0449\u0430\u0435\u0442 \u0438 \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0430\u0435\u0442 \u043f\u0430\u043c\u044f\u0442\u044c \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b `SPH_UDF_FACTORS`.\n\n\u0421\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u0437\u0432\u0430\u0442\u044c `init()` \u0438 `unpack()`, \u0437\u0430\u0442\u0435\u043c \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u043b\u044f `SPH_UDF_FACTORS`, \u0438, \u043d\u0430\u043a\u043e\u043d\u0435\u0446, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043e\u0447\u0438\u0441\u0442\u043a\u0443 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e `deinit()`.\n\n\u042d\u0442\u043e\u0442 \u043f\u043e\u0434\u0445\u043e\u0434 \u043f\u0440\u043e\u0441\u0442, \u043d\u043e \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442\u044c \u043a \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0443 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043f\u0430\u043c\u044f\u0442\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u043c\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430, \u0447\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u043c.\n\n### \u0424\u0443\u043d\u043a\u0446\u0438\u0438 sphinx_get_YYY_factor()\n\n\u0414\u0440\u0443\u0433\u043e\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441, \u0441\u043e\u0441\u0442\u043e\u044f\u0449\u0438\u0439 \u0438\u0437 \u043d\u0430\u0431\u043e\u0440\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 `sphinx_get_YYY_factor()`, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u0431\u043e\u043b\u0435\u0435 \u043c\u043d\u043e\u0433\u043e\u0441\u043b\u043e\u0432\u043d\u043e, \u043d\u043e \u043e\u043d \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043a \u0434\u0430\u043d\u043d\u044b\u043c \u0431\u043b\u043e\u043a\u0430 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0438 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043f\u0430\u043c\u044f\u0442\u0438. \u0414\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 UDF \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432\u0430\u043c \u0441\u043b\u0435\u0434\u0443\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u043e\u0442 \u043f\u043e\u0434\u0445\u043e\u0434.\n\n## \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0442\u0438\u043f\u044b UDF\n\n\u0427\u0442\u043e \u043a\u0430\u0441\u0430\u0435\u0442\u0441\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0445 \u0442\u0438\u043f\u043e\u0432, UDF \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u043c\u043e\u0433\u0443\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0438\u043f\u0430 INTEGER, BIGINT, FLOAT \u0438\u043b\u0438 STRING. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0442\u0438\u043f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f C-\u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c `sphinx_int64_t`, `sphinx_int64_t`, `double` \u0438\u043b\u0438 `char*`. \u0412 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0432\u044b **\u043e\u0431\u044f\u0437\u0430\u043d\u044b** \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e `args->fn_malloc` \u0434\u043b\u044f \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u043e\u0434 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f. \u0412\u043d\u0443\u0442\u0440\u0438 \u0432\u0430\u0448\u0435\u0439 UDF \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0447\u0442\u043e \u0443\u0433\u043e\u0434\u043d\u043e, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u0438\u043c\u0435\u0440 `testfunc_init()` \u0432\u044b\u0448\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u043c \u043a\u043e\u0434\u043e\u043c, \u0434\u0430\u0436\u0435 \u043d\u0435\u0441\u043c\u043e\u0442\u0440\u044f \u043d\u0430 \u043f\u0440\u044f\u043c\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 malloc(): \u0432\u044b \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0435 \u044d\u0442\u0438\u043c \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e, \u043e\u043d \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0430\u0435\u0442\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430 free(), \u0438 \u0432\u0441\u0451 \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f Manticore, \u0438 \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0430\u043b\u043b\u043e\u043a\u0430\u0442\u043e\u0440, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0438\u043c\u0435\u043d\u043d\u043e \u0434\u043b\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0432\u0430\u043c \u0442\u0430\u043a\u0436\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0433\u043e.\n\n\u0412 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0432\u0430\u0448\u0438 UDF \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0435, \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0432\u044b\u0437\u043e\u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 (`testfunc()` \u0432 \u043d\u0430\u0448\u0435\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435) \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0440\u0430\u0437\u043d\u043e\u043c \u043e\u0431\u044a\u0451\u043c\u0435 \u0438 \u043f\u043e\u0440\u044f\u0434\u043a\u0435. \u0410 \u0438\u043c\u0435\u043d\u043d\u043e:\n\n* UDF, \u0443\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0435 \u0432 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u0445 WHERE, ORDER BY \u0438\u043b\u0438 GROUP BY, \u0434\u043e\u043b\u0436\u043d\u044b \u0438 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430. \u041e\u043d\u0438 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0435\u0441\u0442\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f.\n* \u0431\u0435\u0437 \u043f\u043e\u0434\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432, UDF, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u044b \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u044d\u0442\u0430\u043f\u0435 \u043d\u0430\u0434 \u043e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u043d\u0430\u0431\u043e\u0440\u043e\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432, \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u044b \u0438\u043c\u0435\u043d\u043d\u043e \u0442\u0430\u043a, \u043d\u043e \u0434\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f `LIMIT`. \u041e\u043d\u0438 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043d\u0430\u0431\u043e\u0440\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432.\n* \u0441 \u043f\u043e\u0434\u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c\u0438, \u0442\u0430\u043a\u0438\u0435 UDF \u0442\u0430\u043a\u0436\u0435 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u044b \u043f\u043e\u0441\u043b\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f `LIMIT`.\n\n\u041e\u0434\u043d\u0430\u043a\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0432\u044b\u0437\u043e\u0432\u0430 \u0434\u0440\u0443\u0433\u0438\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0430. \u0410 \u0438\u043c\u0435\u043d\u043d\u043e:\n\n* `testfunc_init()` \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u043f\u0440\u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430. \u041e\u043d\u0430 \u043c\u043e\u0436\u0435\u0442 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043d\u0435\u043d\u0443\u043b\u0435\u0432\u043e\u0439 \u043a\u043e\u0434 \u0434\u043b\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u043d\u0430 \u043e\u0448\u0438\u0431\u043a\u0443; \u0432 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0435\u0440\u0432\u0430\u043d, \u0438 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435 \u0438\u0437 \u0431\u0443\u0444\u0435\u0440\u0430 `error_message`.\n* `testfunc()` \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 (\u0441\u043c. \u0432\u044b\u0448\u0435), \u043a\u043e\u0433\u0434\u0430 Manticore \u043d\u0443\u0436\u0434\u0430\u0435\u0442\u0441\u044f \u0432 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f UDF. \u041e\u043d\u0430 \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u0435\u0442 \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430 (\u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044e\u044e) \u043e\u0448\u0438\u0431\u043a\u0443, \u0437\u0430\u043f\u0438\u0441\u0430\u0432 \u043d\u0435\u043d\u0443\u043b\u0435\u0432\u043e\u0435 \u0431\u0430\u0439\u0442\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432 `error_flag`. \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0441\u0442\u0440\u043e\u043a, \u0438 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e, \u0440\u0430\u0432\u043d\u043e\u0435 0. Manticore \u043c\u043e\u0436\u0435\u0442 \u043a\u0430\u043a \u043f\u0440\u0435\u0440\u0432\u0430\u0442\u044c \u0442\u0430\u043a\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u0441\u0440\u043e\u0447\u043d\u043e, \u0442\u0430\u043a \u0438 \u043d\u0435 \u0434\u0435\u043b\u0430\u0442\u044c \u044d\u0442\u043e\u0433\u043e; \u043d\u0438 \u043e\u0434\u043d\u043e \u0438\u0437 \u044d\u0442\u0438\u0445 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0439 \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u043d\u0435 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f.\n* `testfunc_deinit()` \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u043f\u0440\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 (\u0432 \u0434\u0430\u043d\u043d\u043e\u043c \u0448\u0430\u0440\u0434\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b).\n\n<!-- proofread -->"
        },
        "is_code_or_comment": false,
        "model": "deepseek/deepseek-v3.2",
        "updated_at": 1766374316
    }
}