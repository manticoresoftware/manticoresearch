{
    "92c56c5c23909e24226739eade4381637a9845a60ac9c57e38a28dc4c726c392": {
        "original": "# UDFs and Plugins\n\nManticore can be extended with user-defined functions, or UDFs for short, like this:\n\nCODE_BLOCK_0\n\nYou can dynamically load and unload UDFs into `searchd` without having to restart the server, and use them in expressions when searching, ranking, etc. A quick summary of the UDF features is as follows:\n\n* UDFs can take integer (both 32-bit and 64-bit), float, string, MVA, or `PACKEDFACTORS()` arguments.\n* UDFs can return integer, float, or string values.\n* UDFs can check the argument number, types, and names during the query setup phase, and raise errors.\n\nWe do not yet support aggregation functions. In other words, your UDFs will be called for just a single document at a time and are expected to return some value for that document. Writing a function that can compute an aggregate value like AVG() over the entire group of documents that share the same GROUP BY key is not yet possible. However, you can use UDFs within the built-in aggregate functions: that is, even though MYCUSTOMAVG() is not supported yet, AVG(MYCUSTOMFUNC()) should work just fine!\n\nUDFs offer a wide range of applications, such as:\n\n* incorporating custom mathematical or string functions;\n* accessing databases or files from within Manticore;\n* creating complex ranking functions.\n\n## Plugins\n\nPlugins offer additional opportunities to expand search functionality. They can currently be used to compute custom rankings and tokenize documents and queries.\n\nHere's the complete list of plugin types:\n\n* UDF plugins (essentially UDFs, but since they're plugged in, they're also referred to as 'UDF plugins')\n* ranker plugins\n* indexing-time token filter plugins\n* query-time token filter plugins\n\nThis section covers the general process of writing and managing plugins; specifics related to creating different types of plugins are discussed in their respective subsections.\n\nSo, how do you write and use a plugin? Here's a quick four-step guide:\n\n* create a dynamic library (either .so or .dll), most likely using C or C++;\n* load the plugin into searchd with [CREATE PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Creating_a_plugin.md);\n* use the plugin with plugin-specific calls (usually through specific OPTIONS).\n* unload or reload a plugin with [DROP PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Deleting_a_plugin.md) and [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md), respectively.\n\nNote that while UDFs are first-class plugins, they are installed using a separate [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md) statement. This allows for a neat specification of the return type, without sacrificing backward compatibility or changing the syntax.\n\nDynamic plugins are supported in threads and thread_pool workers. Multiple plugins (and/or UDFs) can be contained in a single library file. You may choose to either group all project-specific plugins in one large library or create a separate library for each UDF and plugin; it's up to you.\n\nAs with UDFs, you should include the `src/sphinxudf.h` header file. At the very least, you'll need the `SPH_UDF_VERSION` constant to implement an appropriate version function. Depending on the specific plugin type, you may or may not need to link your plugin with `src/sphinxudf.c`. However, all functions implemented in `sphinxudf.c` are related to unpacking the `PACKEDFACTORS()` blob, and no plugin types have access to that data. So currently, linking with just the header should suffice. (In fact, if you copy over the UDF version number, you won't even need the header file for some plugin types.)\n\nFormally, plugins are simply sets of C functions that adhere to a specific naming pattern. You're typically required to define one key function for the primary task, but you can also define additional functions. For instance, to implement a ranker called \"myrank\", you must define a `myrank_finalize()` function that returns the rank value. However, you can also define `myrank_init()`, `myrank_update()`, and `myrank_deinit()` functions. Specific sets of well-known suffixes and call arguments differ based on the plugin type, but _init() and _deinit() are generic, and every plugin has them. Hint: for a quick reference on known suffixes and their argument types, refer to `sphinxplugin.h`, where the call prototypes are defined at the beginning of the file.\n\nEven though the public interface is defined in pure C, our plugins essentially follow an *object-oriented model*. Indeed, every `_init()` function receives a `void ** userdata` out-parameter, and the pointer value stored at `(*userdata)` is then passed as the first argument to all other plugin functions. So you can think of a plugin as a *class* that gets instantiated every time an object of that class is needed to handle a request: the `userdata` pointer serves as the `this` pointer; the functions act as methods, and the `_init()` and `_deinit()` functions work as constructor and destructor, respectively.\n\nThis minor OOP-in-C complication arises because plugins run in a multi-threaded environment, and some need to maintain state. You can't store that state in a global variable in your plugin, so we pass around a userdata parameter, which naturally leads to the OOP model. If your plugin is simple and stateless, the interface allows you to omit `_init()`, `_deinit()`, and any other functions.\n\nTo summarize, here's the simplest complete ranker plugin in just three lines of C code:\n\nCODE_BLOCK_1\n\nHere's how to use the simple ranker plugin:\n\nCODE_BLOCK_2\n<!-- proofread -->\n\n\n",
        "translations": {
            "chinese": "# UDFs and Plugins\n\nManticore \u53ef\u4ee5\u901a\u8fc7\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u7b80\u79f0 UDFs\uff0c\u8fdb\u884c\u6269\u5c55\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a\n\nCODE_BLOCK_0\n\n\u4f60\u53ef\u4ee5\u52a8\u6001\u52a0\u8f7d\u548c\u5378\u8f7d UDFs \u5230 `searchd` \u4e2d\uff0c\u65e0\u9700\u91cd\u542f\u670d\u52a1\u5668\uff0c\u5e76\u5728\u641c\u7d22\u3001\u6392\u5e8f\u7b49\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002UDF \u7279\u6027\u7684\u7b80\u8981\u603b\u7ed3\u5982\u4e0b\uff1a\n\n* UDFs \u53ef\u4ee5\u63a5\u53d7\u6574\u6570\uff0832 \u4f4d\u548c 64 \u4f4d\uff09\u3001\u6d6e\u70b9\u6570\u3001\u5b57\u7b26\u4e32\u3001\u591a\u503c\u5c5e\u6027\uff08MVA\uff09\u6216 `PACKEDFACTORS()` \u53c2\u6570\u3002\n* UDFs \u53ef\u4ee5\u8fd4\u56de\u6574\u6570\u3001\u6d6e\u70b9\u6570\u6216\u5b57\u7b26\u4e32\u503c\u3002\n* UDFs \u53ef\u4ee5\u5728\u67e5\u8be2\u8bbe\u7f6e\u9636\u6bb5\u68c0\u67e5\u53c2\u6570\u6570\u91cf\u3001\u7c7b\u578b\u548c\u540d\u79f0\uff0c\u5e76\u629b\u51fa\u9519\u8bef\u3002\n\n\u6211\u4eec\u5c1a\u672a\u652f\u6301\u805a\u5408\u51fd\u6570\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cUDFs \u6bcf\u6b21\u4ec5\u5bf9\u5355\u4e2a\u6587\u6863\u8c03\u7528\uff0c\u4e14\u9884\u671f\u4e3a\u8be5\u6587\u6863\u8fd4\u56de\u67d0\u4e2a\u503c\u3002\u7f16\u5199\u4e00\u4e2a\u80fd\u8ba1\u7b97\u6574\u4e2a\u5171\u4eab\u76f8\u540c GROUP BY \u952e\u7684\u6587\u6863\u7ec4\u7684\u805a\u5408\u503c\uff08\u5982 AVG()\uff09\u7684\u51fd\u6570\u76ee\u524d\u8fd8\u4e0d\u53ef\u884c\u3002\u4e0d\u8fc7\uff0c\u4f60\u53ef\u4ee5\u5728\u5185\u7f6e\u805a\u5408\u51fd\u6570\u4e2d\u4f7f\u7528 UDFs\uff1a\u5373\u4f7f MYCUSTOMAVG() \u5c1a\u4e0d\u652f\u6301\uff0c\u4f7f\u7528 AVG(MYCUSTOMFUNC()) \u5e94\u8be5\u6ca1\u6709\u95ee\u9898\uff01\n\nUDFs \u5177\u6709\u5e7f\u6cdb\u7684\u5e94\u7528\uff0c\u5982\uff1a\n\n* \u5f15\u5165\u81ea\u5b9a\u4e49\u6570\u5b66\u6216\u5b57\u7b26\u4e32\u51fd\u6570\uff1b\n* \u5728 Manticore \u5185\u90e8\u8bbf\u95ee\u6570\u636e\u5e93\u6216\u6587\u4ef6\uff1b\n* \u521b\u5efa\u590d\u6742\u7684\u6392\u5e8f\u51fd\u6570\u3002\n\n## Plugins\n\n\u63d2\u4ef6\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u6269\u5c55\u641c\u7d22\u529f\u80fd\u7684\u53ef\u80fd\u6027\u3002\u76ee\u524d\u5b83\u4eec\u53ef\u4ee5\u7528\u4e8e\u8ba1\u7b97\u81ea\u5b9a\u4e49\u6392\u540d\u4ee5\u53ca\u5bf9\u6587\u6863\u548c\u67e5\u8be2\u8fdb\u884c\u5206\u8bcd\u3002\n\n\u4e0b\u9762\u662f\u63d2\u4ef6\u7c7b\u578b\u7684\u5b8c\u6574\u5217\u8868\uff1a\n\n* UDF \u63d2\u4ef6\uff08\u672c\u8d28\u4e0a\u662f UDFs\uff0c\u4f46\u7531\u4e8e\u662f\u63d2\u4ef6\u5f62\u5f0f\uff0c\u4e5f\u79f0\u4f5c\u201cUDF \u63d2\u4ef6\u201d\uff09\n* \u6392\u5e8f\u5668\uff08ranker\uff09\u63d2\u4ef6\n* \u7d22\u5f15\u65f6\u7684\u5206\u8bcd\u8fc7\u6ee4\u5668\u63d2\u4ef6\n* \u67e5\u8be2\u65f6\u7684\u5206\u8bcd\u8fc7\u6ee4\u5668\u63d2\u4ef6\n\n\u672c\u8282\u6db5\u76d6\u7f16\u5199\u548c\u7ba1\u7406\u63d2\u4ef6\u7684\u4e00\u822c\u6d41\u7a0b\uff1b\u4e0d\u540c\u7c7b\u578b\u63d2\u4ef6\u7684\u5177\u4f53\u5185\u5bb9\u5c06\u5728\u5404\u81ea\u5c0f\u8282\u4e2d\u8ba8\u8bba\u3002\n\n\u90a3\u4e48\uff0c\u5982\u4f55\u7f16\u5199\u548c\u4f7f\u7528\u63d2\u4ef6\u5462\uff1f\u8fd9\u91cc\u6709\u4e00\u4e2a\u7b80\u77ed\u7684\u56db\u6b65\u6307\u5357\uff1a\n\n* \u521b\u5efa\u4e00\u4e2a\u52a8\u6001\u5e93\uff08.so \u6216 .dll\uff09\uff0c\u901a\u5e38\u4f7f\u7528 C \u6216 C++\uff1b\n* \u4f7f\u7528 [CREATE PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Creating_a_plugin.md) \u5c06\u63d2\u4ef6\u52a0\u8f7d\u5230 searchd \u4e2d\uff1b\n* \u901a\u8fc7\u7279\u5b9a\u63d2\u4ef6\u8c03\u7528\uff08\u901a\u5e38\u901a\u8fc7\u7279\u5b9a OPTIONS\uff09\u4f7f\u7528\u63d2\u4ef6\uff1b\n* \u4f7f\u7528 [DROP PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Deleting_a_plugin.md) \u548c [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md) \u5378\u8f7d\u6216\u91cd\u65b0\u52a0\u8f7d\u63d2\u4ef6\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5c3d\u7ba1 UDFs \u662f\u4e00\u7b49\u63d2\u4ef6\uff0c\u4f46\u5b83\u4eec\u662f\u901a\u8fc7\u5355\u72ec\u7684 [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md) \u8bed\u53e5\u5b89\u88c5\u7684\u3002\u8fd9\u4f7f\u5f97\u80fd\u7b80\u6d01\u5730\u6307\u5b9a\u8fd4\u56de\u7c7b\u578b\uff0c\u540c\u65f6\u4e0d\u727a\u7272\u5411\u540e\u517c\u5bb9\u6027\u6216\u6539\u53d8\u8bed\u6cd5\u3002\n\n\u52a8\u6001\u63d2\u4ef6\u652f\u6301\u7ebf\u7a0b\u548c\u7ebf\u7a0b\u6c60\u5de5\u4f5c\u8005\u3002\u591a\u4e2a\u63d2\u4ef6\uff08\u548c/\u6216 UDFs\uff09\u53ef\u4ee5\u5305\u542b\u5728\u5355\u4e2a\u5e93\u6587\u4ef6\u4e2d\u3002\u4f60\u53ef\u4ee5\u9009\u62e9\u5c06\u6240\u6709\u9879\u76ee\u7279\u5b9a\u63d2\u4ef6\u96c6\u4e2d\u5230\u4e00\u4e2a\u5927\u578b\u5e93\u4e2d\uff0c\u6216\u4e3a\u6bcf\u4e2a UDF \u548c\u63d2\u4ef6\u521b\u5efa\u5355\u72ec\u5e93\uff0c\u7531\u4f60\u51b3\u5b9a\u3002\n\n\u548c UDFs \u4e00\u6837\uff0c\u4f60\u5e94\u8be5\u5305\u542b `src/sphinxudf.h` \u5934\u6587\u4ef6\u3002\u81f3\u5c11\uff0c\u4f60\u9700\u8981 `SPH_UDF_VERSION` \u5e38\u91cf\u4ee5\u5b9e\u73b0\u5408\u9002\u7684\u7248\u672c\u51fd\u6570\u3002\u6839\u636e\u5177\u4f53\u63d2\u4ef6\u7c7b\u578b\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u6216\u4e0d\u9700\u8981\u5c06\u63d2\u4ef6\u4e0e `src/sphinxudf.c` \u94fe\u63a5\u3002\u7136\u800c\uff0c\u6240\u6709\u5728 `sphinxudf.c` \u4e2d\u5b9e\u73b0\u7684\u51fd\u6570\u90fd\u4e0e\u89e3\u5305 `PACKEDFACTORS()` blob \u76f8\u5173\uff0c\u800c\u6ca1\u6709\u63d2\u4ef6\u7c7b\u578b\u53ef\u4ee5\u8bbf\u95ee\u8be5\u6570\u636e\u3002\u56e0\u6b64\u76ee\u524d\u53ea\u9700\u94fe\u63a5\u5934\u6587\u4ef6\u5373\u53ef\u3002(\u4e8b\u5b9e\u4e0a\uff0c\u5982\u679c\u4f60\u590d\u5236\u4e86 UDF \u7248\u672c\u53f7\uff0c\u5bf9\u67d0\u4e9b\u63d2\u4ef6\u7c7b\u578b\u6765\u8bf4\u751a\u81f3\u4e0d\u9700\u8981\u5934\u6587\u4ef6\u3002)\n\n\u4ece\u5f62\u5f0f\u4e0a\u8bb2\uff0c\u63d2\u4ef6\u4ec5\u4ec5\u662f\u4e00\u7ec4\u9075\u5faa\u7279\u5b9a\u547d\u540d\u6a21\u5f0f\u7684 C \u51fd\u6570\u3002\u4f60\u901a\u5e38\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u4e3b\u8981\u4efb\u52a1\u7684\u6838\u5fc3\u51fd\u6570\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u989d\u5916\u51fd\u6570\u3002\u4f8b\u5982\uff0c\u4e3a\u5b9e\u73b0\u4e00\u4e2a\u540d\u4e3a \u201cmyrank\u201d \u7684\u6392\u5e8f\u5668\uff0c\u4f60\u5fc5\u987b\u5b9a\u4e49\u4e00\u4e2a\u8fd4\u56de\u6392\u5e8f\u503c\u7684 `myrank_finalize()` \u51fd\u6570\u3002\u4f46\u662f\u4f60\u540c\u6837\u53ef\u4ee5\u5b9a\u4e49 `myrank_init()`\u3001`myrank_update()` \u548c `myrank_deinit()` \u51fd\u6570\u3002\u4f17\u6240\u5468\u77e5\u7684\u540e\u7f00\u96c6\u548c\u8c03\u7528\u53c2\u6570\u6839\u636e\u63d2\u4ef6\u7c7b\u578b\u4e0d\u540c\u800c\u5f02\uff0c\u4f46 _init() \u548c _deinit() \u662f\u901a\u7528\u7684\uff0c\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u6709\u5b83\u4eec\u3002\u63d0\u793a\uff1a\u8981\u5feb\u901f\u53c2\u8003\u5df2\u77e5\u540e\u7f00\u53ca\u5176\u53c2\u6570\u7c7b\u578b\uff0c\u8bf7\u53c2\u8003 `sphinxplugin.h`\uff0c\u8be5\u6587\u4ef6\u5f00\u5934\u5b9a\u4e49\u4e86\u8c03\u7528\u539f\u578b\u3002\n\n\u5c3d\u7ba1\u516c\u5171\u63a5\u53e3\u662f\u7eaf C \u5b9a\u4e49\u7684\uff0c\u6211\u4eec\u7684\u63d2\u4ef6\u672c\u8d28\u4e0a\u9075\u5faa\u4e00\u79cd*\u9762\u5411\u5bf9\u8c61\u6a21\u578b*\u3002\u786e\u5b9e\uff0c\u6bcf\u4e2a `_init()` \u51fd\u6570\u63a5\u6536\u4e00\u4e2a `void ** userdata` \u8f93\u51fa\u53c2\u6570\uff0c\u968f\u540e\u5b58\u50a8\u5728 `(*userdata)` \u4e2d\u7684\u6307\u9488\u503c\u4f1a\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u9012\u7ed9\u5176\u4ed6\u6240\u6709\u63d2\u4ef6\u51fd\u6570\u3002\u56e0\u6b64\u4f60\u53ef\u4ee5\u628a\u63d2\u4ef6\u770b\u4f5c\u4e00\u4e2a*\u7c7b*\uff0c\u6bcf\u5f53\u9700\u8981\u5904\u7406\u8bf7\u6c42\u65f6\u5b9e\u4f8b\u5316\u8be5\u7c7b\u4e00\u4e2a\u5bf9\u8c61\uff1a`userdata` \u6307\u9488\u5145\u5f53 `this` \u6307\u9488\uff1b\u51fd\u6570\u4f5c\u4e3a\u65b9\u6cd5\uff0c`_init()` \u548c `_deinit()` \u662f\u6784\u9020\u51fd\u6570\u548c\u6790\u6784\u51fd\u6570\u3002\n\n\u8fd9\u4e2a\u5728 C \u4e2d\u7684\u9762\u5411\u5bf9\u8c61\u65b9\u5f0f\u7684\u8f7b\u5fae\u590d\u6742\u5ea6\u4ea7\u751f\u4e8e\u63d2\u4ef6\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u8fd0\u884c\uff0c\u4e14\u6709\u4e9b\u63d2\u4ef6\u9700\u8981\u7ef4\u62a4\u72b6\u6001\u3002\u4f60\u4e0d\u80fd\u5728\u63d2\u4ef6\u4e2d\u7528\u5168\u5c40\u53d8\u91cf\u5b58\u50a8\u8fd9\u4e2a\u72b6\u6001\uff0c\u56e0\u6b64\u6211\u4eec\u4f20\u9012\u4e00\u4e2a userdata \u53c2\u6570\uff0c\u8fd9\u81ea\u7136\u5bfc\u81f4\u4e86\u9762\u5411\u5bf9\u8c61\u6a21\u5f0f\u3002\u5982\u679c\u4f60\u7684\u63d2\u4ef6\u7b80\u5355\u4e14\u65e0\u72b6\u6001\uff0c\u63a5\u53e3\u5141\u8bb8\u4f60\u7701\u7565 `_init()`\u3001`_deinit()` \u548c\u5176\u4ed6\u51fd\u6570\u3002\n\n\u603b\u7ed3\u4e00\u4e0b\uff0c\u8fd9\u91cc\u662f\u53ea\u9700\u4e09\u884c C \u4ee3\u7801\u7684\u6700\u7b80\u5355\u5b8c\u6574\u6392\u5e8f\u5668\u63d2\u4ef6\uff1a\n\nCODE_BLOCK_1\n\n\u4e0b\u9762\u662f\u5982\u4f55\u4f7f\u7528\u8fd9\u4e2a\u7b80\u5355\u6392\u5e8f\u5668\u63d2\u4ef6\uff1a\n\nCODE_BLOCK_2\n<!-- proofread -->\n",
            "russian": "# UDFs and Plugins\n\nManticore \u043c\u043e\u0436\u043d\u043e \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u0438\u043b\u0438 UDF (User-Defined Functions) \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c:\n\nCODE_BLOCK_0\n\n\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0438 \u0432\u044b\u0433\u0440\u0443\u0436\u0430\u0442\u044c UDF \u0432 `searchd` \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u0445 \u0432 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u0445 \u043f\u0440\u0438 \u043f\u043e\u0438\u0441\u043a\u0435, \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0438 \u0442.\u0434. \u041a\u0440\u0430\u0442\u043a\u043e\u0435 \u0440\u0435\u0437\u044e\u043c\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0435\u0439 UDF:\n\n* UDF \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b \u0442\u0438\u043f\u0430 integer (\u043a\u0430\u043a 32-\u0431\u0438\u0442\u043d\u044b\u0435, \u0442\u0430\u043a \u0438 64-\u0431\u0438\u0442\u043d\u044b\u0435), float, string, MVA \u0438\u043b\u0438 `PACKEDFACTORS()`.\n* UDF \u043c\u043e\u0433\u0443\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0442\u0438\u043f\u0430 integer, float \u0438\u043b\u0438 string.\n* UDF \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e, \u0442\u0438\u043f\u044b \u0438 \u0438\u043c\u0435\u043d\u0430 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u043d\u0430 \u044d\u0442\u0430\u043f\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0438 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0438.\n\n\u0410\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043f\u043e\u043a\u0430 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f. \u0414\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u0432\u0430\u0448\u0438 UDF \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u043e\u0434\u043d\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 \u0437\u0430 \u0440\u0430\u0437 \u0438 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430. \u041d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 AVG(), \u0434\u043b\u044f \u0432\u0441\u0435\u0439 \u0433\u0440\u0443\u043f\u043f\u044b \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c \u043a\u043b\u044e\u0447\u043e\u043c GROUP BY \u043f\u043e\u043a\u0430 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c UDF \u0432\u043d\u0443\u0442\u0440\u0438 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0445 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439: \u0442\u043e \u0435\u0441\u0442\u044c, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 MYCUSTOMAVG() \u043f\u043e\u043a\u0430 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f, AVG(MYCUSTOMFUNC()) \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0431\u0435\u0437 \u043f\u0440\u043e\u0431\u043b\u0435\u043c!\n\nUDF \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u0448\u0438\u0440\u043e\u043a\u0438\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:\n\n* \u0432\u043d\u0435\u0434\u0440\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0438\u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439;\n* \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0431\u0430\u0437\u0430\u043c \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u043b\u0438 \u0444\u0430\u0439\u043b\u0430\u043c \u0438\u0437\u043d\u0443\u0442\u0440\u0438 Manticore;\n* \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f.\n\n## \u041f\u043b\u0430\u0433\u0438\u043d\u044b\n\n\u041f\u043b\u0430\u0433\u0438\u043d\u044b \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b\u0430 \u043f\u043e\u0438\u0441\u043a\u0430. \u0412 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0438\u0445 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u043e\u043a, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0434\u043b\u044f \u0442\u043e\u043a\u0435\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432.\n\n\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0438\u043f\u043e\u0432 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432:\n\n* UDF-\u043f\u043b\u0430\u0433\u0438\u043d\u044b (\u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 UDF, \u043d\u043e \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043e\u043d\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u044e\u0442\u0441\u044f \u043a\u0430\u043a \u043f\u043b\u0430\u0433\u0438\u043d\u044b, \u0438\u0445 \u0442\u0430\u043a\u0436\u0435 \u043d\u0430\u0437\u044b\u0432\u0430\u044e\u0442 \u00abUDF-\u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438\u00bb)\n* \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n* \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u043d\u0430 \u044d\u0442\u0430\u043f\u0435 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u0438\n* \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u043d\u0430 \u044d\u0442\u0430\u043f\u0435 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\n\n\u0412 \u044d\u0442\u043e\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435 \u043e\u043f\u0438\u0441\u0430\u043d \u043e\u0431\u0449\u0438\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438; \u0434\u0435\u0442\u0430\u043b\u0438, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435\u043c \u0440\u0430\u0437\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432, \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u044e\u0442\u0441\u044f \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0430\u0445.\n\n\u0418\u0442\u0430\u043a, \u043a\u0430\u043a \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043b\u0430\u0433\u0438\u043d? \u0412\u043e\u0442 \u043a\u0440\u0430\u0442\u043a\u043e\u0435 \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u0438\u0437 \u0447\u0435\u0442\u044b\u0440\u0435\u0445 \u0448\u0430\u0433\u043e\u0432:\n\n* \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443 (.so \u0438\u043b\u0438 .dll), \u0441\u043a\u043e\u0440\u0435\u0435 \u0432\u0441\u0435\u0433\u043e \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e C \u0438\u043b\u0438 C++;\n* \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043b\u0430\u0433\u0438\u043d \u0432 searchd \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e [CREATE PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Creating_a_plugin.md);\n* \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043b\u0430\u0433\u0438\u043d \u0441 \u0432\u044b\u0437\u043e\u0432\u0430\u043c\u0438, \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u044b\u043c\u0438 \u0434\u043b\u044f \u043f\u043b\u0430\u0433\u0438\u043d\u0430 (\u043e\u0431\u044b\u0447\u043d\u043e \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 OPTIONS);\n* \u0432\u044b\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043b\u0430\u0433\u0438\u043d \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e [DROP PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Deleting_a_plugin.md) \u0438 [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md) \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e.\n\n\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e UDF \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430, \u043e\u0434\u043d\u0430\u043a\u043e \u043e\u043d\u0438 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md). \u042d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0442\u043e\u0447\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0442\u0438\u043f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0431\u0435\u0437 \u043f\u043e\u0442\u0435\u0440\u0438 \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u0439 \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438 \u0438\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441\u0430.\n\n\u0414\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0432 \u043f\u043e\u0442\u043e\u043a\u0430\u0445 \u0438 \u0432 worker'\u0430\u0445 thread_pool. \u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432 (\u0438/\u0438\u043b\u0438 UDF) \u043c\u043e\u0433\u0443\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u043c \u0444\u0430\u0439\u043b\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043b\u0438\u0431\u043e \u0441\u043e\u0431\u0438\u0440\u0430\u0442\u044c \u0432\u0441\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u043d\u044b\u0435 \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u0432 \u043e\u0434\u043d\u043e\u0439 \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0435, \u043b\u0438\u0431\u043e \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e UDF \u0438 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u0430 \u2014 \u0432\u044b\u0431\u043e\u0440 \u0437\u0430 \u0432\u0430\u043c\u0438.\n\n\u0422\u0430\u043a \u0436\u0435, \u043a\u0430\u043a \u0438 \u0434\u043b\u044f UDF, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b `src/sphinxudf.h`. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430 `SPH_UDF_VERSION` \u0434\u043b\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0432\u0435\u0440\u0441\u0438\u0438. \u0412 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0442\u0438\u043f\u0430 \u043f\u043b\u0430\u0433\u0438\u043d\u0430 \u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u0442\u0440\u0435\u0431\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0438\u043b\u0438 \u043d\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043b\u0438\u043d\u043a\u043e\u0432\u043a\u0430 \u0441 `src/sphinxudf.c`. \u0422\u0435\u043c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 \u0432\u0441\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438, \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0432 `sphinxudf.c`, \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u043a\u043e\u0439 blob'\u0430 `PACKEDFACTORS()`, \u0438 \u043d\u0438 \u043e\u0434\u0438\u043d \u0442\u0438\u043f \u043f\u043b\u0430\u0433\u0438\u043d\u0430 \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u044d\u0442\u0438\u043c \u0434\u0430\u043d\u043d\u044b\u043c. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b. (\u0424\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438, \u0435\u0441\u043b\u0438 \u0432\u044b \u0441\u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u0432\u0435\u0440\u0441\u0438\u0438 UDF, \u0434\u0430\u0436\u0435 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432 \u043c\u043e\u0436\u0435\u0442 \u043d\u0435 \u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u044c\u0441\u044f.)\n\n\u0424\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e, \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u2014 \u044d\u0442\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u043d\u0430\u0431\u043e\u0440\u044b \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u043d\u0430 C, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0448\u0430\u0431\u043b\u043e\u043d\u0443 \u0438\u043c\u0435\u043d. \u041e\u0431\u044b\u0447\u043d\u043e \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043e\u0434\u043d\u0443 \u043a\u043b\u044e\u0447\u0435\u0432\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0438, \u043d\u043e \u043c\u043e\u0436\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0447\u0442\u043e\u0431\u044b \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0441 \u0438\u043c\u0435\u043d\u0435\u043c \"myrank\", \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e `myrank_finalize()`, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0440\u0430\u043d\u0433\u0430. \u041c\u043e\u0436\u043d\u043e \u0442\u0430\u043a\u0436\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c `myrank_init()`, `myrank_update()`, \u0438 `myrank_deinit()`. \u041a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u043d\u0430\u0431\u043e\u0440\u044b \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u043e\u0432 \u0438 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0432\u044b\u0437\u043e\u0432\u0430 \u0437\u0430\u0432\u0438\u0441\u044f\u0442 \u043e\u0442 \u0442\u0438\u043f\u0430 \u043f\u043b\u0430\u0433\u0438\u043d\u0430, \u043d\u043e `_init()` \u0438 `_deinit()` \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u043c\u0438, \u0438 \u0443 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u0430 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c. \u041f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0430: \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u0441 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u043c\u0438 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u0430\u043c\u0438 \u0438 \u0438\u0445 \u0442\u0438\u043f\u0430\u043c\u0438 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 `sphinxplugin.h`, \u0433\u0434\u0435 \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u0444\u0430\u0439\u043b\u0430 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u044b \u043f\u0440\u043e\u0442\u043e\u0442\u0438\u043f\u044b \u0432\u044b\u0437\u043e\u0432\u043e\u0432.\n\n\u0425\u043e\u0442\u044f \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d \u043d\u0430 \u0447\u0438\u0441\u0442\u043e\u043c C, \u043d\u0430\u0448\u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043b\u0435\u0434\u0443\u044e\u0442 *\u043e\u0431\u044a\u0435\u043a\u0442\u043d\u043e-\u043e\u0440\u0438\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u043c\u043e\u0434\u0435\u043b\u0438*. \u041a\u0430\u0436\u0434\u044b\u0439 `_init()` \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 `void ** userdata` \u0434\u043b\u044f \u0432\u044b\u0432\u043e\u0434\u0430, \u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c, \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0439 \u0432 `(*userdata)`, \u0437\u0430\u0442\u0435\u043c \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u043f\u0435\u0440\u0432\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0432\u043e \u0432\u0441\u0435 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u0430. \u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043c\u043e\u0436\u043d\u043e \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u043f\u043b\u0430\u0433\u0438\u043d *\u043a\u043b\u0430\u0441\u0441\u043e\u043c*, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0438\u043d\u0441\u0442\u0430\u043d\u0446\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u044d\u0442\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430 \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430: \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c `userdata` \u0432\u044b\u0441\u0442\u0443\u043f\u0430\u0435\u0442 \u043a\u0430\u043a \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c `this`; \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u2014 \u043a\u0430\u043a \u043c\u0435\u0442\u043e\u0434\u044b; \u0444\u0443\u043d\u043a\u0446\u0438\u0438 `_init()` \u0438 `_deinit()` \u0441\u043b\u0443\u0436\u0430\u0442 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u043e\u043c \u0438 \u0434\u0435\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u043e\u043c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e.\n\n\u042d\u0442\u043e \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u043e\u0435 \u0443\u0441\u043b\u043e\u0436\u043d\u0435\u043d\u0438\u0435 \u041e\u041e\u041f \u0432 C \u0441\u0432\u044f\u0437\u0430\u043d\u043e \u0441 \u0442\u0435\u043c, \u0447\u0442\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442 \u0432 \u043c\u043d\u043e\u0433\u043e\u043f\u043e\u0442\u043e\u0447\u043d\u043e\u043c \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u0438, \u0438 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0438\u0437 \u043d\u0438\u0445 \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435. \u041d\u0435\u043b\u044c\u0437\u044f \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0432 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u043f\u043b\u0430\u0433\u0438\u043d\u0430, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 userdata, \u0447\u0442\u043e \u0435\u0441\u0442\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043c\u043e\u0434\u0435\u043b\u0438 \u041e\u041e\u041f. \u0415\u0441\u043b\u0438 \u0432\u0430\u0448 \u043f\u043b\u0430\u0433\u0438\u043d \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0438 \u0431\u0435\u0437 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f, \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c `_init()`, `_deinit()` \u0438 \u043b\u044e\u0431\u044b\u0435 \u0434\u0440\u0443\u0433\u0438\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438.\n\n\u0412 \u0437\u0430\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435, \u0432\u043e\u0442 \u0441\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u043b\u0430\u0433\u0438\u043d \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438\u0437 \u0432\u0441\u0435\u0433\u043e \u0442\u0440\u0435\u0445 \u0441\u0442\u0440\u043e\u043a \u043a\u043e\u0434\u0430 \u043d\u0430 C:\n\nCODE_BLOCK_1\n\n\u0412\u043e\u0442 \u043a\u0430\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u043b\u0430\u0433\u0438\u043d \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f:\n\nCODE_BLOCK_2\n<!-- proofread -->\n\n\n"
        },
        "is_code_or_comment": false,
        "model": "openai:gpt-4.1-mini",
        "updated_at": 1766339843
    },
    "37bcc30b49fb4288ad245867308a51717edbd07eacf4d8f37f2543aad691c490": {
        "original": "# UDFs and Plugins\n\nManticore can be extended with user-defined functions, or UDFs for short, like this:\n\nCODE_BLOCK_0\n\nYou can dynamically load and unload UDFs into `searchd` without having to restart the server, and use them in expressions when searching, ranking, etc. A quick summary of the UDF features is as follows:\n\n* UDFs can take integer (both 32-bit and 64-bit), float, string, MVA, or `PACKEDFACTORS()` arguments.\n* UDFs can return integer, float, or string values.\n* UDFs can check the argument number, types, and names during the query setup phase, and raise errors.\n\nWe do not yet support aggregation functions. In other words, your UDFs will be called for just a single document at a time and are expected to return some value for that document. Writing a function that can compute an aggregate value like AVG() over the entire group of documents that share the same GROUP BY key is not yet possible. However, you can use UDFs within the built-in aggregate functions: that is, even though MYCUSTOMAVG() is not supported yet, AVG(MYCUSTOMFUNC()) should work just fine!\n\nUDFs offer a wide range of applications, such as:\n\n* incorporating custom mathematical or string functions;\n* accessing databases or files from within Manticore;\n* creating complex ranking functions.\n\n## Plugins\n\nPlugins offer additional opportunities to expand search functionality. They can currently be used to compute custom rankings and tokenize documents and queries.\n\nHere's the complete list of plugin types:\n\n* UDF plugins (essentially UDFs, but since they're plugged in, they're also referred to as 'UDF plugins')\n* ranker plugins\n* indexing-time token filter plugins\n* query-time token filter plugins\n\nThis section covers the general process of writing and managing plugins; specifics related to creating different types of plugins are discussed in their respective subsections.\n\nSo, how do you write and use a plugin? Here's a quick four-step guide:\n\n* create a dynamic library (either .so or .dll), most likely using C or C++;\n* load the plugin into searchd with [CREATE PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Creating_a_plugin.md);\n* use the plugin with plugin-specific calls (usually through specific OPTIONS).\n* unload or reload a plugin with [DROP PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Deleting_a_plugin.md) and [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md), respectively.\n\nNote that while UDFs are first-class plugins, they are installed using a separate [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md) statement. This allows for a neat specification of the return type, without sacrificing backward compatibility or changing the syntax.\n\nDynamic plugins are supported in threads and thread_pool workers. Multiple plugins (and/or UDFs) can be contained in a single library file. You may choose to either group all project-specific plugins in one large library or create a separate library for each UDF and plugin; it's up to you.\n\nAs with UDFs, you should include the `src/sphinxudf.h` header file. At the very least, you'll need the `SPH_UDF_VERSION` constant to implement an appropriate version function. Depending on the specific plugin type, you may or may not need to link your plugin with `src/sphinxudf.c`. However, all functions implemented in `sphinxudf.c` are related to unpacking the `PACKEDFACTORS()` blob, and no plugin types have access to that data. So currently, linking with just the header should suffice. (In fact, if you copy over the UDF version number, you won't even need the header file for some plugin types.)\n\nFormally, plugins are simply sets of C functions that adhere to a specific naming pattern. You're typically required to define one key function for the primary task, but you can also define additional functions. For instance, to implement a ranker called \"myrank\", you must define a `myrank_finalize()` function that returns the rank value. However, you can also define `myrank_init()`, `myrank_update()`, and `myrank_deinit()` functions. Specific sets of well-known suffixes and call arguments differ based on the plugin type, but _init() and _deinit() are generic, and every plugin has them. Hint: for a quick reference on known suffixes and their argument types, refer to `sphinxplugin.h`, where the call prototypes are defined at the beginning of the file.\n\nEven though the public interface is defined in pure C, our plugins essentially follow an *object-oriented model*. Indeed, every `_init()` function receives a `void ** userdata` out-parameter, and the pointer value stored at `(*userdata)` is then passed as the first argument to all other plugin functions. So you can think of a plugin as a *class* that gets instantiated every time an object of that class is needed to handle a request: the `userdata` pointer serves as the `this` pointer; the functions act as methods, and the `_init()` and `_deinit()` functions work as constructor and destructor, respectively.\n\nThis minor OOP-in-C complication arises because plugins run in a multi-threaded environment, and some need to maintain state. You can't store that state in a global variable in your plugin, so we pass around a userdata parameter, which naturally leads to the OOP model. If your plugin is simple and stateless, the interface allows you to omit `_init()`, `_deinit()`, and any other functions.\n\nTo summarize, here's the simplest complete ranker plugin in just three lines of C code:\n\nCODE_BLOCK_1\n\nHere's how to use the simple ranker plugin:\n\nCODE_BLOCK_2\n<!-- proofread -->\n\n",
        "translations": {
            "chinese": "# UDFs\u548c\u63d2\u4ef6\n\nManticore\u53ef\u4ee5\u901a\u8fc7\u7528\u6237\u5b9a\u4e49\u51fd\u6570\uff08\u7b80\u79f0UDF\uff09\u8fdb\u884c\u6269\u5c55\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n\nCODE_BLOCK_0\n\n\u60a8\u53ef\u4ee5\u5728\u4e0d\u91cd\u542f\u670d\u52a1\u5668\u7684\u60c5\u51b5\u4e0b\u52a8\u6001\u52a0\u8f7d\u548c\u5378\u8f7dUDF\u5230`searchd`\u4e2d\uff0c\u5e76\u5728\u641c\u7d22\u3001\u6392\u540d\u7b49\u64cd\u4f5c\u65f6\u4f7f\u7528\u5b83\u4eec\u3002UDF\u7684\u4e00\u4e9b\u7279\u70b9\u5982\u4e0b\uff1a\n\n* UDF\u53ef\u4ee5\u63a5\u53d7\u6574\u6570\uff0832\u4f4d\u548c64\u4f4d\uff09\u3001\u6d6e\u70b9\u6570\u3001\u5b57\u7b26\u4e32\u3001MVA\u6216`PACKEDFACTORS()`\u53c2\u6570\u3002\n* UDF\u53ef\u4ee5\u8fd4\u56de\u6574\u6570\u3001\u6d6e\u70b9\u6570\u6216\u5b57\u7b26\u4e32\u503c\u3002\n* UDF\u53ef\u4ee5\u5728\u67e5\u8be2\u8bbe\u7f6e\u9636\u6bb5\u68c0\u67e5\u53c2\u6570\u6570\u91cf\u3001\u7c7b\u578b\u548c\u540d\u79f0\uff0c\u5e76\u5728\u5fc5\u8981\u65f6\u629b\u51fa\u9519\u8bef\u3002\n\n\u6211\u4eec\u5c1a\u672a\u652f\u6301\u805a\u5408\u51fd\u6570\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u60a8\u7684UDF\u5c06\u4ec5\u9488\u5bf9\u5355\u4e2a\u6587\u6863\u8c03\u7528\uff0c\u5e76\u4e14\u671f\u671b\u4e3a\u8be5\u6587\u6863\u8fd4\u56de\u67d0\u4e9b\u503c\u3002\u7f16\u5199\u4e00\u4e2a\u53ef\u4ee5\u8ba1\u7b97\u6574\u4e2a\u5177\u6709\u76f8\u540cGROUP BY\u952e\u7684\u6587\u6863\u7ec4\u7684\u805a\u5408\u503c\uff08\u5982AVG()\uff09\u7684\u51fd\u6570\u76ee\u524d\u662f\u4e0d\u53ef\u80fd\u7684\u3002\u4f46\u662f\uff0c\u60a8\u53ef\u4ee5\u5728\u5185\u7f6e\u805a\u5408\u51fd\u6570\u4e2d\u4f7f\u7528UDF\uff1a\u4e5f\u5c31\u662f\u8bf4\uff0c\u5373\u4f7fMYCUSTOMAVG()\u5c1a\u672a\u652f\u6301\uff0cAVG(MYCUSTOMFUNC())\u4e5f\u5e94\u8be5\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff01\n\nUDF\u63d0\u4f9b\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\u573a\u666f\uff0c\u4f8b\u5982\uff1a\n\n* \u96c6\u6210\u81ea\u5b9a\u4e49\u6570\u5b66\u6216\u5b57\u7b26\u4e32\u51fd\u6570\uff1b\n* \u4eceManticore\u8bbf\u95ee\u6570\u636e\u5e93\u6216\u6587\u4ef6\uff1b\n* \u521b\u5efa\u590d\u6742\u7684\u6392\u540d\u51fd\u6570\u3002\n\n## \u63d2\u4ef6\n\n\u63d2\u4ef6\u63d0\u4f9b\u4e86\u6269\u5c55\u641c\u7d22\u529f\u80fd\u7684\u989d\u5916\u673a\u4f1a\u3002\u5b83\u4eec\u5f53\u524d\u53ef\u7528\u4e8e\u8ba1\u7b97\u81ea\u5b9a\u4e49\u6392\u540d\u548c\u5206\u8bcd\u6587\u6863\u548c\u67e5\u8be2\u3002\n\n\u4ee5\u4e0b\u662f\u63d2\u4ef6\u7c7b\u578b\u7684\u5b8c\u6574\u5217\u8868\uff1a\n\n* UDF\u63d2\u4ef6\uff08\u672c\u8d28\u4e0a\u662fUDF\uff0c\u4f46\u7531\u4e8e\u5b83\u4eec\u662f\u63d2\u4ef6\uff0c\u56e0\u6b64\u4e5f\u88ab\u79f0\u4e3a\u201cUDF\u63d2\u4ef6\u201d\uff09\n* \u6392\u540d\u63d2\u4ef6\n* \u7d22\u5f15\u65f6\u5206\u8bcd\u8fc7\u6ee4\u5668\u63d2\u4ef6\n* \u67e5\u8be2\u65f6\u5206\u8bcd\u8fc7\u6ee4\u5668\u63d2\u4ef6\n\n\u672c\u8282\u6db5\u76d6\u4e86\u7f16\u5199\u548c\u7ba1\u7406\u63d2\u4ef6\u7684\u4e00\u822c\u8fc7\u7a0b\uff1b\u6709\u5173\u521b\u5efa\u4e0d\u540c\u7c7b\u578b\u7684\u63d2\u4ef6\u7684\u5177\u4f53\u7ec6\u8282\u5c06\u5728\u5404\u81ea\u7684\u5b50\u8282\u4e2d\u8ba8\u8bba\u3002\n\n\u90a3\u4e48\uff0c\u5982\u4f55\u7f16\u5199\u548c\u4f7f\u7528\u63d2\u4ef6\uff1f\u8fd9\u91cc\u6709\u4e00\u4e2a\u5feb\u901f\u7684\u56db\u6b65\u6307\u5357\uff1a\n\n* \u521b\u5efa\u4e00\u4e2a\u52a8\u6001\u5e93\uff08\u53ef\u80fd\u662f.so\u6216.dll\uff09\uff0c\u6700\u6709\u53ef\u80fd\u4f7f\u7528C\u6216C++\uff1b\n* \u4f7f\u7528[CREATE PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Creating_a_plugin.md)\u5c06\u63d2\u4ef6\u52a0\u8f7d\u5230searchd\u4e2d\uff1b\n* \u4f7f\u7528\u63d2\u4ef6\u7279\u5b9a\u7684\u8c03\u7528\uff08\u901a\u5e38\u901a\u8fc7\u7279\u5b9a\u7684OPTIONS\uff09\u4f7f\u7528\u63d2\u4ef6\uff1b\n* \u4f7f\u7528[DROP PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Deleting_a_plugin.md)\u5378\u8f7d\u6216\u4f7f\u7528[RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md)\u91cd\u65b0\u52a0\u8f7d\u63d2\u4ef6\u3002\n\n\u8bf7\u6ce8\u610f\uff0c\u867d\u7136UDF\u662f\u4e00\u7b49\u63d2\u4ef6\uff0c\u4f46\u5b83\u4eec\u4f7f\u7528\u5355\u72ec\u7684[CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md)\u8bed\u53e5\u5b89\u88c5\u3002\u8fd9\u5141\u8bb8\u7b80\u6d01\u5730\u6307\u5b9a\u8fd4\u56de\u7c7b\u578b\uff0c\u800c\u4e0d\u727a\u7272\u5411\u540e\u517c\u5bb9\u6027\u6216\u66f4\u6539\u8bed\u6cd5\u3002\n\n\u52a8\u6001\u63d2\u4ef6\u5728\u591a\u7ebf\u7a0b\u548cthread_pool\u5de5\u4f5c\u7ebf\u7a0b\u4e2d\u53d7\u652f\u6301\u3002\u4e00\u4e2a\u5e93\u6587\u4ef6\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u63d2\u4ef6\uff08\u548c/\u6216UDF\uff09\u3002\u60a8\u53ef\u4ee5\u9009\u62e9\u5c06\u6240\u6709\u9879\u76ee\u7279\u5b9a\u7684\u63d2\u4ef6\u653e\u5728\u4e00\u4e2a\u5927\u578b\u5e93\u4e2d\uff0c\u6216\u8005\u4e3a\u6bcf\u4e2aUDF\u548c\u63d2\u4ef6\u521b\u5efa\u5355\u72ec\u7684\u5e93\uff1b\u8fd9\u53d6\u51b3\u4e8e\u60a8\u3002\n\n\u4e0eUDF\u4e00\u6837\uff0c\u60a8\u5e94\u8be5\u5305\u542b`src/sphinxudf.h`\u5934\u6587\u4ef6\u3002\u81f3\u5c11\uff0c\u60a8\u9700\u8981`SPH_UDF_VERSION`\u5e38\u91cf\u6765\u5b9e\u73b0\u9002\u5f53\u7248\u672c\u7684\u51fd\u6570\u3002\u6839\u636e\u7279\u5b9a\u7684\u63d2\u4ef6\u7c7b\u578b\uff0c\u60a8\u53ef\u80fd\u6216\u53ef\u80fd\u4e0d\u9700\u8981\u5c06\u63d2\u4ef6\u94fe\u63a5\u5230`src/sphinxudf.c`\u3002\u4f46\u662f\uff0c`sphinxudf.c`\u4e2d\u5b9e\u73b0\u7684\u6240\u6709\u51fd\u6570\u90fd\u4e0e`PACKEDFACTORS()`\u7684\u89e3\u5305\u6709\u5173\uff0c\u800c\u6ca1\u6709\u4efb\u4f55\u63d2\u4ef6\u7c7b\u578b\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u3002\u56e0\u6b64\uff0c\u76ee\u524d\u4ec5\u94fe\u63a5\u5934\u6587\u4ef6\u5c31\u8db3\u591f\u4e86\u3002\uff08\u4e8b\u5b9e\u4e0a\uff0c\u5982\u679c\u60a8\u590d\u5236\u4e86UDF\u7248\u672c\u53f7\uff0c\u60a8\u751a\u81f3\u4e0d\u9700\u8981\u5934\u6587\u4ef6\u6765\u5b9e\u73b0\u67d0\u4e9b\u63d2\u4ef6\u7c7b\u578b\u3002\uff09\n\n\u5f62\u5f0f\u4e0a\uff0c\u63d2\u4ef6\u662f\u4e00\u7ec4\u9075\u5faa\u7279\u5b9a\u547d\u540d\u6a21\u5f0f\u7684C\u51fd\u6570\u3002\u901a\u5e38\uff0c\u60a8\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u5173\u952e\u51fd\u6570\u6765\u6267\u884c\u4e3b\u8981\u4efb\u52a1\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u5176\u4ed6\u51fd\u6570\u3002\u4f8b\u5982\uff0c\u8981\u5b9e\u73b0\u4e00\u4e2a\u540d\u4e3a\u201cmyrank\u201d\u7684\u6392\u540d\u5668\uff0c\u60a8\u5fc5\u987b\u5b9a\u4e49\u4e00\u4e2a`myrank_finalize()`\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u8fd4\u56de\u6392\u540d\u503c\u3002\u4f46\u662f\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5b9a\u4e49`myrank_init()`\u3001`myrank_update()`\u548c`myrank_deinit()`\u51fd\u6570\u3002\u7279\u5b9a\u7684\u5df2\u77e5\u540e\u7f00\u96c6\u548c\u8c03\u7528\u53c2\u6570\u6839\u636e\u63d2\u4ef6\u7c7b\u578b\u800c\u5f02\uff0c\u4f46_init()\u548c_deinit()\u662f\u901a\u7528\u7684\uff0c\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u6709\u5b83\u4eec\u3002\u63d0\u793a\uff1a\u8981\u5feb\u901f\u53c2\u8003\u5df2\u77e5\u7684\u540e\u7f00\u53ca\u5176\u53c2\u6570\u7c7b\u578b\uff0c\u8bf7\u53c2\u9605`sphinxplugin.h`\uff0c\u5176\u4e2d\u5728\u6587\u4ef6\u5f00\u5934\u5b9a\u4e49\u4e86\u8c03\u7528\u539f\u578b\u3002\n\n\u5c3d\u7ba1\u516c\u5171\u63a5\u53e3\u662f\u7eafC\u5b9a\u4e49\u7684\uff0c\u4f46\u6211\u4eec\u7684\u63d2\u4ef6\u5b9e\u9645\u4e0a\u9075\u5faa\u4e00\u79cd*\u9762\u5411\u5bf9\u8c61\u6a21\u578b*\u3002\u786e\u5b9e\uff0c\u6bcf\u4e2a_init()\u51fd\u6570\u63a5\u6536\u4e00\u4e2a`void ** userdata`\u8f93\u51fa\u53c2\u6570\uff0c\u7136\u540e\u5c06\u5b58\u50a8\u5728`(*userdata)`\u4e2d\u7684\u6307\u9488\u503c\u4f5c\u4e3a\u6240\u6709\u5176\u4ed6\u63d2\u4ef6\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u9012\u3002\u56e0\u6b64\uff0c\u60a8\u53ef\u4ee5\u5c06\u63d2\u4ef6\u89c6\u4e3a\u6bcf\u6b21\u9700\u8981\u5904\u7406\u8bf7\u6c42\u7684\u5bf9\u8c61\u7684*\u7c7b*\u5b9e\u4f8b\u5316\uff1auserdata\u6307\u9488\u5145\u5f53this\u6307\u9488\uff1b\u51fd\u6570\u4f5c\u4e3a\u65b9\u6cd5\uff0c\u800c_init()\u548c_deinit()\u51fd\u6570\u5206\u522b\u4f5c\u4e3a\u6784\u9020\u51fd\u6570\u548c\u6790\u6784\u51fd\u6570\u3002\n\n\u7531\u4e8e\u63d2\u4ef6\u8fd0\u884c\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\uff0c\u4e14\u67d0\u4e9b\u63d2\u4ef6\u9700\u8981\u7ef4\u62a4\u72b6\u6001\uff0c\u56e0\u6b64\u8fd9\u79cd\u9762\u5411\u5bf9\u8c61\u7684C\u8bed\u8a00\u5fae\u5c0f\u590d\u6742\u6027\u662f\u56e0\u4e3a\u60a8\u4e0d\u80fd\u5728\u63d2\u4ef6\u4e2d\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u6765\u5b58\u50a8\u72b6\u6001\uff0c\u6240\u4ee5\u6211\u4eec\u4f20\u9012userdata\u53c2\u6570\uff0c\u81ea\u7136\u5bfc\u81f4\u9762\u5411\u5bf9\u8c61\u6a21\u578b\u3002\u5982\u679c\u60a8\u7684\u63d2\u4ef6\u7b80\u5355\u4e14\u65e0\u72b6\u6001\uff0c\u63a5\u53e3\u5141\u8bb8\u60a8\u7701\u7565_init()\u3001_deinit()\u548c\u5176\u4ed6\u4efb\u4f55\u51fd\u6570\u3002\n\n\u603b\u4e4b\uff0c\u8fd9\u91cc\u662f\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u5b8c\u6574\u6392\u540d\u5668\u63d2\u4ef6\uff0c\u4ec5\u7528\u4e09\u884cC\u4ee3\u7801\u5b9e\u73b0\uff1a\n\nCODE_BLOCK_1\n\n\u8fd9\u662f\u5982\u4f55\u4f7f\u7528\u7b80\u5355\u7684\u6392\u540d\u5668\u63d2\u4ef6\uff1a\n\nCODE_BLOCK_2\n<!-- \u8bf7\u6821\u5bf9 -->",
            "russian": "# UDF \u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u044b\n\nManticore \u043c\u043e\u0436\u043d\u043e \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439, \u0438\u043b\u0438 \u0441\u043e\u043a\u0440\u0430\u0449\u0435\u043d\u043d\u043e UDF, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0442\u0430\u043a:\n\nCODE_BLOCK_0\n\n\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0438 \u0432\u044b\u0433\u0440\u0443\u0436\u0430\u0442\u044c UDF \u0432 `searchd` \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u0445 \u0432 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u0445 \u043f\u0440\u0438 \u043f\u043e\u0438\u0441\u043a\u0435, \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0438 \u0442.\u0434. \u041a\u0440\u0430\u0442\u043a\u0438\u0439 \u043e\u0431\u0437\u043e\u0440 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0435\u0439 UDF:\n\n* UDF \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0446\u0435\u043b\u043e\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0435 (\u043a\u0430\u043a 32-\u0431\u0438\u0442\u043d\u044b\u0435, \u0442\u0430\u043a \u0438 64-\u0431\u0438\u0442\u043d\u044b\u0435), \u0432\u0435\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435, \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b, \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b \u0442\u0438\u043f\u0430 MVA \u0438\u043b\u0438 `PACKEDFACTORS()`.\n* UDF \u043c\u043e\u0433\u0443\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0446\u0435\u043b\u043e\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0435, \u0432\u0435\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u0438\u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f.\n* UDF \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e, \u0442\u0438\u043f\u044b \u0438 \u0438\u043c\u0435\u043d\u0430 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u043d\u0430 \u044d\u0442\u0430\u043f\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0438.\n\n\u041c\u044b \u043f\u043e\u043a\u0430 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438. \u0414\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u0432\u0430\u0448\u0438 UDF \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u043e\u0434\u043d\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 \u0437\u0430 \u0440\u0430\u0437 \u0438 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430. \u041d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u0442\u0430\u043a\u043e\u0435 \u043a\u0430\u043a AVG(), \u0434\u043b\u044f \u0432\u0441\u0435\u0439 \u0433\u0440\u0443\u043f\u043f\u044b \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u0438\u043c\u0435\u044e\u0449\u0438\u0445 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0439 \u043a\u043b\u044e\u0447 GROUP BY, \u043f\u043e\u043a\u0430 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c UDF \u0432\u043d\u0443\u0442\u0440\u0438 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0445 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439: \u0442\u043e \u0435\u0441\u0442\u044c, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 MYCUSTOMAVG() \u043f\u043e\u043a\u0430 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f, AVG(MYCUSTOMFUNC()) \u0434\u043e\u043b\u0436\u0435\u043d \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u043e\u0442\u043b\u0438\u0447\u043d\u043e!\n\nUDF \u043f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u044e\u0442 \u0448\u0438\u0440\u043e\u043a\u0438\u0439 \u0441\u043f\u0435\u043a\u0442\u0440 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0439, \u0442\u0430\u043a\u0438\u0445 \u043a\u0430\u043a:\n\n* \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0438\u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439;\n* \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0431\u0430\u0437\u0430\u043c \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u043b\u0438 \u0444\u0430\u0439\u043b\u0430\u043c \u0438\u0437\u043d\u0443\u0442\u0440\u0438 Manticore;\n* \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f.\n\n## \u041f\u043b\u0430\u0433\u0438\u043d\u044b\n\n\u041f\u043b\u0430\u0433\u0438\u043d\u044b \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u043f\u043e\u0438\u0441\u043a\u0430. \u0412 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0438\u0445 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0435\u0439, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0434\u043b\u044f \u0442\u043e\u043a\u0435\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432.\n\n\u0412\u043e\u0442 \u043f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0438\u043f\u043e\u0432 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432:\n\n* \u041f\u043b\u0430\u0433\u0438\u043d\u044b UDF (\u043f\u043e \u0441\u0443\u0442\u0438, UDF, \u043d\u043e \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043e\u043d\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u044e\u0442\u0441\u044f, \u0438\u0445 \u0442\u0430\u043a\u0436\u0435 \u043d\u0430\u0437\u044b\u0432\u0430\u044e\u0442 '\u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438 UDF')\n* \u041f\u043b\u0430\u0433\u0438\u043d\u044b \u0440\u0430\u043d\u043a\u0435\u0440\u0430\n* \u041f\u043b\u0430\u0433\u0438\u043d\u044b \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u0438\n* \u041f\u043b\u0430\u0433\u0438\u043d\u044b \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430\n\n\u0412 \u044d\u0442\u043e\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435 \u0440\u0430\u0441\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043e\u0431\u0449\u0438\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438; \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u0430\u044f \u0441 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435\u043c \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432, \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u0435\u0442\u0441\u044f \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0430\u0445.\n\n\u0418\u0442\u0430\u043a, \u043a\u0430\u043a \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043b\u0430\u0433\u0438\u043d? \u0412\u043e\u0442 \u043a\u0440\u0430\u0442\u043a\u043e\u0435 \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u0438\u0437 \u0447\u0435\u0442\u044b\u0440\u0435\u0445 \u0448\u0430\u0433\u043e\u0432:\n\n* \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443 (\u043b\u0438\u0431\u043e .so, \u043b\u0438\u0431\u043e .dll), \u0441\u043a\u043e\u0440\u0435\u0435 \u0432\u0441\u0435\u0433\u043e, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f C \u0438\u043b\u0438 C++;\n* \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043f\u043b\u0430\u0433\u0438\u043d \u0432 searchd \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e [CREATE PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Creating_a_plugin.md);\n* \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043f\u043b\u0430\u0433\u0438\u043d \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u044b\u0445 \u0434\u043b\u044f \u043f\u043b\u0430\u0433\u0438\u043d\u0430 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 (\u043e\u0431\u044b\u0447\u043d\u043e \u0447\u0435\u0440\u0435\u0437 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 OPTIONS).\n* \u0432\u044b\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043f\u043b\u0430\u0433\u0438\u043d \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e [DROP PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Deleting_a_plugin.md) \u0438 [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md) \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e.\n\n\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0445\u043e\u0442\u044f UDF \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u043e\u0446\u0435\u043d\u043d\u044b\u043c\u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438, \u043e\u043d\u0438 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md). \u042d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0430\u043a\u043a\u0443\u0440\u0430\u0442\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0442\u0438\u043f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u043d\u0435 \u0436\u0435\u0440\u0442\u0432\u0443\u044f \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u0439 \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u044c\u044e \u0438 \u043d\u0435 \u043c\u0435\u043d\u044f\u044f \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441.\n\n\u0414\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0432 \u043f\u043e\u0442\u043e\u043a\u0430\u0445 \u0438 \u0432\u043e\u0440\u043a\u0435\u0440\u0430\u0445 thread_pool. \u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432 (\u0438/\u0438\u043b\u0438 UDF) \u043c\u043e\u0433\u0443\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u043c \u0444\u0430\u0439\u043b\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438. \u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043b\u0438\u0431\u043e \u0441\u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u043f\u043b\u0430\u0433\u0438\u043d\u044b, \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u044b\u0435 \u0434\u043b\u044f \u043f\u0440\u043e\u0435\u043a\u0442\u0430, \u0432 \u043e\u0434\u043d\u043e\u0439 \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0435, \u043b\u0438\u0431\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 UDF \u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u0430; \u044d\u0442\u043e \u043d\u0430 \u0432\u0430\u0448\u0435 \u0443\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u0438\u0435.\n\n\u041a\u0430\u043a \u0438 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u0441 UDF, \u0432\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b `src/sphinxudf.h`. \u041a\u0430\u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c, \u0432\u0430\u043c \u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u0441\u044f \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430 `SPH_UDF_VERSION` \u0434\u043b\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0432\u0435\u0440\u0441\u0438\u0438. \u0412 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u043f\u043b\u0430\u0433\u0438\u043d\u0430, \u0432\u0430\u043c \u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u044c\u0441\u044f \u0438\u043b\u0438 \u043d\u0435 \u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u044c\u0441\u044f \u043b\u0438\u043d\u043a\u043e\u0432\u0430\u0442\u044c \u0432\u0430\u0448 \u043f\u043b\u0430\u0433\u0438\u043d \u0441 `src/sphinxudf.c`. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u0441\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438, \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0432 `sphinxudf.c`, \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u043a\u043e\u0439 \u0431\u0438\u043d\u0430\u0440\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 `PACKEDFACTORS()`, \u0438 \u043d\u0438 \u043e\u0434\u0438\u043d \u0442\u0438\u043f \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432 \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u044d\u0442\u0438\u043c \u0434\u0430\u043d\u043d\u044b\u043c. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043b\u0438\u043d\u043a\u043e\u0432\u043a\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0441 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u043c \u0444\u0430\u0439\u043b\u043e\u043c. (\u0424\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438, \u0435\u0441\u043b\u0438 \u0432\u044b \u0441\u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u0432\u0435\u0440\u0441\u0438\u0438 UDF, \u0432\u0430\u043c \u0434\u0430\u0436\u0435 \u043d\u0435 \u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u0441\u044f \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432.)\n\n\u0424\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u2014 \u044d\u0442\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u043d\u0430\u0431\u043e\u0440\u044b \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u043d\u0430 \u044f\u0437\u044b\u043a\u0435 C, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0448\u0430\u0431\u043b\u043e\u043d\u0443 \u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044f. \u041e\u0431\u044b\u0447\u043d\u043e \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043e\u0434\u043d\u0443 \u043a\u043b\u044e\u0447\u0435\u0432\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0438, \u043d\u043e \u043c\u043e\u0436\u043d\u043e \u0442\u0430\u043a\u0436\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0447\u0442\u043e\u0431\u044b \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0440\u0430\u043d\u043a\u0435\u0440 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c \"myrank\", \u0432\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e `myrank_finalize()`, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u044b \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u0438 `myrank_init()`, `myrank_update()` \u0438 `myrank_deinit()`. \u041a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u043d\u0430\u0431\u043e\u0440\u044b \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u043e\u0432 \u0438 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0432\u044b\u0437\u043e\u0432\u0430 \u0440\u0430\u0437\u043b\u0438\u0447\u0430\u044e\u0442\u0441\u044f \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0442\u0438\u043f\u0430 \u043f\u043b\u0430\u0433\u0438\u043d\u0430, \u043d\u043e _init() \u0438 _deinit() \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u043e\u0431\u0449\u0438\u043c\u0438, \u0438 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c \u0443 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u0430. \u041f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0430: \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u0441 \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u043c\u0438 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u0430\u043c\u0438 \u0438 \u0438\u0445 \u0442\u0438\u043f\u0430\u043c\u0438 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a `sphinxplugin.h`, \u0433\u0434\u0435 \u043f\u0440\u043e\u0442\u043e\u0442\u0438\u043f\u044b \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u044b \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u0444\u0430\u0439\u043b\u0430.\n\n\u0425\u043e\u0442\u044f \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d \u043d\u0430 \u0447\u0438\u0441\u0442\u043e\u043c C, \u043d\u0430\u0448\u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u043f\u043e \u0441\u0443\u0442\u0438 \u0441\u043b\u0435\u0434\u0443\u044e\u0442 *\u043e\u0431\u044a\u0435\u043a\u0442\u043d\u043e-\u043e\u0440\u0438\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u043c\u043e\u0434\u0435\u043b\u0438*. \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e, \u043a\u0430\u0436\u0434\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f `_init()` \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0432\u044b\u0445\u043e\u0434\u043d\u043e\u0439 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 `void ** userdata`, \u0438 \u0437\u0430\u0442\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f, \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u043e\u0435 \u0432 `(*userdata)`, \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0432\u0441\u0435\u043c \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c \u043f\u043b\u0430\u0433\u0438\u043d\u0430. \u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u0443\u043c\u0430\u0442\u044c \u043e \u043f\u043b\u0430\u0433\u0438\u043d\u0435 \u043a\u0430\u043a \u043e *\u043a\u043b\u0430\u0441\u0441\u0435*, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043e\u0431\u044a\u0435\u043a\u0442 \u044d\u0442\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430: \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c `userdata` \u0441\u043b\u0443\u0436\u0438\u0442 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c `this`; \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0442 \u043a\u0430\u043a \u043c\u0435\u0442\u043e\u0434\u044b, \u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 `_init()` \u0438 `_deinit()` \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442 \u043a\u0430\u043a \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440 \u0438 \u0434\u0435\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e.\n\n\u042d\u0442\u0430 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0430\u044f \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0441 \u041e\u041e\u041f \u043d\u0430 C \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442 \u043f\u043e\u0442\u043e\u043c\u0443, \u0447\u0442\u043e \u043f\u043b\u0430\u0433\u0438\u043d\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442 \u0432 \u043c\u043d\u043e\u0433\u043e\u043f\u043e\u0442\u043e\u0447\u043d\u043e\u0439 \u0441\u0440\u0435\u0434\u0435, \u0438 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435. \u0412\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0432 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0432 \u0432\u0430\u0448\u0435\u043c \u043f\u043b\u0430\u0433\u0438\u043d\u0435, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043c\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 userdata, \u0447\u0442\u043e \u0435\u0441\u0442\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u041e\u041e\u041f-\u043c\u043e\u0434\u0435\u043b\u0438. \u0415\u0441\u043b\u0438 \u0432\u0430\u0448 \u043f\u043b\u0430\u0433\u0438\u043d \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0438 \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f, \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c `_init()`, `_deinit()` \u0438 \u043b\u044e\u0431\u044b\u0435 \u0434\u0440\u0443\u0433\u0438\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438.\n\n\u041f\u043e\u0434\u0432\u043e\u0434\u044f \u0438\u0442\u043e\u0433, \u0432\u043e\u0442 \u0441\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u043b\u0430\u0433\u0438\u043d \u0440\u0430\u043d\u043a\u0435\u0440\u0430 \u0432\u0441\u0435\u0433\u043e \u0432 \u0442\u0440\u0435\u0445 \u0441\u0442\u0440\u043e\u043a\u0430\u0445 \u043a\u043e\u0434\u0430 \u043d\u0430 C:\n\nCODE_BLOCK_1\n\n\u0412\u043e\u0442 \u043a\u0430\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u043b\u0430\u0433\u0438\u043d \u0440\u0430\u043d\u043a\u0435\u0440\u0430:\n\nCODE_BLOCK_2\n<!-- proofread -->"
        },
        "is_code_or_comment": false,
        "model": "deepseek/deepseek-v3.2",
        "updated_at": 1766374202
    },
    "__meta": {
        "source_text": "# UDFs and Plugins\n\nManticore can be extended with user-defined functions, or UDFs for short, like this:\n\n```sql\nSELECT id, attr1, myudf (attr2, attr3+attr4) ...\n```\n\nYou can dynamically load and unload UDFs into `searchd` without having to restart the server, and use them in expressions when searching, ranking, etc. A quick summary of the UDF features is as follows:\n\n* UDFs can take integer (both 32-bit and 64-bit), float, string, MVA, or `PACKEDFACTORS()` arguments.\n* UDFs can return integer, float, or string values.\n* UDFs can check the argument number, types, and names during the query setup phase, and raise errors.\n\nWe do not yet support aggregation functions. In other words, your UDFs will be called for just a single document at a time and are expected to return some value for that document. Writing a function that can compute an aggregate value like AVG() over the entire group of documents that share the same GROUP BY key is not yet possible. However, you can use UDFs within the built-in aggregate functions: that is, even though MYCUSTOMAVG() is not supported yet, AVG(MYCUSTOMFUNC()) should work just fine!\n\nUDFs offer a wide range of applications, such as:\n\n* incorporating custom mathematical or string functions;\n* accessing databases or files from within Manticore;\n* creating complex ranking functions.\n\n## Plugins\n\nPlugins offer additional opportunities to expand search functionality. They can currently be used to compute custom rankings and tokenize documents and queries.\n\nHere's the complete list of plugin types:\n\n* UDF plugins (essentially UDFs, but since they're plugged in, they're also referred to as 'UDF plugins')\n* ranker plugins\n* indexing-time token filter plugins\n* query-time token filter plugins\n\nThis section covers the general process of writing and managing plugins; specifics related to creating different types of plugins are discussed in their respective subsections.\n\nSo, how do you write and use a plugin? Here's a quick four-step guide:\n\n* create a dynamic library (either .so or .dll), most likely using C or C++;\n* load the plugin into searchd with [CREATE PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Creating_a_plugin.md);\n* use the plugin with plugin-specific calls (usually through specific OPTIONS).\n* unload or reload a plugin with [DROP PLUGIN](../../Extensions/UDFs_and_Plugins/Plugins/Deleting_a_plugin.md) and [RELOAD PLUGINS](../../Extensions/UDFs_and_Plugins/Plugins/Reloading_plugins.md), respectively.\n\nNote that while UDFs are first-class plugins, they are installed using a separate [CREATE FUNCTION](../../Extensions/UDFs_and_Plugins/UDF/Creating_a_function.md) statement. This allows for a neat specification of the return type, without sacrificing backward compatibility or changing the syntax.\n\nDynamic plugins are supported in threads and thread_pool workers. Multiple plugins (and/or UDFs) can be contained in a single library file. You may choose to either group all project-specific plugins in one large library or create a separate library for each UDF and plugin; it's up to you.\n\nAs with UDFs, you should include the `src/sphinxudf.h` header file. At the very least, you'll need the `SPH_UDF_VERSION` constant to implement an appropriate version function. Depending on the specific plugin type, you may or may not need to link your plugin with `src/sphinxudf.c`. However, all functions implemented in `sphinxudf.c` are related to unpacking the `PACKEDFACTORS()` blob, and no plugin types have access to that data. So currently, linking with just the header should suffice. (In fact, if you copy over the UDF version number, you won't even need the header file for some plugin types.)\n\nFormally, plugins are simply sets of C functions that adhere to a specific naming pattern. You're typically required to define one key function for the primary task, but you can also define additional functions. For instance, to implement a ranker called \"myrank\", you must define a `myrank_finalize()` function that returns the rank value. However, you can also define `myrank_init()`, `myrank_update()`, and `myrank_deinit()` functions. Specific sets of well-known suffixes and call arguments differ based on the plugin type, but _init() and _deinit() are generic, and every plugin has them. Hint: for a quick reference on known suffixes and their argument types, refer to `sphinxplugin.h`, where the call prototypes are defined at the beginning of the file.\n\nEven though the public interface is defined in pure C, our plugins essentially follow an *object-oriented model*. Indeed, every `_init()` function receives a `void ** userdata` out-parameter, and the pointer value stored at `(*userdata)` is then passed as the first argument to all other plugin functions. So you can think of a plugin as a *class* that gets instantiated every time an object of that class is needed to handle a request: the `userdata` pointer serves as the `this` pointer; the functions act as methods, and the `_init()` and `_deinit()` functions work as constructor and destructor, respectively.\n\nThis minor OOP-in-C complication arises because plugins run in a multi-threaded environment, and some need to maintain state. You can't store that state in a global variable in your plugin, so we pass around a userdata parameter, which naturally leads to the OOP model. If your plugin is simple and stateless, the interface allows you to omit `_init()`, `_deinit()`, and any other functions.\n\nTo summarize, here's the simplest complete ranker plugin in just three lines of C code:\n\n```c\n// gcc -fPIC -shared -o myrank.so myrank.c\n#include \"sphinxudf.h\"\nint myrank_ver() { return SPH_UDF_VERSION; }\nint myrank_finalize(void *u, int w) { return 123; }\n```\n\nHere's how to use the simple ranker plugin:\n\n```sql\nmysql> CREATE PLUGIN myrank TYPE 'ranker' SONAME 'myrank.dll';\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SELECT id, weight() FROM test1 WHERE MATCH('test') OPTION ranker=myrank('');\n+------+----------+\n| id   | weight() |\n+------+----------+\n|    1 |      123 |\n|    2 |      123 |\n+------+----------+\n2 rows in set (0.01 sec)\n```\n<!-- proofread -->\n\n\n",
        "updated_at": 1768530797,
        "source_md5": "40e47f7e2f0538da8915ce72b8e109bb"
    }
}