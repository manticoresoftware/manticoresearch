{
    "ddc1869a663b46438ff09266014c222b4b40e6ff7a142451c523567911556489": {
        "original": "Table functions are a mechanism for post-query result set processing. Table functions take an arbitrary result set as input and return a new, processed set as output. The first argument should be the input result set, but a table function can optionally take and handle more arguments. Table functions can completely change the result set, including the schema. Currently, only built-in table functions are supported. Table functions work for both outer `SELECT` and [nested SELECT](../Searching/Sub-selects.md).\n\n<!-- proofread -->\n\n",
        "translations": {
            "chinese": "\u8868\u51fd\u6570\u662f\u4e00\u79cd\u7528\u4e8e\u67e5\u8be2\u540e\u7ed3\u679c\u96c6\u5904\u7406\u7684\u673a\u5236\u3002\u8868\u51fd\u6570\u63a5\u6536\u4efb\u610f\u7ed3\u679c\u96c6\u4f5c\u4e3a\u8f93\u5165\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u3001\u7ecf\u8fc7\u5904\u7406\u7684\u7ed3\u679c\u96c6\u4f5c\u4e3a\u8f93\u51fa\u3002\u7b2c\u4e00\u4e2a\u53c2\u6570\u5e94\u4e3a\u8f93\u5165\u7ed3\u679c\u96c6\uff0c\u4f46\u8868\u51fd\u6570\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u63a5\u53d7\u548c\u5904\u7406\u66f4\u591a\u53c2\u6570\u3002\u8868\u51fd\u6570\u53ef\u4ee5\u5b8c\u5168\u6539\u53d8\u7ed3\u679c\u96c6\uff0c\u5305\u62ec\u5176\u6a21\u5f0f\u3002\u76ee\u524d\uff0c\u4ec5\u652f\u6301\u5185\u7f6e\u8868\u51fd\u6570\u3002\u8868\u51fd\u6570\u9002\u7528\u4e8e\u5916\u90e8`SELECT`\u548c[\u5d4c\u5957SELECT](../Searching/Sub-selects.md)\u3002\n\n<!-- proofread -->",
            "russian": "\u0424\u0443\u043d\u043a\u0446\u0438\u0438 \u0442\u0430\u0431\u043b\u0438\u0446 \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u043e\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u043d\u0430\u0431\u043e\u0440\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430. \u0424\u0443\u043d\u043a\u0446\u0438\u0438 \u0442\u0430\u0431\u043b\u0438\u0446 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u044e\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0432\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442 \u043d\u043e\u0432\u044b\u0439, \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0432\u044b\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445. \u041f\u0435\u0440\u0432\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0432\u0445\u043e\u0434\u043d\u044b\u043c \u043d\u0430\u0431\u043e\u0440\u043e\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432, \u043d\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043c\u043e\u0436\u0435\u0442 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0438 \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432. \u0424\u0443\u043d\u043a\u0446\u0438\u0438 \u0442\u0430\u0431\u043b\u0438\u0446 \u043c\u043e\u0433\u0443\u0442 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430\u0431\u043e\u0440 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432, \u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0441\u0445\u0435\u043c\u0443. \u0412 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0442\u0430\u0431\u043b\u0438\u0446. \u0424\u0443\u043d\u043a\u0446\u0438\u0438 \u0442\u0430\u0431\u043b\u0438\u0446 \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442 \u043a\u0430\u043a \u0434\u043b\u044f \u0432\u043d\u0435\u0448\u043d\u0435\u0433\u043e `SELECT`, \u0442\u0430\u043a \u0438 \u0434\u043b\u044f [\u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0433\u043e SELECT](../Searching/Sub-selects.md).\n\n<!-- proofread -->\n\n"
        },
        "is_code_or_comment": false,
        "model": "openai:gpt-4o-mini",
        "updated_at": 1766374285
    },
    "bdfef8400ef2ce943837b4d6c46f773dcb8ce524395b76da2478ee8693e59ddf": {
        "original": "# Searching and ranking functions\n\n### BM25A()\n`BM25A(k1,b)` returns the exact `BM25A()` value. Requires the `expr` ranker and enabled `index_field_lengths`. Parameters `k1` and `b` must be floats.\n\n### BM25F()\n`BM25F(k1, b, {field=weight, ...})` returns the exact `BM25F()` value and requires `index_field_lengths` to be enabled. The `expr` ranker is also necessary. Parameters `k1` and `b` must be floats.\n\n### EXIST()\nSubstitutes non-existent columns with default values. It returns either the value of an attribute specified by 'attr-name', or the 'default-value' if that attribute does not exist. STRING or MVA attributes are not supported. This function is useful when searching through multiple tables with different schemas.\n\nCODE_BLOCK_0\n\n### MIN_TOP_SORTVAL()\nReturns the sort key value of the worst-ranked element in the current top-N matches if the sort key is a float, and 0 otherwise.\n\n### MIN_TOP_WEIGHT()\nReturns the weight of the worst-ranked element in the current top-N matches.\n\n### PACKEDFACTORS()\n`PACKEDFACTORS()` can be used in queries to display all calculated weighting factors during matching or to provide a binary attribute for creating a custom ranking UDF. This function only works if the expression ranker is specified and the query is not a full scan; otherwise, it returns an error. `PACKEDFACTORS()` can take an optional argument that disables ATC ranking factor calculation: `PACKEDFACTORS({no_atc=1})`. Calculating ATC significantly slows down query processing, so this option can be useful if you need to see the ranking factors but don't require ATC. `PACKEDFACTORS()` can also output in JSON format: `PACKEDFACTORS({json=1})`. The respective outputs in either key-value pair or JSON format are shown below. (Note that the examples below are wrapped for readability; actual returned values would be single-line.)\n\nCODE_BLOCK_1\n\nCODE_BLOCK_2\n\nThis function can be used to implement custom ranking functions in UDFs, as in:\n\nCODE_BLOCK_3\n\nWhere `CUSTOM_RANK()` is a function implemented in a UDF. It should declare a `SPH_UDF_FACTORS` structure (defined in sphinxudf.h), initialize this structure, unpack the factors into it before usage, and deinitialize it afterwards, as follows:\n\nCODE_BLOCK_4\n\n`PACKEDFACTORS()` data is available at all query stages, not just during the initial matching and ranking pass. This enables another particularly interesting application of `PACKEDFACTORS()`: re-ranking.\n\nIn the example above, we used an expression-based ranker with a dummy expression and sorted the result set by the value computed by our UDF. In other words, we used the UDF to rank all our results. Now, let's assume for the sake of an example that our UDF is extremely expensive to compute, with a throughput of only 10,000 calls per second. If our query matches 1,000,000 documents, we would want to use a much simpler expression to do most of our ranking in order to maintain reasonable performance. Then, we would apply the expensive UDF to only a few top results, say, the top 100 results. In other words, we would build the top 100 results using a simpler ranking function and then re-rank those with a more complex one. This can be done with subselects:\n\nCODE_BLOCK_5\n\nIn this example, the expression-based ranker is called for every matched document to compute `WEIGHT()`, so it gets called 1,000,000 times. However, the UDF computation can be postponed until the outer sort, and it will only be performed for the top 100 matches by `WEIGHT()`, according to the inner limit. This means the UDF will only be called 100 times. Finally, the top 10 matches by UDF value are selected and returned to the application.\n\nFor reference, in a distributed setup, the `PACKEDFACTORS()` data is sent from the agents to the master node in binary format. This makes it technically feasible to implement additional re-ranking passes on the master node if needed.\n\nWhen used in SQL but not called from any UDFs, the result of `PACKEDFACTORS()` is formatted as plain text, which can be used to manually assess the ranking factors. Note that this feature is not currently supported by the Manticore API.\n\n\n### REMOVE_REPEATS()\n`REMOVE_REPEATS ( result_set, column, offset, limit )` - removes repeated adjusted rows with the same 'column' value.\n\nCODE_BLOCK_6\nNote that `REMOVE_REPEATS` does not affect `total_found` in the [search query meta info](../Node_info_and_management/SHOW_META.md#SHOW-META).\n\n### WEIGHT()\nThe `WEIGHT()` function returns the calculated matching score. If no ordering is specified, the result is sorted in descending order by the score provided by `WEIGHT()`. In this example, we order first by weight and then by an integer attribute.\n\nThe search above performs a simple matching, where all words need to be present. However, we can do more (and this is just a simple example):\n\nCODE_BLOCK_7\n\nHere, we search for four words, but a match can occur even if only three of the four words are found. The search will rank documents containing all words higher.\n\n### ZONESPANLIST()\nThe `ZONESPANLIST()` function returns pairs of matched zone spans. Each pair contains the matched zone span identifier, a colon, and the order number of the matched zone span. For example, if a document reads `<emphasis role=\"bold\"><i>text</i> the <i>text</i></emphasis>`, and you query for `'ZONESPAN:(i,b) text'`, then `ZONESPANLIST()` will return the string `\"1:1 1:2 2:1\"`, meaning that the first zone span matched \"text\" in spans 1 and 2, and the second zone span in span 1 only.\n\n### QUERY()\n`QUERY()` returns the current search query. `QUERY()` is a postlimit expression and is intended to be used with [SNIPPET()](../Functions/String_functions.md#SNIPPET%28%29).",
        "translations": {
            "chinese": "# \u641c\u7d22\u548c\u6392\u5e8f\u51fd\u6570\n\n### BM25A()\n`BM25A(k1,b)` \u8fd4\u56de\u7cbe\u786e\u7684 `BM25A()` \u503c\u3002\u9700\u8981 `expr` \u6392\u5e8f\u5668\u5e76\u542f\u7528 `index_field_lengths`\u3002\u53c2\u6570 `k1` \u548c `b` \u5fc5\u987b\u662f\u6d6e\u70b9\u6570\u3002\n\n### BM25F()\n`BM25F(k1, b, {field=weight, ...})` \u8fd4\u56de\u7cbe\u786e\u7684 `BM25F()` \u503c\uff0c\u4e14\u9700\u8981\u542f\u7528 `index_field_lengths`\u3002\u540c\u6837\u9700\u8981 `expr` \u6392\u5e8f\u5668\u3002\u53c2\u6570 `k1` \u548c `b` \u5fc5\u987b\u662f\u6d6e\u70b9\u6570\u3002\n\n### EXIST()\n\u7528\u9ed8\u8ba4\u503c\u66ff\u4ee3\u4e0d\u5b58\u5728\u7684\u5217\u3002\u8fd4\u56de\u7531 'attr-name' \u6307\u5b9a\u7684\u5c5e\u6027\u503c\uff1b\u5982\u679c\u8be5\u5c5e\u6027\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de 'default-value'\u3002\u4e0d\u652f\u6301 STRING \u6216 MVA \u5c5e\u6027\u3002\u6b64\u51fd\u6570\u5728\u641c\u7d22\u5177\u6709\u4e0d\u540c\u6a21\u5f0f\u7684\u591a\u4e2a\u8868\u65f6\u975e\u5e38\u6709\u7528\u3002\n\nCODE_BLOCK_0\n\n### MIN_TOP_SORTVAL()\n\u5982\u679c\u6392\u5e8f\u952e\u662f\u6d6e\u70b9\u6570\uff0c\u5219\u8fd4\u56de\u5f53\u524d top-N \u5339\u914d\u4e2d\u6392\u540d\u6700\u5dee\u5143\u7d20\u7684\u6392\u5e8f\u952e\u503c\uff0c\u5426\u5219\u8fd4\u56de 0\u3002\n\n### MIN_TOP_WEIGHT()\n\u8fd4\u56de\u5f53\u524d top-N \u5339\u914d\u4e2d\u6392\u540d\u6700\u5dee\u5143\u7d20\u7684\u6743\u91cd\u3002\n\n### PACKEDFACTORS()\n`PACKEDFACTORS()` \u53ef\u7528\u4e8e\u67e5\u8be2\u4e2d\u663e\u793a\u5339\u914d\u671f\u95f4\u8ba1\u7b97\u7684\u6240\u6709\u52a0\u6743\u56e0\u5b50\uff0c\u6216\u63d0\u4f9b\u4e8c\u8fdb\u5236\u5c5e\u6027\u4ee5\u521b\u5efa\u81ea\u5b9a\u4e49\u6392\u540d UDF\u3002\u6b64\u51fd\u6570\u4ec5\u5728\u6307\u5b9a\u8868\u8fbe\u5f0f\u6392\u5e8f\u5668\u4e14\u67e5\u8be2\u4e0d\u662f\u5168\u626b\u63cf\u65f6\u6709\u6548\uff1b\u5426\u5219\u8fd4\u56de\u9519\u8bef\u3002`PACKEDFACTORS()` \u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\u7981\u7528 ATC \u6392\u540d\u56e0\u5b50\u8ba1\u7b97\uff1a`PACKEDFACTORS({no_atc=1})`\u3002\u8ba1\u7b97 ATC \u4f1a\u663e\u8457\u964d\u4f4e\u67e5\u8be2\u901f\u5ea6\uff0c\u6240\u4ee5\u5982\u679c\u9700\u8981\u67e5\u770b\u6392\u540d\u56e0\u5b50\u4f46\u4e0d\u9700\u8981 ATC\uff0c\u6b64\u9009\u9879\u5f88\u6709\u7528\u3002`PACKEDFACTORS()` \u4e5f\u53ef\u4ee5\u4ee5 JSON \u683c\u5f0f\u8f93\u51fa\uff1a`PACKEDFACTORS({json=1})`\u3002\u4e0b\u9762\u5206\u522b\u5c55\u793a\u4e86\u952e\u503c\u5bf9\u683c\u5f0f\u548c JSON \u683c\u5f0f\u7684\u8f93\u51fa\u3002\uff08\u6ce8\u610f\uff0c\u4e0b\u9762\u7684\u793a\u4f8b\u4e3a\u4fbf\u4e8e\u9605\u8bfb\u8fdb\u884c\u4e86\u6362\u884c\uff1b\u5b9e\u9645\u8fd4\u56de\u7684\u503c\u662f\u5355\u884c\u7684\u3002\uff09\n\nCODE_BLOCK_1\n\nCODE_BLOCK_2\n\n\u6b64\u51fd\u6570\u53ef\u7528\u4e8e UDF \u4e2d\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6392\u540d\u51fd\u6570\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n\nCODE_BLOCK_3\n\n\u5176\u4e2d `CUSTOM_RANK()` \u662f UDF \u4e2d\u5b9e\u73b0\u7684\u51fd\u6570\u3002\u5b83\u5e94\u58f0\u660e\u4e00\u4e2a `SPH_UDF_FACTORS` \u7ed3\u6784\u4f53\uff08\u5b9a\u4e49\u4e8e sphinxudf.h\uff09\uff0c\u521d\u59cb\u5316\u8be5\u7ed3\u6784\u4f53\uff0c\u4f7f\u7528\u524d\u89e3\u5305\u56e0\u5b50\u5e76\u5728\u4f7f\u7528\u540e\u53cd\u521d\u59cb\u5316\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a\n\nCODE_BLOCK_4\n\n`PACKEDFACTORS()` \u6570\u636e\u5728\u6240\u6709\u67e5\u8be2\u9636\u6bb5\u5747\u53ef\u7528\uff0c\u4e0d\u4ec5\u9650\u4e8e\u521d\u59cb\u5339\u914d\u548c\u6392\u540d\u9636\u6bb5\u3002\u8fd9\u4f7f\u5f97 `PACKEDFACTORS()` \u6709\u4e00\u4e2a\u7279\u522b\u6709\u8da3\u7684\u5e94\u7528\uff1a\u91cd\u6392\u540d\u3002\n\n\u4ee5\u4e0a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u8868\u8fbe\u5f0f\u6392\u5e8f\u5668\u5e76\u4f20\u5165\u4e00\u4e2a\u7a7a\u8868\u8fbe\u5f0f\uff0c\u7136\u540e\u6309 UDF \u8ba1\u7b97\u7684\u503c\u5bf9\u7ed3\u679c\u96c6\u6392\u5e8f\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528 UDF \u5bf9\u6240\u6709\u7ed3\u679c\u8fdb\u884c\u6392\u5e8f\u3002\u73b0\u5728\uff0c\u5047\u8bbe\u6211\u4eec\u7684 UDF \u975e\u5e38\u6602\u8d35\uff0c\u8c03\u7528\u541e\u5410\u91cf\u53ea\u6709\u6bcf\u79d2 10,000 \u6b21\u3002\u5982\u679c\u6211\u4eec\u7684\u67e5\u8be2\u5339\u914d\u4e86 1,000,000 \u6761\u6587\u6863\uff0c\u6211\u4eec\u4f1a\u60f3\u7528\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u8868\u8fbe\u5f0f\u8fdb\u884c\u5927\u90e8\u5206\u6392\u5e8f\u4ee5\u4fdd\u6301\u5408\u7406\u6027\u80fd\u3002\u7136\u540e\u53ea\u5bf9\u524d 100 \u6761\u7ed3\u679c\u5e94\u7528\u6602\u8d35\u7684 UDF\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u7528\u4e00\u4e2a\u7b80\u5355\u6392\u5e8f\u6784\u9020\u524d 100 \u6761\u7ed3\u679c\uff0c\u518d\u7528\u590d\u6742\u51fd\u6570\u5bf9\u5b83\u4eec\u91cd\u6392\u540d\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u7528\u5b50\u67e5\u8be2\u5b9e\u73b0\uff1a\n\nCODE_BLOCK_5\n\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u8868\u8fbe\u5f0f\u6392\u5e8f\u5668\u5bf9\u6bcf\u4e2a\u5339\u914d\u6587\u6863\u8c03\u7528\u4ee5\u8ba1\u7b97 `WEIGHT()`\uff0c\u56e0\u6b64\u8c03\u7528\u4e86 1,000,000 \u6b21\u3002\u4f46 UDF \u8ba1\u7b97\u63a8\u8fdf\u5230\u5916\u5c42\u6392\u5e8f\uff0c\u4ec5\u5bf9\u5185\u5c42\u9650\u5236\u4e2d\u7684 top 100 \u8ba1\u7b97\uff0c\u5373\u8c03\u7528\u4e86 100 \u6b21\u3002\u6700\u540e\u9009\u51fa UDF \u6392\u540d\u524d 10 \u7684\u7ed3\u679c\u8fd4\u56de\u3002\n\n\u4f5c\u4e3a\u53c2\u8003\uff0c\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e2d\uff0c`PACKEDFACTORS()` \u6570\u636e\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u4ece\u4ee3\u7406\u53d1\u9001\u5230\u4e3b\u8282\u70b9\u3002\u8fd9\u4f7f\u5f97\u5728\u4e3b\u8282\u70b9\u5b9e\u73b0\u9644\u52a0\u7684\u91cd\u6392\u540d\u8fc7\u7a0b\u6280\u672f\u4e0a\u53ef\u884c\u3002\n\n\u5728 SQL \u4e2d\u4f7f\u7528\u4f46\u4e0d\u4ece\u4efb\u4f55 UDF \u8c03\u7528\u65f6\uff0c`PACKEDFACTORS()` \u7684\u7ed3\u679c\u683c\u5f0f\u4e3a\u7eaf\u6587\u672c\uff0c\u53ef\u7528\u4e8e\u4eba\u5de5\u8bc4\u4f30\u6392\u540d\u56e0\u5b50\u3002\u6ce8\u610f\uff0c\u8be5\u529f\u80fd\u5f53\u524d\u4e0d\u88ab Manticore API \u652f\u6301\u3002\n\n\n### REMOVE_REPEATS()\n`REMOVE_REPEATS ( result_set, column, offset, limit )` - \u79fb\u9664\u5728\u6307\u5b9a 'column' \u4e0a\u503c\u91cd\u590d\u7684\u8c03\u6574\u884c\u3002\n\nCODE_BLOCK_6\n\u6ce8\u610f\uff0c`REMOVE_REPEATS` \u4e0d\u5f71\u54cd [\u641c\u7d22\u67e5\u8be2\u5143\u4fe1\u606f](../Node_info_and_management/SHOW_META.md#SHOW-META)\u4e2d\u7684 `total_found` \u503c\u3002\n\n### WEIGHT()\n`WEIGHT()` \u51fd\u6570\u8fd4\u56de\u8ba1\u7b97\u5f97\u5230\u7684\u5339\u914d\u5206\u6570\u3002\u5982\u679c\u672a\u6307\u5b9a\u6392\u5e8f\uff0c\u5219\u7ed3\u679c\u6309 `WEIGHT()` \u63d0\u4f9b\u7684\u5206\u6570\u964d\u5e8f\u6392\u5e8f\u3002\u5728\u793a\u4f8b\u4e2d\uff0c\u5148\u6309\u6743\u91cd\u6392\u5e8f\uff0c\u518d\u6309\u6574\u578b\u5c5e\u6027\u6392\u5e8f\u3002\n\n\u4e0a\u8ff0\u641c\u7d22\u4e3a\u7b80\u5355\u5339\u914d\uff0c\u6240\u6709\u8bcd\u5fc5\u987b\u51fa\u73b0\u3002\u7136\u800c\u6211\u4eec\u8fd8\u53ef\u4ee5\u505a\u66f4\u591a\uff08\u8fd9\u91cc\u53ea\u662f\u4e00\u4e2a\u7b80\u5355\u4f8b\u5b50\uff09\uff1a\n\nCODE_BLOCK_7\n\n\u8fd9\u91cc\u6211\u4eec\u641c\u7d22\u56db\u4e2a\u8bcd\uff0c\u4f46\u53ea\u9700\u627e\u5230\u5176\u4e2d\u4e09\u4e2a\u8bcd\u5373\u53ef\u5339\u914d\u3002\u5305\u542b\u5168\u90e8\u8bcd\u7684\u6587\u6863\u6392\u540d\u66f4\u9ad8\u3002\n\n### ZONESPANLIST()\n`ZONESPANLIST()` \u51fd\u6570\u8fd4\u56de\u5339\u914d\u533a\u57df\u8de8\u5ea6\u5bf9\u3002\u6bcf\u5bf9\u5305\u542b\u5339\u914d\u533a\u57df\u8de8\u5ea6\u6807\u8bc6\u7b26\u3001\u5192\u53f7\u548c\u5339\u914d\u533a\u57df\u8de8\u5ea6\u7684\u987a\u5e8f\u53f7\u3002\u4f8b\u5982\uff0c\u82e5\u6587\u6863\u4e3a `<emphasis role=\"bold\"><i>text</i> the <i>text</i></emphasis>`\uff0c\u4e14\u67e5\u8be2\u4e3a `'ZONESPAN:(i,b) text'`\uff0c\u5219 `ZONESPANLIST()` \u8fd4\u56de\u5b57\u7b26\u4e32 `\"1:1 1:2 2:1\"`\uff0c\u8868\u793a\u7b2c\u4e00\u4e2a\u533a\u57df\u8de8\u5ea6\u7684\u7b2c 1 \u548c\u7b2c 2 \u4e2a\u8de8\u5ea6\u5339\u914d\u4e86 \"text\"\uff0c\u7b2c\u4e8c\u4e2a\u533a\u57df\u8de8\u5ea6\u7684\u7b2c 1 \u4e2a\u8de8\u5ea6\u4e5f\u5339\u914d\u4e86 \"text\"\u3002\n\n### QUERY()\n`QUERY()` \u8fd4\u56de\u5f53\u524d\u641c\u7d22\u67e5\u8be2\u3002`QUERY()` \u662f\u540e\u9650\u5236\u8868\u8fbe\u5f0f\uff0c\u901a\u5e38\u548c [SNIPPET()](../Functions/String_functions.md#SNIPPET%28%29) \u4e00\u8d77\u4f7f\u7528\u3002",
            "russian": "# \u041f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0435 \u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u0443\u044e\u0449\u0438\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438\n\n### BM25A()\n`BM25A(k1,b)` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u043e\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 `BM25A()`. \u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0449\u0438\u043a `expr` \u0438 \u0432\u043a\u043b\u044e\u0447\u0451\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 `index_field_lengths`. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b `k1` \u0438 `b` \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0447\u0438\u0441\u043b\u0430\u043c\u0438 \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0442\u043e\u0447\u043a\u043e\u0439.\n\n### BM25F()\n`BM25F(k1, b, {field=weight, ...})` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u043e\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 `BM25F()` \u0438 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0451\u043d\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 `index_field_lengths`. \u0422\u0430\u043a\u0436\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0449\u0438\u043a `expr`. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b `k1` \u0438 `b` \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0447\u0438\u0441\u043b\u0430\u043c\u0438 \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0442\u043e\u0447\u043a\u043e\u0439.\n\n### EXIST()\n\u0417\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u043d\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0441\u0442\u043e\u043b\u0431\u0446\u044b \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e. \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043b\u0438\u0431\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0432 `'attr-name'`, \u043b\u0438\u0431\u043e `'default-value'`, \u0435\u0441\u043b\u0438 \u0430\u0442\u0440\u0438\u0431\u0443\u0442 \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u0421\u0442\u0440\u043e\u043a\u043e\u0432\u044b\u0435 (STRING) \u0438 \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u044b (MVA) \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f. \u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u043e\u043b\u0435\u0437\u043d\u0430 \u043f\u0440\u0438 \u043f\u043e\u0438\u0441\u043a\u0435 \u043f\u043e \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0441\u0445\u0435\u043c\u0430\u043c\u0438.\n\nCODE_BLOCK_0\n\n### MIN_TOP_SORTVAL()\n\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0430 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043d\u0430\u0438\u0445\u0443\u0434\u0448\u0435\u0433\u043e \u043f\u043e \u0440\u0430\u043d\u0433\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0438\u0445 \u0442\u043e\u043f-N \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439, \u0435\u0441\u043b\u0438 \u043a\u043b\u044e\u0447 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0447\u0438\u0441\u043b\u043e\u043c \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0442\u043e\u0447\u043a\u043e\u0439, \u0438\u043d\u0430\u0447\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 0.\n\n### MIN_TOP_WEIGHT()\n\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0432\u0435\u0441 \u043d\u0430\u0438\u0445\u0443\u0434\u0448\u0435\u0433\u043e \u043f\u043e \u0440\u0430\u043d\u0433\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0438\u0445 \u0442\u043e\u043f-N \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439.\n\n### PACKEDFACTORS()\n`PACKEDFACTORS()` \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u0445 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0445 \u0444\u0430\u043a\u0442\u043e\u0440\u043e\u0432 \u0432\u0435\u0441\u043e\u0432\u044b\u0445 \u043a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442\u043e\u0432 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0434\u043b\u044f \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0438\u043d\u0430\u0440\u043d\u043e\u0433\u043e \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (UDF). \u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0449\u0438\u043a\u0435 expression \u0438 \u0435\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u044b\u043c \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c; \u0432 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u0430. `PACKEDFACTORS()` \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442, \u043e\u0442\u043a\u043b\u044e\u0447\u0430\u044e\u0449\u0438\u0439 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u0444\u0430\u043a\u0442\u043e\u0440\u0430 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f ATC: `PACKEDFACTORS({no_atc=1})`. \u0412\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 ATC \u0437\u043d\u0430\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0437\u0430\u043c\u0435\u0434\u043b\u044f\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u044d\u0442\u043e\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u0435\u0437\u0435\u043d, \u0435\u0441\u043b\u0438 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0444\u0430\u043a\u0442\u043e\u0440\u044b \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u043d\u043e ATC \u043d\u0435 \u043d\u0443\u0436\u0435\u043d. `PACKEDFACTORS()` \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON: `PACKEDFACTORS({json=1})`. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0444\u043e\u0440\u043c\u0430\u0442\u044b \u0432\u044b\u0432\u043e\u0434\u0430 \u2014 \u043b\u0438\u0431\u043e \u0432 \u0432\u0438\u0434\u0435 \u043f\u0430\u0440 \u043a\u043b\u044e\u0447-\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u043b\u0438\u0431\u043e \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON \u2014 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u044b \u043d\u0438\u0436\u0435. (\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0432 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u0445 \u043d\u0438\u0436\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u044b \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u0441\u0442\u0432\u0430 \u0447\u0442\u0435\u043d\u0438\u044f; \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438\u0434\u0443\u0442 \u0432 \u043e\u0434\u043d\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0435.)\n\nCODE_BLOCK_1\n\nCODE_BLOCK_2\n\n\u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432 UDF, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:\n\nCODE_BLOCK_3\n\n\u0413\u0434\u0435 `CUSTOM_RANK()` \u2014 \u0444\u0443\u043d\u043a\u0446\u0438\u044f, \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0432 UDF. \u041e\u043d\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u043e\u0431\u044a\u044f\u0432\u043b\u044f\u0442\u044c \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_FACTORS` (\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0430 \u0432 sphinxudf.h), \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u0443 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443, \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u0432 \u043d\u0435\u0451 \u0444\u0430\u043a\u0442\u043e\u0440\u044b \u043f\u0435\u0440\u0435\u0434 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0438 \u043e\u0447\u0438\u0449\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435, \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c:\n\nCODE_BLOCK_4\n\n\u0414\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 `PACKEDFACTORS()` \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u043d\u0430 \u0432\u0441\u0435\u0445 \u044d\u0442\u0430\u043f\u0430\u0445 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u0430 \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u042d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0435\u0449\u0435 \u043e\u0434\u043d\u0443 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u0443\u044e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f `PACKEDFACTORS()`: \u043f\u0435\u0440\u0435\u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435.\n\n\u0412 \u043f\u0440\u0438\u0432\u0435\u0434\u0451\u043d\u043d\u043e\u043c \u0432\u044b\u0448\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u043c\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 expression \u0441 \u0444\u0438\u043a\u0442\u0438\u0432\u043d\u044b\u043c \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u0438 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043b\u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e, \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u043d\u0430\u0448\u0438\u043c UDF. \u0414\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043c\u044b \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u043b\u0438 UDF, \u0447\u0442\u043e\u0431\u044b \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b. \u0422\u0435\u043f\u0435\u0440\u044c \u043f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u043c \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u0430, \u0447\u0442\u043e \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u043d\u0430\u0448\u0435\u0433\u043e UDF \u0447\u0440\u0435\u0437\u0432\u044b\u0447\u0430\u0439\u043d\u043e \u0434\u043e\u0440\u043e\u0433\u043e\u0435, \u0441 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u043d\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c\u044e \u0432\u0441\u0435\u0433\u043e 10 000 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443. \u0415\u0441\u043b\u0438 \u043d\u0430\u0448 \u0437\u0430\u043f\u0440\u043e\u0441 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 1 000 000 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0437\u0443\u043c\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0447\u0442\u043e\u0431\u044b \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u0443\u044e \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c. \u0417\u0430\u0442\u0435\u043c \u0441\u043b\u043e\u0436\u043d\u044b\u0439 UDF \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0438\u043c\u0435\u043d\u0451\u043d \u0442\u043e\u043b\u044c\u043a\u043e \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0432\u0435\u0440\u0445\u043d\u0438\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430\u043c, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043a \u0442\u043e\u043f-100. \u0418\u043d\u044b\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043c\u044b \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u0442\u043e\u043f-100 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0430 \u0437\u0430\u0442\u0435\u043c \u043f\u0435\u0440\u0435\u0440\u0430\u043d\u0436\u0438\u0440\u0443\u0435\u043c \u0438\u0445 \u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u043e\u0436\u043d\u043e\u0439. \u042d\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u043f\u043e\u0434\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432:\n\nCODE_BLOCK_5\n\n\u0412 \u044d\u0442\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 expression \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u043e\u0432\u043f\u0430\u0432\u0448\u0435\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 \u0434\u043b\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f `WEIGHT()`, \u0442\u043e \u0435\u0441\u0442\u044c \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f 1 000 000 \u0440\u0430\u0437. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 UDF \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u043b\u043e\u0436\u0435\u043d\u043e \u0434\u043e \u0432\u043d\u0435\u0448\u043d\u0435\u0439 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u043b\u0438\u0448\u044c \u0434\u043b\u044f \u0432\u0435\u0440\u0445\u043d\u0438\u0445 100 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u043f\u043e `WEIGHT()`, \u0441\u043e\u0433\u043b\u0430\u0441\u043d\u043e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u043c\u0443 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044e. \u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e UDF \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u0432\u0430\u043d \u0432\u0441\u0435\u0433\u043e 100 \u0440\u0430\u0437. \u0412 \u0438\u0442\u043e\u0433\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442\u0441\u044f 10 \u043b\u0443\u0447\u0448\u0438\u0445 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e UDF.\n\n\u0414\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043a\u0438, \u0432 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0439 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 `PACKEDFACTORS()` \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u043e\u0442 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u043a \u043c\u0430\u0441\u0442\u0435\u0440\u0443 \u0432 \u0431\u0438\u043d\u0430\u0440\u043d\u043e\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435. \u042d\u0442\u043e \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u044b \u043f\u0435\u0440\u0435\u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043d\u0430 \u0443\u0437\u043b\u0435 \u043c\u0430\u0441\u0442\u0435\u0440\u0430 \u043f\u0440\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438.\n\n\u041f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0432 SQL, \u043d\u043e \u0431\u0435\u0437 \u0432\u044b\u0437\u043e\u0432\u0430 \u0438\u0437 UDF, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 `PACKEDFACTORS()` \u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u043e\u0431\u044b\u0447\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0440\u0443\u0447\u043d\u043e\u0439 \u043e\u0446\u0435\u043d\u043a\u0438 \u0444\u0430\u043a\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u044d\u0442\u0430 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f API Manticore.\n\n### REMOVE_REPEATS()\n`REMOVE_REPEATS ( result_set, column, offset, limit )` \u2014 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0449\u0438\u0435\u0441\u044f \u043f\u043e\u0434\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c \u0432 \u0441\u0442\u043e\u043b\u0431\u0446\u0435 `column`.\n\nCODE_BLOCK_6\n\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e `REMOVE_REPEATS` \u043d\u0435 \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 `total_found` \u0432 [\u043c\u0435\u0442\u0430\u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430](../Node_info_and_management/SHOW_META.md#SHOW-META).\n\n### WEIGHT()\n\u0424\u0443\u043d\u043a\u0446\u0438\u044f `WEIGHT()` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0439 \u0431\u0430\u043b\u043b \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f. \u0415\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0438\u043d\u043e\u0435 \u0443\u043f\u043e\u0440\u044f\u0434\u043e\u0447\u0438\u0432\u0430\u043d\u0438\u0435, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043f\u043e \u0443\u0431\u044b\u0432\u0430\u043d\u0438\u044e \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u043e\u043c\u0443 `WEIGHT()`. \u0412 \u044d\u0442\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c \u043f\u043e \u0432\u0435\u0441\u0443, \u0430 \u0437\u0430\u0442\u0435\u043c \u043f\u043e \u0446\u0435\u043b\u043e\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0443.\n\n\u041f\u0440\u0438\u0432\u0435\u0434\u0451\u043d\u043d\u044b\u0439 \u0432\u044b\u0448\u0435 \u043f\u043e\u0438\u0441\u043a \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0435 \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435, \u0433\u0434\u0435 \u0432\u0441\u0435 \u0441\u043b\u043e\u0432\u0430 \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c. \u041e\u0434\u043d\u0430\u043a\u043e \u043c\u043e\u0436\u043d\u043e \u0434\u0435\u043b\u0430\u0442\u044c \u0438 \u0431\u043e\u043b\u044c\u0448\u0435 (\u0438 \u044d\u0442\u043e \u0432\u0441\u0435\u0433\u043e \u043b\u0438\u0448\u044c \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u0440\u0438\u043c\u0435\u0440):\n\nCODE_BLOCK_7\n\n\u0417\u0434\u0435\u0441\u044c \u043c\u044b \u0438\u0449\u0435\u043c \u0447\u0435\u0442\u044b\u0440\u0435 \u0441\u043b\u043e\u0432\u0430, \u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u0440\u0438 \u0438\u0437 \u0447\u0435\u0442\u044b\u0440\u0451\u0445. \u041f\u043e\u0438\u0441\u043a \u043e\u0442\u0434\u0430\u0441\u0442 \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0435\u043d\u0438\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u043c, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u043c \u0432\u0441\u0435 \u0441\u043b\u043e\u0432\u0430.\n\n### ZONESPANLIST()\n\u0424\u0443\u043d\u043a\u0446\u0438\u044f `ZONESPANLIST()` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u0430\u0440\u044b \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0437\u043e\u043d\u043d\u044b\u0445 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u043e\u0432. \u041a\u0430\u0436\u0434\u0430\u044f \u043f\u0430\u0440\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0437\u043e\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0430, \u0434\u0432\u043e\u0435\u0442\u043e\u0447\u0438\u0435 \u0438 \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0437\u043e\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0430. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0435 \u0442\u0435\u043a\u0441\u0442 `<emphasis role=\"bold\"><i>text</i> the <i>text</i></emphasis>`, \u0438 \u0432\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 `'ZONESPAN:(i,b) text'`, \u0442\u043e\u0433\u0434\u0430 `ZONESPANLIST()` \u0432\u0435\u0440\u043d\u0451\u0442 \u0441\u0442\u0440\u043e\u043a\u0443 `\"1:1 1:2 2:1\"`, \u0447\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u0437\u043e\u043d\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u0441\u043e\u0432\u043f\u0430\u043b \u0441\u043e \u0441\u043b\u043e\u0432\u043e\u043c \"text\" \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0430\u0445 1 \u0438 2, \u0430 \u0432\u0442\u043e\u0440\u043e\u0439 \u0437\u043e\u043d\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0435 1.\n\n### QUERY()\n`QUERY()` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441. `QUERY()` \u2014 \u044d\u0442\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u0441\u0442\u043b\u0438\u043c\u0438\u0442\u0430 \u0438 \u043f\u0440\u0435\u0434\u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u043e \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0441 [SNIPPET()](../Functions/String_functions.md#SNIPPET%28%29)."
        },
        "is_code_or_comment": false,
        "model": "openai:gpt-4.1-mini",
        "updated_at": 1766339873
    },
    "b3a6e4e6a505d3dbc1af55a087ae814594ed85b03d9a151f07ba8e14091ef192": {
        "original": "# Searching and ranking functions\n\n### BM25A()\n`BM25A(k1,b)` returns the exact `BM25A()` value. Requires the `expr` ranker and enabled `index_field_lengths`. Parameters `k1` and `b` must be floats.\n\n### BM25F()\n`BM25F(k1, b, {field=weight, ...})` returns the exact `BM25F()` value and requires `index_field_lengths` to be enabled. The `expr` ranker is also necessary. Parameters `k1` and `b` must be floats.\n\n### EXIST()\nSubstitutes non-existent columns with default values. It returns either the value of an attribute specified by 'attr-name', or the 'default-value' if that attribute does not exist. STRING or MVA attributes are not supported. This function is useful when searching through multiple tables with different schemas.\n\nCODE_BLOCK_0\n\n### MIN_TOP_SORTVAL()\nReturns the sort key value of the worst-ranked element in the current top-N matches if the sort key is a float, and 0 otherwise.\n\n### MIN_TOP_WEIGHT()\nReturns the weight of the worst-ranked element in the current top-N matches.\n\n### PACKEDFACTORS()\n`PACKEDFACTORS()` can be used in queries to display all calculated weighting factors during matching or to provide a binary attribute for creating a custom ranking UDF. This function only works if the expression ranker is specified and the query is not a full scan; otherwise, it returns an error. `PACKEDFACTORS()` can take an optional argument that disables ATC ranking factor calculation: `PACKEDFACTORS({no_atc=1})`. Calculating ATC significantly slows down query processing, so this option can be useful if you need to see the ranking factors but don't require ATC. `PACKEDFACTORS()` can also output in JSON format: `PACKEDFACTORS({json=1})`. The respective outputs in either key-value pair or JSON format are shown below. (Note that the examples below are wrapped for readability; actual returned values would be single-line.)\n\nCODE_BLOCK_1\n\nCODE_BLOCK_2\n\nThis function can be used to implement custom ranking functions in UDFs, as in:\n\nCODE_BLOCK_3\n\nWhere `CUSTOM_RANK()` is a function implemented in a UDF. It should declare a `SPH_UDF_FACTORS` structure (defined in sphinxudf.h), initialize this structure, unpack the factors into it before usage, and deinitialize it afterwards, as follows:\n\nCODE_BLOCK_4\n\n`PACKEDFACTORS()` data is available at all query stages, not just during the initial matching and ranking pass. This enables another particularly interesting application of `PACKEDFACTORS()`: re-ranking.\n\nIn the example above, we used an expression-based ranker with a dummy expression and sorted the result set by the value computed by our UDF. In other words, we used the UDF to rank all our results. Now, let's assume for the sake of an example that our UDF is extremely expensive to compute, with a throughput of only 10,000 calls per second. If our query matches 1,000,000 documents, we would want to use a much simpler expression to do most of our ranking in order to maintain reasonable performance. Then, we would apply the expensive UDF to only a few top results, say, the top 100 results. In other words, we would build the top 100 results using a simpler ranking function and then re-rank those with a more complex one. This can be done with subselects:\n\nCODE_BLOCK_5\n\nIn this example, the expression-based ranker is called for every matched document to compute `WEIGHT()`, so it gets called 1,000,000 times. However, the UDF computation can be postponed until the outer sort, and it will only be performed for the top 100 matches by `WEIGHT()`, according to the inner limit. This means the UDF will only be called 100 times. Finally, the top 10 matches by UDF value are selected and returned to the application.\n\nFor reference, in a distributed setup, the `PACKEDFACTORS()` data is sent from the agents to the master node in binary format. This makes it technically feasible to implement additional re-ranking passes on the master node if needed.\n\nWhen used in SQL but not called from any UDFs, the result of `PACKEDFACTORS()` is formatted as plain text, which can be used to manually assess the ranking factors. Note that this feature is not currently supported by the Manticore API.\n\n### REMOVE_REPEATS()\n`REMOVE_REPEATS ( result_set, column, offset, limit )` - removes repeated adjusted rows with the same 'column' value.\n\nCODE_BLOCK_6\nNote that `REMOVE_REPEATS` does not affect `total_found` in the [search query meta info](../Node_info_and_management/SHOW_META.md#SHOW-META).\n\n### WEIGHT()\nThe `WEIGHT()` function returns the calculated matching score. If no ordering is specified, the result is sorted in descending order by the score provided by `WEIGHT()`. In this example, we order first by weight and then by an integer attribute.\n\nThe search above performs a simple matching, where all words need to be present. However, we can do more (and this is just a simple example):\n\nCODE_BLOCK_7\n\nHere, we search for four words, but a match can occur even if only three of the four words are found. The search will rank documents containing all words higher.\n\n### ZONESPANLIST()\nThe `ZONESPANLIST()` function returns pairs of matched zone spans. Each pair contains the matched zone span identifier, a colon, and the order number of the matched zone span. For example, if a document reads `<emphasis role=\"bold\"><i>text</i> the <i>text</i></emphasis>`, and you query for `'ZONESPAN:(i,b) text'`, then `ZONESPANLIST()` will return the string `\"1:1 1:2 2:1\"`, meaning that the first zone span matched \"text\" in spans 1 and 2, and the second zone span in span 1 only.\n\n### QUERY()\n`QUERY()` returns the current search query. `QUERY()` is a postlimit expression and is intended to be used with [SNIPPET()](../Functions/String_functions.md#SNIPPET%28%29).",
        "translations": {
            "chinese": "# \u641c\u7d22\u548c\u6392\u540d\u51fd\u6570\n\n### BM25A()\n`BM25A(k1,b)` \u8fd4\u56de\u7cbe\u786e\u7684 `BM25A()` \u503c\u3002\u9700\u8981 `expr` \u6392\u5e8f\u5668\u5e76\u4e14\u542f\u7528\u4e86 `index_field_lengths`\u3002\u53c2\u6570 `k1` \u548c `b` \u5fc5\u987b\u662f\u6d6e\u70b9\u6570\u3002\n\n### BM25F()\n`BM25F(k1, b, {field=weight, ...})` \u8fd4\u56de\u7cbe\u786e\u7684 `BM25F()` \u503c\uff0c\u5e76\u4e14\u9700\u8981\u542f\u7528 `index_field_lengths`\u3002\u8fd8\u9700\u8981 `expr` \u6392\u5e8f\u5668\u3002\u53c2\u6570 `k1` \u548c `b` \u5fc5\u987b\u662f\u6d6e\u70b9\u6570\u3002\n\n### EXIST()\n\u7528\u9ed8\u8ba4\u503c\u66ff\u6362\u4e0d\u5b58\u5728\u7684\u5217\u3002\u5b83\u8fd4\u56de\u7531 'attr-name' \u6307\u5b9a\u7684\u5c5e\u6027\u503c\uff0c\u6216\u8005\u5982\u679c\u8be5\u5c5e\u6027\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de 'default-value'\u3002STRING \u6216 MVA \u5c5e\u6027\u4e0d\u652f\u6301\u3002\u6b64\u51fd\u6570\u5728\u641c\u7d22\u5177\u6709\u4e0d\u540c\u6a21\u5f0f\u7684\u591a\u4e2a\u8868\u65f6\u5f88\u6709\u7528\u3002\n\nCODE_BLOCK_0\n\n### MIN_TOP_SORTVAL()\n\u5982\u679c\u6392\u5e8f\u952e\u662f\u6d6e\u70b9\u6570\uff0c\u5219\u8fd4\u56de\u5f53\u524d\u524d N \u5339\u914d\u4e2d\u6700\u5dee\u6392\u540d\u5143\u7d20\u7684\u6392\u5e8f\u952e\u503c\uff1b\u5426\u5219\u8fd4\u56de 0\u3002\n\n### MIN_TOP_WEIGHT()\n\u8fd4\u56de\u5f53\u524d\u524d N \u5339\u914d\u4e2d\u6700\u5dee\u6392\u540d\u5143\u7d20\u7684\u6743\u91cd\u3002\n\n### PACKEDFACTORS()\n`PACKEDFACTORS()` \u53ef\u4ee5\u7528\u4e8e\u67e5\u8be2\u4e2d\u663e\u793a\u5339\u914d\u6216\u5339\u914d\u671f\u95f4\u8ba1\u7b97\u7684\u6240\u6709\u52a0\u6743\u56e0\u5b50\uff0c\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u4e8c\u8fdb\u5236\u5c5e\u6027\u4ee5\u521b\u5efa\u81ea\u5b9a\u4e49\u6392\u540d UDF\u3002\u6b64\u51fd\u6570\u4ec5\u5728\u6307\u5b9a\u8868\u8fbe\u5f0f\u6392\u5e8f\u5668\u4e14\u67e5\u8be2\u4e0d\u662f\u5168\u626b\u63cf\u65f6\u6709\u6548\uff1b\u5426\u5219\u8fd4\u56de\u9519\u8bef\u3002`PACKEDFACTORS()` \u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\u6765\u7981\u7528 ATC \u6392\u540d\u56e0\u5b50\u8ba1\u7b97\uff1a`PACKEDFACTORS({no_atc=1})`\u3002\u8ba1\u7b97 ATC \u663e\u8457\u51cf\u6162\u4e86\u67e5\u8be2\u5904\u7406\u901f\u5ea6\uff0c\u56e0\u6b64\u5982\u679c\u53ea\u9700\u8981\u67e5\u770b\u6392\u540d\u56e0\u5b50\u4f46\u4e0d\u9700\u8981 ATC\uff0c\u6b64\u9009\u9879\u5f88\u6709\u7528\u3002`PACKEDFACTORS()` \u8fd8\u53ef\u4ee5\u8f93\u51fa\u4e3a JSON \u683c\u5f0f\uff1a`PACKEDFACTORS({json=1})`\u3002\u4ee5\u4e0b\u662f\u5728\u952e\u503c\u5bf9\u6216 JSON \u683c\u5f0f\u4e0b\u7684\u76f8\u5e94\u8f93\u51fa\u793a\u4f8b\u3002\uff08\u6ce8\u610f\uff0c\u4e0b\u9762\u7684\u793a\u4f8b\u662f\u4e3a\u4e86\u53ef\u8bfb\u6027\u800c\u6362\u884c\u7684\uff1b\u5b9e\u9645\u8fd4\u56de\u503c\u4f1a\u662f\u4e00\u884c\u3002\uff09\n\nCODE_BLOCK_1\n\nCODE_BLOCK_2\n\n\u6b64\u51fd\u6570\u53ef\u7528\u4e8e\u5728 UDF \u4e2d\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6392\u540d\u51fd\u6570\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n\nCODE_BLOCK_3\n\n\u5176\u4e2d `CUSTOM_RANK()` \u662f\u5728 UDF \u4e2d\u5b9e\u73b0\u7684\u4e00\u4e2a\u51fd\u6570\u3002\u5b83\u5e94\u8be5\u58f0\u660e\u4e00\u4e2a `SPH_UDF_FACTORS` \u7ed3\u6784\uff08\u5b9a\u4e49\u5728 sphinxudf.h \u4e2d\uff09\uff0c\u521d\u59cb\u5316\u6b64\u7ed3\u6784\uff0c\u5728\u4f7f\u7528\u524d\u5c06\u56e0\u5b50\u89e3\u5305\u5230\u5176\u4e2d\uff0c\u5e76\u5728\u4f7f\u7528\u540e\u8fdb\u884c\u53cd\u521d\u59cb\u5316\uff0c\u5982\u4e0b\u6240\u793a\uff1a\n\nCODE_BLOCK_4\n\n`PACKEDFACTORS()` \u6570\u636e\u5728\u6240\u6709\u67e5\u8be2\u9636\u6bb5\u90fd\u53ef\u7528\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u521d\u59cb\u5339\u914d\u548c\u6392\u540d\u9636\u6bb5\u3002\u8fd9\u4f7f `PACKEDFACTORS()` \u7684\u53e6\u4e00\u4e2a\u7279\u522b\u6709\u8da3\u7684\u7528\u9014\u6210\u4e3a\u53ef\u80fd\uff1a\u91cd\u65b0\u6392\u540d\u3002\n\n\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u4e00\u4e2a\u57fa\u4e8e\u8868\u8fbe\u5f0f\u7684\u6392\u5e8f\u5668\u548c\u4e00\u4e2a\u5047\u8868\u8fbe\u5f0f\uff0c\u5e76\u6309\u6211\u4eec\u7684 UDF \u8ba1\u7b97\u51fa\u7684\u503c\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u4e86\u6392\u5e8f\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528 UDF \u5bf9\u6240\u6709\u7ed3\u679c\u8fdb\u884c\u4e86\u6392\u5e8f\u3002\u73b0\u5728\uff0c\u5047\u8bbe\u4e3a\u4e86\u4e3e\u4f8b\u8bf4\u660e\uff0c\u6211\u4eec\u7684 UDF \u8ba1\u7b97\u975e\u5e38\u6602\u8d35\uff0c\u541e\u5410\u91cf\u4ec5\u4e3a\u6bcf\u79d2 10,000 \u6b21\u8c03\u7528\u3002\u5982\u679c\u6211\u4eec\u67e5\u8be2\u5339\u914d\u4e86 1,000,000 \u4e2a\u6587\u6863\uff0c\u6211\u4eec\u5e0c\u671b\u4f7f\u7528\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u8868\u8fbe\u5f0f\u6765\u8fdb\u884c\u5927\u90e8\u5206\u6392\u5e8f\uff0c\u4ee5\u4fbf\u4fdd\u6301\u5408\u7406\u7684\u6027\u80fd\u3002\u7136\u540e\uff0c\u6211\u4eec\u5c06\u53ea\u5bf9\u524d 100 \u4e2a\u7ed3\u679c\u5e94\u7528\u6602\u8d35\u7684 UDF\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u6392\u540d\u51fd\u6570\u6784\u5efa\u524d 100 \u4e2a\u7ed3\u679c\uff0c\u7136\u540e\u518d\u7528\u4e00\u4e2a\u66f4\u590d\u6742\u7684\u51fd\u6570\u5bf9\u5176\u8fdb\u884c\u91cd\u65b0\u6392\u5e8f\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5b50\u67e5\u8be2\u5b8c\u6210\uff1a\n\nCODE_BLOCK_5\n\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5339\u914d\u7684\u6587\u6863\uff0c\u57fa\u4e8e\u8868\u8fbe\u5f0f\u7684\u6392\u5e8f\u5668\u90fd\u4f1a\u8ba1\u7b97 `WEIGHT()`\uff0c\u56e0\u6b64\u4f1a\u88ab\u8c03\u7528 1,000,000 \u6b21\u3002\u7136\u800c\uff0cUDF \u8ba1\u7b97\u53ef\u4ee5\u63a8\u8fdf\u5230\u5916\u90e8\u6392\u5e8f\uff0c\u5e76\u4e14\u53ea\u4f1a\u5728 `WEIGHT()` \u7684\u524d 100 \u4e2a\u5339\u914d\u4e2d\u6267\u884c\uff0c\u6839\u636e\u5185\u90e8\u9650\u5236\u3002\u8fd9\u610f\u5473\u7740 UDF \u5c06\u53ea\u4f1a\u88ab\u8c03\u7528 100 \u6b21\u3002\u6700\u540e\uff0c\u6839\u636e UDF \u503c\u9009\u62e9\u5e76\u8fd4\u56de\u524d 10 \u4e2a\u7ed3\u679c\u7ed9\u5e94\u7528\u7a0b\u5e8f\u3002\n\n\u4f5c\u4e3a\u53c2\u8003\uff0c\u5728\u5206\u5e03\u5f0f\u8bbe\u7f6e\u4e2d\uff0c`PACKEDFACTORS()` \u6570\u636e\u5c06\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u4ece\u4ee3\u7406\u53d1\u9001\u5230\u4e3b\u8282\u70b9\u3002\u8fd9\u4f7f\u5f97\u5728\u4e3b\u8282\u70b9\u4e0a\u5b9e\u73b0\u989d\u5916\u7684\u91cd\u65b0\u6392\u5e8f\u6b65\u9aa4\u6210\u4e3a\u6280\u672f\u4e0a\u53ef\u884c\u7684\u3002\n\n\u5f53\u5728 SQL \u4e2d\u4f7f\u7528\u4f46\u672a\u4ece\u4efb\u4f55 UDF \u8c03\u7528\u65f6\uff0c`PACKEDFACTORS()` \u7684\u7ed3\u679c\u4ee5\u7eaf\u6587\u672c\u683c\u5f0f\u5448\u73b0\uff0c\u53ef\u7528\u4e8e\u624b\u52a8\u8bc4\u4f30\u6392\u540d\u56e0\u5b50\u3002\u8bf7\u6ce8\u610f\uff0c\u6b64\u529f\u80fd\u76ee\u524d\u4e0d\u88ab Manticore API \u652f\u6301\u3002\n\n### REMOVE_REPEATS()\n`REMOVE_REPEATS ( result_set, column, offset, limit )` - \u5220\u9664\u5177\u6709\u76f8\u540c 'column' \u503c\u7684\u91cd\u590d\u8c03\u6574\u884c\u3002\n\nCODE_BLOCK_6\n\u8bf7\u6ce8\u610f\uff0c`REMOVE_REPEATS` \u4e0d\u4f1a\u5f71\u54cd [\u641c\u7d22\u67e5\u8be2\u5143\u4fe1\u606f](../Node_info_and_management/SHOW_META.md#SHOW-META) \u4e2d\u7684 `total_found`\u3002\n\n### WEIGHT()\n`WEIGHT()` \u51fd\u6570\u8fd4\u56de\u8ba1\u7b97\u51fa\u7684\u5339\u914d\u5f97\u5206\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u6392\u5e8f\uff0c\u5219\u7ed3\u679c\u6309 `WEIGHT()` \u63d0\u4f9b\u7684\u5f97\u5206\u964d\u5e8f\u6392\u5e8f\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u6309\u6743\u91cd\u6392\u5e8f\uff0c\u7136\u540e\u6309\u6574\u6570\u5c5e\u6027\u6392\u5e8f\u3002\n\n\u4e0a\u8ff0\u641c\u7d22\u6267\u884c\u7b80\u5355\u7684\u5339\u914d\uff0c\u6240\u6709\u5355\u8bcd\u90fd\u9700\u8981\u5b58\u5728\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u505a\u66f4\u591a\uff08\u8fd9\u53ea\u662f\u7b80\u5355\u793a\u4f8b\uff09\uff1a\n\nCODE_BLOCK_7\n\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u641c\u7d22\u56db\u4e2a\u5355\u8bcd\uff0c\u4f46\u5982\u679c\u53ea\u6709\u56db\u4e2a\u5355\u8bcd\u4e2d\u7684\u4e09\u4e2a\u88ab\u627e\u5230\uff0c\u4e5f\u53ef\u4ee5\u5339\u914d\u3002\u641c\u7d22\u5c06\u5bf9\u5305\u542b\u6240\u6709\u5355\u8bcd\u7684\u6587\u6863\u8fdb\u884c\u66f4\u9ad8\u6392\u540d\u3002\n\n### ZONESPANLIST()\n`ZONESPANLIST()` \u51fd\u6570\u8fd4\u56de\u5339\u914d\u533a\u95f4\u7684\u5bf9\u3002\u6bcf\u4e2a\u5bf9\u5305\u542b\u5339\u914d\u533a\u95f4\u7684\u6807\u8bc6\u7b26\u3001\u5192\u53f7\u4ee5\u53ca\u5339\u914d\u533a\u95f4\u7684\u987a\u5e8f\u7f16\u53f7\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6587\u6863\u5185\u5bb9\u4e3a `<emphasis role=\"bold\"><i>text</i> the <i>text</i></emphasis>`\uff0c\u5e76\u4e14\u67e5\u8be2\u4e3a `'ZONESPAN:(i,b) text'`\uff0c\u5219 `ZONESPANLIST()` \u5c06\u8fd4\u56de\u5b57\u7b26\u4e32 `\"1:1 1:2 2:1\"`\uff0c\u8868\u793a\u7b2c\u4e00\u4e2a\u533a\u95f4\u5339\u914d\u4e86\u5728\u533a\u95f4 1 \u548c 2 \u4e2d\u7684 \"text\"\uff0c\u7b2c\u4e8c\u4e2a\u533a\u95f4\u4ec5\u5728\u533a\u95f4 1 \u4e2d\u5339\u914d\u4e86 \"text\"\u3002\n\n### QUERY()\n`QUERY()` \u8fd4\u56de\u5f53\u524d\u641c\u7d22\u67e5\u8be2\u3002`QUERY()` \u662f\u4e00\u4e2a postlimit \u8868\u8fbe\u5f0f\uff0c\u5e76\u4e14\u65e8\u5728\u4e0e [SNIPPET()](../Functions/String_functions.md#SNIPPET%28%29) \u4e00\u8d77\u4f7f\u7528\u3002",
            "russian": "# \u0424\u0443\u043d\u043a\u0446\u0438\u0438 \u043f\u043e\u0438\u0441\u043a\u0430 \u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n\n### BM25A()\n`BM25A(k1,b)` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u043e\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 `BM25A()`. \u0422\u0440\u0435\u0431\u0443\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0440\u0430\u043d\u043a\u0435\u0440\u0430 `expr` \u0438 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0445 `index_field_lengths`. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b `k1` \u0438 `b` \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0447\u0438\u0441\u043b\u0430\u043c\u0438 \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0442\u043e\u0447\u043a\u043e\u0439.\n\n### BM25F()\n`BM25F(k1, b, {field=weight, ...})` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u043e\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 `BM25F()` \u0438 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f `index_field_lengths`. \u0422\u0430\u043a\u0436\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c \u0440\u0430\u043d\u043a\u0435\u0440 `expr`. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b `k1` \u0438 `b` \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0447\u0438\u0441\u043b\u0430\u043c\u0438 \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0442\u043e\u0447\u043a\u043e\u0439.\n\n### EXIST()\n\u0417\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u043d\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0441\u0442\u043e\u043b\u0431\u0446\u044b \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e. \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043b\u0438\u0431\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0432 'attr-name', \u043b\u0438\u0431\u043e 'default-value', \u0435\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u0430\u0442\u0440\u0438\u0431\u0443\u0442 \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b STRING \u0438\u043b\u0438 MVA \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f. \u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u043e\u043b\u0435\u0437\u043d\u0430 \u043f\u0440\u0438 \u043f\u043e\u0438\u0441\u043a\u0435 \u043f\u043e \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0441\u0445\u0435\u043c\u0430\u043c\u0438.\n\nCODE_BLOCK_0\n\n### MIN_TOP_SORTVAL()\n\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0430 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0445\u0443\u0434\u0448\u0435\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 \u0442\u0435\u043a\u0443\u0449\u0438\u0445 top-N \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u044f\u0445, \u0435\u0441\u043b\u0438 \u043a\u043b\u044e\u0447 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0447\u0438\u0441\u043b\u043e\u043c \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0442\u043e\u0447\u043a\u043e\u0439, \u0438 0 \u0432 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435.\n\n### MIN_TOP_WEIGHT()\n\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0432\u0435\u0441 \u0445\u0443\u0434\u0448\u0435\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 \u0442\u0435\u043a\u0443\u0449\u0438\u0445 top-N \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u044f\u0445.\n\n### PACKEDFACTORS()\n`PACKEDFACTORS()` \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u0445 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0445 \u0432\u0435\u0441\u043e\u0432\u044b\u0445 \u043a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442\u043e\u0432 \u043f\u0440\u0438 \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \u0438\u043b\u0438 \u0434\u043b\u044f \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0438\u043d\u0430\u0440\u043d\u043e\u0433\u043e \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0439 \u0440\u0430\u043d\u0436\u0438\u0440\u0443\u044e\u0449\u0435\u0439 UDF. \u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0443\u043a\u0430\u0437\u0430\u043d \u0440\u0430\u043d\u043a\u0435\u0440 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u044b\u043c \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c; \u0432 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u0430. `PACKEDFACTORS()` \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442, \u043e\u0442\u043a\u043b\u044e\u0447\u0430\u044e\u0449\u0438\u0439 \u0440\u0430\u0441\u0447\u0435\u0442 \u0444\u0430\u043a\u0442\u043e\u0440\u0430 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f ATC: `PACKEDFACTORS({no_atc=1})`. \u0420\u0430\u0441\u0447\u0435\u0442 ATC \u0437\u043d\u0430\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0437\u0430\u043c\u0435\u0434\u043b\u044f\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u044d\u0442\u0430 \u043e\u043f\u0446\u0438\u044f \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u0435\u0437\u043d\u0430, \u0435\u0441\u043b\u0438 \u0432\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0444\u0430\u043a\u0442\u043e\u0440\u044b \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u043d\u043e ATC \u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f. `PACKEDFACTORS()` \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON: `PACKEDFACTORS({json=1})`. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0432\u044b\u0432\u043e\u0434\u044b \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u043f\u0430\u0440 \u043a\u043b\u044e\u0447-\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u043b\u0438 JSON \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u044b \u043d\u0438\u0436\u0435. (\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u043d\u0438\u0436\u0435 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u044b \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u0441\u0442\u0432\u0430 \u0447\u0442\u0435\u043d\u0438\u044f; \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0431\u0443\u0434\u0443\u0442 \u0432 \u043e\u0434\u043d\u0443 \u0441\u0442\u0440\u043e\u043a\u0443.)\n\nCODE_BLOCK_1\n\nCODE_BLOCK_2\n\n\u042d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432 UDF, \u043a\u0430\u043a \u0432:\n\nCODE_BLOCK_3\n\n\u0413\u0434\u0435 `CUSTOM_RANK()` \u2014 \u044d\u0442\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u044f, \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0432 UDF. \u041e\u043d\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u043e\u0431\u044a\u044f\u0432\u043b\u044f\u0442\u044c \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `SPH_UDF_FACTORS` (\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0430 \u0432 sphinxudf.h), \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u0443 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443, \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u0432 \u043d\u0435\u0435 \u0444\u0430\u043a\u0442\u043e\u0440\u044b \u043f\u0435\u0440\u0435\u0434 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0438 \u0434\u0435\u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0435\u0435 \u043f\u043e\u0441\u043b\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f, \u043a\u0430\u043a \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0438\u0436\u0435:\n\nCODE_BLOCK_4\n\n\u0414\u0430\u043d\u043d\u044b\u0435 `PACKEDFACTORS()` \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u043d\u0430 \u0432\u0441\u0435\u0445 \u044d\u0442\u0430\u043f\u0430\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u0430 \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u042d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0449\u0435 \u043e\u0434\u043d\u043e \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u043e\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 `PACKEDFACTORS()`: \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0435 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435.\n\n\u0412 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0432\u044b\u0448\u0435 \u043c\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438 \u0440\u0430\u043d\u043a\u0435\u0440 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0441 \u0444\u0438\u043a\u0442\u0438\u0432\u043d\u044b\u043c \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u0438 \u043e\u0442\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043b\u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u043d\u0430\u0431\u043e\u0440 \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e, \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u043d\u0430\u0448\u0435\u0439 UDF. \u0414\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043c\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438 UDF \u0434\u043b\u044f \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u043d\u0430\u0448\u0438\u0445 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432. \u0422\u0435\u043f\u0435\u0440\u044c, \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u0430, \u0447\u0442\u043e \u043d\u0430\u0448\u0430 UDF \u0447\u0440\u0435\u0437\u0432\u044b\u0447\u0430\u0439\u043d\u043e \u0434\u043e\u0440\u043e\u0433\u0430 \u0432 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0438, \u0441 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u043d\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c\u044e \u0432\u0441\u0435\u0433\u043e 10 000 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443. \u0415\u0441\u043b\u0438 \u043d\u0430\u0448 \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0430\u0445\u043e\u0434\u0438\u0442 1 000 000 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u043c\u044b \u0437\u0430\u0445\u043e\u0442\u0438\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0433\u043e\u0440\u0430\u0437\u0434\u043e \u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0431\u043e\u043b\u044c\u0448\u0435\u0439 \u0447\u0430\u0441\u0442\u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0447\u0442\u043e\u0431\u044b \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u0443\u043c\u043d\u0443\u044e \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c. \u0417\u0430\u0442\u0435\u043c \u043c\u044b \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c \u0434\u043e\u0440\u043e\u0433\u0443\u044e UDF \u0442\u043e\u043b\u044c\u043a\u043e \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u043b\u0443\u0447\u0448\u0438\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430\u043c, \u0441\u043a\u0430\u0436\u0435\u043c, \u043a \u0442\u043e\u043f-100 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430\u043c. \u0414\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043c\u044b \u043f\u043e\u0441\u0442\u0440\u043e\u0438\u043c \u0442\u043e\u043f-100 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0430 \u0437\u0430\u0442\u0435\u043c \u043f\u0435\u0440\u0435\u0440\u0430\u043d\u0436\u0438\u0440\u0443\u0435\u043c \u0438\u0445 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u043e\u0436\u043d\u043e\u0439. \u042d\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043f\u043e\u0434\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432:\n\nCODE_BLOCK_5\n\n\u0412 \u044d\u0442\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0440\u0430\u043d\u043a\u0435\u0440 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 \u0434\u043b\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f `WEIGHT()`, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u043d \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f 1 000 000 \u0440\u0430\u0437. \u041e\u0434\u043d\u0430\u043a\u043e \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 UDF \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u043b\u043e\u0436\u0435\u043d\u043e \u0434\u043e \u0432\u043d\u0435\u0448\u043d\u0435\u0439 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438, \u0438 \u043e\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0442\u043e\u043f-100 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043f\u043e `WEIGHT()`, \u0441\u043e\u0433\u043b\u0430\u0441\u043d\u043e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u043c\u0443 \u043b\u0438\u043c\u0438\u0442\u0443. \u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e UDF \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u0432\u0430\u043d\u0430 \u0442\u043e\u043b\u044c\u043a\u043e 100 \u0440\u0430\u0437. \u041d\u0430\u043a\u043e\u043d\u0435\u0446, \u0432\u044b\u0431\u0438\u0440\u0430\u044e\u0442\u0441\u044f \u0442\u043e\u043f-10 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e UDF \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442\u0441\u044f \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044e.\n\n\u0414\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043a\u0438, \u0432 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0439 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 `PACKEDFACTORS()` \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u043e\u0442 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u0443\u0437\u0435\u043b \u0432 \u0434\u0432\u043e\u0438\u0447\u043d\u043e\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435. \u042d\u0442\u043e \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u044d\u0442\u0430\u043f\u044b \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u043e\u043c \u0443\u0437\u043b\u0435 \u043f\u0440\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438.\n\n\u041f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0432 SQL, \u043d\u043e \u043d\u0435 \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 \u0438\u0437 \u043a\u0430\u043a\u0438\u0445-\u043b\u0438\u0431\u043e UDF, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 `PACKEDFACTORS()` \u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u043e\u0431\u044b\u0447\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0440\u0443\u0447\u043d\u043e\u0439 \u043e\u0446\u0435\u043d\u043a\u0438 \u0444\u0430\u043a\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u044d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f API Manticore.\n\n### REMOVE_REPEATS()\n`REMOVE_REPEATS ( result_set, column, offset, limit )` \u2014 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0449\u0438\u0435\u0441\u044f \u0441\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c 'column'.\n\nCODE_BLOCK_6\n\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e `REMOVE_REPEATS` \u043d\u0435 \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 `total_found` \u0432 [\u043c\u0435\u0442\u0430\u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430](../Node_info_and_management/SHOW_META.md#SHOW-META).\n\n### WEIGHT()\n\u0424\u0443\u043d\u043a\u0446\u0438\u044f `WEIGHT()` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u0430\u043d\u043d\u0443\u044e \u043e\u0446\u0435\u043d\u043a\u0443 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f. \u0415\u0441\u043b\u0438 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043f\u043e \u0443\u0431\u044b\u0432\u0430\u043d\u0438\u044e \u043e\u0446\u0435\u043d\u043a\u0438, \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0439 `WEIGHT()`. \u0412 \u044d\u0442\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u043c\u044b \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c \u043f\u043e \u0432\u0435\u0441\u0443, \u0430 \u0437\u0430\u0442\u0435\u043c \u043f\u043e \u0446\u0435\u043b\u043e\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0443.\n\n\u041f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u0439 \u0432\u044b\u0448\u0435 \u043f\u043e\u0438\u0441\u043a \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0435 \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435, \u0433\u0434\u0435 \u0432\u0441\u0435 \u0441\u043b\u043e\u0432\u0430 \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c. \u041e\u0434\u043d\u0430\u043a\u043e \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 (\u0438 \u044d\u0442\u043e \u0432\u0441\u0435\u0433\u043e \u043b\u0438\u0448\u044c \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043f\u0440\u0438\u043c\u0435\u0440):\n\nCODE_BLOCK_7\n\n\u0417\u0434\u0435\u0441\u044c \u043c\u044b \u0438\u0449\u0435\u043c \u0447\u0435\u0442\u044b\u0440\u0435 \u0441\u043b\u043e\u0432\u0430, \u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u043e\u0439\u0442\u0438, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u0440\u0438 \u0438\u0437 \u0447\u0435\u0442\u044b\u0440\u0435\u0445 \u0441\u043b\u043e\u0432. \u041f\u043e\u0438\u0441\u043a \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u043d\u0436\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0435 \u0432\u0441\u0435 \u0441\u043b\u043e\u0432\u0430, \u0432\u044b\u0448\u0435.\n\n### ZONESPANLIST()\n\u0424\u0443\u043d\u043a\u0446\u0438\u044f `ZONESPANLIST()` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u0430\u0440\u044b \u0441\u043e\u0432\u043f\u0430\u0432\u0448\u0438\u0445 \u0437\u043e\u043d\u043d\u044b\u0445 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u043e\u0432. \u041a\u0430\u0436\u0434\u0430\u044f \u043f\u0430\u0440\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0441\u043e\u0432\u043f\u0430\u0432\u0448\u0435\u0433\u043e \u0437\u043e\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0430, \u0434\u0432\u043e\u0435\u0442\u043e\u0447\u0438\u0435 \u0438 \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0441\u043e\u0432\u043f\u0430\u0432\u0448\u0435\u0433\u043e \u0437\u043e\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0430. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u0433\u043b\u0430\u0441\u0438\u0442 `<emphasis role=\"bold\"><i>text</i> the <i>text</i></emphasis>`, \u0438 \u0432\u044b \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442\u0435 `'ZONESPAN:(i,b) text'`, \u0442\u043e `ZONESPANLIST()` \u0432\u0435\u0440\u043d\u0435\u0442 \u0441\u0442\u0440\u043e\u043a\u0443 `\"1:1 1:2 2:1\"`, \u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0449\u0443\u044e, \u0447\u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u0437\u043e\u043d\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u0441\u043e\u0432\u043f\u0430\u043b \u0441 \"text\" \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0430\u0445 1 \u0438 2, \u0430 \u0432\u0442\u043e\u0440\u043e\u0439 \u0437\u043e\u043d\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0435 1.\n\n### QUERY()\n`QUERY()` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441. `QUERY()` \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u043f\u043e\u0441\u0442-\u043b\u0438\u043c\u0438\u0442\u0430 \u0438 \u043f\u0440\u0435\u0434\u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0430 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0441 [SNIPPET()](../Functions/String_functions.md#SNIPPET%28%29)."
        },
        "is_code_or_comment": false,
        "model": "deepseek/deepseek-v3.2",
        "updated_at": 1766374334
    },
    "__meta": {
        "source_text": "# Searching and ranking functions\n\n### BM25A()\n`BM25A(k1,b)` returns the exact `BM25A()` value. Requires the `expr` ranker and enabled `index_field_lengths`. Parameters `k1` and `b` must be floats.\n\n### BM25F()\n`BM25F(k1, b, {field=weight, ...})` returns the exact `BM25F()` value and requires `index_field_lengths` to be enabled. The `expr` ranker is also necessary. Parameters `k1` and `b` must be floats.\n\n### EXIST()\nSubstitutes non-existent columns with default values. It returns either the value of an attribute specified by 'attr-name', or the 'default-value' if that attribute does not exist. STRING or MVA attributes are not supported. This function is useful when searching through multiple tables with different schemas.\n\n```sql\nSELECT *, EXIST('gid', 6) as cnd FROM i1, i2 WHERE cnd>5\n```\n\n### MIN_TOP_SORTVAL()\nReturns the sort key value of the worst-ranked element in the current top-N matches if the sort key is a float, and 0 otherwise.\n\n### MIN_TOP_WEIGHT()\nReturns the weight of the worst-ranked element in the current top-N matches.\n\n### PACKEDFACTORS()\n`PACKEDFACTORS()` can be used in queries to display all calculated weighting factors during matching or to provide a binary attribute for creating a custom ranking UDF. This function only works if the expression ranker is specified and the query is not a full scan; otherwise, it returns an error. `PACKEDFACTORS()` can take an optional argument that disables ATC ranking factor calculation: `PACKEDFACTORS({no_atc=1})`. Calculating ATC significantly slows down query processing, so this option can be useful if you need to see the ranking factors but don't require ATC. `PACKEDFACTORS()` can also output in JSON format: `PACKEDFACTORS({json=1})`. The respective outputs in either key-value pair or JSON format are shown below. (Note that the examples below are wrapped for readability; actual returned values would be single-line.)\n\n```sql\nmysql> SELECT id, PACKEDFACTORS() FROM test1\n    -> WHERE MATCH('test one') OPTION ranker=expr('1') \\G\n*************************** 1\\. row ***************************\n             id: 1\npackedfactors(): bm25=569, bm25a=0.617197, field_mask=2, doc_word_count=2,\n    field1=(lcs=1, hit_count=2, word_count=2, tf_idf=0.152356,\n        min_idf=-0.062982, max_idf=0.215338, sum_idf=0.152356, min_hit_pos=4,\n        min_best_span_pos=4, exact_hit=0, max_window_hits=1, min_gaps=2,\n        exact_order=1, lccs=1, wlccs=0.215338, atc=-0.003974),\n    word0=(tf=1, idf=-0.062982),\n    word1=(tf=1, idf=0.215338)\n1 row in set (0.00 sec)\n```\n\n```sql\nmysql> SELECT id, PACKEDFACTORS({json=1}) FROM test1\n    -> WHERE MATCH('test one') OPTION ranker=expr('1') \\G\n*************************** 1\\. row ***************************\n                     id: 1\npackedfactors({json=1}):\n{\n\n    \"bm25\": 569,\n    \"bm25a\": 0.617197,\n    \"field_mask\": 2,\n    \"doc_word_count\": 2,\n    \"fields\": [\n        {\n            \"lcs\": 1,\n            \"hit_count\": 2,\n            \"word_count\": 2,\n            \"tf_idf\": 0.152356,\n            \"min_idf\": -0.062982,\n            \"max_idf\": 0.215338,\n            \"sum_idf\": 0.152356,\n            \"min_hit_pos\": 4,\n            \"min_best_span_pos\": 4,\n            \"exact_hit\": 0,\n            \"max_window_hits\": 1,\n            \"min_gaps\": 2,\n            \"exact_order\": 1,\n            \"lccs\": 1,\n            \"wlccs\": 0.215338,\n            \"atc\": -0.003974\n        }\n    ],\n    \"words\": [\n        {\n            \"tf\": 1,\n            \"idf\": -0.062982\n        },\n        {\n            \"tf\": 1,\n            \"idf\": 0.215338\n        }\n    ]\n\n}\n1 row in set (0.01 sec)\n```\n\nThis function can be used to implement custom ranking functions in UDFs, as in:\n\n```sql\nSELECT *, CUSTOM_RANK(PACKEDFACTORS()) AS r\nFROM my_index\nWHERE match('hello')\nORDER BY r DESC\nOPTION ranker=expr('1');\n```\n\nWhere `CUSTOM_RANK()` is a function implemented in a UDF. It should declare a `SPH_UDF_FACTORS` structure (defined in sphinxudf.h), initialize this structure, unpack the factors into it before usage, and deinitialize it afterwards, as follows:\n\n```sql\nSPH_UDF_FACTORS factors;\nsphinx_factors_init(&factors);\nsphinx_factors_unpack((DWORD*)args->arg_values[0], &factors);\n// ... can use the contents of factors variable here ...\nsphinx_factors_deinit(&factors);\n```\n\n`PACKEDFACTORS()` data is available at all query stages, not just during the initial matching and ranking pass. This enables another particularly interesting application of `PACKEDFACTORS()`: re-ranking.\n\nIn the example above, we used an expression-based ranker with a dummy expression and sorted the result set by the value computed by our UDF. In other words, we used the UDF to rank all our results. Now, let's assume for the sake of an example that our UDF is extremely expensive to compute, with a throughput of only 10,000 calls per second. If our query matches 1,000,000 documents, we would want to use a much simpler expression to do most of our ranking in order to maintain reasonable performance. Then, we would apply the expensive UDF to only a few top results, say, the top 100 results. In other words, we would build the top 100 results using a simpler ranking function and then re-rank those with a more complex one. This can be done with subselects:\n\n```sql\nSELECT * FROM (\n    SELECT *, CUSTOM_RANK(PACKEDFACTORS()) AS r\n    FROM my_index WHERE match('hello')\n    OPTION ranker=expr('sum(lcs)*1000+bm25')\n    ORDER BY WEIGHT() DESC\n    LIMIT 100\n) ORDER BY r DESC LIMIT 10\n```\n\nIn this example, the expression-based ranker is called for every matched document to compute `WEIGHT()`, so it gets called 1,000,000 times. However, the UDF computation can be postponed until the outer sort, and it will only be performed for the top 100 matches by `WEIGHT()`, according to the inner limit. This means the UDF will only be called 100 times. Finally, the top 10 matches by UDF value are selected and returned to the application.\n\nFor reference, in a distributed setup, the `PACKEDFACTORS()` data is sent from the agents to the master node in binary format. This makes it technically feasible to implement additional re-ranking passes on the master node if needed.\n\nWhen used in SQL but not called from any UDFs, the result of `PACKEDFACTORS()` is formatted as plain text, which can be used to manually assess the ranking factors. Note that this feature is not currently supported by the Manticore API.\n\n\n### REMOVE_REPEATS()\n`REMOVE_REPEATS ( result_set, column, offset, limit )` - removes repeated adjusted rows with the same 'column' value.\n\n```sql\nSELECT REMOVE_REPEATS((SELECT * FROM dist1), gid, 0, 10)\n```\nNote that `REMOVE_REPEATS` does not affect `total_found` in the [search query meta info](../Node_info_and_management/SHOW_META.md#SHOW-META).\n\n### WEIGHT()\nThe `WEIGHT()` function returns the calculated matching score. If no ordering is specified, the result is sorted in descending order by the score provided by `WEIGHT()`. In this example, we order first by weight and then by an integer attribute.\n\nThe search above performs a simple matching, where all words need to be present. However, we can do more (and this is just a simple example):\n\n```sql\nmysql> SELECT *,WEIGHT() FROM testrt WHERE MATCH('\"list of business laptops\"/3');\n+------+------+-------------------------------------+---------------------------+----------+\n| id   | gid  | title                               | content                   | weight() |\n+------+------+-------------------------------------+---------------------------+----------+\n|    1 |   10 | List of HP business laptops         | Elitebook Probook         |     2397 |\n|    2 |   10 | List of Dell business laptops       | Latitude Precision Vostro |     2397 |\n|    3 |   20 | List of Dell gaming laptops         | Inspirion Alienware       |     2375 |\n|    5 |   30 | List of ASUS ultrabooks and laptops | Zenbook Vivobook          |     2375 |\n+------+------+-------------------------------------+---------------------------+----------+\n4 rows in set (0.00 sec)\n\n\nmysql> SHOW META;\n+----------------+----------+\n| Variable_name  | Value    |\n+----------------+----------+\n| total          | 4        |\n| total_found    | 4        |\n| total_relation | eq       |\n| time           | 0.000    |\n| keyword[0]     | list     |\n| docs[0]        | 5        |\n| hits[0]        | 5        |\n| keyword[1]     | of       |\n| docs[1]        | 4        |\n| hits[1]        | 4        |\n| keyword[2]     | business |\n| docs[2]        | 2        |\n| hits[2]        | 2        |\n| keyword[3]     | laptops  |\n| docs[3]        | 5        |\n| hits[3]        | 5        |\n+----------------+----------+\n16 rows in set (0.00 sec)\n```\n\nHere, we search for four words, but a match can occur even if only three of the four words are found. The search will rank documents containing all words higher.\n\n### ZONESPANLIST()\nThe `ZONESPANLIST()` function returns pairs of matched zone spans. Each pair contains the matched zone span identifier, a colon, and the order number of the matched zone span. For example, if a document reads `<emphasis role=\"bold\"><i>text</i> the <i>text</i></emphasis>`, and you query for `'ZONESPAN:(i,b) text'`, then `ZONESPANLIST()` will return the string `\"1:1 1:2 2:1\"`, meaning that the first zone span matched \"text\" in spans 1 and 2, and the second zone span in span 1 only.\n\n### QUERY()\n`QUERY()` returns the current search query. `QUERY()` is a postlimit expression and is intended to be used with [SNIPPET()](../Functions/String_functions.md#SNIPPET%28%29).\n\nTable functions are a mechanism for post-query result set processing. Table functions take an arbitrary result set as input and return a new, processed set as output. The first argument should be the input result set, but a table function can optionally take and handle more arguments. Table functions can completely change the result set, including the schema. Currently, only built-in table functions are supported. Table functions work for both outer `SELECT` and [nested SELECT](../Searching/Sub-selects.md).\n\n<!-- proofread -->\n\n",
        "updated_at": 1768530797,
        "source_md5": "701423fcde105ae566b3e2b452761484"
    }
}