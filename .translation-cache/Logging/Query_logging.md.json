{
  "15b6d3fad49d540ef87cdaa5a1318a50c2fc041c3430841329f9dcf15558d6f9": {
    "original": "# Query logging\n\n<!-- example query_logging -->\n\nQuery logging can be enabled by setting the [query_log](../Server_settings/Searchd.md#query_log) directive in the searchd section of the configuration file.\n\nQueries can also be sent to syslog by setting `syslog` instead of a file path. In this case, all search queries will be sent to the syslog daemon with `LOG_INFO` priority, prefixed with `[query]` instead of a timestamp. Only the `plain` log format is supported for syslog.\n\n<!-- intro -->\n\n`query_log` example:\n\n<!-- request Config -->\n\nCODE_BLOCK_0\n\n<!-- end -->\n\n## Logging format\n\nTwo query log formats are supported:\n\n* `sphinxql` (default): Logs in SQL format. It also provides an easy way to replay logged queries.\n\n* `plain`: Logs full-text queries in a simple text format. This format is recommended if most of your queries are primarily full-text or if you do not need to log non-full-text components, such as filtering by attributes, sorting, or grouping. Queries logged in the `plain` format cannot be replayed. Note that queries processed through [Buddy](../Installation/Manticore_Buddy.md) are not logged in this mode.\n\nTo switch between the formats, you can use the searchd setting [query_log_format](../Server_settings/Searchd.md#query_log_format).\n\n### SQL log format\n\n<!-- example sphixql_log -->\n\nThe SQL log format is the default setting. In this mode, Manticore logs all successful and unsuccessful select queries. Requests sent as SQL or via the binary API are logged in the SQL format, but JSON queries are logged as is. This type of logging only works with plain log files and does not support the 'syslog' service for logging.\n\n<!-- intro -->\n\n`query_log_format` example:\n\n<!-- request Config -->\n\nCODE_BLOCK_1\n\n<!-- end -->\n\n<!-- example sphixql_log2 -->\n\nThe features of the Manticore SQL log format compared to the [plain format](../Logging/Query_logging.md#Plain-log-format) include:\n\n* Full statement data is logged where possible.\n\n* Errors and warnings are logged.\n\n* The query log can be replayed.\n\n* Additional performance counters (currently, per-agent distributed query times) are logged.\n\n* Each log entry is a valid Manticore SQL/JSON statement that reconstructs the full request, except if the logged request is too large and needs to be shortened for performance reasons.\n\n* JSON requests and additional messages, counters, etc., are logged as comments.\n\n<!-- intro -->\n\n`sphinxql` log entries example:\n\n<!-- request Example -->\n\nCODE_BLOCK_2\n\n<!-- end -->\n\n### Plain log format\n\n<!-- example plain_log -->\n\nWith the `plain` log format, Manticore logs all successfully executed search queries in a simple text format. Non-full-text parts of the queries are not logged. JSON queries are recorded as single-line entries. Queries processed through [Buddy](../Installation/Manticore_Buddy.md) are not logged.\n\n<!-- intro -->\n\n`query_log_format` example:\n\n<!-- request Config -->\n\nCODE_BLOCK_3\n\n<!-- end -->\n\n<!-- example plain_log2 -->\n\nThe log format is as follows:\n\nCODE_BLOCK_4\n\nwhere:\n\n* `real-time` is the time from the start to the finish of the query.\n\n* `wall-time` is similar to real-time, but excludes time spent waiting for agents and merging result sets from them.\n\n* `perf-stats` includes CPU/IO stats when Manticore is started with `--cpustats` (or it was enabled via `SET GLOBAL cpustats=1`) and/or `--iostats` (or it was enabled via `SET GLOBAL iostats=1`):\n\n  - `ios` is the number of file I/O operations carried out;\n\n  - `kb` is the amount of data in kilobytes read from the table files;\n\n  - `ms` is the time spent on I/O operations.\n\n  - `cpums` is the time in milliseconds spent on CPU processing the query.\n\n* `match-mode` can have one of the following values:\n\n  - \"all\" for `SPH_MATCH_ALL` mode;\n\n  - \"any\" for `SPH_MATCH_ANY` mode;\n\n  - \"phr\" for `SPH_MATCH_PHRASE` mode;\n\n  - \"bool\" for `SPH_MATCH_BOOLEAN` mode;\n\n  - \"ext\" for `SPH_MATCH_EXTENDED` mode;\n\n  - \"ext2\" for `SPH_MATCH_EXTENDED2` mode;\n\n  - \"scan\" if the full scan mode was used, either by being specified with `SPH_MATCH_FULLSCAN` or if the query was empty.\n\n* `sort-mode` can have one of the following values:\n\n  - \"rel\" for `SPH_SORT_RELEVANCE` mode;\n\n  - \"attr-\" for `SPH_SORT_ATTR_DESC` mode;\n\n  - \"attr+\" for `SPH_SORT_ATTR_ASC` mode;\n\n  - \"tsegs\" for `SPH_SORT_TIME_SEGMENTS` mode;\n\n  - \"ext\" for `SPH_SORT_EXTENDED` mode.\n\nNote: the `SPH*` modes are specific to the `sphinx` legacy interface. SQL and JSON interfaces will log, in most cases, `ext2` as `match-mode` and `ext` and `rel` as `sort-mode`.\n\n<!-- intro -->\n\nQuery log example:\n\n<!-- request Example -->\n\nCODE_BLOCK_5\n\n<!-- end -->\n\n## Logging only slow queries\n\n<!-- example query_log_min_msec -->\n\nBy default, all queries are logged. If you want to log only queries with execution times exceeding a specified limit, the `query_log_min_msec` directive can be used.\n\nThe expected unit of measurement is milliseconds, but time suffix expressions can also be used.\n\n<!-- intro -->\n\n`query_log_min_msec` example:\n\n<!-- request Config -->\n\nCODE_BLOCK_6\n\n<!-- end -->\n\n## Log file permission mode\n\n<!-- Example query_log_mode -->\n\nBy default, the searchd and query log files are created with permission `600`, so only the user under which Manticore is running and `root` can read the log files. The `query_log_mode` option allows setting a different permission. This can be helpful for allowing other users to read the log files (for example, monitoring solutions running on non-root users).\n\n<!-- intro -->\n\n`query_log_mode` example:\n\n<!-- request Config -->\n\nCODE_BLOCK_7\n\n<!-- end -->\n\n<!-- proofread -->",
    "translations": {
      "chinese": "# 查询日志\n\n<!-- example query_logging -->\n\n可以通过在配置文件的 searchd 部分设置 [query_log](../Server_settings/Searchd.md#query_log) 指令来启用查询日志。\n\n查询也可以通过设置 `syslog`（而不是文件路径）发送到 syslog。在这种情况下，所有搜索查询将以 `LOG_INFO` 优先级发送到 syslog 守护进程，前缀为 `[query]`，而不是时间戳。syslog 仅支持 `plain` 日志格式。\n\n<!-- intro -->\n\n`query_log` 示例：\n\n<!-- request Config -->\n\nCODE_BLOCK_0\n\n<!-- end -->\n\n## 日志格式\n\n支持两种查询日志格式：\n\n* `sphinxql`（默认）：以 SQL 格式记录日志。它还提供了一种轻松重放已记录查询的方法。\n\n* `plain`：以简单文本格式记录全文查询。若大多数查询主要是全文查询，或者不需要记录非全文组件（如按属性过滤、排序或分组），推荐使用此格式。以 `plain` 格式记录的查询无法重放。请注意，通过 [Buddy](../Installation/Manticore_Buddy.md) 处理的查询不会在此模式下记录。\n\n要切换格式，可以使用 searchd 设置 [query_log_format](../Server_settings/Searchd.md#query_log_format)。\n\n### SQL 日志格式\n\n<!-- example sphixql_log -->\n\nSQL 日志格式是默认设置。在此模式下，Manticore 记录所有成功和失败的 select 查询。以 SQL 或二进制 API 发送的请求以 SQL 格式记录，但 JSON 查询按原样记录。此类日志仅适用于普通日志文件，不支持使用 'syslog' 服务记录。\n\n<!-- intro -->\n\n`query_log_format` 示例：\n\n<!-- request Config -->\n\nCODE_BLOCK_1\n\n<!-- end -->\n\n<!-- example sphixql_log2 -->\n\n与[plain 格式](../Logging/Query_logging.md#Plain-log-format)相比，Manticore SQL 日志格式的特点包括：\n\n* 尽可能记录完整的语句数据。\n\n* 记录错误和警告。\n\n* 查询日志可以重放。\n\n* 记录额外的性能计数器（当前为每个代理的分布式查询时间）。\n\n* 每条日志条目都是有效的 Manticore SQL/JSON 语句，可重构完整请求，除非记录的请求过大，为性能考虑需要缩短。\n\n* JSON 请求及附加消息、计数器等以注释形式记录。\n\n<!-- intro -->\n\n`sphinxql` 日志条目示例：\n\n<!-- request Example -->\n\nCODE_BLOCK_2\n\n<!-- end -->\n\n### Plain 日志格式\n\n<!-- example plain_log -->\n\n使用 `plain` 日志格式时，Manticore 以简单文本格式记录所有成功执行的搜索查询。查询的非全文部分不被记录。JSON 查询以单行条目记录。通过 [Buddy](../Installation/Manticore_Buddy.md) 处理的查询不会被记录。\n\n<!-- intro -->\n\n`query_log_format` 示例：\n\n<!-- request Config -->\n\nCODE_BLOCK_3\n\n<!-- end -->\n\n<!-- example plain_log2 -->\n\n日志格式如下：\n\nCODE_BLOCK_4\n\n其中：\n\n* `real-time` 是查询从开始到结束的时间。\n\n* `wall-time` 类似于 real-time，但不包括等待代理和合并代理结果集的时间。\n\n* `perf-stats` 包含 CPU/IO 统计信息，当 Manticore 以 `--cpustats` 启动（或通过 `SET GLOBAL cpustats=1` 启用）和/或 `--iostats` 启动（或通过 `SET GLOBAL iostats=1` 启用）时：\n\n  - `ios` 是执行的文件 I/O 操作次数；\n\n  - `kb` 是从表文件读取的数据量（千字节）；\n\n  - `ms` 是 I/O 操作所花费的时间。\n\n  - `cpums` 是处理查询时 CPU 花费的毫秒数。\n\n* `match-mode` 可以是以下值之一：\n\n  - \"all\" 表示 `SPH_MATCH_ALL` 模式；\n\n  - \"any\" 表示 `SPH_MATCH_ANY` 模式；\n\n  - \"phr\" 表示 `SPH_MATCH_PHRASE` 模式；\n\n  - \"bool\" 表示 `SPH_MATCH_BOOLEAN` 模式；\n\n  - \"ext\" 表示 `SPH_MATCH_EXTENDED` 模式；\n\n  - \"ext2\" 表示 `SPH_MATCH_EXTENDED2` 模式；\n\n  - \"scan\" 表示使用了全扫描模式，可能是通过 `SPH_MATCH_FULLSCAN` 指定，或查询为空。\n\n* `sort-mode` 可以是以下值之一：\n\n  - \"rel\" 表示 `SPH_SORT_RELEVANCE` 模式；\n\n  - \"attr-\" 表示 `SPH_SORT_ATTR_DESC` 模式；\n\n  - \"attr+\" 表示 `SPH_SORT_ATTR_ASC` 模式；\n\n  - \"tsegs\" 表示 `SPH_SORT_TIME_SEGMENTS` 模式；\n\n  - \"ext\" 表示 `SPH_SORT_EXTENDED` 模式。\n\n注意：`SPH*` 模式特指 `sphinx` 旧接口。SQL 和 JSON 接口在大多数情况下会记录 `ext2` 作为 `match-mode`，以及 `ext` 和 `rel` 作为 `sort-mode`。\n\n<!-- intro -->\n\n查询日志示例：\n\n<!-- request Example -->\n\nCODE_BLOCK_5\n\n<!-- end -->\n\n## 仅记录慢查询\n\n<!-- example query_log_min_msec -->\n\n默认情况下，所有查询都会被记录。如果只想记录执行时间超过指定限制的查询，可以使用 `query_log_min_msec` 指令。\n\n预期的单位是毫秒，但也可以使用时间后缀表达式。\n\n<!-- intro -->\n\n`query_log_min_msec` 示例：\n\n<!-- request Config -->\n\nCODE_BLOCK_6\n\n<!-- end -->\n\n## 日志文件权限模式\n\n<!-- Example query_log_mode -->\n\n默认情况下，searchd 和查询日志文件的权限为 `600`，因此只有运行 Manticore 的用户和 `root` 可以读取日志文件。`query_log_mode` 选项允许设置不同的权限。这对于允许其他用户读取日志文件（例如，运行在非 root 用户下的监控解决方案）很有帮助。\n\n<!-- intro -->\n\n`query_log_mode` 示例：\n\n<!-- request Config -->\n\nCODE_BLOCK_7\n\n<!-- end -->\n\n<!-- proofread -->",
      "russian": "# Логирование запросов\n\n<!-- example query_logging -->\n\nЛогирование запросов можно включить, установив директиву [query_log](../Server_settings/Searchd.md#query_log) в разделе searchd конфигурационного файла.\n\nЗапросы также могут быть отправлены в syslog, если вместо пути к файлу указать `syslog`. В этом случае все поисковые запросы будут отправлены демону syslog с приоритетом `LOG_INFO`, с префиксом `[query]` вместо временной метки. Для syslog поддерживается только формат лога `plain`.\n\n<!-- intro -->\n\nПример `query_log`:\n\n<!-- request Config -->\n\nCODE_BLOCK_0\n\n<!-- end -->\n\n## Формат логирования\n\nПоддерживаются два формата логов запросов:\n\n* `sphinxql` (по умолчанию): Логи в формате SQL. Также предоставляет простой способ воспроизведения залогированных запросов.\n\n* `plain`: Логи полнотекстовых запросов в простом текстовом формате. Этот формат рекомендуется, если большинство ваших запросов в основном полнотекстовые или если вам не нужно логировать нефулл-текстовые компоненты, такие как фильтрация по атрибутам, сортировка или группировка. Запросы, залогированные в формате `plain`, не могут быть воспроизведены. Обратите внимание, что запросы, обработанные через [Buddy](../Installation/Manticore_Buddy.md), в этом режиме не логируются.\n\nДля переключения между форматами можно использовать настройку searchd [query_log_format](../Server_settings/Searchd.md#query_log_format).\n\n### Формат SQL лога\n\n<!-- example sphixql_log -->\n\nФормат SQL лога является настройкой по умолчанию. В этом режиме Manticore логирует все успешные и неуспешные select-запросы. Запросы, отправленные в виде SQL или через бинарный API, логируются в формате SQL, а JSON-запросы логируются как есть. Этот тип логирования работает только с обычными лог-файлами и не поддерживает сервис 'syslog' для логирования.\n\n<!-- intro -->\n\nПример `query_log_format`:\n\n<!-- request Config -->\n\nCODE_BLOCK_1\n\n<!-- end -->\n\n<!-- example sphixql_log2 -->\n\nОсобенности формата SQL лога Manticore по сравнению с [plain форматом](../Logging/Query_logging.md#Plain-log-format) включают:\n\n* Логируются полные данные запроса, где это возможно.\n\n* Логируются ошибки и предупреждения.\n\n* Лог запросов можно воспроизвести.\n\n* Логируются дополнительные счетчики производительности (в настоящее время, время распределенных запросов по агентам).\n\n* Каждая запись лога является валидным SQL/JSON-запросом Manticore, который восстанавливает полный запрос, за исключением случаев, когда залогированный запрос слишком большой и для производительности его нужно сократить.\n\n* JSON-запросы и дополнительные сообщения, счетчики и т.д. логируются как комментарии.\n\n<!-- intro -->\n\nПример записей лога `sphinxql`:\n\n<!-- request Example -->\n\nCODE_BLOCK_2\n\n<!-- end -->\n\n### Формат plain лога\n\n<!-- example plain_log -->\n\nВ формате лога `plain` Manticore логирует все успешно выполненные поисковые запросы в простом текстовом формате. Нефулл-текстовые части запросов не логируются. JSON-запросы записываются в виде однострочных записей. Запросы, обработанные через [Buddy](../Installation/Manticore_Buddy.md), не логируются.\n\n<!-- intro -->\n\nПример `query_log_format`:\n\n<!-- request Config -->\n\nCODE_BLOCK_3\n\n<!-- end -->\n\n<!-- example plain_log2 -->\n\nФормат лога следующий:\n\nCODE_BLOCK_4\n\nгде:\n\n* `real-time` — время от начала до окончания запроса.\n\n* `wall-time` — аналогично real-time, но исключает время ожидания агентов и слияния результатов от них.\n\n* `perf-stats` включает статистику CPU/IO, если Manticore запущен с `--cpustats` (или это было включено через `SET GLOBAL cpustats=1`) и/или `--iostats` (или это было включено через `SET GLOBAL iostats=1`):\n\n  - `ios` — количество операций ввода-вывода файлов;\n\n  - `kb` — объем данных в килобайтах, прочитанных из файлов таблиц;\n\n  - `ms` — время, затраченное на операции ввода-вывода.\n\n  - `cpums` — время в миллисекундах, затраченное CPU на обработку запроса.\n\n* `match-mode` может принимать одно из следующих значений:\n\n  - \"all\" для режима `SPH_MATCH_ALL`;\n\n  - \"any\" для режима `SPH_MATCH_ANY`;\n\n  - \"phr\" для режима `SPH_MATCH_PHRASE`;\n\n  - \"bool\" для режима `SPH_MATCH_BOOLEAN`;\n\n  - \"ext\" для режима `SPH_MATCH_EXTENDED`;\n\n  - \"ext2\" для режима `SPH_MATCH_EXTENDED2`;\n\n  - \"scan\" если использовался режим полного сканирования, либо заданный через `SPH_MATCH_FULLSCAN`, либо если запрос был пустым.\n\n* `sort-mode` может принимать одно из следующих значений:\n\n  - \"rel\" для режима `SPH_SORT_RELEVANCE`;\n\n  - \"attr-\" для режима `SPH_SORT_ATTR_DESC`;\n\n  - \"attr+\" для режима `SPH_SORT_ATTR_ASC`;\n\n  - \"tsegs\" для режима `SPH_SORT_TIME_SEGMENTS`;\n\n  - \"ext\" для режима `SPH_SORT_EXTENDED`.\n\nПримечание: режимы `SPH*` специфичны для устаревшего интерфейса `sphinx`. SQL и JSON интерфейсы в большинстве случаев будут логировать `ext2` как `match-mode` и `ext` и `rel` как `sort-mode`.\n\n<!-- intro -->\n\nПример лога запросов:\n\n<!-- request Example -->\n\nCODE_BLOCK_5\n\n<!-- end -->\n\n## Логирование только медленных запросов\n\n<!-- example query_log_min_msec -->\n\nПо умолчанию логируются все запросы. Если вы хотите логировать только запросы с временем выполнения, превышающим заданный предел, можно использовать директиву `query_log_min_msec`.\n\nОжидаемая единица измерения — миллисекунды, но также можно использовать выражения с суффиксами времени.\n\n<!-- intro -->\n\nПример `query_log_min_msec`:\n\n<!-- request Config -->\n\nCODE_BLOCK_6\n\n<!-- end -->\n\n## Режим прав доступа к файлу лога\n\n<!-- Example query_log_mode -->\n\nПо умолчанию файлы логов searchd и запросов создаются с правами `600`, поэтому читать лог-файлы могут только пользователь, под которым запущен Manticore, и `root`. Опция `query_log_mode` позволяет задать другие права доступа. Это может быть полезно для предоставления другим пользователям доступа к логам (например, решениям мониторинга, работающим под не-root пользователями).\n\n<!-- intro -->\n\nПример `query_log_mode`:\n\n<!-- request Config -->\n\nCODE_BLOCK_7\n\n<!-- end -->\n\n<!-- proofread -->"
    },
    "is_code_or_comment": false
  }
}
