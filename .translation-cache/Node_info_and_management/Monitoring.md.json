{
    "d074574e282e16aff466cf2c6920cbf9244cd3eee011be52f1a6a79c51dc68f6": {
        "original": "# Monitoring\n\nManticore provides a Prometheus metrics endpoint and officially maintained alert rules and Grafana dashboards for Manticore Buddy.\n\n## Prometheus Exporter\n\n<!-- example prometheus exporter -->\n\nManticore Search has a built-in Prometheus exporter.\nTo request metrics, make sure the HTTP port is exposed and simply call the /metrics endpoint.\n\n**Note:** The exporter requires **Buddy** to be enabled.\n\n<!-- intro -->\n##### HTTP:\n\n<!-- request http -->\n\nCODE_BLOCK_0\n<!-- response http -->\n\nCODE_BLOCK_1\n\n<!-- end -->\n\n## Prometheus alerting rules\n\nThis folder contains officially maintained monitoring assets for Manticore Search.\n\nFile: [manticore-alerts.yml](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/prometheus/manticore-alerts.yml)\n\nExample scrape config:\n\nCODE_BLOCK_2\n\n#### Alert guide:\n* **ManticoreBuddyTargetDown**: Prometheus cannot scrape this target. Means the service is down, unreachable, or the scrape config is wrong.\n* **ManticoreBuddyRecentlyRestarted**: Uptime stays under 5 minutes for 5 minutes. Means the process is restarting or flapping.\n* **ManticoreBuddyMaxedOutErrors**: The `maxed_out` error counter increases. Means Manticore is rejecting work due to limits.\n* **ManticoreBuddySearchLatencyP95High**: p95 search latency stays above 500 ms for 10 minutes. Most users feel slow searches.\n* **ManticoreBuddySearchLatencyP99High**: p99 search latency stays above 1000 ms for 10 minutes. The slowest requests are very slow.\n* **ManticoreBuddyWorkQueueBacklog**: Work queue length stays above 100 for 5 minutes. Requests are piling up.\n* **ManticoreBuddyWorkersSaturated**: More than 90% of workers are active for 10 minutes. Threads are maxed, so latency will rise.\n* **ManticoreBuddyQueryCacheNearLimit**: Query cache stays above 90% usage for 10 minutes. Cache churn likely, expect slower queries.\n* **ManticoreBuddyDiskMappedCacheLow**: Disk mapped cache ratio stays below 50% for 15 minutes. More disk IO, slower queries.\n* **ManticoreBuddyDiskMappedCacheVeryLow**: Disk mapped cache ratio stays below 20% for 15 minutes. Severe disk IO, high latency risk.\n\n#### Why these alerts exist:\n* Availability and restarts catch hard outages and flapping early.\n* Latency and queueing detect overload before errors appear.\n* Cache and disk-mapped ratio are early warnings for IO-bound slowdowns.\n* Worker saturation and maxed_out errors indicate capacity limits are being hit.\n\n#### If you see an alert:\n* **TargetDown**: check service health, network, scrape config, and firewall.\n* **RecentlyRestarted**: check logs, crashes, OOM, or restarts from orchestration.\n* **MaxedOutErrors**: check resource limits, worker count, and query concurrency.\n* **Latency/Queue/Saturation**: reduce load, scale resources, or tune queries/indexes.\n* **Cache alerts**: increase cache size or reduce cache-churning queries.\n* **Disk mapped cache** ratio alerts: add RAM, reduce working set, or optimize tables.\n\n## Grafana dashboard\n\nFile: [manticore-buddy-dashboard.json](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/grafana/manticore-dashboard.json)\n\n#### Dashboard panel guide:\n* **Uptime**: Time since the last restart. If this keeps dropping, the service is restarting or crashing.\n* **Version**: The exact Manticore build running. If behavior changes after a deploy, check this first.\n* **Current Connections**: How many client connections are open right now. A sudden spike = traffic surge; a sudden drop = outage or client issues.\n* **Active Workers**: How many worker threads are busy. If this is near the total for a long time, the server is overloaded.\n* **Load (All Queues)**: Average queue load over 1/5/15 minutes. If all three lines climb, the system is falling behind.\n* **Work Queue Length**: How many tasks are waiting. If this keeps growing, requests are piling up and latency will rise.\n* **Commands per Second**: How many searches/inserts/updates/etc. per second. Tells you if traffic is heavy and what kind.\n* **Search Latency (p95/p99)**: 95%/99% of searches are faster than this. If these grow, users feel slow searches even if averages look fine.\n* **Query Cache Usage**: How much cache is used vs the max. If usage keeps growing to the limit, the cache will churn and queries slow down.\n* **Query Cache Hit Rate**: How many cache hits per second. If this goes down while traffic stays high, the cache is not helping.\n* **Disk and RAM Bytes**: Size of indexed data on disk and RAM. Rapid growth means more storage pressure and usually slower queries.\n* **Disk Mapped Cache Ratio by Table**: How much of each table is already cached in memory. Low ratios mean more disk reads and slower queries.\n* **Slowest Thread**: How long the slowest running query takes. If this spikes, there may be stuck or very heavy queries.\n* **Connections by Type**: Splits connections into current, buddy, and vip. Helpful to see which protocol is driving load.\n\n#### How to import:\n1. Open Grafana and go to Dashboards -> Import.\n2. Upload the JSON file.\n3. Select your Prometheus datasource when prompted.\n",
        "translations": {
            "chinese": "# \u76d1\u63a7\n\nManticore \u63d0\u4f9b\u4e86\u4e00\u4e2a Prometheus \u6307\u6807\u7aef\u70b9\uff0c\u5e76\u4e3a Manticore Buddy \u63d0\u4f9b\u5b98\u65b9\u7ef4\u62a4\u7684\u544a\u8b66\u89c4\u5219\u548c Grafana \u4eea\u8868\u677f\u3002\n\n## Prometheus \u5bfc\u51fa\u5668\n\n<!-- example prometheus exporter -->\n\nManticore Search \u5185\u7f6e\u4e86 Prometheus \u5bfc\u51fa\u5668\u3002\n\u8981\u8bf7\u6c42\u6307\u6807\uff0c\u8bf7\u786e\u4fdd\u66b4\u9732 HTTP \u7aef\u53e3\uff0c\u7136\u540e\u76f4\u63a5\u8c03\u7528 /metrics \u7aef\u70b9\u3002\n\n**\u6ce8\u610f\uff1a** \u5bfc\u51fa\u5668\u9700\u8981\u542f\u7528 **Buddy**\u3002\n\n<!-- intro -->\n##### HTTP:\n\n<!-- request http -->\n\nCODE_BLOCK_0\n<!-- response http -->\n\nCODE_BLOCK_1\n\n<!-- end -->\n\n## Prometheus \u544a\u8b66\u89c4\u5219\n\n\u6b64\u6587\u4ef6\u5939\u5305\u542b\u4e3a Manticore Search \u5b98\u65b9\u7ef4\u62a4\u7684\u76d1\u63a7\u8d44\u6e90\u3002\n\n\u6587\u4ef6\uff1a[manticore-alerts.yml](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/prometheus/manticore-alerts.yml)\n\n\u793a\u4f8b\u6293\u53d6\u914d\u7f6e\uff1a\n\nCODE_BLOCK_2\n\n#### \u544a\u8b66\u6307\u5357\uff1a\n* **ManticoreBuddyTargetDown**\uff1aPrometheus \u65e0\u6cd5\u6293\u53d6\u6b64\u76ee\u6807\u3002\u8868\u793a\u670d\u52a1\u5df2\u5173\u95ed\u3001\u4e0d\u53ef\u8fbe\u6216\u6293\u53d6\u914d\u7f6e\u9519\u8bef\u3002\n* **ManticoreBuddyRecentlyRestarted**\uff1a5 \u5206\u949f\u5185\u8fd0\u884c\u65f6\u95f4\u4fdd\u6301\u5728 5 \u5206\u949f\u4ee5\u4e0b\u3002\u8868\u793a\u8fdb\u7a0b\u6b63\u5728\u91cd\u542f\u6216\u6ce2\u52a8\u3002\n* **ManticoreBuddyMaxedOutErrors**\uff1a`maxed_out` \u9519\u8bef\u8ba1\u6570\u5668\u589e\u52a0\u3002\u8868\u793a Manticore \u56e0\u9650\u5236\u800c\u62d2\u7edd\u5de5\u4f5c\u3002\n* **ManticoreBuddySearchLatencyP95High**\uff1ap95 \u641c\u7d22\u5ef6\u8fdf\u5728 10 \u5206\u949f\u5185\u4fdd\u6301\u5728 500 \u6beb\u79d2\u4ee5\u4e0a\u3002\u5927\u591a\u6570\u7528\u6237\u4f1a\u611f\u89c9\u641c\u7d22\u53d8\u6162\u3002\n* **ManticoreBuddySearchLatencyP99High**\uff1ap99 \u641c\u7d22\u5ef6\u8fdf\u5728 10 \u5206\u949f\u5185\u4fdd\u6301\u5728 1000 \u6beb\u79d2\u4ee5\u4e0a\u3002\u6700\u6162\u7684\u8bf7\u6c42\u975e\u5e38\u6162\u3002\n* **ManticoreBuddyWorkQueueBacklog**\uff1a\u5de5\u4f5c\u961f\u5217\u957f\u5ea6\u5728 5 \u5206\u949f\u5185\u4fdd\u6301\u5728 100 \u4ee5\u4e0a\u3002\u8bf7\u6c42\u6b63\u5728\u5806\u79ef\u3002\n* **ManticoreBuddyWorkersSaturated**\uff1a\u8d85\u8fc7 90% \u7684\u5de5\u4f5c\u7ebf\u7a0b\u5728 10 \u5206\u949f\u5185\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u3002\u7ebf\u7a0b\u5df2\u6ee1\uff0c\u5ef6\u8fdf\u5c06\u4e0a\u5347\u3002\n* **ManticoreBuddyQueryCacheNearLimit**\uff1a\u67e5\u8be2\u7f13\u5b58\u4f7f\u7528\u7387\u5728 10 \u5206\u949f\u5185\u4fdd\u6301\u5728 90% \u4ee5\u4e0a\u3002\u7f13\u5b58\u9891\u7e41\u66f4\u6362\uff0c\u9884\u8ba1\u67e5\u8be2\u4f1a\u53d8\u6162\u3002\n* **ManticoreBuddyDiskMappedCacheLow**\uff1a\u78c1\u76d8\u6620\u5c04\u7f13\u5b58\u6bd4\u7387\u5728 15 \u5206\u949f\u5185\u4fdd\u6301\u5728 50% \u4ee5\u4e0b\u3002\u78c1\u76d8 I/O \u589e\u52a0\uff0c\u67e5\u8be2\u53d8\u6162\u3002\n* **ManticoreBuddyDiskMappedCacheVeryLow**\uff1a\u78c1\u76d8\u6620\u5c04\u7f13\u5b58\u6bd4\u7387\u5728 15 \u5206\u949f\u5185\u4fdd\u6301\u5728 20% \u4ee5\u4e0b\u3002\u4e25\u91cd\u7684\u78c1\u76d8 I/O\uff0c\u5b58\u5728\u9ad8\u5ef6\u8fdf\u98ce\u9669\u3002\n\n#### \u8fd9\u4e9b\u544a\u8b66\u5b58\u5728\u7684\u539f\u56e0\uff1a\n* \u53ef\u7528\u6027\u548c\u91cd\u542f\u68c0\u6d4b\u53ef\u4ee5\u65e9\u671f\u53d1\u73b0\u4e25\u91cd\u6545\u969c\u548c\u6ce2\u52a8\u3002\n* \u5ef6\u8fdf\u548c\u6392\u961f\u68c0\u6d4b\u53ef\u4ee5\u5728\u9519\u8bef\u51fa\u73b0\u524d\u53d1\u73b0\u8fc7\u8f7d\u3002\n* \u7f13\u5b58\u548c\u78c1\u76d8\u6620\u5c04\u6bd4\u7387\u662f I/O \u5bc6\u96c6\u578b\u51cf\u901f\u7684\u65e9\u671f\u9884\u8b66\u3002\n* \u5de5\u4f5c\u7ebf\u7a0b\u9971\u548c\u548c maxed_out \u9519\u8bef\u8868\u660e\u5bb9\u91cf\u9650\u5236\u5df2\u88ab\u89e6\u53ca\u3002\n\n#### \u5982\u679c\u770b\u5230\u544a\u8b66\uff1a\n* **TargetDown**\uff1a\u68c0\u67e5\u670d\u52a1\u5065\u5eb7\u72b6\u51b5\u3001\u7f51\u7edc\u3001\u6293\u53d6\u914d\u7f6e\u548c\u9632\u706b\u5899\u3002\n* **RecentlyRestarted**\uff1a\u68c0\u67e5\u65e5\u5fd7\u3001\u5d29\u6e83\u3001\u5185\u5b58\u4e0d\u8db3\u6216\u7f16\u6392\u91cd\u542f\u3002\n* **MaxedOutErrors**\uff1a\u68c0\u67e5\u8d44\u6e90\u9650\u5236\u3001\u5de5\u4f5c\u7ebf\u7a0b\u6570\u548c\u67e5\u8be2\u5e76\u53d1\u3002\n* **\u5ef6\u8fdf/\u6392\u961f/\u9971\u548c**\uff1a\u51cf\u5c11\u8d1f\u8f7d\u3001\u6269\u5c55\u8d44\u6e90\u6216\u8c03\u6574\u67e5\u8be2/\u7d22\u5f15\u3002\n* **\u7f13\u5b58\u544a\u8b66**\uff1a\u589e\u52a0\u7f13\u5b58\u5927\u5c0f\u6216\u51cf\u5c11\u7f13\u5b58\u9891\u7e41\u66f4\u6362\u7684\u67e5\u8be2\u3002\n* **\u78c1\u76d8\u6620\u5c04\u7f13\u5b58** \u6bd4\u7387\u544a\u8b66\uff1a\u589e\u52a0 RAM\u3001\u51cf\u5c11\u5de5\u4f5c\u96c6\u6216\u4f18\u5316\u8868\u3002\n\n## Grafana \u4eea\u8868\u677f\n\n\u6587\u4ef6\uff1a[manticore-buddy-dashboard.json](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/grafana/manticore-dashboard.json)\n\n#### \u4eea\u8868\u677f\u9762\u677f\u6307\u5357\uff1a\n* **\u8fd0\u884c\u65f6\u95f4**\uff1a\u81ea\u4e0a\u6b21\u91cd\u542f\u4ee5\u6765\u7684\u65f6\u95f4\u3002\u5982\u679c\u6b64\u503c\u6301\u7eed\u4e0b\u964d\uff0c\u670d\u52a1\u6b63\u5728\u91cd\u542f\u6216\u5d29\u6e83\u3002\n* **\u7248\u672c**\uff1a\u6b63\u5728\u8fd0\u884c\u7684 Manticore \u7cbe\u786e\u6784\u5efa\u7248\u672c\u3002\u5982\u679c\u90e8\u7f72\u540e\u884c\u4e3a\u53d1\u751f\u53d8\u5316\uff0c\u8bf7\u9996\u5148\u68c0\u67e5\u6b64\u5185\u5bb9\u3002\n* **\u5f53\u524d\u8fde\u63a5\u6570**\uff1a\u5f53\u524d\u6253\u5f00\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002\u7a81\u7136\u6fc0\u589e\u8868\u793a\u6d41\u91cf\u6fc0\u589e\uff1b\u7a81\u7136\u4e0b\u964d\u8868\u793a\u6545\u969c\u6216\u5ba2\u6237\u7aef\u95ee\u9898\u3002\n* **\u6d3b\u52a8\u5de5\u4f5c\u7ebf\u7a0b**\uff1a\u5f53\u524d\u6b63\u5728\u5de5\u4f5c\u7684\u7ebf\u7a0b\u6570\u3002\u5982\u679c\u957f\u65f6\u95f4\u63a5\u8fd1\u603b\u6570\uff0c\u670d\u52a1\u5668\u5df2\u8fc7\u8f7d\u3002\n* **\u8d1f\u8f7d\uff08\u6240\u6709\u961f\u5217\uff09**\uff1a1/5/15 \u5206\u949f\u7684\u5e73\u5747\u961f\u5217\u8d1f\u8f7d\u3002\u5982\u679c\u4e09\u6761\u7ebf\u90fd\u4e0a\u5347\uff0c\u7cfb\u7edf\u6b63\u5728\u843d\u540e\u3002\n* **\u5de5\u4f5c\u961f\u5217\u957f\u5ea6**\uff1a\u7b49\u5f85\u7684\u4efb\u52a1\u6570\u3002\u5982\u679c\u6301\u7eed\u589e\u957f\uff0c\u8bf7\u6c42\u6b63\u5728\u5806\u79ef\uff0c\u5ef6\u8fdf\u5c06\u4e0a\u5347\u3002\n* **\u6bcf\u79d2\u547d\u4ee4\u6570**\uff1a\u6bcf\u79d2\u7684\u641c\u7d22/\u63d2\u5165/\u66f4\u65b0\u7b49\u64cd\u4f5c\u6570\u3002\u544a\u8bc9\u4f60\u6d41\u91cf\u662f\u5426\u7e41\u91cd\u4ee5\u53ca\u7c7b\u578b\u3002\n* **\u641c\u7d22\u5ef6\u8fdf\uff08p95/p99\uff09**\uff1a95%/99% \u7684\u641c\u7d22\u901f\u5ea6\u90fd\u5feb\u4e8e\u6b64\u503c\u3002\u5982\u679c\u8fd9\u4e9b\u503c\u589e\u957f\uff0c\u5373\u4f7f\u5e73\u5747\u503c\u770b\u8d77\u6765\u6b63\u5e38\uff0c\u7528\u6237\u4e5f\u4f1a\u611f\u89c9\u641c\u7d22\u53d8\u6162\u3002\n* **\u67e5\u8be2\u7f13\u5b58\u4f7f\u7528\u7387**\uff1a\u4f7f\u7528\u7684\u7f13\u5b58\u4e0e\u6700\u5927\u503c\u7684\u6bd4\u7387\u3002\u5982\u679c\u4f7f\u7528\u7387\u6301\u7eed\u589e\u957f\u5230\u6781\u9650\uff0c\u7f13\u5b58\u5c06\u9891\u7e41\u66f4\u6362\uff0c\u67e5\u8be2\u4f1a\u53d8\u6162\u3002\n* **\u67e5\u8be2\u7f13\u5b58\u547d\u4e2d\u7387**\uff1a\u6bcf\u79d2\u7684\u7f13\u5b58\u547d\u4e2d\u6b21\u6570\u3002\u5982\u679c\u6d41\u91cf\u4fdd\u6301\u9ad8\u4f4d\u800c\u6b64\u503c\u4e0b\u964d\uff0c\u7f13\u5b58\u6ca1\u6709\u5e2e\u52a9\u3002\n* **\u78c1\u76d8\u548c RAM \u5b57\u8282**\uff1a\u78c1\u76d8\u548c RAM \u4e0a\u7d22\u5f15\u6570\u636e\u7684\u5927\u5c0f\u3002\u5feb\u901f\u589e\u957f\u610f\u5473\u7740\u66f4\u591a\u7684\u5b58\u50a8\u538b\u529b\uff0c\u901a\u5e38\u67e5\u8be2\u66f4\u6162\u3002\n* **\u6309\u8868\u7684\u78c1\u76d8\u6620\u5c04\u7f13\u5b58\u6bd4\u7387**\uff1a\u6bcf\u4e2a\u8868\u5728\u5185\u5b58\u4e2d\u5df2\u7f13\u5b58\u7684\u6bd4\u4f8b\u3002\u4f4e\u6bd4\u7387\u610f\u5473\u7740\u66f4\u591a\u78c1\u76d8\u8bfb\u53d6\u548c\u66f4\u6162\u7684\u67e5\u8be2\u3002\n* **\u6700\u6162\u7ebf\u7a0b**\uff1a\u6700\u6162\u8fd0\u884c\u67e5\u8be2\u6240\u9700\u7684\u65f6\u95f4\u3002\u5982\u679c\u6b64\u503c\u6fc0\u589e\uff0c\u53ef\u80fd\u5b58\u5728\u5361\u4f4f\u6216\u975e\u5e38\u91cd\u7684\u67e5\u8be2\u3002\n* **\u6309\u7c7b\u578b\u5212\u5206\u7684\u8fde\u63a5**\uff1a\u5c06\u8fde\u63a5\u5206\u4e3a\u5f53\u524d\u3001buddy \u548c vip\u3002\u6709\u52a9\u4e8e\u4e86\u89e3\u54ea\u79cd\u534f\u8bae\u9a71\u52a8\u8d1f\u8f7d\u3002\n\n#### \u5982\u4f55\u5bfc\u5165\uff1a\n1. \u6253\u5f00 Grafana \u5e76\u8fdb\u5165\u4eea\u8868\u677f -> \u5bfc\u5165\u3002\n2. \u4e0a\u4f20 JSON \u6587\u4ef6\u3002\n3. \u5728\u63d0\u793a\u65f6\u9009\u62e9\u60a8\u7684 Prometheus \u6570\u636e\u6e90\u3002\n",
            "russian": "# \u041c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433\n\nManticore \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u044d\u043d\u0434\u043f\u043e\u0438\u043d\u0442 \u043c\u0435\u0442\u0440\u0438\u043a Prometheus, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u0439 \u0438 \u0434\u0430\u0448\u0431\u043e\u0440\u0434\u044b Grafana \u0434\u043b\u044f Manticore Buddy.\n\n## Prometheus Exporter\n\n<!-- example prometheus exporter -->\n\nManticore Search \u0438\u043c\u0435\u0435\u0442 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0439 \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0435\u0440 Prometheus.\n\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u043c\u0435\u0442\u0440\u0438\u043a\u0438, \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e HTTP-\u043f\u043e\u0440\u0442 \u043e\u0442\u043a\u0440\u044b\u0442, \u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u0432\u044b\u0437\u043e\u0432\u0438\u0442\u0435 \u044d\u043d\u0434\u043f\u043e\u0438\u043d\u0442 /metrics.\n\n**\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435:** \u0414\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0435\u0440\u0430 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f, \u0447\u0442\u043e\u0431\u044b **Buddy** \u0431\u044b\u043b \u0432\u043a\u043b\u044e\u0447\u0435\u043d.\n\n<!-- intro -->\n##### HTTP:\n\n<!-- request http -->\n\nCODE_BLOCK_0\n<!-- response http -->\n\nCODE_BLOCK_1\n\n<!-- end -->\n\n## \u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u0439 Prometheus\n\n\u042d\u0442\u0430 \u043f\u0430\u043f\u043a\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u044b \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433\u0430 \u0434\u043b\u044f Manticore Search.\n\n\u0424\u0430\u0439\u043b: [manticore-alerts.yml](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/prometheus/manticore-alerts.yml)\n\n\u041f\u0440\u0438\u043c\u0435\u0440 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0441\u0431\u043e\u0440\u0430 \u043c\u0435\u0442\u0440\u0438\u043a (scrape config):\n\nCODE_BLOCK_2\n\n#### \u0420\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u043f\u043e \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u044f\u043c:\n* **ManticoreBuddyTargetDown**: Prometheus \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u043c\u0435\u0442\u0440\u0438\u043a\u0438 \u0441 \u044d\u0442\u043e\u0439 \u0446\u0435\u043b\u0438. \u041e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u0441\u0435\u0440\u0432\u0438\u0441 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442, \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0438\u043b\u0438 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0441\u0431\u043e\u0440\u0430 \u043d\u0435\u0432\u0435\u0440\u043d\u0430.\n* **ManticoreBuddyRecentlyRestarted**: \u0412\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b (uptime) \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u043c\u0435\u043d\u0435\u0435 5 \u043c\u0438\u043d\u0443\u0442 \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 5 \u043c\u0438\u043d\u0443\u0442. \u041e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u0438\u043b\u0438 \u043d\u0435\u0441\u0442\u0430\u0431\u0438\u043b\u0435\u043d.\n* **ManticoreBuddyMaxedOutErrors**: \u0421\u0447\u0435\u0442\u0447\u0438\u043a \u043e\u0448\u0438\u0431\u043e\u043a `maxed_out` \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f. \u041e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e Manticore \u043e\u0442\u043a\u043b\u043e\u043d\u044f\u0435\u0442 \u0437\u0430\u0434\u0430\u0447\u0438 \u0438\u0437-\u0437\u0430 \u043b\u0438\u043c\u0438\u0442\u043e\u0432.\n* **ManticoreBuddySearchLatencyP95High**: 95-\u0439 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u0438\u043b\u044c \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438 \u043f\u043e\u0438\u0441\u043a\u0430 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u0448\u0435 500 \u043c\u0441 \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 10 \u043c\u0438\u043d\u0443\u0442. \u0411\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043e\u0449\u0443\u0449\u0430\u044e\u0442 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u0438\u0441\u043a.\n* **ManticoreBuddySearchLatencyP99High**: 99-\u0439 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u0438\u043b\u044c \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438 \u043f\u043e\u0438\u0441\u043a\u0430 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u0448\u0435 1000 \u043c\u0441 \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 10 \u043c\u0438\u043d\u0443\u0442. \u0421\u0430\u043c\u044b\u0435 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043e\u0447\u0435\u043d\u044c \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0435.\n* **ManticoreBuddyWorkQueueBacklog**: \u0414\u043b\u0438\u043d\u0430 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0437\u0430\u0434\u0430\u0447 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u0448\u0435 100 \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 5 \u043c\u0438\u043d\u0443\u0442. \u0417\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0430\u043a\u0430\u043f\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f.\n* **ManticoreBuddyWorkersSaturated**: \u0411\u043e\u043b\u0435\u0435 90% \u0440\u0430\u0431\u043e\u0447\u0438\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432 \u0430\u043a\u0442\u0438\u0432\u043d\u044b \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 10 \u043c\u0438\u043d\u0443\u0442. \u041f\u043e\u0442\u043e\u043a\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b \u043f\u043e \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c\u0443, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0441\u0442\u0438.\n* **ManticoreBuddyQueryCacheNearLimit**: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u044d\u0448\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u0448\u0435 90% \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 10 \u043c\u0438\u043d\u0443\u0442. \u0412\u0435\u0440\u043e\u044f\u0442\u043d\u043e, \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432\u044b\u0442\u0435\u0441\u043d\u0435\u043d\u0438\u0435 \u0438\u0437 \u043a\u044d\u0448\u0430, \u043e\u0436\u0438\u0434\u0430\u0439\u0442\u0435 \u0431\u043e\u043b\u0435\u0435 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432.\n* **ManticoreBuddyDiskMappedCacheLow**: \u041a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0434\u0438\u0441\u043a\u0430 \u0432 \u043a\u044d\u0448 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u043d\u0438\u0436\u0435 50% \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 15 \u043c\u0438\u043d\u0443\u0442. \u0411\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439 \u0432\u0432\u043e\u0434\u0430-\u0432\u044b\u0432\u043e\u0434\u0430 \u043d\u0430 \u0434\u0438\u0441\u043a, \u0431\u043e\u043b\u0435\u0435 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b.\n* **ManticoreBuddyDiskMappedCacheVeryLow**: \u041a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0434\u0438\u0441\u043a\u0430 \u0432 \u043a\u044d\u0448 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u043d\u0438\u0436\u0435 20% \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 15 \u043c\u0438\u043d\u0443\u0442. \u0421\u0435\u0440\u044c\u0435\u0437\u043d\u0430\u044f \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0430 \u0434\u0438\u0441\u043a, \u0432\u044b\u0441\u043e\u043a\u0438\u0439 \u0440\u0438\u0441\u043a \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438.\n\n#### \u0417\u0430\u0447\u0435\u043c \u043d\u0443\u0436\u043d\u044b \u044d\u0442\u0438 \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u044f:\n* \u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0438 \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u0440\u0430\u043d\u043e \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0438\u0442\u044c \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u044b\u0435 \u0441\u0431\u043e\u0438 \u0438 \u043d\u0435\u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c.\n* \u0417\u0430\u0434\u0435\u0440\u0436\u043a\u0430 \u0438 \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0438\u0432\u0430\u044e\u0442 \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0437\u043a\u0443 \u0434\u043e \u043f\u043e\u044f\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0448\u0438\u0431\u043e\u043a.\n* \u041a\u044d\u0448 \u0438 \u043a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0434\u0438\u0441\u043a\u0430 \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0440\u0430\u043d\u043d\u0438\u043c\u0438 \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u044f\u043c\u0438 \u043e \u0437\u0430\u043c\u0435\u0434\u043b\u0435\u043d\u0438\u044f\u0445, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u0441 \u0432\u0432\u043e\u0434\u043e\u043c-\u0432\u044b\u0432\u043e\u0434\u043e\u043c.\n* \u041d\u0430\u0441\u044b\u0449\u0435\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0447\u0438\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432 \u0438 \u043e\u0448\u0438\u0431\u043a\u0438 maxed_out \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0442 \u043d\u0430 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u0435\u043b\u043e\u0432 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438.\n\n#### \u0415\u0441\u043b\u0438 \u0432\u044b \u0432\u0438\u0434\u0438\u0442\u0435 \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u0435:\n* **TargetDown**: \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u0430, \u0441\u0435\u0442\u044c, \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0441\u0431\u043e\u0440\u0430 \u043c\u0435\u0442\u0440\u0438\u043a \u0438 \u0431\u0440\u0430\u043d\u0434\u043c\u0430\u0443\u044d\u0440.\n* **RecentlyRestarted**: \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043b\u043e\u0433\u0438, \u0441\u0431\u043e\u0438, \u043d\u0435\u0445\u0432\u0430\u0442\u043a\u0443 \u043f\u0430\u043c\u044f\u0442\u0438 (OOM) \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0438 \u043e\u0442 \u043e\u0440\u043a\u0435\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430.\n* **MaxedOutErrors**: \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043b\u0438\u043c\u0438\u0442\u044b \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432, \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0440\u0430\u0431\u043e\u0447\u0438\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432 \u0438 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u0438\u0437\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432.\n* **Latency/Queue/Saturation**: \u0443\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u0435 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0443, \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u0439\u0442\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u044b \u0438\u043b\u0438 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b/\u0438\u043d\u0434\u0435\u043a\u0441\u044b.\n* **Cache alerts**: \u0443\u0432\u0435\u043b\u0438\u0447\u044c\u0442\u0435 \u0440\u0430\u0437\u043c\u0435\u0440 \u043a\u044d\u0448\u0430 \u0438\u043b\u0438 \u0443\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432, \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0438\u0445 \u0432\u044b\u0442\u0435\u0441\u043d\u0435\u043d\u0438\u0435 \u0438\u0437 \u043a\u044d\u0448\u0430.\n* **Disk mapped cache ratio alerts**: \u0434\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438, \u0443\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u0435 \u0440\u0430\u0431\u043e\u0447\u0438\u0439 \u043d\u0430\u0431\u043e\u0440 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u043b\u0438 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b.\n\n## \u0414\u0430\u0448\u0431\u043e\u0440\u0434 Grafana\n\n\u0424\u0430\u0439\u043b: [manticore-buddy-dashboard.json](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/grafana/manticore-dashboard.json)\n\n#### \u0420\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u043f\u043e \u043f\u0430\u043d\u0435\u043b\u044f\u043c \u0434\u0430\u0448\u0431\u043e\u0440\u0434\u0430:\n* **Uptime**: \u0412\u0440\u0435\u043c\u044f \u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u043e \u043f\u0430\u0434\u0430\u0435\u0442, \u0441\u0435\u0440\u0432\u0438\u0441 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u0438\u043b\u0438 \u043f\u0430\u0434\u0430\u0435\u0442.\n* **Version**: \u0422\u043e\u0447\u043d\u0430\u044f \u0441\u0431\u043e\u0440\u043a\u0430 Manticore, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442. \u0415\u0441\u043b\u0438 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c \u043f\u043e\u0441\u043b\u0435 \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u044f, \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u044d\u0442\u043e \u0432 \u043f\u0435\u0440\u0432\u0443\u044e \u043e\u0447\u0435\u0440\u0435\u0434\u044c.\n* **Current Connections**: \u0421\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u0445 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u043e\u0442\u043a\u0440\u044b\u0442\u043e \u043f\u0440\u044f\u043c\u043e \u0441\u0435\u0439\u0447\u0430\u0441. \u0412\u043d\u0435\u0437\u0430\u043f\u043d\u044b\u0439 \u0441\u043a\u0430\u0447\u043e\u043a = \u0432\u0441\u043f\u043b\u0435\u0441\u043a \u0442\u0440\u0430\u0444\u0438\u043a\u0430; \u0432\u043d\u0435\u0437\u0430\u043f\u043d\u043e\u0435 \u043f\u0430\u0434\u0435\u043d\u0438\u0435 = \u0441\u0431\u043e\u0439 \u0438\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430.\n* **Active Workers**: \u0421\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0430\u0431\u043e\u0447\u0438\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432 \u0437\u0430\u043d\u044f\u0442\u043e. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0434\u043e\u043b\u0433\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u0431\u043b\u0438\u0437\u043e\u043a \u043a \u043e\u0431\u0449\u0435\u043c\u0443 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0443, \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043d.\n* **Load (All Queues)**: \u0421\u0440\u0435\u0434\u043d\u044f\u044f \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0437\u0430 1/5/15 \u043c\u0438\u043d\u0443\u0442. \u0415\u0441\u043b\u0438 \u0432\u0441\u0435 \u0442\u0440\u0438 \u043b\u0438\u043d\u0438\u0438 \u0440\u0430\u0441\u0442\u0443\u0442, \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043d\u0435 \u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f.\n* **Work Queue Length**: \u0421\u043a\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0434\u0430\u0447 \u043e\u0436\u0438\u0434\u0430\u044e\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u0442 \u0440\u0430\u0441\u0442\u0438, \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0430\u043a\u0430\u043f\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f, \u0438 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0442\u044c\u0441\u044f.\n* **Commands per Second**: \u0421\u043a\u043e\u043b\u044c\u043a\u043e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439 \u043f\u043e\u0438\u0441\u043a\u0430/\u0432\u0441\u0442\u0430\u0432\u043a\u0438/\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438 \u0442.\u0434. \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443. \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u043d\u0430\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u044b\u0441\u043e\u043a\u0430 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438 \u043a\u0430\u043a\u043e\u0433\u043e \u043e\u043d\u0430 \u0442\u0438\u043f\u0430.\n* **Search Latency (p95/p99)**: 95%/99% \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u0431\u044b\u0441\u0442\u0440\u0435\u0435 \u044d\u0442\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f. \u0415\u0441\u043b\u0438 \u044d\u0442\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0440\u0430\u0441\u0442\u0443\u0442, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u043e\u0449\u0443\u0449\u0430\u044e\u0442 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u0438\u0441\u043a, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0441\u0440\u0435\u0434\u043d\u0438\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u0432\u044b\u0433\u043b\u044f\u0434\u044f\u0442 \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e.\n* **Query Cache Usage**: \u0421\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u044d\u0448\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043f\u043e \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044e \u0441 \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c\u043e\u043c. \u0415\u0441\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u043e \u0440\u0430\u0441\u0442\u0435\u0442 \u0434\u043e \u043f\u0440\u0435\u0434\u0435\u043b\u0430, \u043a\u044d\u0448 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0442\u0435\u0441\u043d\u044f\u0442\u044c\u0441\u044f, \u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0437\u0430\u043c\u0435\u0434\u043b\u044f\u0442\u0441\u044f.\n* **Query Cache Hit Rate**: \u0421\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u043f\u0430\u0434\u0430\u043d\u0438\u0439 \u0432 \u043a\u044d\u0448 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043f\u0430\u0434\u0430\u0435\u0442 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438, \u043a\u044d\u0448 \u043d\u0435 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442.\n* **Disk and RAM Bytes**: \u0420\u0430\u0437\u043c\u0435\u0440 \u043f\u0440\u043e\u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0434\u0438\u0441\u043a\u0435 \u0438 \u0432 \u043e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438. \u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u0440\u043e\u0441\u0442 \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435\u0435 \u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0438 \u043e\u0431\u044b\u0447\u043d\u043e \u0431\u043e\u043b\u0435\u0435 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b.\n* **Disk Mapped Cache Ratio by Table**: \u041a\u0430\u043a\u0430\u044f \u0447\u0430\u0441\u0442\u044c \u043a\u0430\u0436\u0434\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0443\u0436\u0435 \u0437\u0430\u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0432 \u043f\u0430\u043c\u044f\u0442\u0438. \u041d\u0438\u0437\u043a\u0438\u0435 \u043a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442\u044b \u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439 \u0447\u0442\u0435\u043d\u0438\u044f \u0441 \u0434\u0438\u0441\u043a\u0430 \u0438 \u0431\u043e\u043b\u0435\u0435 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b.\n* **Slowest Thread**: \u0421\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 \u0441\u0430\u043c\u044b\u0439 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0439 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0440\u0435\u0437\u043a\u043e \u0432\u043e\u0437\u0440\u0430\u0441\u0442\u0430\u0435\u0442, \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u0435\u0441\u0442\u044c \u0437\u0430\u0432\u0438\u0441\u0448\u0438\u0435 \u0438\u043b\u0438 \u043e\u0447\u0435\u043d\u044c \u0442\u044f\u0436\u0435\u043b\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b.\n* **Connections by Type**: \u0420\u0430\u0437\u0434\u0435\u043b\u044f\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0435, buddy \u0438 vip. \u041f\u043e\u043b\u0435\u0437\u043d\u043e \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f, \u043a\u0430\u043a\u043e\u0439 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0443.\n\n#### \u041a\u0430\u043a \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c:\n1. \u041e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 Grafana \u0438 \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 Dashboards -> Import.\n2. \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 JSON-\u0444\u0430\u0439\u043b.\n3. \u041f\u0440\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0430\u0448 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445 Prometheus.\n"
        },
        "is_code_or_comment": false,
        "model": "deepseek/deepseek-v3.2",
        "updated_at": 1770242571
    },
    "__meta": {
        "source_md5": "7486fa1c84d3e76c61e4a88c8056d26a",
        "updated_at": 1770242571,
        "source_text": "# Monitoring\n\nManticore provides a Prometheus metrics endpoint and officially maintained alert rules and Grafana dashboards for Manticore Buddy.\n\n## Prometheus Exporter\n\n<!-- example prometheus exporter -->\n\nManticore Search has a built-in Prometheus exporter.\nTo request metrics, make sure the HTTP port is exposed and simply call the /metrics endpoint.\n\n**Note:** The exporter requires **Buddy** to be enabled.\n\n<!-- intro -->\n##### HTTP:\n\n<!-- request http -->\n\n```go\ncurl -s 0:9308/metrics\n```\n<!-- response http -->\n\n```http\n# HELP manticore_uptime_seconds Time in seconds since start\n# TYPE manticore_uptime_seconds counter\nmanticore_uptime_seconds 25\n# HELP manticore_connections_count Connections count since start\n# TYPE manticore_connections_count gauge\nmanticore_connections_count 55\n# HELP manticore_maxed_out_error_count Count of maxed_out errors since start\n# TYPE manticore_maxed_out_error_count counter\nmanticore_maxed_out_error_count 0\n# HELP manticore_version Manticore Search version\n# TYPE manticore_version gauge\nmanticore_version {version=\"0.0.0 c88e811b2@25060409 (columnar 5.0.1 59c7092@25060304) (secondary 5.0.1 59c7092@25060304) (knn 5.0.1 59c7092@25060304) (embeddings 1.0.0) (buddy v3.28.6-7-g14ee10)\"} 1\n# HELP manticore_mysql_version Manticore Search version\n# TYPE manticore_mysql_version gauge\nmanticore_mysql_version {version=\"0.0.0 c88e811b2@25060409 (columnar 5.0.1 59c7092@25060304) (secondary 5.0.1 59c7092@25060304) (knn 5.0.1 59c7092@25060304) (embeddings 1.0.0)\"} 1\n# HELP manticore_command_search_count Count of search queries since start\n# TYPE manticore_command_search_count counter\nmanticore_command_search_count 1\n......\n```\n\n<!-- end -->\n\n## Prometheus alerting rules\n\nThis folder contains officially maintained monitoring assets for Manticore Search.\n\nFile: [manticore-alerts.yml](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/prometheus/manticore-alerts.yml)\n\nExample scrape config:\n\n```yaml\nscrape_configs:\n  - job_name: manticoresearch\n    metrics_path: /metrics\n    static_configs:\n      - targets:\n          - 127.0.0.1:9308\n```\n\n#### Alert guide:\n* **ManticoreBuddyTargetDown**: Prometheus cannot scrape this target. Means the service is down, unreachable, or the scrape config is wrong.\n* **ManticoreBuddyRecentlyRestarted**: Uptime stays under 5 minutes for 5 minutes. Means the process is restarting or flapping.\n* **ManticoreBuddyMaxedOutErrors**: The `maxed_out` error counter increases. Means Manticore is rejecting work due to limits.\n* **ManticoreBuddySearchLatencyP95High**: p95 search latency stays above 500 ms for 10 minutes. Most users feel slow searches.\n* **ManticoreBuddySearchLatencyP99High**: p99 search latency stays above 1000 ms for 10 minutes. The slowest requests are very slow.\n* **ManticoreBuddyWorkQueueBacklog**: Work queue length stays above 100 for 5 minutes. Requests are piling up.\n* **ManticoreBuddyWorkersSaturated**: More than 90% of workers are active for 10 minutes. Threads are maxed, so latency will rise.\n* **ManticoreBuddyQueryCacheNearLimit**: Query cache stays above 90% usage for 10 minutes. Cache churn likely, expect slower queries.\n* **ManticoreBuddyDiskMappedCacheLow**: Disk mapped cache ratio stays below 50% for 15 minutes. More disk IO, slower queries.\n* **ManticoreBuddyDiskMappedCacheVeryLow**: Disk mapped cache ratio stays below 20% for 15 minutes. Severe disk IO, high latency risk.\n\n#### Why these alerts exist:\n* Availability and restarts catch hard outages and flapping early.\n* Latency and queueing detect overload before errors appear.\n* Cache and disk-mapped ratio are early warnings for IO-bound slowdowns.\n* Worker saturation and maxed_out errors indicate capacity limits are being hit.\n\n#### If you see an alert:\n* **TargetDown**: check service health, network, scrape config, and firewall.\n* **RecentlyRestarted**: check logs, crashes, OOM, or restarts from orchestration.\n* **MaxedOutErrors**: check resource limits, worker count, and query concurrency.\n* **Latency/Queue/Saturation**: reduce load, scale resources, or tune queries/indexes.\n* **Cache alerts**: increase cache size or reduce cache-churning queries.\n* **Disk mapped cache** ratio alerts: add RAM, reduce working set, or optimize tables.\n\n## Grafana dashboard\n\nFile: [manticore-buddy-dashboard.json](https://github.com/manticoresoftware/manticoresearch-buddy/blob/main/monitoring/grafana/manticore-dashboard.json)\n\n#### Dashboard panel guide:\n* **Uptime**: Time since the last restart. If this keeps dropping, the service is restarting or crashing.\n* **Version**: The exact Manticore build running. If behavior changes after a deploy, check this first.\n* **Current Connections**: How many client connections are open right now. A sudden spike = traffic surge; a sudden drop = outage or client issues.\n* **Active Workers**: How many worker threads are busy. If this is near the total for a long time, the server is overloaded.\n* **Load (All Queues)**: Average queue load over 1/5/15 minutes. If all three lines climb, the system is falling behind.\n* **Work Queue Length**: How many tasks are waiting. If this keeps growing, requests are piling up and latency will rise.\n* **Commands per Second**: How many searches/inserts/updates/etc. per second. Tells you if traffic is heavy and what kind.\n* **Search Latency (p95/p99)**: 95%/99% of searches are faster than this. If these grow, users feel slow searches even if averages look fine.\n* **Query Cache Usage**: How much cache is used vs the max. If usage keeps growing to the limit, the cache will churn and queries slow down.\n* **Query Cache Hit Rate**: How many cache hits per second. If this goes down while traffic stays high, the cache is not helping.\n* **Disk and RAM Bytes**: Size of indexed data on disk and RAM. Rapid growth means more storage pressure and usually slower queries.\n* **Disk Mapped Cache Ratio by Table**: How much of each table is already cached in memory. Low ratios mean more disk reads and slower queries.\n* **Slowest Thread**: How long the slowest running query takes. If this spikes, there may be stuck or very heavy queries.\n* **Connections by Type**: Splits connections into current, buddy, and vip. Helpful to see which protocol is driving load.\n\n#### How to import:\n1. Open Grafana and go to Dashboards -> Import.\n2. Upload the JSON file.\n3. Select your Prometheus datasource when prompted.\n",
        "source_snapshot": "/tmp/translator-source-RQKlzr"
    }
}