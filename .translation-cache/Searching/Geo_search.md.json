{
  "61219ad506e1569c9c0d82e21a3916d8bc4c318f7457ce6c9578942100b89864": {
    "original": "# Geo search\n\nOne of the greatest features of Manticore Search is the ability to combine full-text searching with geo-location. For example, a retailer can offer a search where a user looks for a product, and the result set can indicate the closest shop that has the product in stock, so the user can go in-store and pick it up. A travel site can provide results based on a search limited to a certain area and have the results sorted by the distance from a point (for example, 'search museums near a hotel').\n\nTo perform geo-searching, a document needs to contain pairs of latitude/longitude coordinates. The coordinates can be stored as float attributes. If the document has multiple locations, it may be convenient to use a JSON attribute to store coordinate pairs.\n\nCODE_BLOCK_0\n\nThe coordinates can be stored as degrees or radians.\n\nIf secondary indexes are generated for latitude and longitude attributes, they may automatically be used to speed up geo searches if the [Cost based optimizer](../Searching/Cost_based_optimizer.md) decides to use them.\n\n## Performing distance сalculation\n\nTo find out the distance between two points, the [GEODIST()](../Functions/Geo_spatial_functions.md#GEODIST%28%29) function can be used. `GEODIST` requires two pairs of coordinates as its first four parameters.\n\nThe 5th parameter in a simplified JSON format can configure certain aspects of the function. By default, `GEODIST` expects coordinates to be in radians, but `in=degrees` can be added to allow using degrees as input. The coordinates for which we perform the geo distance must have the same type (degrees or radians) as the ones stored in the table; otherwise, results will be misleading.\n\nThe calculated distance is by default in meters, but with the `out` option, it can be transformed to kilometers, feet, or miles. Lastly, by default, a calculation method called `adaptive` is used. An alternative method based on the `haversine` algorithm is available; however, this one is slower and less precise.\n\nThe result of the function - the distance - can be used in the`ORDER BY` clause to sort the results:\n\nCODE_BLOCK_1\n\nOr to limit the results to a radial area around the point:\n\nCODE_BLOCK_2\n\n## Searching in polygons\n\nAnother geo search feature is the ability to determine if a location is within a specified area. A special function constructs a polygon object, which is then used by another function to test whether a set of coordinates is contained within that polygon or not.\n\nThere are two functions available for creating the polygon:\n\n*   [GEOPOLY2D()](../Functions/Geo_spatial_functions.md#GEOPOLY2D%28%29) - creates a polygon that takes into account the Earth's curvature\n\n*   [POLY2D()](../Functions/Geo_spatial_functions.md#POLY2D%28%29) - creates a simple polygon in flat space\n\n`POLY2D` is suitable for geo searches when the area has sides shorter than 500km (for polygons with 3-4 sides; for polygons with more sides, lower values should be considered). For areas with longer sides, using `GEOPOLY2D` is required to maintain accurate results. `GEOPOLY2D` expects coordinates as latitude/longitude pairs in degrees; using radians will yield results in flat space (similar to `POLY2D`).\n\n[CONTAINS()](../Functions/Arrays_and_conditions_functions.md#CONTAINS%28%29) takes a polygon and a set of coordinates as input and outputs `1` if the point is inside the polygon or `0` otherwise.\n\nCODE_BLOCK_3\n\n<!-- proofread -->",
    "translations": {
      "chinese": "# 地理搜索\n\nManticore Search 最强大的功能之一是能够将全文搜索与地理位置结合起来。例如，零售商可以提供一种搜索，用户查找某个产品，结果集可以显示最近的有该产品库存的商店，这样用户就可以去店里取货。旅游网站可以基于限定区域的搜索提供结果，并按距离某点的远近排序（例如，“搜索酒店附近的博物馆”）。\n\n要执行地理搜索，文档需要包含一对纬度/经度坐标。坐标可以存储为浮点属性。如果文档有多个位置，使用 JSON 属性存储坐标对可能更方便。\n\nCODE_BLOCK_0\n\n坐标可以以度或弧度存储。\n\n如果为纬度和经度属性生成了二级索引，且[基于成本的优化器](../Searching/Cost_based_optimizer.md)决定使用它们，则它们可能会自动用于加速地理搜索。\n\n## 执行距离计算\n\n要计算两点之间的距离，可以使用[GEODIST()](../Functions/Geo_spatial_functions.md#GEODIST%28%29)函数。`GEODIST` 需要两个坐标对作为前四个参数。\n\n第五个参数是简化的 JSON 格式，可以配置函数的某些方面。默认情况下，`GEODIST` 期望坐标为弧度，但可以添加 `in=degrees` 以允许使用度作为输入。用于计算地理距离的坐标必须与表中存储的坐标类型（度或弧度）相同，否则结果会产生误导。\n\n计算出的距离默认单位为米，但通过 `out` 选项，可以转换为千米、英尺或英里。最后，默认使用一种称为 `adaptive` 的计算方法。还有一种基于 `haversine` 算法的替代方法，但该方法较慢且精度较低。\n\n函数的结果——距离——可以用于 `ORDER BY` 子句对结果进行排序：\n\nCODE_BLOCK_1\n\n或者限制结果在某点的半径范围内：\n\nCODE_BLOCK_2\n\n## 多边形内搜索\n\n另一个地理搜索功能是判断某个位置是否在指定区域内。一个特殊函数构造多边形对象，另一个函数用来测试一组坐标是否包含在该多边形内。\n\n有两个函数可用于创建多边形：\n\n*   [GEOPOLY2D()](../Functions/Geo_spatial_functions.md#GEOPOLY2D%28%29) - 创建考虑地球曲率的多边形\n\n*   [POLY2D()](../Functions/Geo_spatial_functions.md#POLY2D%28%29) - 创建平面空间中的简单多边形\n\n`POLY2D` 适用于边长小于 500 公里的区域（对于 3-4 边的多边形；边数更多时应考虑更低的值）。对于边长较长的区域，必须使用 `GEOPOLY2D` 以保持结果准确。`GEOPOLY2D` 期望坐标为度的纬度/经度对；使用弧度将得到平面空间的结果（类似于 `POLY2D`）。\n\n[CONTAINS()](../Functions/Arrays_and_conditions_functions.md#CONTAINS%28%29) 接受一个多边形和一组坐标作为输入，如果点在多边形内则输出 `1`，否则输出 `0`。\n\nCODE_BLOCK_3\n\n<!-- proofread -->",
      "russian": "# Гео поиск\n\nОдна из главных особенностей Manticore Search — возможность комбинировать полнотекстовый поиск с геолокацией. Например, ритейлер может предложить поиск, где пользователь ищет товар, а набор результатов может указывать ближайший магазин, в котором этот товар есть в наличии, чтобы пользователь мог прийти в магазин и забрать его. Туристический сайт может предоставлять результаты на основе поиска, ограниченного определённой областью, и сортировать результаты по расстоянию от точки (например, «поиск музеев рядом с отелем»).\n\nДля выполнения гео-поиска документ должен содержать пары координат широты/долготы. Координаты могут храниться как атрибуты с плавающей точкой. Если в документе несколько локаций, может быть удобно использовать JSON-атрибут для хранения пар координат.\n\nCODE_BLOCK_0\n\nКоординаты могут храниться в градусах или радианах.\n\nЕсли для атрибутов широты и долготы сгенерированы вторичные индексы, они могут автоматически использоваться для ускорения гео-поисков, если [оптимизатор на основе стоимости](../Searching/Cost_based_optimizer.md) решит их применить.\n\n## Выполнение расчёта расстояния\n\nЧтобы узнать расстояние между двумя точками, можно использовать функцию [GEODIST()](../Functions/Geo_spatial_functions.md#GEODIST%28%29). `GEODIST` требует две пары координат в качестве первых четырёх параметров.\n\n5-й параметр в упрощённом JSON-формате может настраивать определённые аспекты функции. По умолчанию `GEODIST` ожидает координаты в радианах, но можно добавить `in=degrees`, чтобы использовать градусы в качестве входных данных. Координаты, для которых выполняется вычисление гео-расстояния, должны иметь тот же тип (градусы или радианы), что и хранящиеся в таблице; в противном случае результаты будут некорректными.\n\nВычисленное расстояние по умолчанию в метрах, но с опцией `out` его можно преобразовать в километры, футы или мили. Наконец, по умолчанию используется метод расчёта под названием `adaptive`. Альтернативный метод на основе алгоритма `haversine` также доступен; однако он медленнее и менее точен.\n\nРезультат функции — расстояние — можно использовать в предложении `ORDER BY` для сортировки результатов:\n\nCODE_BLOCK_1\n\nИли для ограничения результатов радиальной областью вокруг точки:\n\nCODE_BLOCK_2\n\n## Поиск внутри многоугольников\n\nЕщё одна функция гео-поиска — возможность определить, находится ли локация внутри заданной области. Специальная функция создаёт объект многоугольника, который затем используется другой функцией для проверки, содержатся ли координаты внутри этого многоугольника или нет.\n\nДоступны две функции для создания многоугольника:\n\n*   [GEOPOLY2D()](../Functions/Geo_spatial_functions.md#GEOPOLY2D%28%29) — создаёт многоугольник с учётом кривизны Земли\n\n*   [POLY2D()](../Functions/Geo_spatial_functions.md#POLY2D%28%29) — создаёт простой многоугольник в плоском пространстве\n\n`POLY2D` подходит для гео-поиска, когда стороны области короче 500 км (для многоугольников с 3-4 сторонами; для многоугольников с большим числом сторон следует учитывать меньшие значения). Для областей с более длинными сторонами требуется использовать `GEOPOLY2D` для сохранения точности результатов. `GEOPOLY2D` ожидает координаты в виде пар широты/долготы в градусах; использование радиан даст результаты в плоском пространстве (аналогично `POLY2D`).\n\n[CONTAINS()](../Functions/Arrays_and_conditions_functions.md#CONTAINS%28%29) принимает многоугольник и набор координат на вход и возвращает `1`, если точка находится внутри многоугольника, или `0` в противном случае.\n\nCODE_BLOCK_3\n\n<!-- proofread -->"
    },
    "is_code_or_comment": false
  }
}
