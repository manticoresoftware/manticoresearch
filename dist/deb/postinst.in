#!/bin/sh
# postinst script for manticore
#
# see: dh_installdeb(1)

set -e

if ! getent group manticore >/dev/null; then
   addgroup --system manticore
fi
if ! getent passwd manticore >/dev/null; then
   adduser --system --ingroup manticore  --no-create-home --shell /bin/false manticore
fi
DATADIR=@LOCALSTATEDIR@/lib/manticore
LOGDIR=@LOCALSTATEDIR@/log/manticore
SYSCONFDIR=@SYSCONFDIR@/manticoresearch
chown manticore:manticore $DATADIR -R
chown manticore:manticore $LOGDIR -R
chown manticore:manticore $SYSCONFDIR -R

case "$1" in
    configure)
        if [ -f @SYSCONFDIR@/sphinxsearch/sphinx.conf ]; then
	        echo "Moving existing configuration to new location..."
		    mv @SYSCONFDIR@/sphinxsearch/sphinx.conf @SYSCONFDIR@/manticoresearch/manticore.conf
	    fi
	;;
	abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac


echo "Manticore Search (https://manticoresearch.com)"
echo ""
echo "Getting Started with Manticore Search:"
echo "  https://docs.manticoresearch.com/latest/html/getting-started.html"
echo ""
echo "Learn Manticore with interactive courses:"
echo "  https://play.manticoresearch.com/"
echo ""
echo "To start Manticore Search service:"
if [ -x "/usr/bin/deb-systemd-helper" ]; then
 echo "  > systemctl start manticore"
else
 echo "  > service manticore start"
fi
echo ""
echo "Configuration file:"
echo "  /etc/manticoresearch/manticore.conf"
echo ""


if [ -x "/usr/bin/deb-systemd-helper" ]; then
  deb-systemd-helper unmask manticore.service >/dev/null || true
  if deb-systemd-helper --quiet was-enabled manticore.service; then
   deb-systemd-helper enable manticore.service >/dev/null || true
  else
   deb-systemd-helper update-state manticore.service >/dev/null || true
  fi
  systemctl --system daemon-reload >/dev/null || true
fi

# section below id distribute-specivic.
# It contains shell code generated by cmake cpack script.

@POSTINST_SPECIFIC@


exit 0
