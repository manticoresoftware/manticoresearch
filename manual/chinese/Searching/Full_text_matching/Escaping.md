# 在查询字符串中转义字符

由于某些字符在查询字符串中作为操作符使用，因此必须对它们进行转义以防止查询错误或意外的匹配条件。

以下字符应使用反斜杠 (`\`) 转义：

```
!    "    $    '    (    )    -    /    <    @    \    ^    |    ~
```

## 在MySQL命令行客户端中

要转义单引号 ('), 请使用一个反斜杠：
```sql
SELECT * FROM your_index WHERE MATCH('l\'italiano');
```


对于前面提到的列表中的其他字符，这些字符是操作符或查询构造，它们必须通过引擎前面的转义字符被视为简单字符。
反斜杠也必须被转义，结果是两个反斜杠：

```sql
SELECT * FROM your_index WHERE MATCH('r\\&b | \\(official video\\)');
```

要使用反斜杠作为字符，必须对反斜杠作为字符和反斜杠作为转义操作符进行转义，这需要四个反斜杠：

```sql
SELECT * FROM your_index WHERE MATCH('\\\\ABC');
```

当您使用Manticore Search中的JSON数据并需要在JSON字符串中包含双引号 (`"`) 时，重要的是使用正确的转义进行处理。在JSON中，字符串中的双引号使用反斜杠 (`\`) 转义。然而，通过SQL查询插入JSON数据时，Manticore Search将反斜杠 (`\`) 视为字符串中的转义字符。

为确保双引号被正确插入到JSON数据中，您需要对反斜杠本身进行转义。这会导致在双引号前使用两个反斜杠 (`\\`)。例如：

```sql
insert into tbl(j) values('{"a": "\\"abc\\""}');
```

## 使用MySQL驱动程序

MySQL驱动程序提供转义函数（例如，PHP中的 `mysqli_real_escape_string` 或Python中的 `conn.escape_string`），但它们只转义特定字符。
您仍然需要为之前列表中提到的字符添加转义，这些字符不被各自的函数转义。
因为这些函数会为您转义反斜杠，您只需再添加一个反斜杠即可。

这也适用于支持（客户端）准备好的语句的驱动程序。例如，在PHP PDO准备好的语句中，您需要为 `$` 字符添加一个反斜杠：

```php
$statement = $ln_sph->prepare( "SELECT * FROM index WHERE MATCH(:match)");
$match = '\$manticore';
$statement->bindParam(':match',$match,PDO::PARAM_STR);
$results = $statement->execute();
```

最终查询结果为 `SELECT * FROM index WHERE MATCH('\\$manticore');`

## 在 HTTP JSON API 中

SQL协议的相同规则适用，但对于JSON，双引号必须用单个反斜杠转义，而其他字符则需要双重转义。

当使用转换数据结构为JSON字符串的JSON库或函数时，双引号和单个反斜杠会被这些函数自动转义，无需明确转义。



## 在客户端中

[官方客户端](https://github.com/manticoresoftware/) 在底层使用各自编程语言中可用的通用JSON库/函数。前面提到的相同转义规则适用。


## 转义星号

星号 (`*`) 是一个特殊字符，有两个用途：
* 作为通配符前缀/后缀扩展器
* 作为短语搜索中的任意项修饰符。

与其它特殊字符作为操作符的情况不同，当星号处于提供其功能的位置时不能被转义。

在非通配符查询中，星号不需要转义，无论它是否在 `charset_table` 中。

在通配符查询中，单词中的星号在中间不需要转义。作为通配符操作符（无论在单词的开头还是结尾），即使应用了转义，星号也总是作为通配符操作符进行解释。

## 在 SQL 中转义JSON节点名称

要转义JSON节点中的特殊字符，请使用反引号。例如：

```sql
MySQL [(none)]> select * from t where json.`a=b`=234;
+---------------------+-------------+------+
| id                  | json        | text |
+---------------------+-------------+------+
| 8215557549554925578 | {"a=b":234} |      |
+---------------------+-------------+------+

MySQL [(none)]> select * from t where json.`a:b`=123;
+---------------------+-------------+------+
| id                  | json        | text |
+---------------------+-------------+------+
| 8215557549554925577 | {"a:b":123} |      |
+---------------------+-------------+------+
```
<!-- proofread -->
