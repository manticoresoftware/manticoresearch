# फ़ेच क्वेरीज़ का निष्पादन

सभी SQL ड्राइवर्स के साथ, एक साधारण तालिका का निर्माण सामान्यतया इस प्रकार किया जाता है।

* डेटाबेस से कनेक्शन स्थापित किया जाता है।
* `sql_query_pre_all` क्वेरियाँ आवश्यक प्रारंभिक सेटअप करने के लिए निष्पादित की जाती हैं, जैसे कि MySQL के साथ प्रति-कनेक्शन एनकोडिंग सेट करना। ये क्वेरियाँ पूरे इंडेक्सिंग प्रक्रिया से पहले, और साथ ही MVA एट्रिब्यूट्स और जुड़े हुए फील्ड्स के इंडेक्सिंग के लिए रीकनेक्ट के बाद चलती हैं।
* `sql_query_pre` प्री-क्वेरी को आवश्यक प्रारंभिक सेटअप करने के लिए निष्पादित किया जाता है, जैसे कि अस्थायी तालिकाएँ स्थापित करना या काउंटर तालिकाओं का रख-रखाव करना। ये क्वेरियाँ पूरे इंडेक्सिंग प्रक्रिया के लिए एक बार चलती हैं।
* प्री-क्वेरियाँ अर्थात् `sql_query_pre` आवश्यक प्रारंभिक सेटअप करने के लिए निष्पादित की जाती हैं, जैसे कि अस्थायी

  तालिकाएँ स्थापित करना, या काउंटर तालिका का रख-रखाव करना। ये क्वेरियाँ सम्पूर्ण इंडेक्सिंग में एक बार चलती हैं।
* मुख्य क्वेरी अर्थात् `sql_query` निष्पादित की जाती है और जो पंक्तियाँ यह लौटाती है उनका प्रसंस्करण किया जाता है।
* पोस्ट-क्वेरी अर्थात् `sql_query_post` कुछ आवश्यक सफाई-कार्रवाई करने के लिए निष्पादित की जाती है।
* डेटाबेस से कनेक्शन बंद कर दिया जाता है।
* इंडेक्सर छँटाई (विशेष रूप से तालिका-प्रकार विशिष्ट पोस्ट-प्रोसेसिंग) का चरण करता है।
* डेटाबेस से कनेक्शन फिर से स्थापित किया जाता है।
* पोस्ट-प्रोसेसिंग क्वेरी अर्थात् `sql_query_post_index` कुछ आवश्यक अंतिम सफाई-कार्रवाई करने के लिए निष्पादित की जाती है।
* डेटाबेस से कनेक्शन फिर से बंद कर दिया जाता है।

MYSQL से डेटा फ़ेच करने वाले स्रोत का उदाहरण:

```ini
source mysource {

  type             = mysql

  path             = /path/to/realtime

  sql_host         = localhost

  sql_user         = myuser

  sql_pass         = mypass

  sql_db           = mydb

  sql_query_pre    = SET CHARACTER_SET_RESULTS=utf8

  sql_query_pre    = SET NAMES utf8

  sql_query        =  SELECT id, title, description, category_id  FROM mytable

  sql_query_post   = DROP TABLE view_table

  sql_query_post_index = REPLACE INTO counters ( id, val ) \

    VALUES ( 'max_indexed_id', $maxid )

  sql_attr_uint    = category_id

  sql_field_string = title

 }


table mytable {

  type   = plain

  source = mysource

  path   = /path/to/mytable

  ...

 }
```

## sql_query

यह वह क्वेरी है जिसका उपयोग SQL सर्वर से दस्तावेज़ प्राप्त करने के लिए किया जाता है। केवल एक ही sql_query घोषित किया जा सकता है, और इसका होना अनिवार्य है। देखें भी [प्राप्त किए गए डेटा की प्रक्रिया](../../../Data_creation_and_modification/Adding_data_from_external_storages/Fetching_from_databases/Processing_fetched_data.md#Processing-fetched-data)

## sql_query_pre

प्री-फ़ेच क्वेरी या प्री-क्वेरी। यह एक मल्टी-वैल्यू, वैकल्पिक सेटिंग है, जिसका डिफ़ॉल्ट मान क्वेरियों की एक खाली सूची है। प्री-क्वेरियाँ sql_query से पहले, कॉन्फ़िगरेशन फ़ाइल में दर्शाए गए क्रम में निष्पादित की जाती हैं। प्री-क्वेरियों के परिणाम की अनदेखी की जाती है।

प्री-क्वेरियाँ कई तरीकों से उपयोगी होती हैं। इनका उपयोग एनकोडिंग सेट करने, उन रिकॉर्ड्स को चिह्नित करने, जिन्हें इंडेक्स किया जाना है, आंतरिक काउंटर अपडेट करने, प्रति-कनेक्शन SQL सर्वर विकल्पों और वेरिएबल्स को सेट करने आदि के लिए किया जा सकता है।

शायद प्री-क्वेरी का सबसे सामान्य उपयोग यह निर्दिष्ट करना है कि सर्वर द्वारा लौटाई गई पंक्तियों के लिए कौन सी एनकोडिंग का उपयोग किया जाएगा। ध्यान दें कि Manticore केवल UTF-8 टेक्स्ट स्वीकार करता है। एनकोडिंग सेट करने के दो MySQL विशिष्ट उदाहरण हैं:

```ini
sql_query_pre = SET CHARACTER_SET_RESULTS=utf8
sql_query_pre = SET NAMES utf8
```

साथ ही, MySQL स्रोतों के लिए विशेष रूप से, यह फायदेमंद है कि क्वेरी कैश को (केवल इंडेक्सर कनेक्शन के लिए) प्री-क्वेरी में डिसेबल कर दिया जाए, क्योंकि इंडेक्सिंग क्वेरियाँ वैसे भी बार-बार नहीं चलाई जाएँगी, और उनके परिणामों को कैश करने का कोई मतलब नहीं है।
यह निम्न प्रकार से किया जा सकता है:

```ini
sql_query_pre = SET SESSION query_cache_type=OFF
```
