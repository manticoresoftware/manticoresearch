# क्वेरी लॉगिंग

<!-- उदाहरण query_logging -->
क्वेरी लॉगिंग को कॉन्फ़िगरेशन फ़ाइल के searchd अनुभाग में [query_log](../Server_settings/Searchd.md#query_log) निर्देश सेट करके सक्षम किया जा सकता है।

क्वेरीज़ को फ़ाइल पथ के बजाय `syslog` सेट करके syslog में भी भेजा जा सकता है। इस मामले में, सभी खोज क्वेरीज़ `LOG_INFO` प्राथमिकता के साथ syslog डीमन पर `[query]` द्वारा समयमुहर के बजाय भेजी जाएँगी। केवल `plain` लॉग प्रारूप syslog के लिए समर्थित है।

<!-- परिचय -->
`query_log` उदाहरण:
<!-- अनुरोध कॉन्फ़िग -->
```ini
searchd {
...
    query_log = /var/log/query.log
    query_log_format = sphinxql # डिफ़ॉल्ट
...
}
```
<!-- अंत -->


## लॉगिंग प्रारूप

दो क्वेरी लॉग प्रारूप समर्थित हैं:
* `sphinxql` (डिफ़ॉल्ट): SQL प्रारूप में लॉग करता है। यह लॉग की गई क्वेरीज़ को फिर से चलाने का एक आसान तरीका भी प्रदान करता है।
* `plain`: सादा पाठ प्रारूप में पूर्ण-श्याम क्वेरीज़ को लॉग करता है। यह प्रारूप अनुशंसित है यदि आपकी अधिकांश क्वेरीज़ मुख्यतः पूर्ण-श्याम हैं या यदि आपको विशेषताओं द्वारा फ़िल्टरिंग, क्रमबद्धता या समूहबद्धता जैसे गैर-पूर्ण-श्याम घटकों को लॉग करने की आवश्यकता नहीं है। `plain` प्रारूप में लॉग की गई क्वेरीज़ को फिर से नहीं चलाया जा सकता है। ध्यान दें कि [Buddy](../Installation/Manticore_Buddy.md) के माध्यम से संसाधित क्वेरीज़ इस मोड में लॉग नहीं होती हैं।

प्रारूपों के बीच स्विच करने के लिए, आप searchd सेटिंग [query_log_format](../Server_settings/Searchd.md#query_log_format) का उपयोग कर सकते हैं।

### SQL लॉग प्रारूप

<!-- उदाहरण sphixql_log -->
SQL लॉग प्रारूप डिफ़ॉल्ट सेटिंग है। इस मोड में, Manticore सभी सफल और असफल चयन क्वेरीज़ को लॉग करता है। SQL या बाइनरी API के माध्यम से भेजे गए अनुरोधों को SQL प्रारूप में लॉग किया जाता है, लेकिन JSON क्वेरीज़ को जैसे हैं, वैसे ही लॉग किया जाता है। यह प्रकार का लॉगिंग केवल सामान्य लॉग फ़ाइलों के साथ काम करता है और लॉगिंग के लिए 'syslog' सेवा का समर्थन नहीं करता है।

<!-- परिचय -->
`query_log_format` उदाहरण:
<!-- अनुरोध कॉन्फ़िग -->
```ini
query_log_format = sphinxql # डिफ़ॉल्ट
```

<!-- अंत -->

<!-- उदाहरण sphixql_log2 -->
Manticore SQL लॉग प्रारूप की विशेषताएँ [plain प्रारूप](../../Logging/Query_logging.md#Plain-log-format) की तुलना में включ करती हैं:
* संभव होने पर पूर्ण कथन डेटा लॉग किया जाता है।
* त्रुटियाँ और चेतावनियाँ लॉग की जाती हैं।
* क्वेरी लॉग को फिर से चलाया जा सकता है।
* अतिरिक्त प्रदर्शन काउंटर (वर्तमान में, प्रति-एजेंट वितरित क्वेरी समय) लॉग किए जाते हैं।
* प्रत्येक लॉग प्रविष्टि एक मान्य Manticore SQL/JSON कथन है जो पूर्ण अनुरोध को फिर से बनाता है, सिवाय इसके कि यदि लॉग किया गया अनुरोध बहुत बड़ा है और प्रदर्शन कारणों से संक्षिप्त करना आवश्यक है।
* JSON अनुरोध और अतिरिक्त संदेश, काउंटर, आदि को टिप्पणियों के रूप में लॉग किया जाता है।

<!-- परिचय -->
`sphinxql` लॉग प्रविष्टियों का उदाहरण:
<!-- अनुरोध उदाहरण -->
```sql
/* सन अप्र 28 12:38:02.808 2024 conn 2 (127.0.0.1:53228) वास्तविक 0.000 दीवार 0.000 पाया 0 */ SELECT * FROM test WHERE MATCH('test') OPTION ranker=proximity;
/* सन अप्र 28 12:38:05.585 2024 conn 2 (127.0.0.1:53228) वास्तविक 0.001 दीवार 0.001 पाया 0 */ SELECT * FROM test WHERE MATCH('test') GROUP BY channel_id OPTION ranker=proximity;
/* सन अप्र 28 12:40:57.366 2024 conn 4 (127.0.0.1:53256) वास्तविक 0.000 दीवार 0.000 पाया 0 */  /*{
    "table" : "test",
    "query":
    {
        "match":
        {
            "*" : "test"
        }
    },
    "_source": ["f"],
    "limit": 30
} */
```
<!-- अंत -->

### प्लेन लॉग प्रारूप

<!-- उदाहरण plain_log -->
`plain` लॉग प्रारूप के साथ, Manticore सभी सफलतापूर्वक निष्पादित खोज क्वेरीज़ को एक साधारण पाठ प्रारूप में लॉग करता है। क्वेरीज़ के गैर-पूर्ण-श्याम भागों को लॉग नहीं किया जाता है। JSON क्वेरीज़ को एकल-पंक्ति प्रविष्टियों के रूप में रिकॉर्ड किया जाता है। [Buddy](../Installation/Manticore_Buddy.md) के माध्यम से संसाधित क्वेरीज़ को लॉग नहीं किया जाता है।

<!-- परिचय -->
`query_log_format` उदाहरण:
<!-- अनुरोध कॉन्फ़िग -->
```ini
query_log_format = plain
```
<!-- अंत -->

<!-- उदाहरण plain_log2 -->
लॉग प्रारूप निम्नलिखित है:

```
[query-date] वास्तविक समय दीवार समय [match-mode/filters-count/sort-mode कुल मिलाकर-मेल (offset,limit) @groupby-attr] [table-name] {perf-stats} क्वेरी
```

जहाँ:
* `real-time` क्वेरी के शुरू होने से लेकर समाप्त होने तक का समय है।
* `wall-time` वास्तविक समय के समान है, लेकिन एजेंटों से परिणाम सेट के लिए प्रतीक्षा करते समय खर्च किए गए समय को बाहर करता है।
* `perf-stats` में CPU/IO सांख्यिकी शामिल हैं जब Manticore को `--cpustats` के साथ शुरू किया गया है (या इसे `SET GLOBAL cpustats=1` के माध्यम से सक्षम किया गया था) और/या `--iostats` (या इसे `SET GLOBAL iostats=1` के जरिए सक्षम किया गया था):
  - `ios` फ़ाइल I/O संचालन की संख्या है जो की गई;
  - `kb` वह डेटा है जो तालिका फ़ाइलों से किलोबाइट में पढ़ा गया;
  - `ms` I/O संचालन में व्यतीत समय है।
  - `cpums` वह समय है जो क्वेरी को CPU पर प्रोसेसिंग में मिलिसेकंड में खर्च किया गया।
* `match-mode` में निम्नलिखित में से एक मान हो सकता है:
  - "all" के लिए `SPH_MATCH_ALL` मोड;
  - "any" के लिए `SPH_MATCH_ANY` मोड;
  - "phr" के लिए `SPH_MATCH_PHRASE` मोड;
  - "bool" के लिए `SPH_MATCH_BOOLEAN` मोड;
  - "ext" के लिए `SPH_MATCH_EXTENDED` मोड;
  - "ext2" के लिए `SPH_MATCH_EXTENDED2` मोड;
  - "scan" यदि पूर्ण स्कैन मोड का उपयोग किया गया था, या तो `SPH_MATCH_FULLSCAN` के साथ निर्दिष्ट करके या यदि क्वेरी खाली थी।
* `sort-mode` में निम्नलिखित में से एक मान हो सकता है:
  - "rel" के लिए `SPH_SORT_RELEVANCE` मोड;
  - "attr-" के लिए `SPH_SORT_ATTR_DESC` मोड;
  - "attr+" के लिए `SPH_SORT_ATTR_ASC` मोड;
  - "tsegs" के लिए `SPH_SORT_TIME_SEGMENTS` मोड;
  - "ext" के लिए `SPH_SORT_EXTENDED` मोड।

ध्यान दें: `SPH*` मोड `sphinx` विरासती इंटरफ़ेस के लिए विशिष्ट हैं। SQL और JSON इंटरफेस अधिकांश मामलों में, `ext2` को `match-mode` और `ext` तथा `rel` को `sort-mode` के रूप में लॉग करेंगे।

<!-- परिचय -->
क्वेरी लॉग का उदाहरण:
<!-- अनुरोध उदाहरण -->
```ini
[शुक्र जून 29 21:17:58 2021] 0.004 सेकंड [all/0/rel 35254 (0,20)] [lj] [ios=6 kb=111.1 ms=0.5] परीक्षण
[शुक्र जून 29 21:17:58 2021] 0.004 सेकंड [all/0/rel 35254 (0,20)] [lj] [ios=6 kb=111.1 ms=0.5 cpums=0.3] परीक्षण
[रविवार अप्र 28 15:09:38.712 2024] 0.000 सेकंड 0.000 सेकंड [ext2/0/ext 0 (0,20)] [test] परीक्षण
[सन अप्रैल 28 15:09:44.974 2024] 0.000 सेक 0.000 सेक [ext2/0/ext 0 (0,20) @channel_id] [test] परीक्षण
[सन अप्रैल 28 15:24:32.975 2024] 0.000 सेक 0.000 सेक [ext2/0/ext 0 (0,30)] [test] {     "table" : "test",     "query":     {         "match":         {             "*" : "test"         }     },     "_source": ["f"],     "limit": 30 }
```

<!-- end -->

## केवल धीमी क्वेरीज लॉग करें

<!-- example query_log_min_msec -->
डिफ़ॉल्ट रूप से, सभी क्वेरीज लॉग की जाती हैं। यदि आप केवल उन क्वेरीज को लॉग करना चाहते हैं जिनका निष्पादन समय एक निर्दिष्ट सीमा को पार करता है, तो `query_log_min_msec` निर्देश का उपयोग किया जा सकता है।

अपेक्षित माप की इकाई मिलीसेकंड है, लेकिन समय उपसर्ग अभिव्यक्तियों का भी उपयोग किया जा सकता है।

<!-- intro -->
`query_log_min_msec` उदाहरण:
<!-- request Config -->
```ini
searchd {
...
    query_log = /var/log/query.log
    query_log_min_msec  = 1000
    # query_log_min_msec  = 1s
...
}
```

<!-- end -->

## लॉग फ़ाइल अनुमति मोड

<!-- Example query_log_mode -->
डिफ़ॉल्ट रूप से, searchd और क्वेरी लॉग फ़ाइलें अनुमति `600` के साथ बनाई जाती हैं, इसलिए केवल उसी उपयोगकर्ता को जो Manticore चला रहा है और `root` लॉग फ़ाइलों को पढ़ सकता है। `query_log_mode` विकल्प विभिन्न अनुमति सेट करने की अनुमति देता है। यह अन्य उपयोगकर्ताओं को लॉग फ़ाइलें पढ़ने की अनुमति देने के लिए सहायक हो सकता है (उदाहरण के लिए, गैर-रूट उपयोगकर्ताओं पर चलने वाले निगरानी समाधानों के लिए)।

<!-- intro -->
`query_log_mode` उदाहरण:
<!-- request Config -->
```ini
searchd {
...
    query_log = /var/log/query.log
    query_log_mode = 666
...
}
```
<!-- end -->
<!-- proofread -->
