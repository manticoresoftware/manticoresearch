# भू-खोज

Manticore Search की सबसे शानदार विशेषताओं में से एक है पूर्ण-पाठ खोज को भौगोलिक-स्थान के साथ मिलाना। उदाहरण के लिए, एक खुदरा विक्रेता ऐसा खोज विकल्प प्रदान कर सकता है जहाँ उपयोगकर्ता किसी उत्पाद की खोज करता है, और परिणाम सूची यह संकेत कर सकती है कि कौन सी नजदीकी दुकान में वह उत्पाद स्टॉक में उपलब्ध है, ताकि उपयोगकर्ता दुकान में जाकर उसे प्राप्त कर सके। एक यात्रा साइट एक निश्चित क्षेत्र तक सीमित खोज के आधार पर परिणाम प्रदान कर सकती है और परिणामों को किसी बिंदु से दूरी के अनुसार क्रमबद्ध कर सकती है (उदाहरण के लिए, 'होटल के पास संग्रहालय खोजें')। 

भू-खोज करने के लिए, एक दस्तावेज़ में अक्षांश/देशांतर के जोड़े शामिल होने चाहिए। इन निर्देशांकों को फ्लोट गुणों (float attributes) के रूप में संग्रहीत किया जा सकता है। यदि दस्तावेज़ में कई स्थान हैं, तो निर्देशांक जोड़ें संग्रहीत करने के लिए JSON गुण का उपयोग करना सुविधाजनक हो सकता है.



```ini
table myrt
{

    ...

    rt_attr_float = lat

    rt_attr_float = lon

    ...

}
```

निर्देशांकों को डिग्री या रेडियन के रूप में संग्रहीत किया जा सकता है.

यदि अक्षांश और देशांतर गुणों के लिए द्वितीयक सूचकांक (secondary indexes) बनाए गए हैं, तो उन्हें स्वचालित रूप से भू खोजों को तेज करने के लिए उपयोग किया जा सकता है यदि [Cost based optimizer](../Searching/Cost_based_optimizer.md) उन्हें उपयोग करने का निर्णय लेता है.

## दूरी गणना करना

दो बिंदुओं के बीच दूरी ज्ञात करने के लिए, [GEODIST()](../Functions/Geo_spatial_functions.md#GEODIST%28%29) फ़ंक्शन का उपयोग किया जा सकता है। `GEODIST` को अपने पहले चार पैरामीटर के रूप में दो निर्देशांक जोड़े की आवश्यकता होती है.

सरलीकृत JSON प्रारूप में 5वां पैरामीटर फ़ंक्शन के कुछ पहलुओं को विन्यस्त कर सकता है। डिफ़ॉल्ट रूप से, `GEODIST` अपेक्षा करता है कि निर्देशांक रेडियन में हों, लेकिन इनपुट के रूप में डिग्री का उपयोग करने की अनुमति देने के लिए `in=degrees` जोड़ा जा सकता है। जिन निर्देशांकों के लिए हम भू दूरी का निर्धारण करते हैं, उनका प्रकार (डिग्री या रेडियन) तालिका में संग्रहीत निर्देशांकों के समान होना चाहिए; अन्यथा, परिणाम भ्रामक होंगे.

गणना की गई दूरी डिफ़ॉल्ट रूप से मीटर में होती है, लेकिन `out` विकल्प के साथ, इसे किलोमीटर, फीट, या मील में परिवर्तित किया जा सकता है। अंत में, डिफ़ॉल्ट रूप से, एक गणना विधि जिसे `adaptive` कहा जाता है का उपयोग किया जाता है। `haversine` एल्गोरिदम पर आधारित एक वैकल्पिक विधि भी उपलब्ध है; हालाँकि, यह धीमी और कम सटीक है.

फ़ंक्शन का परिणाम - दूरी - `ORDER BY` खंड में परिणामों को क्रमबद्ध करने के लिए उपयोग किया जा सकता है:

```sql
SELECT *, GEODIST(40.7643929, -73.9997683, lat, lon, {in=degrees, out=miles}) AS distance FROM myindex WHERE MATCH('...') ORDER BY distance ASC, WEIGHT() DESC;
```

या परिणामों को बिंदु के चारों ओर एक त्रिज्या क्षेत्र तक सीमित करने के लिए:

```sql
SELECT *,GEODIST(40.7643929, -73.9997683, lat,lon, {in=degrees, out=miles}) AS distance FROM myindex WHERE MATCH('...') AND distance <1000 ORDER BY WEIGHT(), DISTANCE ASC;
```

## बहुभुजों में खोज

एक अन्य भू खोज सुविधा यह है कि यह निर्धारित कर सके कि कोई स्थान किसी निर्दिष्ट क्षेत्र के भीतर है या नहीं। एक विशेष फ़ंक्शन एक बहुभुज वस्तु (polygon object) का निर्माण करता है, जिसे फिर एक अन्य फ़ंक्शन द्वारा परीक्षण के लिए उपयोग किया जाता है कि कोई निर्देशांक सेट उस बहुभुज के भीतर है या नहीं.

बहुभुज बनाने के लिए दो फ़ंक्शन उपलब्ध हैं:

*   [GEOPOLY2D()](../Functions/Geo_spatial_functions.md#GEOPOLY2D%28%29) - एक ऐसा बहुभुज बनाता है जो पृथ्वी की वक्रता को ध्यान में रखता है
*   [POLY2D()](../Functions/Geo_spatial_functions.md#POLY2D%28%29) - तिरछी सतह (flat space) में एक सरल बहुभुज बनाता है

`POLY2D` उन भू खोजों के लिए उपयुक्त है जब क्षेत्र की भुजाएँ 500 किमी से कम हों (3-4 भुजाओं वाले बहुभुज के लिए; अधिक भुजाओं वाले बहुभुज के लिए, कम मानों पर विचार करना चाहिए)। लंबी भुजाओं वाले क्षेत्रों के लिए, सटीक परिणाम बनाए रखने हेतु `GEOPOLY2D` का उपयोग आवश्यक है। `GEOPOLY2D` निर्देशांकों की अपेक्षा अक्षांश/देशांतर जोड़े को डिग्री में मानता है; रेडियन का उपयोग करने पर परिणाम फ्लैट स्पेस (POLY2D के समान) में प्राप्त होंगे.

[CONTAINS()](../Functions/Arrays_and_conditions_functions.md#CONTAINS%28%29) एक बहुभुज और निर्देशांकों के एक सेट को इनपुट के रूप में लेता है और यदि बिंदु बहुभुज के भीतर है तो `1` या अन्यथा `0` आउटपुट करता है.
