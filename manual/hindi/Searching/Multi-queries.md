# рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝

рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝, рдпрд╛ рдХреНрд╡реЗрд░реА рдмреИрдЪ, рдЖрдкрдХреЛ рдПрдХрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдЕрдиреБрд░реЛрдз рдореЗрдВ Manticore рдХреЛ рдХрдИ рдЦреЛрдЬ рдХреНрд╡реЗрд░реА рднреЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВред

ЁЯСН рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрдпреЛрдВ рдХрд░реЗрдВ?

рдореБрдЦреНрдп рдХрд╛рд░рдг рдкреНрд░рджрд░реНрд╢рди рд╣реИред рдПрдХ-рдПрдХ рдХрд░рдХреЗ рднреЗрдЬрдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдмреИрдЪ рдореЗрдВ Manticore рдХреЛ рднреЗрдЬрдиреЗ рд╕реЗ, рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рд░рд╛рдЙрдВрдб-рдЯреНрд░рд┐рдкреНрд╕ рдХреЛ рдХрдо рдХрд░рдХреЗ рд╕рдордп рдмрдЪрд╛рддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдмреИрдЪ рдореЗрдВ рдХреНрд╡реЗрд░реА рднреЗрдЬрдиреЗ рд╕реЗ Manticore рдХреЛ рдЖрдВрддрд░рд┐рдХ рдЕрдиреБрдХреВрд▓рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рдпрджрд┐ рдХреЛрдИ рдмреИрдЪ рдЕрдиреБрдХреВрд▓рди рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдХреНрд╡реЗрд░рд┐рдпреЛрдВ рдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

тЫФ рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдм рди рдХрд░реЗрдВ?

рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝ рдХреЗ рд▓рд┐рдП рдмреИрдЪ рдореЗрдВ рд╕рднреА рдЦреЛрдЬ рдХреНрд╡реЗрд░реАрдЬрд╝ рдХрд╛ рд╕реНрд╡рддрдВрддреНрд░ рд╣реЛрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЬреЛ рдХрд┐ рд╣рдореЗрд╢рд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛрддрд╛ред рдХрднреА-рдХрднреА рдХреНрд╡реЗрд░реА B, рдХреНрд╡реЗрд░реА A рдХреЗ рдирддреАрдЬреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдХреНрд╡реЗрд░реА B рдХреЛ рдХреЗрд╡рд▓ рдХреНрд╡реЗрд░реА A рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдмрд╛рдж рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдкреНрд░рд╛рдердорд┐рдХ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдХрд┐рд╕реА рдкрд░рд┐рдгрд╛рдо рдХреЗ рди рдорд┐рд▓рдиреЗ рдкрд░ рдХреЗрд╡рд▓ рдПрдХ рджреНрд╡рд┐рддреАрдпрдХ рд╕реВрдЪрдХрд╛рдВрдХ рд╕реЗ рдкрд░рд┐рдгрд╛рдо рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЖрдк рдкрд╣рд▓реЗ рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдореЗрдВ рдореИрдЪ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рджреВрд╕рд░реЗ рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдореЗрдВ рдПрдХ рдСрдлрд╕реЗрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣ рд╕рдХрддреЗ рд╣реИрдВред рдЗрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЖрдкрдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреНрд╡реЗрд░рд┐рдпрд╛рдБ (рдпрд╛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдмреИрдЪ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

<!-- example multi-query 1 -->
You can run multiple search queries with SQL by separating them with a semicolon. When Manticore receives a query formatted like this from a client, all inter-statement optimizations will be applied.

рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝ `FACET` рдХреЗ рд╕рд╛рде рдХреНрд╡реЗрд░реАрдЬрд╝ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВред рдПрдХ рдмреИрдЪ рдореЗрдВ рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝ рдХреА рд╕рдВрдЦреНрдпрд╛ [max_batch_queries](../Server_settings/Searchd.md#max_batch_queries) рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред


<!-- intro -->
##### SQL:

<!-- request SQL -->

```sql
SELECT id, price FROM products WHERE MATCH('remove hair') ORDER BY price DESC; SELECT id, price FROM products WHERE MATCH('remove hair') ORDER BY price ASC
```
<!-- end -->

## рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реАрдЬрд╝ рдЕрдиреБрдХреВрд▓рди

рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рджреЛ рдкреНрд░рдореБрдЦ рдЕрдиреБрдХреВрд▓рди рд╣реИрдВ: рд╕рд╛рдорд╛рдиреНрдп рдХреНрд╡реЗрд░реА рдЕрдиреБрдХреВрд▓рди рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдЙрдк-рд╡реГрдХреНрд╖ рдЕрдиреБрдХреВрд▓рдиред

**рд╕рд╛рдорд╛рдиреНрдп рдХреНрд╡реЗрд░реА рдЕрдиреБрдХреВрд▓рди** рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ `searchd` рдмреИрдЪ рдореЗрдВ рдЙрди рд╕рднреА рдХреНрд╡реЗрд░рд┐рдпреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдЧрд╛ рдЬрд╣рд╛рдБ рдХреЗрд╡рд▓ рд╕реЙрд░реНрдЯрд┐рдВрдЧ рдФрд░ group-by рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдЕрд▓рдЧ рд╣реЛрддреА рд╣реИрдВ, рдФрд░ *рд╕рд┐рд░реНрдлрд╝ рдПрдХ рдмрд╛рд░ рдЦреЛрдЬ рдкреНрд░рджрд░реНрд╢рди рдХрд░реЗрдЧрд╛*ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рдмреИрдЪ рдореЗрдВ 3 рдХреНрд╡реЗрд░рд┐рдпрд╛рдБ рд╣реИрдВ, рд╕рднреА "ipod nano" рдХреЗ рд▓рд┐рдП рд╣реИрдВ, рд▓реЗрдХрд┐рди рдкрд╣рд▓реА рдХреНрд╡реЗрд░реА рдореВрд▓реНрдп рджреНрд╡рд╛рд░рд╛ рдХреНрд░рдордмрджреНрдз рд╢реАрд░реНрд╖-10 рдкрд░рд┐рдгрд╛рдо рдЪрд╛рд╣рддреА рд╣реИ, рджреВрд╕рд░реА рдХреНрд╡реЗрд░реА рд╡рд┐рдХреНрд░реЗрддрд╛ рдЖрдИрдбреА рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рдореВрд╣рдмрджреНрдз рд╣реЛрддреА рд╣реИ рдФрд░ рд░реЗрдЯрд┐рдВрдЧ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╢реАрд░реНрд╖-5 рд╡рд┐рдХреНрд░реЗрддрд╛ рдЪрд╛рд╣рддреА рд╣реИ, рдФрд░ рддреАрд╕рд░реА рдХреНрд╡реЗрд░реА рдЕрдзрд┐рдХрддрдо рдХреАрдордд рдорд╛рдВрдЧрддреА рд╣реИ, рддреЛ "ipod nano" рдХреЗ рд▓рд┐рдП рдлреБрд▓-рдЯреЗрдХреНрд╕реНрдЯ рдЦреЛрдЬ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдХреА рдЬрд╛рдПрдЧреА, рдФрд░ рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ 3 рд╡рд┐рднрд┐рдиреНрди рдкрд░рд┐рдгрд╛рдо рд╕реЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

[Faceted search](../Searching/Faceted_search.md) рдПрдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдорд╛рдорд▓рд╛ рд╣реИ рдЬреЛ рдЗрд╕ рдЕрдиреБрдХреВрд▓рди рд╕реЗ рд▓рд╛рднрд╛рдиреНрд╡рд┐рдд рд╣реЛрддрд╛ рд╣реИред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, faceted рдЦреЛрдЬ рдХреЛ рдХрдИ рдХреНрд╡реЗрд░рд┐рдпрд╛рдБ рдЪрд▓рд╛рдХрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдПрдХ рдЦреЛрдЬ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдХреБрдЫ рдЕрдиреНрдп рд╕рдорд╛рди рдлреБрд▓-рдЯреЗрдХреНрд╕реНрдЯ рдХреНрд╡реЗрд░реА рдХреЗ рд╕рд╛рде рд▓реЗрдХрд┐рди рд╡рд┐рднрд┐рдиреНрди group-by рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд╕рд╛рде рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдкрд░рд┐рдгрд╛рдо рд╕рдореВрд╣ (рдЯреЙрдк-3 рд▓реЗрдЦрдХ, рдЯреЙрдк-5 рд╡рд┐рдХреНрд░реЗрддрд╛, рдЖрджрд┐) рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдЬрдм рддрдХ рдХрд┐ рдлреБрд▓-рдЯреЗрдХреНрд╕реНрдЯ рдХреНрд╡реЗрд░реА рдФрд░ рдлрд┐рд▓реНрдЯрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕рдорд╛рди рд░рд╣рддреА рд╣реИрдВ, рд╕рд╛рдорд╛рдиреНрдп рдХреНрд╡реЗрд░реА рдЕрдиреБрдХреВрд▓рди рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛, рдФрд░ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдХрд╛рдлреА рд╕реБрдзрд╛рд░ рдХрд░реЗрдЧрд╛ред

**рд╕рд╛рдорд╛рдиреНрдп рдЙрдк-рд╡реГрдХреНрд╖ рдЕрдиреБрдХреВрд▓рди** рдФрд░ рднреА рджрд┐рд▓рдЪрд╕реНрдк рд╣реИред рдпрд╣ `searchd` рдХреЛ рдмреИрдЪ рдХрд┐рдП рдЧрдП рдлреБрд▓-рдЯреЗрдХреНрд╕реНрдЯ рдХреНрд╡реЗрд░рд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдорд╛рдирддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рд╕рднреА рдХреНрд╡реЗрд░рд┐рдпреЛрдВ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдлреБрд▓-рдЯреЗрдХреНрд╕реНрдЯ рдХреНрд╡реЗрд░реА рд╣рд┐рд╕реНрд╕реЛрдВ (рдЙрдк-рд╡реГрдХреНрд╖реЛрдВ) рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреНрд╡реЗрд░рд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рдХреИрд╢ рдХрд░рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреНрд╡реЗрд░реА рдмреИрдЪ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:

```bash
donald trump president
donald trump barack obama john mccain
donald trump speech
```

рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рджреЛ-рд╢рдмреНрдж рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ `donald trump` рд╣реИ рдЬрд┐рд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рд╕рдВрдЧрдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдлрд┐рд░ рдХреИрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХреНрд╡реЗрд░рд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдЙрдк-рд╡реГрдХреНрд╖ рдЕрдиреБрдХреВрд▓рди рд╡рд╣реА рдХрд░рддрд╛ рд╣реИред рдкреНрд░рддрд┐-рдкреНрд░рд╢реНрди рдХреИрд╢ рдЖрдХрд╛рд░ [subtree_docs_cache](../Server_settings/Searchd.md#subtree_docs_cache) рдФрд░ [subtree_hits_cache](../Server_settings/Searchd.md#subtree_hits_cache) рдирд┐рд░реНрджреЗрд╢реЛрдВ рджреНрд╡рд╛рд░рд╛ рдХрдбрд╝рд╛рдИ рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рддрд╛рдХрд┐ "i am" рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реЗ *рд╕рднреА* рд╕реЛрд▓рд╣ рдЧрдЬрд╝реАрд▓рд┐рдпрди рджрд╕реНрддрд╛рд╡реЗрдЬреЛрдВ рдХреЛ рдХреИрд╢ рдХрд░рдиреЗ рд╕реЗ RAM рд╕рдорд╛рдкреНрдд рди рд╣реЛ рдЬрд╛рдП рдФрд░ рдЖрдкрдХрд╛ рд╕рд░реНрд╡рд░ рддреБрд░рдВрдд рди рдмрдВрдж рд╣реЛ рдЬрд╛рдП)ред

<!-- example multi-query 2 -->
How can you tell if the queries in the batch were actually optimized? If they were, the respective query log will have a "multiplier" field that specifies how many queries were processed together:

Note the "x3" field. It means that this query was optimized and processed in a sub-batch of 3 queries.


<!-- intro -->
##### рд▓реЙрдЧ:

<!-- request log -->
```bash
[Sun Jul 12 15:18:17.000 2009] 0.040 sec x3 [ext/0/rel 747541 (0,20)] [lj] the
[Sun Jul 12 15:18:17.000 2009] 0.040 sec x3 [ext/0/ext 747541 (0,20)] [lj] the
[Sun Jul 12 15:18:17.000 2009] 0.040 sec x3 [ext/0/ext 747541 (0,20)] [lj] the
```
<!-- end -->

<!-- example multi-query 3 -->
For reference, this is how the regular log would look like if the queries were not batched:


<!-- intro -->
##### рд▓реЙрдЧ:

<!-- request log -->
```bash
[Sun Jul 12 15:18:17.062 2009] 0.059 sec [ext/0/rel 747541 (0,20)] [lj] the
[Sun Jul 12 15:18:17.156 2009] 0.091 sec [ext/0/ext 747541 (0,20)] [lj] the
[Sun Jul 12 15:18:17.250 2009] 0.092 sec [ext/0/ext 747541 (0,20)] [lj] the
```
<!-- end -->

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдорд▓реНрдЯреА-рдХреНрд╡реЗрд░реА рдорд╛рдорд▓реЗ рдореЗрдВ рдкреНрд░рддрд┐-рдХреНрд╡реЗрд░реА рд╕рдордп рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЙрд░реНрдЯрд┐рдВрдЧ рдореЛрдб рдХреЗ рдЖрдзрд╛рд░ рдкрд░ 1.5x рд╕реЗ 2.3x рддрдХ рдХреИрд╕реЗ рд╕реБрдзрд░рд╛ред

<!-- proofread -->
