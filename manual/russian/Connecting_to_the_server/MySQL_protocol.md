# Протокол MySQL

Manticore Search реализует SQL-интерфейс с использованием протокола MySQL, позволяя любым библиотекам или соединителям MySQL и многим клиентам MySQL подключаться к Manticore Search и работать с ним так, как будто это MySQL сервер, а не Manticore.

Однако диалект SQL отличается и реализует только подмножество SQL команд или функций, доступных в MySQL. Кроме того, есть предложения и функции, специфичные для Manticore Search, такие как оператор `MATCH()` для полнотекстового поиска.

Manticore Search не поддерживает подготовленные заявления на стороне сервера, но можно использовать подготовленные заявления на стороне клиента. Важно отметить, что Manticore реализует тип данных с множественными значениями (MVA), который не имеет эквивалента в MySQL или библиотеках, реализующих подготовленные заявления. В этих случаях значения MVA должны быть сформированы в сыром запросе.

Некоторые клиенты/соединители MySQL требуют значения для имени пользователя/пароля и/или имени базы данных. Поскольку Manticore Search не имеет концепции баз данных и нет реализованного контроля доступа пользователей, эти значения могут быть установлены произвольно, так как Manticore просто проигнорирует их.

## Конфигурация

**Порт по умолчанию для SQL интерфейса - 9306** и он включен по умолчанию. 

Вы можете настроить порт MySQL в разделе searchd конфигурационного файла, используя директиву `listen`, следующим образом:

```ini
searchd {
...
   listen = 127.0.0.1:9306:mysql
...
}
``` 

Имейте в виду, что Manticore не имеет аутентификации пользователя, поэтому убедитесь, что порт MySQL недоступен для кого-либо за пределами вашей сети.

### VIP соединение
Отдельный порт MySQL может быть использован для выполнения "VIP" соединений. При подключении к этому порту пул потоков обходится, и всегда создается новый выделенный поток. Это полезно в случаях сильной перегрузки, когда сервер либо зависает, либо предотвращает подключение через обычный порт.

```ini
searchd {
...
   listen = 127.0.0.1:9306:mysql
   listen = 127.0.0.1:9307:mysql_vip
...
}
``` 

## Подключение через стандартный клиент MySQL
Самый простой способ подключиться к Manticore - использовать стандартный клиент MySQL:

```shell
mysql -P9306 -h0
```

## Защищенное соединение MySQL

Протокол MySQL поддерживает [SSL шифрование](../Security/SSL.md). Защищенные соединения могут быть установлены на том же порту `mysql`.

## Сжатое соединение MySQL

Сжатие может использоваться с соединениями MySQL и доступно клиентам по умолчанию. Клиент просто должен указать, что соединение должно использовать сжатие.

Пример использования клиента MySQL:

```shell
mysql -P9306 -h0 -C
```

Сжатие может использоваться как в защищенных, так и в несообщенных соединениях.
 
## Примечания по соединителям MySQL
Официальные соединители MySQL могут быть использованы для подключения к Manticore Search, однако они могут потребовать определенные настройки, передаваемые в строке DSN, так как соединитель может попытаться выполнить определенные SQL команды, которые еще не реализованы в Manticore.

JDBC Connector 6.x и выше требуют Manticore Search 2.8.2 или выше, и строка DSN должна содержать следующие параметры:
```ini
jdbc:mysql://IP:PORT/DB/?characterEncoding=utf8&maxAllowedPacket=512000&serverTimezone=XXX
```

По умолчанию Manticore Search будет сообщать свою версию соединителю, однако это может вызвать некоторые проблемы. Чтобы это обойти, директива `mysql_version_string` в разделе searchd конфигурации должна быть установлена на версию ниже 5.1.1:

```ini
searchd {
...
   mysql_version_string = 5.0.37
...
}
``` 

.NET соединитель MySQL по умолчанию использует пул соединений. Чтобы правильно получить статистику `SHOW META`, запросы вместе с командой `SHOW META` должны быть отправлены как одно многозначное выражение (`SELECT ...;SHOW META`). Если пуллирование включено, необходимо добавить параметр `Allow Batch=True` в строку соединения, чтобы разрешить многозначные выражения:
```ini
Server=127.0.0.1;Port=9306;Database=somevalue;Uid=somevalue;Pwd=;Allow Batch=True;
```

## Примечания по ODBC подключению
Manticore можно получить через ODBC. Рекомендуется установить `charset=UTF8` в строке ODBC. Некоторые ODBC драйверы не будут довольны версией, сообщенной сервером Manticore, так как они будут воспринимать ее как очень старый сервер MySQL. Это можно переопределить с помощью опции `mysql_version_string`.

## Синтаксис комментариев

Manticore SQL над MySQL поддерживает синтаксис комментариев в стиле C. Все, что находится между открывающей последовательностью `/*` и закрывающей последовательностью `*/`, игнорируется. Комментарии могут занимать несколько строк, не могут быть вложенными и не должны регистрироваться. Специфичные для MySQL комментарии `/*! ... */` также в настоящее время игнорируются. (Поскольку поддержка комментариев была добавлена скорее для лучшей совместимости с дампами, создаваемыми `mysqldump`, а не для улучшения общей совместимости запросов между Manticore и MySQL.)

```sql
SELECT /*! SQL_CALC_FOUND_ROWS */ col1 FROM table1 WHERE ...
```
<!-- proofread -->
