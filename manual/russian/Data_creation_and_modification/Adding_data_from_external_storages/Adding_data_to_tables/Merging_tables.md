# Слияние таблиц

Слияние двух существующих **простых** таблиц может быть более эффективным, чем индексация данных с нуля, и может быть желательным в некоторых случаях (например, слияние 'main' и 'delta' таблиц вместо простого восстановления 'main' в схеме партиционирования 'main+delta'). Таким образом, `indexer` предоставляет возможность сделать это. Слияние таблиц, как правило, быстрее, чем восстановление, но все же **не** мгновенно для огромных таблиц. По сути, это требует один раз прочитать содержимое обеих таблиц и один раз записать результат. Слияние таблицы объемом 100 ГБ и таблицы объемом 1 ГБ, например, приведет к 202 ГБ ввода-вывода (но это все равно, вероятно, меньше, чем требуется для индексации с нуля).

Основной синтаксис команды выглядит следующим образом:

```bash
sudo -u manticore indexer --merge DSTINDEX SRCINDEX [--rotate] [--drop-src]
```

Если не указан `--drop-src`, будет затронута только таблица DSTINDEX: содержимое SRCINDEX будет объединено с ней.

Переключатель `--rotate` требуется, если DSTINDEX уже обрабатывается `searchd`.

Типичный шаблон использования — это слияние меньшего обновления из SRCINDEX в DSTINDEX. Таким образом, при слиянии атрибутов значения из SRCINDEX будут иметь приоритет, если встречаются дублирующиеся идентификаторы документов. Однако обратите внимание, что "старые" ключевые слова **не** будут автоматически удалены в таких случаях. Например, если существует ключевое слово "old", связанное с документом 123 в DSTINDEX, и ключевое слово "new", связанное с ним в SRCINDEX, документ 123 будет найден по обоим ключевым словам после слияния. Вы можете предоставить явное условие для удаления документов из DSTINDEX, чтобы это смягчить; соответствующий переключатель — `--merge-dst-range`:

```bash
sudo -u manticore indexer --merge main delta --merge-dst-range deleted 0 0
```

Этот переключатель позволяет вам применять фильтры к таблице назначения вместе со слиянием. Может быть несколько фильтров; все их условия должны быть выполнены, чтобы включить документ в результирующую объединенную таблицу. В приведенном выше примере фильтр проходит только те записи, где 'deleted' равен 0, исключая все записи, которые были помечены как удаленные.

`--drop-src` позволяет удалить SRCINDEX после слияния и перед вращением таблиц, что важно, если вы указываете DSTINDEX в `killlist_target` для DSTINDEX. В противном случае, при вращении таблиц документы, которые были объединены с DSTINDEX, могут быть подавлены SRCINDEX.
<!-- proofread -->
