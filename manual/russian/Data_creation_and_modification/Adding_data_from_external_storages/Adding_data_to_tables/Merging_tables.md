# Объединение таблиц

Объединение двух существующих **простых** таблиц может быть более эффективным, чем индексация данных с нуля, и может быть желаемо в некоторых случаях (например, объединение таблиц 'main' и 'delta' вместо простого перестроения 'main' в схеме партиционирования 'main+delta'). Таким образом, `indexer` предоставляет для этого опцию. Объединение таблиц обычно быстрее, чем перестроение, но все же **не** мгновенно для огромных таблиц. По сути, нужно один раз прочитать содержимое обеих таблиц и один раз записать результат. Объединение таблиц размером 100 ГБ и 1 ГБ, например, приведет к 202 ГБ ввода-вывода (что, тем не менее, скорее всего, меньше, чем требуется для индексации с нуля).

Базовый синтаксис команды следующий:

```bash
sudo -u manticore indexer --merge DSTINDEX SRCINDEX [--rotate] [--drop-src]
```

Если не указано `--drop-src`, то будет затронута только таблица DSTINDEX: содержимое SRCINDEX будет объединено с ней.

Переключатель `--rotate` обязателен, если DSTINDEX уже обслуживается `searchd`.

Типичный сценарий использования — объединить небольшое обновление из SRCINDEX в DSTINDEX. При объединении атрибутов значения из SRCINDEX будут иметь приоритет, если встретятся дублирующиеся ID документов. Однако обратите внимание, что "старые" ключевые слова **не будут** автоматически удалены в таких случаях. Например, если в DSTINDEX есть ключевое слово "old", связанное с документом 123, а в SRCINDEX с ним связано ключевое слово "new", после объединения документ 123 будет найден по обоим ключевым словам. Чтобы избежать этого, вы можете задать явное условие для удаления документов из DSTINDEX; соответствующий переключатель — `--merge-dst-range`:

```bash
sudo -u manticore indexer --merge main delta --merge-dst-range deleted 0 0
```

Этот переключатель позволяет применять фильтры к таблице назначения вместе с объединением. Фильтров может быть несколько; все их условия должны быть выполнены, чтобы документ попал в результирующую объединённую таблицу. В примере выше фильтр пропускает только записи, где 'deleted' равен 0, исключая все записи, помеченные как удалённые.

`--drop-src` позволяет удалить SRCINDEX после объединения и перед вращением таблиц, что важно, если вы указываете DSTINDEX в `killlist_target` у DSTINDEX. Иначе при вращении таблиц документы, объединённые в DSTINDEX, могут быть подавлены SRCINDEX.
<!-- proofread -->

