# Получение из TSV, CSV 

TSV/CSV — это самый простой способ передать данные в индексатор Manticore. Этот метод был создан из-за ограничений xmlpipe2. В xmlpipe2 индексатор должен сопоставить каждую атрибут и тег поля в XML-файле с соответствующим элементом схемы. Это сопоставление требует времени, и оно увеличивается с ростом числа полей и атрибутов в схеме. У TSV/CSV нет подобных проблем, так как каждое поле и атрибут соответствуют конкретному столбцу в TSV/CSV файле. В некоторых случаях TSV/CSV может работать немного быстрее, чем xmlpipe2.

## Формат файла
Первый столбец в файле TSV/CSV должен быть идентификатором документа. Остальные столбцы должны соответствовать определению полей и атрибутов в схеме. Обратите внимание, что вам не нужно объявлять идентификатор документа в схеме, поскольку он всегда считается присутствующим, должен находиться в 1-м столбце и должен быть уникальным положительным целым числом типа 64 бита, отличным от нуля.

Разница между tsvpipe и csvpipe заключается в правилах разметки и кавычках. В tsvpipe как разделитель используется табуляция, закодированная в строке, и нет правил для кавычек. В csvpipe есть опция `csvpipe_delimiter` для разделителя с умолчательным значением , и также есть правила для кавычек, такие как:

* Любое поле может быть заключено в кавычки
* Поля, содержащие переносы строки, двойные кавычки или запятые, должны быть заключены в кавычки
* Символ двойной кавычки в поле должен быть представлен двумя символами двойной кавычки

## Объявление потока TSV
Директива `tsvpipe_command` обязательна и содержит команду оболочки, вызываемую для генерации потока TSV, который будет индексироваться. Команда может читать файл TSV, но также может быть программой, которая динамически генерирует содержимое, разделенное табуляцией.

##  Индексируемые столбцы TSV 

Следующие директивы могут быть использованы для объявления типов индексируемых столбцов:

* `tsvpipe_field` -  объявляет поле `text`. 
* `tsvpipe_field_string` - объявляет текстовое поле/строковый атрибут. Столбец будет индексироваться как текстовое поле, а также храниться как строковый атрибут.
* `tsvpipe_attr_uint` - объявляет целочисленный атрибут. 
* `tsvpipe_attr_timestamp` - объявляет атрибут временной метки.
* `tsvpipe_attr_bool` -  объявляет логический атрибут.
* `tsvpipe_attr_float` - объявляет атрибут с плавающей запятой.
* `tsvpipe_attr_bigint` - объявляет атрибут с большим целым числом.
* `tsvpipe_attr_multi` - объявляет атрибут с несколькими значениями с целыми числами.
* `tsvpipe_attr_multi_64` - объявляет атрибут с несколькими значениями с 64-битными целыми числами.
* `tsvpipe_attr_string` - объявляет строковый атрибут. 
* `tsvpipe_attr_json` - объявляет атрибут JSON.


Пример источника, использующего файл TSV:

```ini
source tsv_test
{
    type = tsvpipe
    tsvpipe_command = cat /tmp/rock_bands.tsv
    tsvpipe_field = name
    tsvpipe_attr_multi = genre_tags
}
```

```ini
1   Led Zeppelin    35,23,16
2   Deep Purple 35,92
3   Frank Zappa 35,23,16,92,33,24
```

## Объявление потока CSV
Директива `csvpipe_command` обязательна и содержит команду оболочки, вызываемую для генерации потока CSV, который будет индексироваться. Команда может просто читать файл CSV, но она также может быть программой, которая динамически генерирует содержимое, разделенное запятыми.

##  Индексируемые столбцы CSV

Следующие директивы могут быть использованы для объявления типов индексируемых столбцов:

* `csvpipe_field` -  объявляет поле `text`. 
* `csvpipe_field_string` - объявляет текстовое поле/строковый атрибут. Столбец будет индексироваться как текстовое поле, а также храниться как строковый атрибут.
* `csvpipe_attr_uint` - объявляет целочисленный атрибут. 
* `csvpipe_attr_timestamp` - объявляет атрибут временной метки.
* `csvpipe_attr_bool` -  объявляет логический атрибут.
* `csvpipe_attr_float` - объявляет атрибут с плавающей запятой.
* `csvpipe_attr_bigint` - объявляет атрибут с большим целым числом.
* `csvpipe_attr_multi` - объявляет атрибут с несколькими значениями с целыми числами.
* `csvpipe_attr_multi_64` - объявляет атрибут с несколькими значениями с 64-битными целыми числами.
* `csvpipe_attr_string` - объявляет строковый атрибут.
* `csvpipe_attr_json` - объявляет атрибут JSON.

Пример источника, использующего файл CSV:

```ini
source csv_test
{
    type = csvpipe
    csvpipe_command = cat /tmp/rock_bands.csv
    csvpipe_field = name
    csvpipe_attr_multi = genre_tags
}
```

```ini
1,"Led Zeppelin","35,23,16"
2,"Deep Purple","35,92"
3,"Frank Zappa","35,23,16,92,33,24"
```
<!-- proofread -->
