# Получение данных из TSV,CSV

TSV/CSV — самый простой способ передать данные индексатору Manticore. Этот метод был создан из-за ограничений xmlpipe2. В xmlpipe2 индексатор должен сопоставить каждый тег атрибута и поля в XML-файле с соответствующим элементом схемы. Это сопоставление требует времени, и оно увеличивается с ростом количества полей и атрибутов в схеме. В TSV/CSV такой проблемы нет, так как каждое поле и атрибут соответствуют определённому столбцу в файле TSV/CSV. В некоторых случаях TSV/CSV может работать немного быстрее, чем xmlpipe2.

## Формат файла
Первый столбец в файле TSV/CSV должен быть идентификатором документа. Остальные столбцы должны соответствовать объявлению полей и атрибутов в определении схемы. Обратите внимание, что вам не нужно объявлять идентификатор документа в схеме, так как он всегда считается присутствующим, должен находиться в первом столбце и быть уникальным знаковым положительным ненулевым 64-битным целым числом.

Разница между tsvpipe и csvpipe заключается в разделителе и правилах кавычек. tsvpipe использует символ табуляции в качестве жёстко заданного разделителя и не имеет правил кавычек. csvpipe имеет опцию `csvpipe_delimiter` для разделителя со значением по умолчанию , а также правила кавычек, такие как:

* Любое поле может быть заключено в кавычки
* Поля, содержащие перенос строки, двойную кавычку или запятые, должны быть заключены в кавычки
* Символ двойной кавычки в поле должен быть представлен двумя двойными кавычками

## Объявление потока TSV
Директива `tsvpipe_command` обязательна и содержит команду оболочки, вызываемую для создания TSV-потока, который индексируется. Команда может читать TSV-файл, но также может быть программой, которая генерирует содержимое с разделителями табуляции на лету.

## Индексируемые столбцы TSV

Следующие директивы могут использоваться для объявления типов индексируемых столбцов:

* `tsvpipe_field` - объявляет поле типа `text`.
* `tsvpipe_field_string` - объявляет текстовое поле/строковый атрибут. Столбец будет индексироваться как текстовое поле, а также храниться как строковый атрибут.
* `tsvpipe_attr_uint` - объявляет целочисленный атрибут.
* `tsvpipe_attr_timestamp` - объявляет атрибут временной метки.
* `tsvpipe_attr_bool` - объявляет булев атрибут.
* `tsvpipe_attr_float` - объявляет атрибут с плавающей точкой.
* `tsvpipe_attr_bigint` - объявляет атрибут большого целого числа.
* `tsvpipe_attr_multi` - объявляет мульти-значный атрибут с целыми числами.
* `tsvpipe_attr_multi_64` - объявляет мульти-значный атрибут с 64-битными целыми числами.
* `tsvpipe_attr_string` - объявляет строковый атрибут.
* `tsvpipe_attr_json` - объявляет JSON-атрибут.


Пример источника, использующего TSV-файл:

```ini
source tsv_test
{
    type = tsvpipe
    tsvpipe_command = cat /tmp/rock_bands.tsv
    tsvpipe_field = name
    tsvpipe_attr_multi = genre_tags
}
```

```ini
1   Led Zeppelin    35,23,16
2   Deep Purple 35,92
3   Frank Zappa 35,23,16,92,33,24
```

## Объявление потока CSV
Директива `csvpipe_command` обязательна и содержит команду оболочки, вызываемую для создания CSV-потока, который индексируется. Команда может просто читать CSV-файл, но также может быть программой, которая генерирует содержимое с разделителями-запятыми на лету.

## Индексируемые столбцы CSV

Следующие директивы могут использоваться для объявления типов индексируемых столбцов:

* `csvpipe_field` - объявляет поле типа `text`.
* `csvpipe_field_string` - объявляет текстовое поле/строковый атрибут. Столбец будет индексироваться как текстовое поле, а также храниться как строковый атрибут.
* `csvpipe_attr_uint` - объявляет целочисленный атрибут.
* `csvpipe_attr_timestamp` - объявляет атрибут временной метки.
* `csvpipe_attr_bool` - объявляет булев атрибут.
* `csvpipe_attr_float` - объявляет атрибут с плавающей точкой.
* `csvpipe_attr_bigint` - объявляет атрибут большого целого числа.
* `csvpipe_attr_multi` - объявляет мульти-значный атрибут с целыми числами.
* `csvpipe_attr_multi_64` - объявляет мульти-значный атрибут с 64-битными целыми числами.
* `csvpipe_attr_string` - объявляет строковый атрибут.
* `csvpipe_attr_json` - объявляет JSON-атрибут.

Пример источника, использующего CSV-файл:

```ini
source csv_test
{
    type = csvpipe
    csvpipe_command = cat /tmp/rock_bands.csv
    csvpipe_field = name
    csvpipe_attr_multi = genre_tags
}
```

```ini
1,"Led Zeppelin","35,23,16"
2,"Deep Purple","35,92"
3,"Frank Zappa","35,23,16,92,33,24"
```
<!-- proofread -->

