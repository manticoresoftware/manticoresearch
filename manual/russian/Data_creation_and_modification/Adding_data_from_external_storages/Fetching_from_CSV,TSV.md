# Получение из TSV,CSV

TSV/CSV — самый простой способ передачи данных индексеру Manticore. Этот метод был создан из-за ограничений xmlpipe2. В xmlpipe2 индексер должен сопоставить каждый атрибут и тег поля в XML-файле с соответствующим элементом схемы. Это сопоставление требует времени и увеличивается с числом полей и атрибутов в схеме. TSV/CSV не имеет такой проблемы, так как каждое поле и атрибут соответствуют определённому столбцу в файле TSV/CSV. В некоторых случаях TSV/CSV может работать несколько быстрее, чем xmlpipe2.

## Формат файла
Первый столбец в файле TSV/CSV должен быть ID документа. Остальные столбцы должны отражать объявление полей и атрибутов в определении схемы. Обратите внимание, что вам не нужно объявлять ID документа в схеме, так как он всегда считается присутствующим, должен находиться в первом столбце и быть уникальным знаковым положительным ненулевым 64-битным целым числом.

Разница между tsvpipe и csvpipe заключается в разделителе и правилах кавычек. В tsvpipe жёстко задан символ табуляции как разделитель, и кавычки не применяются. В csvpipe есть опция `csvpipe_delimiter` для разделителя со значением по умолчанию `,`, а также применяются правила кавычек, такие как:

* Любое поле может быть заключено в кавычки
* Поля, содержащие перевод строки, двойную кавычку или запятые, должны быть заключены в кавычки
* Символ двойной кавычки в поле должен быть представлен двумя двойными кавычками

## Объявление потока TSV
Директива `tsvpipe_command` обязательна и содержит shell-команду, вызываемую для создания TSV-потока, который индексируется. Команда может читать TSV-файл, но также может быть программой, которая генерирует табуляционно-разделённое содержимое на лету.

## Индексируемые столбцы TSV

Для объявления типов индексируемых столбцов можно использовать следующие директивы:

* `tsvpipe_field` - объявляет `text` поле.
* `tsvpipe_field_string` - объявляет текстовое поле/строковый атрибут. Столбец будет одновременно индексирован как текстовое поле и сохранён как строковый атрибут.
* `tsvpipe_attr_uint` - объявляет целочисленный атрибут.
* `tsvpipe_attr_timestamp` - объявляет атрибут временной метки.
* `tsvpipe_attr_bool` - объявляет булев атрибут.
* `tsvpipe_attr_float` - объявляет атрибут с плавающей точкой.
* `tsvpipe_attr_bigint` - объявляет большой целочисленный атрибут.
* `tsvpipe_attr_multi` - объявляет мульти-значный атрибут с целыми числами.
* `tsvpipe_attr_multi_64` - объявляет мульти-значный атрибут с 64-битными целыми числами.
* `tsvpipe_attr_string` - объявляет строковый атрибут.
* `tsvpipe_attr_json` - объявляет JSON-атрибут.


Пример источника, использующего TSV-файл:

```ini
source tsv_test
{
    type = tsvpipe
    tsvpipe_command = cat /tmp/rock_bands.tsv
    tsvpipe_field = name
    tsvpipe_attr_multi = genre_tags
}
```

```ini
1   Led Zeppelin    35,23,16
2   Deep Purple 35,92
3   Frank Zappa 35,23,16,92,33,24
```

## Объявление потока CSV
Директива `csvpipe_command` обязательна и содержит shell-команду, вызываемую для создания CSV-потока, который индексируется. Команда может просто читать CSV-файл, но также может быть программой, которая генерирует запятой-разделённое содержимое на лету.

## Индексируемые столбцы CSV

Для объявления типов индексируемых столбцов можно использовать следующие директивы:

* `csvpipe_field` - объявляет `text` поле.
* `csvpipe_field_string` - объявляет текстовое поле/строковый атрибут. Столбец будет одновременно индексирован как текстовое поле и сохранён как строковый атрибут.
* `csvpipe_attr_uint` - объявляет целочисленный атрибут.
* `csvpipe_attr_timestamp` - объявляет атрибут временной метки.
* `csvpipe_attr_bool` - объявляет булев атрибут.
* `csvpipe_attr_float` - объявляет атрибут с плавающей точкой.
* `csvpipe_attr_bigint` - объявляет большой целочисленный атрибут.
* `csvpipe_attr_multi` - объявляет мульти-значный атрибут с целыми числами.
* `csvpipe_attr_multi_64` - объявляет мульти-значный атрибут с 64-битными целыми числами.
* `csvpipe_attr_string` - объявляет строковый атрибут.
* `csvpipe_attr_json` - объявляет JSON-атрибут.

Пример источника, использующего CSV-файл:

```ini
source csv_test
{
    type = csvpipe
    csvpipe_command = cat /tmp/rock_bands.csv
    csvpipe_field = name
    csvpipe_attr_multi = genre_tags
}
```

```ini
1,"Led Zeppelin","35,23,16"
2,"Deep Purple","35,92"
3,"Frank Zappa","35,23,16,92,33,24"
```
<!-- proofread -->

