# Подключение к базе данных

Определение источника должно содержать настройки подключения, включая хост, порт, учетные данные пользователя или специфические настройки драйвера.

## sql_host

Хост сервера базы данных для подключения. Обратите внимание, что библиотека клиента MySQL выбирает способ подключения — по TCP/IP или через UNIX-сокет — в зависимости от имени хоста. В частности, "localhost" заставит использовать UNIX-сокет (это режим по умолчанию и обычно рекомендуемый), а "127.0.0.1" — TCP/IP.

## sql_port

IP-порт сервера для подключения.
Для `mysql` по умолчанию 3306, для `pgsql` — 5432.

## sql_db

SQL база данных, которая будет использоваться после установления подключения для выполнения запросов.

## sql_user

Имя пользователя для подключения.

## sql_pass

Пароль пользователя для подключения. Если пароль содержит `#` (который используется для добавления комментариев в конфигурационный файл), его можно экранировать с помощью `\`.

## sql_sock

Имя UNIX-сокета для подключения к локальным серверам базы данных. Обратите внимание, что использование этого значения зависит от настройки `sql_host`.

```ini
sql_sock = /var/lib/mysql/mysql.sock
```

## Специфические настройки драйверов

### MySQL

#### mysql_connect_flags

Флаги подключения клиента MySQL. Необязательно, значение по умолчанию — 0 (не устанавливать флаги).

Опция должна содержать целочисленное значение, являющееся суммой флагов. Значение будет напрямую передано в mysql_real_connect(). Флаги перечислены в файле включения mysql_com.h. Особенно интересные флаги, связанные с индексированием, с их значениями:

* CLIENT_COMPRESS = 32; может использовать протокол сжатия
* CLIENT_SSL = 2048; переключение на SSL после рукопожатия
* CLIENT_SECURE_CONNECTION = 32768; новая аутентификация 4.1
Например, можно указать 2080 (2048+32) для использования и сжатия, и SSL, или 32768 для использования только новой аутентификации. Изначально эта опция была введена для возможности использования сжатия, когда индексатор и mysqld находятся на разных хостах. На каналах 1 Гбит/с сжатие скорее навредит скорости индексирования, хотя и уменьшает сетевой трафик, как в теории, так и на практике. Однако включение сжатия на каналах 100 Мбит/с может значительно улучшить время индексирования (сообщалось о повышении до 20-30% от общего времени индексирования). Ваш опыт может отличаться.

```ini
mysql_connect_flags = 32 # enable compression
```

### Настройки SSL сертификатов

* `mysql_ssl_cert` - путь к SSL сертификату
* `mysql_ssl_key` - путь к файлу SSL ключа
* `mysql_ssl_ca` - путь к сертификату центра сертификации (CA)


### unpack_mysqlcompress

```ini
unpack_mysqlcompress_maxsize = 1M
```

Столбцы для распаковки с использованием алгоритма MySQL `UNCOMPRESS()`. Многозначное значение, необязательно, по умолчанию — пустой список столбцов.

Столбцы, указанные этой директивой, будут распакованы индексатором с использованием модифицированного алгоритма zlib, применяемого в функциях MySQL `COMPRESS()` и `UNCOMPRESS()`. При индексировании на другой машине, отличной от базы данных, это позволяет разгрузить базу данных и сэкономить сетевой трафик. Эта функция доступна только если zlib и zlib-devel были доступны во время сборки.

```ini
unpack_mysqlcompress = body_compressed
unpack_mysqlcompress = description_compressed
```

По умолчанию для распаковки данных используется буфер размером 16М. Его размер можно изменить, установив `unpack_mysqlcompress_maxsize`.

При использовании unpack_mysqlcompress из-за особенностей реализации невозможно определить необходимый размер буфера по сжатым данным. Поэтому буфер должен быть выделен заранее, а распакованные данные не могут превышать размер буфера.

### unpack_zlib

```ini
unpack_zlib = col1
unpack_zlib = col2
```

Столбцы для распаковки с использованием zlib (также известен как deflate, gunzip). Многозначное значение, необязательно, по умолчанию — пустой список столбцов. Применимо только к типам источников `mysql` и `pgsql`.

Столбцы, указанные этой директивой, будут распакованы `indexer` с использованием стандартного алгоритма zlib (называемого deflate и также реализованного в `gunzip`). При индексировании на другой машине, отличной от базы данных, это позволяет разгрузить базу данных и сэкономить сетевой трафик. Эта функция доступна только если zlib и zlib-devel были доступны во время сборки.

### MSSQL

Флаг аутентификации MS SQL Windows. Определяет, использовать ли учетные данные текущего вошедшего в систему Windows-пользователя для аутентификации при подключении к MS SQL Server.

```ini
mssql_winauth = 1
```

### ODBC

Источники, использующие ODBC, требуют наличия строки DSN (Data Source Name), которая может быть задана через `odbc_dsn`.

```ini
odbc_dsn = Driver={Oracle ODBC Driver};Dbq=myDBName;Uid=myUsername;Pwd=myPassword
```

Обратите внимание, что формат зависит от конкретного используемого драйвера ODBC.
<!-- proofread -->

