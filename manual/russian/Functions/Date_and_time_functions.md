# Функции даты и времени

Обратите внимание, что `CURTIME()`, `UTC_TIME()`, `UTC_TIMESTAMP()`, и `TIMEDIFF()` могут быть преобразованы в числовые типы с использованием произвольных функций преобразования, таких как `BIGINT()`, `DOUBLE()`, и т.д.

### NOW()
<!-- example NOW -->
Возвращает текущую метку времени в формате INTEGER.

<!-- request SQL -->
```sql
select NOW();
```
<!-- response SQL -->
```sql
+------------+
| NOW()      |
+------------+
| 1615788407 |
+------------+
```
<!-- end -->

### CURTIME()
<!-- example CURTIME -->
Возвращает текущее время в местной часовой зоне в формате `hh:ii:ss`.

<!-- request SQL -->
```sql
select CURTIME();
```
<!-- response SQL -->
```sql
+-----------+
| CURTIME() |
+-----------+
| 07:06:30  |
+-----------+
```
<!-- end -->

### CURDATE()
<!-- example CURDATE -->
Возвращает текущую дату в местной часовой зоне в формате `YYYY-MM-DD`.

<!-- request SQL -->
```sql
select curdate();
```
<!-- response SQL -->
```sql
+------------+
| curdate()  |
+------------+
| 2023-08-02 |
+------------+
```
<!-- end -->

### UTC_TIME()
<!-- example UTC_TIME -->
Возвращает текущее время в часовой зоне UTC в формате `hh:ii:ss`.

<!-- request SQL -->
```sql
select UTC_TIME();
```
<!-- response SQL -->
```sql
+------------+
| UTC_TIME() |
+------------+
| 06:06:18   |
+------------+
```
<!-- end -->

### UTC_TIMESTAMP()
<!-- example UTC_TIMESTAMP -->
Возвращает текущее время в часовой зоне UTC в формате `YYYY-MM-DD hh:ii:ss`.

<!-- request SQL -->
```sql
select UTC_TIMESTAMP();
```
<!-- response SQL -->
```sql
+---------------------+
| UTC_TIMESTAMP()     |
+---------------------+
| 2021-03-15 06:06:03 |
+---------------------+
```
<!-- end -->

### SECOND()
<!-- example SECOND -->
Возвращает целую секунду (в диапазоне 0..59) из аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select second(now());
```
<!-- response SQL -->
```sql
+---------------+
| second(now()) |
+---------------+
| 52            |
+---------------+
```
<!-- end -->

### MINUTE()
<!-- example MINUTE -->
Возвращает целую минуту (в диапазоне 0..59) из аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select minute(now());
```
<!-- response SQL -->
```sql
+---------------+
| minute(now()) |
+---------------+
| 5             |
+---------------+
```
<!-- end -->

### HOUR()
<!-- example HOUR -->
Возвращает целый час (в диапазоне 0..23) из аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select hour(now());
```
<!-- response SQL -->
```sql
+-------------+
| hour(now()) |
+-------------+
| 7           |
+-------------+
```
<!-- end -->

### DAY()
<!-- example DAY -->
Возвращает целый день месяца (в диапазоне 1..31) из аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select day(now());
```
<!-- response SQL -->
```sql
+------------+
| day(now()) |
+------------+
| 15         |
+------------+
```
<!-- end -->

### MONTH()
<!-- example MONTH -->
Возвращает целый месяц (в диапазоне 1..12) из аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select month(now());
```
<!-- response SQL -->
```sql
+--------------+
| month(now()) |
+--------------+
| 3            |
+--------------+
```
<!-- end -->

### QUARTER()
<!-- example QUARTER -->
Возвращает целый квартал года (в диапазоне 1..4) из аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select quarter(now());
```
<!-- response SQL -->
```sql
+----------------+
| quarter(now()) |
+----------------+
| 2              |
+----------------+
```
<!-- end -->

### YEAR()
<!-- example YEAR -->
Возвращает целый год (в диапазоне 1969..2038) из аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select year(now());
```
<!-- response SQL -->
```sql
+-------------+
| year(now()) |
+-------------+
| 2024        |
+-------------+
```
<!-- end -->

### DAYNAME()
<!-- example DAYNAME -->
Возвращает название дня недели для данного аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select dayname(now());
```
<!-- response SQL -->
```sql
+----------------+
| dayname(now()) |
+----------------+
| Wednesday      |
+----------------+
```
<!-- end -->

### MONTHNAME()
<!-- example MONTHNAME -->
Возвращает название месяца для данного аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select monthname(now());
```
<!-- response SQL -->
```sql
+------------------+
| monthname(now()) |
+------------------+
| August           |
+------------------+
```
<!-- end -->

### DAYOFWEEK()
<!-- example DAYOFWEEK -->
Возвращает целочисленный индекс дня недели (в диапазоне 1..7) для данного аргумента метки времени в соответствии с текущей часовой зоной.
Обратите внимание, что неделя начинается с воскресенья.

<!-- request SQL -->
```sql
select dayofweek(now());
```
<!-- response SQL -->
```sql
+------------------+
| dayofweek(now()) |
+------------------+
| 5                |
+------------------+
```
<!-- end -->

### DAYOFYEAR()
<!-- example DAYOFYEAR -->
Возвращает целочисленный день года (в диапазоне 1..366) для данного аргумента метки времени в соответствии с текущей часовой зоной.

<!-- request SQL -->
```sql
select dayofyear(now());
```
<!-- response SQL -->
```sql
+------------------+
| dayofyear(now()) |
+------------------+
|              214 |
+------------------+
```
<!-- end -->

### YEARWEEK()
<!-- example YEARWEEK -->
Возвращает целое значение года и код дня первого дня текущей недели (в диапазоне 1969001..2038366) для данного аргумента временной метки, в соответствии с текущим часовым поясом.

<!-- request SQL -->
```sql
select yearweek(now());
```
<!-- response SQL -->
```sql
+-----------------+
| yearweek(now()) |
+-----------------+
|         2023211 |
+-----------------+
```
<!-- end -->

### YEARMONTH()
<!-- example YEARMONTH -->
Возвращает целое значение года и код месяца (в диапазоне 196912..203801) из аргумента временной метки, в соответствии с текущим часовым поясом.

<!-- request SQL -->
```sql
select yearmonth(now());
```
<!-- response SQL -->
```sql
+------------------+
| yearmonth(now()) |
+------------------+
| 202103           |
+------------------+
```
<!-- end -->

### YEARMONTHDAY()
<!-- example YEARMONTHDAY -->
Возвращает целое значение года, месяца и кода даты (в диапазоне от 19691231 до 20380119) на основе текущего часового пояса.

<!-- request SQL -->
```sql
select yearmonthday(now());
```
<!-- response SQL -->
```sql
+---------------------+
| yearmonthday(now()) |
+---------------------+
| 20210315            |
+---------------------+
```
<!-- end -->

### TIMEDIFF()
<!-- example TIMEDIFF -->
Вычисляет разницу между двумя временными метками в формате `чч:мм:сс`.

<!-- request SQL -->
```sql
select timediff(1615787586, 1613787583);
```
<!-- response SQL -->
```sql
+----------------------------------+
| timediff(1615787586, 1613787583) |
+----------------------------------+
| 555:33:23                        |
+----------------------------------+
```
<!-- end -->

### DATEDIFF()
<!-- example DATEDIFF -->
Вычисляет количество дней между двумя данными временными метками.

<!-- request SQL -->
```sql
select datediff(1615787586, 1613787583);
```
<!-- response SQL -->
```sql
+----------------------------------+
| datediff(1615787586, 1613787583) |
+----------------------------------+
|                               23 |
+----------------------------------+
```
<!-- end -->

### DATE()
<!-- example DATE -->
Форматирует часть даты из аргумента временной метки как строку в формате `ГГГГ-ММ-ДД`.

<!-- request SQL -->
```sql
select date(now());
```
<!-- response SQL -->
```sql
+-------------+
| date(now()) |
+-------------+
| 2023-08-02  |
+-------------+
```
<!-- end -->

### TIME()
<!-- example TIME -->
Форматирует часть времени из аргумента временной метки как строку в формате `ЧЧ:ММ:СС`.

<!-- request SQL -->
```sql
select time(now());
```
<!-- response SQL -->
```sql
+-------------+
| time(now()) |
+-------------+
| 15:21:27    |
+-------------+
```
<!-- end -->

### DATE_FORMAT()
<!-- example DATE_FORMAT -->
Возвращает отформатированную строку на основе заданных аргументов даты и формата. Аргумент формата использует те же спецификаторы, что и функция [strftime](https://man7.org/linux/man-pages/man3/strftime.3.html). Для удобства вот некоторые общие спецификаторы формата:

- `%Y` - Четырехзначный год
- `%m` - Двухзначный месяц (01-12)
- `%d` - Двухзначный день месяца (01-31)
- `%H` - Двухзначный час (00-23)
- `%M` - Двухзначная минута (00-59)
- `%S` - Двухзначная секунда (00-59)
- `%T` - Время в 24-часовом формате (`%H:%M:%S`)

Обратите внимание, что это не полный список спецификаторов. Пожалуйста, обратитесь к документации для `strftime()` для вашей операционной системы, чтобы получить полный список.

<!-- request SQL -->
```sql
SELECT DATE_FORMAT(NOW(), 'year %Y and time %T');
```
<!-- response SQL -->
```sql
+------------------------------------------+
| DATE_FORMAT(NOW(), 'year %Y and time %T') |
+------------------------------------------+
| year 2023 and time 11:54:52              |
+------------------------------------------+
```
<!-- end -->

Этот пример форматирует текущую дату и время, отображая четырехзначный год и время в 24-часовом формате.

### DATE_HISTOGRAM()
<!-- example DATE_HISTOGRAM -->
`DATE_HISTOGRAM(expr, {calendar_interval='unit_name'})` Берет размер ведра в качестве имени единицы и возвращает номер ведра для значения. Значения округляются до ближайшего ведра. Основная функция:
```sql
key_of_the_bucket = interval * floor ( value / interval )
```
Интервалы могут быть указаны с использованием имени единицы, например `week`, или как одна единица, такая как `1M`. Однако несколько единиц, такие как `2d`, не поддерживаются с `calendar_interval`, но допускаются с `fixed_interval`.

Допустимые интервалы для `calendar_interval`:

- `minute`, `1m`
- `hour`, `1h`
- `day`, `1d`
- `week`, `1w` (неделя — это интервал между началом дня недели, часом, минутой, секундой и следующей неделей, но в тот же день и время недели)
- `month`, `1M`
- `year`, `1y` (год — это интервал между началом дня месяца, временем и следующим годом, но в тот же день месяца, время)

Допустимые интервалы для `fixed_interval`:

- `minute`, `2m`
- `hour`, `3h`
- `day`, `5d`

Используется в агрегации, `FACET` и группировке.

Пример:

```sql
SELECT COUNT(*),
DATE_HISTOGRAM(tm, {calendar_interval='month'}) AS months
FROM facets
GROUP BY months ORDER BY months ASC;
```

### DATE_RANGE()
<!-- example DATE_RANGE -->
`DATE_RANGE(expr, {range_from='date_math', range_to='date_math'})` принимает набор диапазонов и возвращает номер ведра для значения.
Выражение включает значение `range_from` и исключает значение `range_to` для каждого диапазона. Диапазон может быть открытым - иметь только значение `range_from` или только значение `range_to`.
Разница между этим и функцией [RANGE()](../Functions/Arrays_and_conditions_functions.md#RANGE%28%29) заключается в том, что значения `range_from` и `range_to` могут быть выражены в выражениях [Date math](../Functions/Date_and_time_functions.md#Date-math).

Используется в агрегации, `FACET` и группировке.

Пример:

```sql
SELECT COUNT(*),
DATE_RANGE(tm, {range_to='2017||+2M/M'},{range_from='2017||+2M/M',range_to='2017||+5M/M'},{range_from='2017||+5M/M'}) AS points
FROM idx_dates
GROUP BY points ORDER BY points ASC;
```

##### Date math

Date math позволяет работать с датами и временем непосредственно в ваших поисках. Это особенно полезно для обработки данных, которые изменяются с течением времени. С помощью date math вы можете легко выполнять такие действия, как находить записи за определенный период, анализировать тенденции данных или управлять тем, когда информация должна быть удалена. Это упрощает работу с датами, позволяя добавлять или вычитать время от заданной даты, округлять даты до ближайшей единицы времени и многое другое, все в рамках ваших поисковых запросов.

Чтобы использовать date math, вы начинаете с базовой даты, которой может быть:
- `now` для текущей даты и времени,
- или строка конкретной даты, заканчивающаяся на `||`.

Затем вы можете модифицировать эту дату с помощью операций, таких как:
- `+1y` для добавления одного года,
- `-1h` для вычитания одного часа,
- `/m` для округления до ближайшего месяца.

Вы можете использовать эти единицы в своих операциях:
- `s` для секунд,
- `m` для минут,
- `h` (или `H`) для часов,
- `d` для дней,
- `w` для недель,
- `M` для месяцев,
- `y` для лет.

Вот некоторые примеры того, как вы можете использовать date math:
- `now+4h` означает четыре часа от сейчас.
- `now-2d/d` это время два дня назад, округленное до ближайшего дня.
- `2010-04-20||+2M/d` это 20 июня 2010 года, округленное до ближайшего дня.

<!-- proofread -->
