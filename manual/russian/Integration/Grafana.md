# Интеграция с Grafana

> ПРИМЕЧАНИЕ: Интеграция с Grafana требует [Manticore Buddy](../Installation/Manticore_Buddy.md). Если что-то не работает, убедитесь, что Buddy установлен.

[Grafana](https://grafana.com/) - это open-source платформа для визуализации данных и мониторинга, которая позволяет создавать интерактивные панели мониторинга и графики. Manticore Search легко интегрируется с Grafana, используя стандартный MySQL-коннектор, что дает возможность визуализировать поисковые данные, отслеживать показатели производительности и анализировать тренды в реальном времени.

В настоящее время протестированы и поддерживаются версии Grafana 10.0-12.2.

## Предварительные требования

Перед интеграцией Manticore Search с Grafana убедитесь, что:

1. Manticore Search (версия 6.2.0 или новее) правильно установлен и настроен на вашем сервере. Обратитесь к [официальному руководству по установке Manticore Search](../Installation/Installation.md) для получения помощи.
2. Grafana установлена в вашей системе. Следуйте [официальному руководству по установке Grafana](https://grafana.com/docs/grafana/latest/setup-grafana/installation/) для получения инструкций по установке.

## Подключение Manticore Search к Grafana

Для подключения Manticore Search к Grafana:

1. Войдите в свою панель управления Grafana и нажмите "Конфигурация" (значок шестеренки) в левом боковом меню.
2. Выберите "Источники данных" и нажмите "Добавить источник данных".
3. Выберите "MySQL" из списка доступных источников данных.
4. На странице настроек введите следующие данные:
   - **Название**: Название для источника данных (например, "Manticore Search")
   - **Хост**: Имя хоста или IP-адрес вашего сервера Manticore Search (с портом MySQL, по умолчанию: `localhost:9306`)
   - **База данных**: Оставьте пустым или укажите название базы данных
   - **Пользователь**: Имя пользователя с доступом к Manticore Search (по умолчанию: `root`)
   - **Пароль**: Пароль для указанного пользователя (по умолчанию: пустой)
5. Нажмите "Сохранить и проверить" для подтверждения подключения.

## Создание визуализаций и панелей мониторинга

После подключения Manticore Search к Grafana вы можете создавать панели мониторинга и визуализации:

1. На панели Grafana нажмите значок "+" в левом боковом меню и выберите "Новая панель мониторинга".
2. Нажмите кнопку "Добавить визуализацию" для настройки графика.
3. Выберите источник данных Manticore Search, который вы подключили через MySQL-коннектор.
4. Выберите тип графика, который хотите создать (например, Временная шкала, Столбчатый график, Свечной график, Круговая диаграмма).
5. Используйте построитель запросов Grafana или напишите SQL-запрос для получения данных из таблиц Manticore Search.
6. Настройте внешний вид графика, метки и другие параметры по необходимости.
7. Нажмите "Применить" для сохранения визуализации на панели мониторинга.

## Пример использования

Вот простой пример с использованием данных временных рядов. Сначала создайте таблицу и загрузите демонстрационные данные:

```sql
CREATE TABLE btc_usd_trading (
  id bigint,
  time timestamp,
  open float,
  high float,
  low float,
  close float
);
```

Загрузите данные:
```bash
curl -sSL https://gist.githubusercontent.com/donhardman/df109ba6c5e690f73198b95f3768e73f/raw/0fab3aee69d7007fad012f4e97f38901a64831fb/btc_usd_trading.sql | mysql -h0 -P9306
```

В Grafana вы можете создать:
- **График временных рядов**: Визуализация изменений цены с течением времени
- **Свечной график**: Отображение значений открытия, максимума, минимума, закрытия для финансовых данных
- **Графики агрегации**: Использование функций COUNT, AVG, MAX, MIN

Примеры запросов:
```sql
-- Time series query
SELECT time, close FROM btc_usd_trading ORDER BY time;

-- Aggregation query
SELECT DATE(time) as date, AVG(close) as avg_price 
FROM btc_usd_trading 
GROUP BY date 
ORDER BY date;
```

## Поддерживаемые функции

При работе с Manticore Search через Grafana вы можете:

- Выполнять SQL-запросы к таблицам Manticore Search
- Использовать агрегирующие функции: COUNT, AVG, MAX, MIN
- Применять операции GROUP BY и ORDER BY
- Фильтровать данные с помощью условий WHERE
- Получать доступ к метаданным таблиц через `information_schema.tables`
- Создавать различные типы визуализаций, поддерживаемые Grafana

## Ограничения

- Некоторые расширенные функции MySQL могут быть недоступны при работе с Manticore Search через Grafana.
- Доступны только функции, поддерживаемые Manticore Search. Обратитесь к [справочнику по SQL](../Searching/Full_text_matching/Basic_usage.md) для получения подробностей.

## Ссылки

Для получения дополнительной информации и подробных руководств:
- [Статья о интеграции Grafana](https://manticoresearch.com/blog/manticoresearch-grafana-integration/)
- [Официальная документация Grafana](https://grafana.com/docs/)
