# Разные инструменты

## indextool

`indextool` - это полезная утилита, которая извлекает различную информацию о физической таблице, исключая `template` или `distributed` таблицы. Вот общий синтаксис для использования `indextool`:

```sql
indextool <команда> [опции]
```

### Опции

Эти опции применимы ко всем командам:

* `--config <файл>` (`-c <файл>` для краткости) позволяет переопределить имена файлов конфигурации по умолчанию.
* `--quiet` (`-q` для краткости) подавляет вывод баннеров и подобного от `indextool`.
* `--help` (`-h` для краткости) отображает все параметры, доступные в вашей конкретной сборке `indextool`.
* `-v` отображает информацию о версии вашей конкретной сборки `indextool`.

### Команды

Вот доступные команды:

* `--checkconfig` загружает и проверяет файл конфигурации, проверяя его действительность и наличие синтаксических ошибок.
* `--buildidf DICTFILE1 [DICTFILE2 ...] --out IDFILE` создает файл IDF из одного или нескольких дампов словарей (ссылайтесь на `--dumpdict`). Дополнительный параметр `--skip-uniq` пропустит уникальные слова (df=1).
* `--build-infixes TABLENAME` генерирует инфиксы для уже существующей таблицы dict=keywords (обновляет .sph, .spi на месте). Используйте этот параметр для файлов таблиц старого формата, которые уже используют dict=keywords, но теперь требуют поддержки поиска по инфиксам; обновление файлов таблиц с помощью indextool может быть проще или быстрее, чем их полное воссоздание с нуля с помощью indexer.
* `--dumpheader FILENAME.sph` немедленно выгружает указанный файл заголовка таблицы, не беспокоясь о других файлах таблиц или даже файле конфигурации. Отчет предоставляет подробный обзор всех настроек таблицы, особенно полного списка атрибутов и полей.
* `--dumpconfig FILENAME.sph` извлекает определение таблицы из указанного файла заголовка таблицы в формате, соответствующем (почти) manticore.conf.
* `--dumpheader TABLENAME` выгружает заголовок таблицы по имени таблицы, одновременно осуществляя поиск пути заголовка в файле конфигурации.
* `--dumpdict TABLENAME` выгружает словарь. Дополнительный переключатель `-stats` добавит общее количество документов к дампу словаря. Это необходимо для файлов словарей, используемых при создании файла IDF.
* `--dumpdocids TABLENAME` выгружает идентификаторы документов по имени таблицы.
* `--dumphitlist TABLENAME KEYWORD` выгружает все экземпляры (вхождения) указанного ключевого слова в данной таблице, при этом ключевое слово определяется как текст.
* `--dumphitlist TABLENAME --wordid ID` выгружает все экземпляры (вхождения) конкретного ключевого слова в данной таблице, при этом ключевое слово представлено как внутренний числовой идентификатор.
* `--docextract TBL DOCID` выполняет стандартный проход проверки таблицы по всему словарю/docs/hits и собирает все слова и вхождения, связанные с запрашиваемым документом. В дальнейшем все слова упорядочиваются по полям и позициям, а результат выводится, сгруппированный по полю.
* `--fold TABLENAME OPTFILE` Эта опция помогает понять, как токенизатор обрабатывает ввод. Вы можете предоставить indextool текст из файла, если он указан, или из stdin в противном случае. Вывод заменит разделители на пробелы (в соответствии с вашими настройками `charset_table`) и преобразует буквы в словах в нижний регистр.
* `--htmlstrip TABLENAME` применяет настройки фильтра для HTML для указанной таблицы для фильтрации stdin и отправляет результаты фильтрации в stdout. Обратите внимание, что настройки будут взяты из manticore.conf, а не из заголовка таблицы.
* `--mergeidf NODE1.idf [NODE2.idf ...] --out GLOBAL.idf` объединяет несколько .idf файлов в один. Дополнительный параметр `--skip-uniq` проигнорирует уникальные слова (df=1).
* `--morph TABLENAME` применяет морфологию к данному stdin и направляет результат в stdout.
* `--check TABLENAME` оценивает файлы данных таблицы на наличие ошибок непротиворечивости, которые могут быть вызваны ошибками в `indexer` или сбоями оборудования. `--check` также работает с RT таблицами, оперативной и дисковой памятью. Дополнительные параметры:
    - `--check-id-dups` проверяет на наличие дубликатов идентификаторов
    - `--check-disk-chunk CHUNK_NAME` проверяет только конкретный диск-кусок RT таблицы. Аргументом является числовое расширение дискового куска RT таблицы, который нужно проверить.
* `--strip-path` удаляет имена путей из всех имен файлов, на которые ссылается таблица (стоп-слова, формы слов, исключения и т.д.). Это может быть полезно при проверке таблиц, созданных на другой машине с возможно отличающимися макетами путей.
* `--rotate` совместима только с `--check` и определяет, следует ли проверить таблицу, ожидающую ротации, т.е. с расширением .new. Это полезно, когда вы хотите подтвердить вашу таблицу перед фактическим использованием.
* `--apply-killlists` загружает и применяет списки исключений для всех таблиц, указанных в файле конфигурации. Изменения сохраняются в .SPM файлах. Файлы списков исключений (.SPK) удаляются. Это может быть полезно, если вы хотите перенести применение таблиц с запуска сервера на этап индексирования.

### Важное замечание по проверке RT таблиц

`indextool` не может полностью проверить RT таблицу, которая в настоящее время обслуживается демоном. При попытке проверить активную RT таблицу вы можете столкнуться со следующим предупреждением:

```
WARNING: не удалось загрузить оперативные куски, проверка только N дисковых кусков
```

Чтобы избежать этих предупреждений и обеспечить правильную проверку RT таблицы, рассмотрите следующие подходы:

- остановите демон перед выполнением `indextool --check`.  
- убедитесь, что RT таблица не обслуживается демоном.  
- проверьте отдельную копию RT таблицы вместо рабочей.  

Если остановка демона невозможна, вы можете предотвратить непреднамеренные изменения в RT таблице, выполнив следующий оператор MySQL перед выполнением `indextool --check`:

```sql
SET GLOBAL AUTO_OPTIMIZE=0;
```

Эта команда предотвращает выполнение автооптимизации демоном, гарантируя, что файлы RT таблицы останутся неизменными. После выполнения этого оператора дождитесь полной остановки потока оптимизации, прежде чем продолжить с `indextool --check`. Это гарантирует, что во время процесса проверки никакие дисковые куски не будут непреднамеренно изменены или удалены.
Если автооптимизация была включена ранее, вы должны вручную снова включить ее после завершения проверки, выполнив:

```sql
SET GLOBAL AUTO_OPTIMIZE=1;
```

## spelldump

Команда `spelldump` предназначена для извлечения содержимого из файла словаря, который использует формат `ispell` или `MySpell`. Это может быть полезно, когда вам нужно составить списки слов для форм слов, так как она генерирует все возможные формы за вас.

Вот общая синтаксис:

```bash
spelldump [options] <dictionary> <affix> [result] [locale-name]
```

Основные параметры — это основной файл и файл аффиксов словаря. Обычно они называются `[языковой-префикс].dict` и `[языковой-префикс].aff`, соответственно. Вы можете найти эти файлы в большинстве стандартных дистрибутивов Linux или у многочисленных онлайн-источников.

Параметр `[result]` — это место, где будут храниться извлеченные данные словаря, а `[locale-name]` — это параметр, используемый для указания деталей локали по вашему выбору.

Также есть необязательный параметр `-c [file]`. Этот параметр позволяет вам указать файл для деталей преобразования регистра.

Вот несколько примеров использования:

```bash
spelldump en.dict en.aff
spelldump ru.dict ru.aff ru.txt ru_RU.CP1251
spelldump ru.dict ru.aff ru.txt .1251
```

В результате полученный файл будет перечислять все слова из словаря, расположенные в алфавитном порядке и отформатированные как файл форм слов. Затем вы можете изменить этот файл в соответствии с вашими конкретными требованиями. Вот пример того, как может выглядеть выходной файл:

```bash
zone > zone
zoned > zoned
zoning > zoning
```

## wordbreaker

Инструмент `wordbreaker` предназначен для разложения составных слов, что является распространенной особенностью в URL, на их отдельные компоненты. Например, он может разложить "lordoftherings" на четыре отдельных слова или разбить `http://manofsteel.warnerbros.com` на "man of steel warner bros". Эта способность улучшает функциональность поиска, устраняя необходимость в префиксах или инфиксах. Для иллюстрации, поиск по "sphinx" не даст результатов "sphinxsearch". Однако, если вы примените `wordbreaker`, чтобы разобрать составное слово и индексировать отдельные элементы, поиск будет успешным без увеличения размера файла, связанного с использованием префиксов или инфиксов в полнотекстовом индексировании.

Вот несколько примеров использования `wordbreaker`:

```bash
echo manofsteel | bin/wordbreaker -dict dict.txt split
man of steel
```

Файл словаря `-dict` используется для разделения входного потока на отдельные слова. Если файл словаря не указан, Wordbreaker будет искать файл с именем `wordbreaker-dict.txt` в текущем рабочем каталоге. (Убедитесь, что файл словаря соответствует языку составного слова, с которым вы работаете.) Команда `split` разбивает слова из стандартного ввода и выводит результаты на стандартный вывод. Команды `test` и `bench` также доступны для оценки качества разбиения и измерения производительности функции разбиения соответственно.

Wordbreaker использует словарь для определения отдельных подстрок в данной строке. Чтобы различить множественные потенциальные разбиения, он учитывает относительную частоту каждого слова в словаре. Более высокая частота указывает на более высокую вероятность разделения слова. Чтобы создать файл такого рода, вы можете использовать инструмент `indexer`:


```bash
indexer --buildstops dict.txt 100000 --buildfreqs myindex -c /path/to/manticore.conf
```

который создаст текстовый файл с именем `dict.txt`, содержащий 100 000 самых часто встречающихся слов из `myindex` вместе с их соответствующими частотами. Поскольку этот выходной файл является простым текстовым документом, у вас есть возможность вручную редактировать его по мере необходимости. Не стесняйтесь добавлять или удалять слова по мере необходимости.

<!-- proofread -->
