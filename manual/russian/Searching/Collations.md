# Сопоставления (Collations)

Сопоставления в первую очередь влияют на сравнения строковых атрибутов. Они определяют как кодировку набора символов, так и стратегию, которую Manticore использует для сравнения строк при выполнении `ORDER BY` или `GROUP BY`, когда задействован строковый атрибут.

Строковые атрибуты сохраняются как есть во время индексации, и никакая информация о наборе символов или языке к ним не прикрепляется. Это приемлемо, пока Manticore нужно только хранить и возвращать строки вызывающему приложению дословно. Однако, когда вы просите Manticore отсортировать по строковому значению, запрос становится неоднозначным.

Во-первых, одно-байтовые (ASCII, ISO-8859-1 или Windows-1251) строки нужно обрабатывать иначе, чем UTF-8 строки, которые могут кодировать каждый символ переменным числом байтов. Следовательно, нам нужно знать тип набора символов, чтобы правильно интерпретировать необработанные байты как значимые символы.

Во-вторых, нам также нужны правила сортировки, специфичные для языка. Например, при сортировке согласно правилам США в локали en_US, акцентированный символ `ï` (маленькая буква `i` с умляутом) должен находиться где-то после `z`. Однако при сортировке с учётом французских правил и локали fr_FR он должен располагаться между `i` и `j`. Другой набор правил может вовсе игнорировать акценты, позволяя произвольно смешивать `ï` и `i`.

В-третьих, в некоторых случаях требуется сортировка с учётом регистра, а в других — без учёта регистра.

Сопоставления инкапсулируют всё следующее: набор символов, языковые правила и чувствительность к регистру. В настоящее время Manticore предоставляет четыре сопоставления:

1. `libc_ci`
2. `libc_cs`
3. `utf8_general_ci`
4. `binary`

Первые два сопоставления опираются на несколько стандартных вызовов библиотеки C (libc) и, следовательно, могут поддерживать любую локаль, установленную в вашей системе. Они обеспечивают сравнений без учёта регистра (`_ci`) и с учётом регистра (`_cs`) соответственно. По умолчанию используется локаль C, что фактически приводит к побайтовым сравнениям. Чтобы изменить это, нужно указать другую доступную локаль с помощью директивы [collation_libc_locale](../Server_settings/Searchd.md#collation_libc_locale). Список доступных локалей в вашей системе обычно можно получить с помощью команды `locale`:

```bash
$ locale -a
C
en_AG
en_AU.utf8
en_BW.utf8
en_CA.utf8
en_DK.utf8
en_GB.utf8
en_HK.utf8
en_IE.utf8
en_IN
en_NG
en_NZ.utf8
en_PH.utf8
en_SG.utf8
en_US.utf8
en_ZA.utf8
en_ZW.utf8
es_ES
fr_FR
POSIX
ru_RU.utf8
ru_UA.utf8
```

Конкретный список системных локалей может отличаться. Обратитесь к документации вашей операционной системы, чтобы установить необходимые дополнительные локали.

Локали `utf8_general_ci` и `binary` встроены в Manticore. Первая — это универсальное сопоставление для данных в UTF-8 (без какого-либо языкового "подгоняния"); оно должно вести себя аналогично сопоставлению `utf8_general_ci` в MySQL. Вторая — простое побайтовое сравнение.

Сопоставление можно переопределить для одной сессии в SQL с помощью оператора `SET collation_connection`. Все последующие SQL-запросы будут использовать это сопоставление. В противном случае все запросы используют сопоставление по умолчанию сервера или указанное в конфигурационной директиве [collation_server](../Server_settings/Searchd.md#collation_server). В настоящее время Manticore по умолчанию использует сопоставление `libc_ci`.

Сопоставления влияют на все сравнения строковых атрибутов, включая те, что используются в `ORDER BY` и `GROUP BY`, поэтому в зависимости от выбранного сопоставления могут возвращаться результаты в разном порядке или группировке. Обратите внимание, что сопоставления не влияют на полнотекстовый поиск; для этого используйте [charset_table](../Creating_a_table/NLP_and_tokenization/Low-level_tokenization.md#charset_table).

<!-- proofread -->

