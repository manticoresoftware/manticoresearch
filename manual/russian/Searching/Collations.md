# Сравнения

Сравнения в первую очередь влияют на сравнение строковых атрибутов. Они определяют как кодировку набора символов, так и стратегию, которую использует Manticore для сравнения строк при выполнении `ORDER BY` или `GROUP BY` с участием строкового атрибута.

Строковые атрибуты хранятся как есть во время индексации, и никакая информация о наборе символов или языке к ним не прикрепляется. Это нормально, пока Manticore только нужно хранить и возвращать строки вызывающему приложению дословно. Однако, когда вы просите Manticore отсортировать по строковому значению, запрос сразу же становится неоднозначным.

Во-первых, строки с одним байтом (ASCII, ISO-8859-1, или Windows-1251) необходимо обрабатывать иначе, чем строки UTF-8, которые могут кодировать каждый символ с переменным количеством байтов. Таким образом, нам нужно знать тип набора символов, чтобы правильно интерпретировать необработанные байты как значимые символы.

Во-вторых, нам также нужно знать языковые правила сортировки строк. Например, при сортировке в соответствии с правилами США в локали en_US акцентированный символ `ï` (маленькая буква `i` с диэрезисом) должен располагаться где-то после `z`. Однако, при сортировке с учетом французских правил и локали fr_FR, он должен находиться между `i` и `j`. Некоторые другие правила могут вообще игнорировать акценты, позволяя произвольно смешивать `ï` и `i`.

В-третьих, в некоторых случаях может потребоваться сортировка с учетом регистра, в то время как в других случаях нужна нечувствительная к регистру сортировка.

Сравнения охватывают все следующее: набор символов, языковые правила и чувствительность к регистру. В данный момент Manticore предоставляет четыре сравнения:

1. `libc_ci`
2. `libc_cs`
3. `utf8_general_ci`
4. `binary`

Первые два сравнения зависят от нескольких стандартных вызовов библиотеки C (libc) и, таким образом, могут поддерживать любую локаль, установленную в вашей системе. Они обеспечивают нечувствительные к регистру (`_ci`) и чувствительные к регистру (`_cs`) сравнения, соответственно. По умолчанию они используют локаль C, фактически прибегая к побайтовым сравнениям. Чтобы изменить это, вам нужно указать другую доступную локаль с помощью директивы [collation_libc_locale](../Server_settings/Searchd.md#collation_libc_locale). Список локалей, доступных на вашей системе, обычно можно получить с помощью команды `locale`:

```bash
$ locale -a
C
en_AG
en_AU.utf8
en_BW.utf8
en_CA.utf8
en_DK.utf8
en_GB.utf8
en_HK.utf8
en_IE.utf8
en_IN
en_NG
en_NZ.utf8
en_PH.utf8
en_SG.utf8
en_US.utf8
en_ZA.utf8
en_ZW.utf8
es_ES
fr_FR
POSIX
ru_RU.utf8
ru_UA.utf8
```

Конкретный список системных локалей может варьироваться. Обратитесь к документации вашей операционной системы для установки дополнительных необходимых локалей.

Локали `utf8_general_ci` и `binary` встроены в Manticore. Первая из них является универсальным сравнением для данных UTF-8 (без так называемой языковой настройки); она должна вести себя аналогично сравнению `utf8_general_ci` в MySQL. Вторая – это простое побайтовое сравнение.

Сравнения могут быть переопределены с помощью SQL на уровне отдельной сессии с использованием оператора `SET collation_connection`. Все последующие SQL-запросы будут использовать это сравнение. В противном случае все запросы будут использовать сравнение по умолчанию сервера или указанное в конфигурационной директиве [collation_server](../Server_settings/Searchd.md#collation_server). В данный момент Manticore по умолчанию использует сравнение `libc_ci`.

Сравнения влияют на все сравнения строковых атрибутов, включая те, что находятся в `ORDER BY` и `GROUP BY`, так что результаты с различным порядком или группировкой могут быть возвращены в зависимости от выбранного сравнения. Обратите внимание, что сравнения не влияют на полнотекстовый поиск; для этого используйте [charset_table](../Creating_a_table/NLP_and_tokenization/Low-level_tokenization.md#charset_table).

<!-- proofread -->
