# Экранирование символов в строке запроса

Поскольку некоторые символы выступают как операторы в строке запроса, их необходимо экранировать, чтобы предотвратить ошибки запроса или непреднамеренные условия сопоставления.

Следующие символы следует экранировать с помощью обратного слэша (`\`):


```
!    "    $    '    (    )    -    /    <    @    \    ^    |    ~
```

## В командной строке клиента MySQL

Чтобы экранировать одинарную кавычку ('), используйте один обратный слэш:
```sql

SELECT * FROM your_index WHERE MATCH('l\'italiano');

```


Для остальных символов из указанного ранее списка, которые являются операторами или конструкциями запроса, их нужно обрабатывать как обычные символы с предварительным символом экранирования.
Обратный слэш также должен быть экранирован, что приводит к двум обратным слэшам.

```sql

SELECT * FROM your_index WHERE MATCH('r\\&b | \\(official video\\)');

```

Чтобы использовать обратный слэш как символ, необходимо экранировать как сам обратный слэш, так и обратный слэш в качестве оператора экранирования, что требует четырех обратных слэшей.

```sql

SELECT * FROM your_index WHERE MATCH('\\\\ABC');

```

Когда вы работаете с JSON-данными в Manticore Search и вам нужно включить двойную кавычку (`"`) в строку JSON, важно правильно выполнить экранирование. В JSON двойная кавычка внутри строки экранируется с помощью обратного слэша (`\`). Однако при вставке JSON-данных через SQL-запрос Manticore Search интерпретирует обратный слэш (`\`) как символ экранирования в строках.

Чтобы гарантировать корректное вставление двойной кавычки в JSON-данные, необходимо экранировать сам обратный слэш. Это приводит к использованию двух обратных слэшей (`\\`) перед двойной кавычкой. Например:

```sql

insert into tbl(j) values('{"a": "\\"abc\\""}');

```

## Использование драйверов MySQL

Драйверы MySQL предоставляют функции экранирования (например, `mysqli_real_escape_string` в PHP или `conn.escape_string` в Python), но они экранируют только определенные символы.
Вам все равно потребуется добавить экранирование для символов из ранее упомянутого списка, которые не экранируются соответствующими функциями.
Поскольку эти функции экранируют обратный слэш за вас, необходимо добавить только один обратный слэш.

Это также относится к драйверам, поддерживающим (на стороне клиента) подготовленные выражения. Например, при использовании подготовленных выражений PHP PDO, для символа `$` необходимо добавить обратный слэш:

```php

$statement = $ln_sph->prepare( "SELECT * FROM index WHERE MATCH(:match)");

$match = '\$manticore';

$statement->bindParam(':match',$match,PDO::PARAM_STR);

$results = $statement->execute();

```

В результате получается итоговый запрос `SELECT * FROM index WHERE MATCH('\\$manticore');`

## В HTTP JSON API

Те же правила, что и для SQL-протокола, применимы, за исключением того, что для JSON двойная кавычка должна экранироваться одним обратным слэшем, а остальные символы требуют двойного экранирования.

При использовании JSON-библиотек или функций, которые преобразуют структуры данных в JSON-строки, двойная кавычка и одинарный обратный слэш экранируются автоматически, и их не нужно экранировать явно.



## В клиентах

[Официальные клиенты](https://github.com/manticoresoftware/) используют стандартные JSON-библиотеки/функции, доступные в их соответствующих языках программирования. Применяются те же правила экранирования, что упомянуты ранее.


## Экранирование звездочки

Звездочка (`*`) — это уникальный символ, выполняющий две функции:
* в качестве расширителя подстановочного префикса/суффикса
* в качестве модификатора для любого термина в поиске по фразе.

В отличие от других специальных символов, выполняющих роль операторов, звездочку невозможно экранировать, когда она используется для выполнения одной из своих функций.

В запросах без использования подстановочных символов экранирование звездочки не требуется, будь она в `charset_table` или нет.

В запросах с подстановочными символами звездочка, находящаяся внутри слова, не требует экранирования. В качестве оператора подстановки (либо в начале, либо в конце слова) звездочка всегда будет интерпретироваться как оператор подстановки, даже если применяется экранирование.

## Экранирование имен узлов JSON в SQL

Чтобы экранировать специальные символы в узлах JSON, используйте обратную кавычку. Например:

```sql

