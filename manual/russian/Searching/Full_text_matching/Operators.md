# Операторы полнотекстового поиска

Строка запроса может включать специальные операторы, которые определяют условия того, как должны сопоставляться слова из строки запроса.

### Булевы операторы

#### Оператор AND

Встроенный логический оператор AND присутствует всегда, поэтому "hello world" означает, что и "hello", и "world" должны быть найдены в совпадающем документе.

```sql
hello  world
```

Примечание: явного оператора `AND` нет.

#### Оператор OR

Логический оператор OR `|` имеет более высокий приоритет, чем AND, поэтому `looking for cat | dog | mouse` означает `looking for (cat | dog | mouse)`, а не `(looking for cat) | dog | mouse`.

```sql
hello | world
```

Примечание: оператора `OR` не существует. Пожалуйста, используйте `|` вместо него.

### Оператор MAYBE

```sql
hello MAYBE world
```

Оператор `MAYBE` работает аналогично оператору `|`, но он не возвращает документы, которые совпадают только с выражением правого поддерева.

### Оператор отрицания

```sql
hello -world
hello !world
```

Оператор отрицания задаёт правило, что слово не должно присутствовать.

Запросы, содержащие **только** отрицания, **по умолчанию не поддерживаются**. Чтобы включить поддержку, используйте опцию сервера [not_terms_only_allowed](../../Server_settings/Searchd.md#not_terms_only_allowed).

### Оператор поиска по полю

```sql
@title hello @body world
```

Оператор ограничения по полю ограничивает последующий поиск указанным полем. По умолчанию запрос завершится ошибкой, если поле с указанным именем не существует в искомой таблице. Однако это поведение можно подавить, указав опцию `@@relaxed` в начале запроса:

```sql
@@relaxed @nosuchfield my query
```

Это может быть полезно при поиске по разнородным таблицам с разными схемами.

Ограничения по позиции внутри поля дополнительно ограничивают поиск первыми N позициями внутри данного поля (или полей). Например, `@body [50] hello` не будет совпадать с документами, где ключевое слово `hello` находится на позиции 51 или позже в поле body.

```sql
@body[50] hello
```

Оператор поиска по нескольким полям:

```sql
@(title,body) hello world
```

Игнорирование поиска по полю (игнорирует все совпадения 'hello world' в поле 'title'):

```sql
@!title hello world
```

Игнорирование поиска по нескольким полям (если есть поля 'title', 'subject' и 'body', то `@!(title)` эквивалентно `@(subject,body)`):

```sql
@!(title,body) hello world
```

Оператор поиска по всем полям:

```sql
@* hello
```

### Оператор поиска фразы

```sql
"hello world"
```

Оператор фразы требует, чтобы слова были расположены друг рядом с другом.

Оператор поиска фразы может содержать модификатор `match any term`. В операторе фразы позиции терминов имеют значение. При использовании модификатора 'match any term' позиции последующих терминов в запросе с фразой будут сдвинуты. В результате модификатор 'match any' не влияет на производительность поиска.

```sql
"exact * phrase * * for terms"
```

Также можно использовать оператор OR внутри кавычек. Оператор OR (`|`) должен быть заключён в скобки `()` при использовании внутри фраз. Каждая опция проверяется на той же позиции, и фраза совпадает, если любая из опций подходит на эту позицию.

**Правильные примеры** (со скобками):
```sql
"( a | b ) c"
"( ( a b c ) | d ) e"
"man ( happy | sad ) but all ( ( as good ) | ( as fast ) )"
```

**Неправильные примеры** (без скобок - не будут работать):
```sql
"a | b c"
"happy | sad"
```

###  Оператор поиска по близости слов

```sql
"hello world"~10
```

Расстояние близости измеряется в словах, учитывая количество слов, и применяется ко всем словам в кавычках. Например, запрос `"cat dog mouse"~5` означает, что должен быть интервал меньше 8 слов, содержащий все 3 слова. Следовательно, документ с текстом `CAT aaa bbb ccc DOG eee fff MOUSE` не будет соответствовать этому запросу, так как интервал ровно 8 слов.

Также можно использовать оператор OR внутри поиска по близости. Оператор OR (`|`) должен быть заключён в скобки `()` при использовании внутри поиска по близости. Каждая опция проверяется отдельно.

**Правильный пример** (со скобками):
```sql
"( two | four ) fish chips"~5
```

**Неправильный пример** (без скобок - не будет работать):
```sql
"two | four fish chips"~5
```

###  Оператор кворума

```sql
"the world is a wonderful place"/3
```

Оператор кворума реализует тип нечеткого совпадения. Он совпадает только с теми документами, которые удовлетворяют заданному порогу из указанных слов. В приведённом выше примере (`"the world is a wonderful place"/3`) будут совпадать все документы, содержащие как минимум 3 из 6 указанных слов. Оператор ограничен 255 ключевыми словами. Вместо абсолютного числа можно также указать значение от 0.0 до 1.0 (представляющее 0% и 100%), и Manticore совпадёт только с документами, содержащими не менее указанного процента данных слов. Тот же пример можно записать как `"the world is a wonderful place"/0.5`, и он будет совпадать с документами, где есть как минимум 50% из 6 слов.

Оператор кворума поддерживает оператор OR (`|`). Оператор OR (`|`) должен быть заключён в скобки `()` при использовании внутри кворума. В счёт совпадений учитывается только одно слово из каждой группы OR.

**Правильные примеры** (со скобками):
```sql
"( ( a b c ) | d ) e f g"/0.5
"happy ( sad | angry ) man"/2
```

**Неправильный пример** (без скобок - не будет работать):
```sql
"a b c | d e f g"/0.5
```

### Оператор строгого порядка

```sql
aaa << bbb << ccc
```

Оператор строгого порядка (также известный как оператор "before") совпадает с документом, только если его ключевые слова встречаются в документе именно в указанном в запросе порядке. Например, запрос `black << cat` совпадёт с документом "black and white cat", но не с документом "that cat was black". Оператор порядка имеет самый низкий приоритет. Его можно применять как к отдельным ключевым словам, так и к более сложным выражениям. Например, следующий запрос является валидным:

```sql
(bag of words) << "exact phrase" << red|green|blue
```

### Модификатор точной формы

```sql
raining =cats and =dogs
="exact phrase"
```

Модификатор точной формы ключевого слова совпадает с документом, только если ключевое слово встречается в точной форме, указанной в запросе. По умолчанию документ считается совпадающим, если совпадает основание/лемматизированное ключевое слово. Например, запрос "runs" совпадёт как с документом, содержащим "runs", так и с документом, содержащим "running", так как обе формы основаны на "run". Однако запрос `=runs` совпадёт только с первым документом. Модификатор точной формы требует включения опции [index_exact_words](../../Creating_a_table/NLP_and_tokenization/Morphology.md#index_exact_words).


























































































































