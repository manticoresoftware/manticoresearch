# Полнотекстовые операторы

Строка запроса может включать в себя специальные операторы, которые определяют условия соответствия словам из строки запроса.

### Логические операторы

#### Оператор AND

Логический оператор AND всегда присутствует неявно, поэтому "hello world" подразумевает, что в совпадающем документе должны быть найдены как "hello", так и "world".

```sql
hello  world
```

Примечание: Явного оператора `AND` нет.

#### Оператор OR

Логический оператор OR `|` имеет более высокий приоритет, чем AND, поэтому `looking for cat | dog | mouse` означает `looking for (cat | dog | mouse)`, а не `(looking for cat) | dog | mouse`.

```sql
hello | world
```

Примечание: Оператора `OR` нет. Пожалуйста, используйте вместо этого `|`.

### Оператор MAYBE

```sql
hello MAYBE world
```

Оператор `MAYBE` функционирует аналогично оператору `|`, но не возвращает документы, которые соответствуют только выражению правого поддерева.

### Оператор отрицания

```sql
hello -world
hello !world
```

Оператор отрицания устанавливает правило для того, чтобы слово не присутствовало.

Запросы, содержащие **только** отрицания, по умолчанию **не** поддерживаются. Чтобы включить, используйте серверную опцию [not_terms_only_allowed](../../Server_settings/Searchd.md#not_terms_only_allowed).

### Оператор поиска по полю

```sql
@title hello @body world
```

Оператор ограничения по полю ограничивает последующие поиски указанным полем. По умолчанию запрос завершится с сообщением об ошибке, если указанное имя поля не существует в искомой таблице. Однако это поведение можно подавить, указав опцию `@@relaxed` в начале запроса:

```sql
@@relaxed @nosuchfield my query
```

Это может быть полезно при поиске по гетерогенным таблицам с различными схемами.

Ограничения позиции поля дополнительно сужают поиск до первых N позиций в данном поле (или полях). Например, `@body [50] hello` не будет соответствовать документам, где ключевое слово `hello` появляется на позиции 51 или позже в теле.

```sql
@body[50] hello
```

Оператор поиска по нескольким полям:

```sql
@(title,body) hello world
```

Оператор игнорирования поля поиска (игнорирует любые совпадения 'hello world' из поля 'title'):

```sql
@!title hello world
```

Оператор игнорирования поиска по нескольким полям (если присутствуют поля 'title', 'subject' и 'body', то `@!(title)` эквивалентен `@(subject,body)`):

```sql
@!(title,body) hello world
```

Оператор поиска по всем полям:

```sql
@* hello
```

### Оператор фразового поиска

```sql
"hello world"
```

Оператор фразы требует, чтобы слова располагались рядом друг с другом.

Оператор фразового поиска может включать модификатор `match any term`. Внутри оператора фразы термины имеют позиционное значение. Когда используется модификатор 'match any term', позиции последующих терминов в этом фразовом запросе будут смещены. В результате модификатор 'match any' не влияет на производительность поиска.

```sql
"exact * phrase * * for terms"
```

### Оператор близости поиска

```sql
"hello world"~10
```

Расстояние близости измеряется словами, учитывая количество слов, и применяется ко всем словам в кавычках. Например, запрос `"cat dog mouse"~5` указывает, что должен быть интервал менее 8 слов, содержащих все 3 слова. Поэтому документ с `CAT aaa bbb ccc DOG eee fff MOUSE` не совпадет с этим запросом, так как интервал составляет ровно 8 слов.

### Оператор куорумного совпадения

```sql
"the world is a wonderful place"/3
```

Оператор куорумного совпадения вводит тип нечеткого соответствия. Он будет совпадать только с теми документами, которые соответствуют заданному порогу указанных слов. В приведенном выше примере (`"the world is a wonderful place"/3`), он будет совпадать со всеми документами, содержащими по крайней мере 3 из 6 указанных слов. Оператор ограничен 255 ключевыми словами. Вместо абсолютного числа также можно указать значение от 0.0 до 1.0 (представляющее 0% и 100%), и Manticore будет совпадать только с документами, содержащими как минимум указанный процент заданных слов. Тот же пример выше также можно выразить как `"the world is a wonderful place"/0.5`, и он будет совпадать с документами с не менее чем 50% из 6 слов.

### Оператор строгого порядка

```sql
aaa << bbb << ccc
```

Оператор строгого порядка (также известный как оператор "до") совпадает с документом только в том случае, если его ключевые слова аргумента появляются в документе точно в порядке, указанном в запросе. Например, запрос `black << cat` совпадет с документом "black and white cat", но не совпадет с документом "that cat was black". Оператор порядка имеет наименьший приоритет. Его можно применять как к отдельным ключевым словам, так и к более сложным выражениям. Например, это допустимый запрос:

```sql
(bag of words) << "exact phrase" << red|green|blue
```

### Модификатор точной формы

```sql
raining =cats and =dogs
="exact phrase"
```

Модификатор ключевого слова точной формы совпадает с документом только в том случае, если ключевое слово появляется в точной форме, указанной. По умолчанию документ считается совпадающим, если совпадает основное/лемматизированное ключевое слово. Например, запрос "runs" совпадет как с документом, содержащим "runs", так и с документом, содержащим "running", потому что обе формы приводятся к "run". Однако запрос `=runs` совпадет только с первым документом. Модификатор точной формы требует, чтобы опция [index_exact_words](../../Creating_a_table/NLP_and_tokenization/Morphology.md#index_exact_words) была включена.

Другим случаем использования является предотвращение [расширения](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#expand_keywords) ключевого слова до его `*keyword*` формы. Например, с `index_exact_words=1` + `expand_keywords=1/star`, `bcd` найдет документ, содержащий `abcde`, но `=bcd` не найдет.
Как модификатор, влияющий на ключевое слово, он может использоваться в операторах, таких как оператор фразы, ближайший оператор и оператор кворума. Применение модификатора точной формы к оператору фразы возможно, и в этом случае он внутренне добавляет модификатор точной формы ко всем терминам в фразе.

### Операторы подстановки

```sql
nation* *nation* *national
```

Требует [min_infix_len](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#min_infix_len) для префикса (расширения в конце) и/или суффикса (расширения в начале). Если требуется только префикс, можно использовать [min_prefix_len](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#min_prefix_len).

Поиск будет пытаться найти все расширения токенов с подстановочными знаками, и каждое расширение записывается как совпадающий результат. Количество расширений для токена можно контролировать с помощью настройки таблицы [expansion_limit](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#expansion_limit). Токены с подстановочными знаками могут существенно повлиять на время поиска запроса, особенно когда токены имеют короткие длины. В таких случаях желательно использовать лимит расширения.

Оператор подстановки может быть автоматически применен, если используется настройка таблицы [expand_keywords](../../Searching/Options.md#expand_keywords).

В дополнение к этому, поддерживаются следующие встроенные операторы подстановки:

* `?` может соответствовать любому одиночному символу: `t?st` будет соответствовать `test`, но не `teast`
* `%` может соответствовать нулю или одному символу: `tes%` будет соответствовать `tes` или `test`, но не `testing`

Встроенные операторы требуют `dict=keywords` (включено по умолчанию) и включение префиксирования/инфиксирования.

### Оператор REGEX

```sql
REGEX(/t.?e/)
```

Требует установки опций [min_infix_len](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#min_infix_len) или [min_prefix_len](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#min_prefix_len) и [dict](../../Creating_a_table/NLP_and_tokenization/Low-level_tokenization.md#dict)=keywords (что является значением по умолчанию).

Подобно [операторам подстановки](../../Searching/Full_text_matching/Operators.md#Wildcard-operators), оператор REGEX пытается найти все токены, соответствующие предоставленному шаблону, и каждое расширение записывается как совпадающий результат. Обратите внимание, что это может существенно повлиять на время поиска запроса, поскольку весь словарь сканируется, и каждый термин в словаре проходит соответствие с шаблоном REGEX.

Шаблоны должны соответствовать [синтаксису RE2](https://github.com/google/re2/wiki/Syntax). Разделитель выражения REGEX — это первый символ после открывающей скобки. Другими словами, весь текст между открывающей скобкой, за которой следует разделитель, и разделителем и закрывающей скобкой считается выражением RE2.
Пожалуйста, обратите внимание, что термины, сохраненные в словаре, проходят преобразование `charset_table`, что означает, что, например, REGEX может не суметь сопоставить верхние регистры, если все символы преобразованы в нижний регистр в соответствии с `charset_table` (что происходит по умолчанию). Чтобы успешно соответствовать терминам с помощью выражения REGEX, шаблон должен соответствовать всему токену. Для достижения частичного соответствия разместите `.*` в начале и/или в конце вашего шаблона.

```sql
REGEX(/.{3}t/)
REGEX(/t.*\d*/)
```

### Модификатор начала и конца поля

```sql
^hello world$
```

Модификаторы ключевых слов начала и конца поля обеспечивают соответствие ключевого слова только в том случае, если оно появляется в самом начале или в самом конце текстового поля соответственно. Например, запрос `"^hello world$"` (взятый в кавычки, чтобы объединить оператор фразы с модификаторами начала/конца) будет соответствовать только документам, содержащим хотя бы одно поле с этими двумя конкретными ключевыми словами.

### Модификатор повышения IDF

```sql
boosted^1.234 boostedfieldend$^1.234
```

Модификатор повышения увеличивает [IDF](../../Searching/Options.md#idf)_score слова на указанный коэффициент в рейтинговых оценках, которые учитывают IDF в своих расчетах. Это не влияет на процесс сопоставления никаким образом.

### Оператор NEAR

```sql
hello NEAR/3 world NEAR/4 "my test"
```

Оператор `NEAR` является более обобщенной версией оператора близости. Его синтаксис `NEAR/N`, который чувствителен к регистру и не допускает пробелов между ключевыми словами `NEAR`, косой чертой и значением расстояния.

В то время как оригинальный оператор близости работает только с наборами ключевых слов, `NEAR` более универсален и может принимать произвольные подвыражения в качестве своих двух аргументов. Он соответствует документу, когда оба подвыражения находятся в пределах N слов друг от друга, независимо от их порядка. `NEAR` имеет левую ассоциативность и делит ту же (самую низкую) приоритетность с [BEFORE](../../Searching/Full_text_matching/Operators.md#Strict-order-operator).

Важно отметить, что `one NEAR/7 two NEAR/7 three` не совсем эквивалентно `"one two three"~7`. Ключевое отличие заключается в том, что оператор близости позволяет до 6 несовпадающих слов между всеми тремя совпадающими словами, тогда как версия с `NEAR` менее ограничительна: она допускает до 6 слов между `one` и `two`, а затем еще до 6 между этим соответствием из двух слов и `three`.

### Оператор NOTNEAR

```sql
Church NOTNEAR/3 street
```
Оператор `NOTNEAR` служит в качестве негативного утверждения. Он соответствует документу, когда левый аргумент присутствует и либо правый аргумент отсутствует в документе, либо правый аргумент находится на указанном расстоянии от конца левого совпадающего аргумента. Расстояние обозначается в словах. Синтаксис — `NOTNEAR/N`, который чувствителен к регистру и не допускает пробелов между ключевым словом `NOTNEAR`, косой чертой и значением расстояния. Оба аргумента этого оператора могут быть терминами или любыми операторами или группами операторов.

### Операторы SENTENCE и PARAGRAPH

```sql
all SENTENCE words SENTENCE "in one sentence"
```


```sql
"Bill Gates" PARAGRAPH "Steve Jobs"
```
Операторы `SENTENCE` и `PARAGRAPH` совпадают с документом, когда оба их аргумента находятся в одном предложении или одном абзаце текста соответственно. Эти аргументы могут быть ключевыми словами, фразами или экземплярами одного и того же оператора.

Порядок аргументов в предложении или абзаце не имеет значения. Эти операторы функционируют только с таблицами, построенными с включенной функцией [index_sp](../../Creating_a_table/NLP_and_tokenization/Advanced_HTML_tokenization.md#index_sp) (индексация предложений и абзацев), и в противном случае возвращаются к простой операции AND. Для получения информации о том, что такое предложение и абзац, обратитесь к документации директивы [index_sp](../../Creating_a_table/NLP_and_tokenization/Advanced_HTML_tokenization.md#index_sp).


### Оператор предела ZONE

```sql
ZONE:(h3,h4)

только в этих заголовках
```

Оператор `ZONE limit` очень похож на оператор предела поля, но ограничивает совпадение заданной областью в поле или списком зон. Важно отметить, что последующие подпредложения не нужно совпадать в рамках одного непрерывного периода данной зоны и могут совпадать через несколько периодов. Например, запрос `(ZONE:th hello world)` будет сочетаться со следующим примером документа:

```html
<th>Table 1. Local awareness of Hello Kitty brand.</th>
.. здесь находятся некоторые данные таблицы ..
<th>Table 2. World-wide brand awareness.</th>
```

Оператор `ZONE` влияет на запрос до следующего оператора предела поля или `ZONE`, или до закрывающей скобки. Он функционирует исключительно с таблицами, построенными с поддержкой зон (см. [index_zones](../../Creating_a_table/NLP_and_tokenization/Advanced_HTML_tokenization.md#index_zones)) и будет игнорироваться в противном случае.

### Оператор предела ZONESPAN

```sql
ZONESPAN:(h2)

только в (одном) заголовке
```

Оператор предела `ZONESPAN` похож на оператор `ZONE`, но требует, чтобы совпадение происходило в рамках одного непрерывного периода. В приведенном ранее примере `ZONESPAN:th hello world` не совпадет с документом, так как "hello" и "world" не появляются в одном периоде.

<!-- proofread -->

