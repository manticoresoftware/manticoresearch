# Изоляция во время очистки и слияния

Manticore обеспечивает изоляцию во время процесса очистки и слияния реального времени таблиц, чтобы предотвратить любые изменения, влияющие на выполняющиеся запросы.

Например, во время компактации таблицы пара дисковых чанков сливается, и создается новый чанк. В какой-то момент создается новая версия таблицы, в которой новый чанк заменяет оригинальную пару. Это происходит бесшовно, так что длительный запрос, использующий оригинальные чанки, продолжит видеть старую версию таблицы, в то время как новый запрос увидит новую версию с полученным объединенным чанком.

То же самое относится к очистке RAM чанка, где подходящие сегменты RAM сливаются в новый дисковый чанк, а участвующие сегменты RAM чанка отбрасываются. Во время этой операции Manticore обеспечивает изоляцию для запросов, которые начались до начала операции.

Более того, эти операции прозрачны для замены и обновлений. Если вы обновляете атрибут в документе, который принадлежит дисковому чанку, сливаемому с другим, обновление будет применено к обоим чанкам и к полученному объединенному чанку. Если вы удаляете документ во время слияния, он будет удален в оригинальном чанке и также в полученном объединенном чанке, который либо будет иметь документ, помеченный как удаленный, либо не будет содержать такого документа вовсе, если удаление произошло на раннем этапе процесса слияния.
<!-- proofread -->
