# Телеметрия

В Manticore мы собираем различные анонимные метрики для повышения качества наших продуктов, включая Manticore Search. Анализируя эти данные, мы можем не только улучшить общую производительность нашего продукта, но и определить, какие функции стоит приоритизировать, чтобы обеспечить пользователям еще большую ценность. Система телеметрии работает в отдельном потоке в неблокирующем режиме, делая снимки и отправляя их раз в несколько минут.

Мы серьезно относимся к вашей конфиденциальности, и вы можете быть уверены, что все метрики полностью анонимны и никакая чувствительная информация не передается. Однако, если вы все же хотите отключить телеметрию, у вас есть такая возможность:
* Установив переменную окружения `TELEMETRY=0`
* Или установив `telemetry = 0` в разделе `searchd` вашего конфигурационного файла

Вот список всех метрик, которые мы собираем:

Символ ⏱️ указывает, что метрика собирается периодически, в отличие от других метрик, которые собираются на основе конкретных событий.

| Метрика | Описание |
|-|-|
| `invocation` | Отправляется при запуске Manticore Buddy |
| `plugin_*` | Указывает, что плагин с данным именем был выполнен, например, `plugin_backup` для выполнения резервного копирования |
| `command_*` | ⏱️ Все метрики с этим префиксом отправляются из запроса `show status` демона Manticore   |
| `uptime` | ⏱️ Время работы демона Manticore Search |
| `workers_total` | ⏱️ Количество воркеров, используемых Manticore |
| `cluster_count` | ⏱️ Сколько кластеров обрабатывает этот узел |
| `cluster_size` | ⏱️ Сколько узлов во всех кластерах |
| `table_*_count` | ⏱️ Количество созданных таблиц каждого типа: plain, percolate, rt, или distributed |
| `*_field_*_count` | ⏱️ Количество для каждого типа поля для таблиц с типами rt и percolate |
| `columnar` | ⏱️ Указывает, что использовалась библиотека Columnar |
| `columnar_field_count` | ⏱️ Количество полей, использующих библиотеку Columnar |

## Метрики резервного копирования

Инструмент резервного копирования Manticore по умолчанию отправляет анонимные метрики на сервер метрик Manticore, чтобы помочь улучшить продукт. Если вы не хотите отправлять телеметрию, вы можете отключить ее, запустив инструмент с флагом `--disable-metric` или установив переменную окружения `TELEMETRY=0`.

Ниже приведен список всех собираемых метрик:

| Метрика | Описание |
|-|-|
| `invocation` | Отправляется при инициации резервного копирования  |
| `failed` | Отправляется в случае неудачного резервного копирования |
| `done` | Отправляется при успешном резервном копировании/восстановлении |
| `arg_*` | Аргументы, использованные для запуска инструмента (исключая имена индексов и т.п.) |
| `backup_store_versions_fails` | Указывает на ошибку при сохранении версии Manticore в резервной копии |
| `backup_table_count` | Общее количество сохраненных в резервную копию таблиц |
| `backup_no_permissions` | Неудачное резервное копирование из-за недостаточных прав на целевую директорию |
| `backup_total_size` | Общий размер полной резервной копии |
| `backup_time` | Продолжительность резервного копирования |
| `restore_searchd_running` | Не удалось запустить процесс восстановления из-за запущенного searchd |
| `restore_no_config_file` | Конфигурационный файл не найден в резервной копии при восстановлении |
| `restore_time` | Продолжительность восстановления |
| `fsync_time` | Продолжительность fsync |
| `restore_target_exists` | Возникает, если папка или индекс уже существует в целевой папке восстановления |
| `terminations` | Указывает, что процесс был завершен |
| `signal_*` | Сигнал, использованный для завершения процесса |
| `tables` | Количество таблиц в Manticore |
| `config_unreachable` | Указанный конфигурационный файл не существует |
| `config_data_dir_missing` | Ошибка при разборе `data_dir` из указанного конфигурационного файла |
| `config_data_dir_is_relative` | Путь `data_dir` в конфигурационном файле экземпляра Manticore является относительным |

## Метки

Каждая метрика снабжена следующими метками:

| Метка | Описание |
|-|-|
| `collector` | `buddy`. Указывает, что метрика собрана через Manticore Buddy |
| `os_name` | Название операционной системы |
| `os_release_name` | Название из `/etc/os-release`, если доступно, иначе `unknown` |
| `os_release_version` | Версия из `/etc/os-release`, если доступно, иначе `unknown` |
| `dockerized` | Если запущено в среде Docker |
| `official_docker` | В случае Docker — флаг, показывающий, что используется официальный образ |
| `machine_id` | Идентификатор сервера (содержимое `/etc/machine-id` в Linux) |
| `arch` | Архитектура машины, на которой запущено ПО |
| `manticore_version` | Версия Manticore |
| `columnar_version` | Версия библиотеки Columnar, если она установлена |
| `secondary_version` | Версия вторичной библиотеки, если установлена библиотека Columnar |
| `knn_version` | Версия библиотеки KNN, если установлена библиотека Columnar |
| `buddy_version`| Версия Manticore Buddy |

<!-- proofread -->

