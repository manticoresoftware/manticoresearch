# Телеметрия

В Manticore мы собираем различные анонимизированные метрики для повышения качества наших продуктов, включая Manticore Search. Анализируя эти данные, мы можем не только улучшить общую производительность нашего продукта, но и определить, какие функции будет наиболее выгодно приоритизировать, чтобы предоставить нашим пользователям ещё большую ценность. Система телеметрии работает в отдельном потоке в неблокирующем режиме, делая снимки и отправляя их каждые несколько минут.

Мы серьёзно относимся к вашей конфиденциальности, и вы можете быть уверены, что все метрики являются полностью анонимными и никакая конфиденциальная информация не передаётся. Однако, если вы всё же хотите отключить телеметрию, у вас есть такая возможность:
* Установив переменную окружения `TELEMETRY=0`
* Или установив `telemetry = 0` в секции `searchd` вашего файла конфигурации

Вот список всех метрик, которые мы собираем:

Символ ⏱️ указывает на то, что метрика собирается периодически, в отличие от других метрик, которые собираются на основе определённых событий.

| Metric | Description |
|-|-|
| `invocation` | Отправляется при запуске Manticore Buddy |
| `plugin_*` | Указывает, что плагин с данным именем был выполнен, например, `plugin_backup` при выполнении резервного копирования |
| `command_*` | ⏱️ Все метрики с этим префиксом отправляются запросом `show status` демона Manticore   |
| `uptime` | ⏱️ Время работы демона Manticore Search |
| `workers_total` | ⏱️ Количество рабочих процессов, используемых Manticore |
| `cluster_count` | ⏱️ Количество кластеров, которые обрабатывает этот узел |
| `cluster_size` | ⏱️ Общее количество узлов во всех кластерах |
| `table_*_count` | ⏱️ Количество таблиц, созданных для каждого типа: plain, percolate, rt или distributed |
| `*_field_*_count` | ⏱️ Количество для каждого типа поля в таблицах с типами rt и percolate |
| `columnar` | ⏱️ Указывает, что используется библиотека Columnar |
| `columnar_field_count` | ⏱️ Количество полей, использующих библиотеку Columnar |

## Метрики резервного копирования

Инструмент резервного копирования Manticore по умолчанию отправляет анонимизированные метрики на сервер метрик Manticore для улучшения продукта. Если вы не хотите отправлять телеметрию, вы можете отключить её, запустив инструмент с флагом `--disable-metric` или установив переменную окружения `TELEMETRY=0`.

Ниже приведён список всех собираемых метрик:

| Metric | Description |
|-|-|
| `invocation` | Отправляется при запуске резервного копирования  |
| `failed` | Отправляется в случае неудачного резервного копирования |
| `done` | Отправляется, когда резервное копирование/восстановление завершено успешно |
| `arg_*` | Аргументы, использованные для запуска инструмента (за исключением имён индексов и т.д.) |
| `backup_store_versions_fails` | Указывает на ошибку при сохранении версии Manticore в резервной копии |
| `backup_table_count` | Общее количество таблиц в резервной копии |
| `backup_no_permissions` | Неудачное резервное копирование из-за недостаточных прав доступа к целевой директории |
| `backup_total_size` | Общий размер полной резервной копии |
| `backup_time` | Время, затраченное на резервное копирование |
| `restore_searchd_running` | Ошибка запуска процесса восстановления, поскольку searchd уже запущен |
| `restore_no_config_file` | При восстановлении не найден файл конфигурации в резервной копии |
| `restore_time` | Время, затраченное на восстановление |
| `fsync_time` | Время работы fsync |
| `restore_target_exists` | Происходит, когда папка или индекс уже существует в целевой директории при восстановлении |
| `terminations` | Указывает на то, что процесс был завершён |
| `signal_*` | Сигнал, использованный для завершения процесса |
| `tables` | Количество таблиц в Manticore |
| `config_unreachable` | Указанный файл конфигурации не существует |
| `config_data_dir_missing` | Не удалось распарсить `data_dir` из указанного файла конфигурации |
| `config_data_dir_is_relative` | Путь `data_dir` в файле конфигурации экземпляра Manticore является относительным |

## Метки

Каждая метрика имеет следующие метки:

| Label | Description |
|-|-|
| `collector` | `buddy`. Указывает, что эта метрика собирается через Manticore Buddy |
| `os_name` | Название операционной системы |
| `os_release_name` | Название из файла `/etc/os-release`, если присутствует, или `unknown` |
| `os_release_version` | Версия из файла `/etc/os-release`, если присутствует, или `unknown` |
| `dockerized` | Указывает, запущено ли это в среде Docker |
| `official_docker` | В случае Docker это флаг, показывающий, что используется официальный образ |
| `machine_id` | Идентификатор сервера (содержимое файла `/etc/machine-id` в Linux) |
| `arch` | Архитектура машины, на которой запущено приложение |
| `manticore_version` | Версия Manticore |
| `columnar_version` | Версия библиотеки Columnar, если она установлена |
| `secondary_version` | Версия вторичной библиотеки, если установлена библиотека Columnar |
| `knn_version` | Версия библиотеки KNN, если установлена библиотека Columnar |
| `buddy_version`| Версия Manticore Buddy |

<!-- proofread -->
