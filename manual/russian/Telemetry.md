# Телеметрия

В Manticore мы собираем различные анонимные метрики для улучшения качества наших продуктов, включая Manticore Search. Анализируя эти данные, мы можем не только повысить общую производительность нашего продукта, но и определить, какие функции стоит приоритетно развивать, чтобы предоставить пользователям ещё большую ценность. Система телеметрии работает в отдельном потоке в неблокирующем режиме, делая снимки и отправляя их раз в несколько минут.

Мы серьёзно относимся к вашей конфиденциальности, и вы можете быть уверены, что все метрики полностью анонимны и никакая чувствительная информация не передаётся. Однако, если вы всё же хотите отключить телеметрию, у вас есть такая возможность:
* Установить переменную окружения `TELEMETRY=0`
* Или установить `telemetry = 0` в секции `searchd` вашего конфигурационного файла

Ниже приведён список всех собираемых метрик:

Символ ⏱️ указывает, что метрика собирается периодически, в отличие от других метрик, которые собираются на основе конкретных событий.

| Метрика | Описание |
|-|-|
| `invocation` | Отправляется при запуске Manticore Buddy |
| `plugin_*` | Указывает, что плагин с данным именем был выполнен, например, `plugin_backup` для выполнения резервного копирования |
| `command_*` | ⏱️ Все метрики с этим префиксом отправляются из запроса `show status` демона Manticore |
| `uptime` | ⏱️ Время работы демона Manticore Search |
| `workers_total` | ⏱️ Количество воркеров, используемых Manticore |
| `cluster_count` | ⏱️ Сколько кластеров обрабатывает этот узел |
| `cluster_size` | ⏱️ Сколько узлов во всех кластерах |
| `table_*_count` | ⏱️ Количество созданных таблиц каждого типа: plain, percolate, rt или distributed |
| `*_field_*_count` | ⏱️ Количество каждого типа полей для таблиц типов rt и percolate |
| `columnar` | ⏱️ Указывает, что использовалась библиотека Columnar |
| `columnar_field_count` | ⏱️ Количество полей, использующих библиотеку Columnar |

## Метрики резервного копирования

Инструмент резервного копирования Manticore по умолчанию отправляет анонимные метрики на сервер метрик Manticore для помощи в улучшении продукта. Если вы не хотите отправлять телеметрию, вы можете отключить её, запустив инструмент с флагом `--disable-metric` или установив переменную окружения `TELEMETRY=0`.

Ниже приведён список всех собираемых метрик:

| Метрика | Описание |
|-|-|
| `invocation` | Отправляется при запуске резервного копирования |
| `failed` | Отправляется в случае неудачного резервного копирования |
| `done` | Отправляется при успешном резервном копировании/восстановлении |
| `arg_*` | Аргументы, использованные для запуска инструмента (исключая имена индексов и т.п.) |
| `backup_store_versions_fails` | Указывает на ошибку сохранения версии Manticore в резервной копии |
| `backup_table_count` | Общее количество таблиц в резервной копии |
| `backup_no_permissions` | Ошибка резервного копирования из-за недостаточных прав на каталог назначения |
| `backup_total_size` | Общий размер полной резервной копии |
| `backup_time` | Продолжительность резервного копирования |
| `restore_searchd_running` | Ошибка запуска процесса восстановления из-за уже запущенного searchd |
| `restore_no_config_file` | Отсутствие конфигурационного файла в резервной копии при восстановлении |
| `restore_time` | Продолжительность восстановления |
| `fsync_time` | Продолжительность fsync |
| `restore_target_exists` | Возникает, если папка или индекс уже существует в каталоге назначения при восстановлении |
| `terminations` | Указывает, что процесс был завершён |
| `signal_*` | Сигнал, использованный для завершения процесса |
| `tables` | Количество таблиц в Manticore |
| `config_unreachable` | Указанный конфигурационный файл не существует |
| `config_data_dir_missing` | Не удалось распарсить `data_dir` из указанного конфигурационного файла |
| `config_data_dir_is_relative` | Путь `data_dir` в конфигурационном файле экземпляра Manticore является относительным |

## Метки

Каждая метрика сопровождается следующими метками:

| Метка | Описание |
|-|-|
| `collector` | `buddy`. Указывает, что метрика собрана через Manticore Buddy |
| `os_name` | Название операционной системы |
| `os_release_name` | Название из `/etc/os-release`, если присутствует, иначе `unknown` |
| `os_release_version` | Версия из `/etc/os-release`, если присутствует, иначе `unknown` |
| `dockerized` | Запущено ли в среде Docker |
| `official_docker` | В случае Docker — флаг, показывающий, что используется официальный образ |
| `machine_id` | Идентификатор сервера (содержимое `/etc/machine-id` в Linux) |
| `arch` | Архитектура машины, на которой запущено ПО |
| `manticore_version` | Версия Manticore |
| `columnar_version` | Версия библиотеки Columnar, если она установлена |
| `secondary_version` | Версия вторичной библиотеки, если установлена библиотека Columnar |
| `knn_version` | Версия библиотеки KNN, если установлена библиотека Columnar |
| `buddy_version`| Версия Manticore Buddy |

<!-- proofread -->

