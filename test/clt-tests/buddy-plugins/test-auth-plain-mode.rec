––– comment –––
Test Plain Mode bootstrap from auth.json.
Spec: https://github.com/manticoresoftware/manticoresearch/blob/wip_auth/src/auth/spec.md
Issue: https://github.com/manticoresoftware/manticoresearch/issues/2983

Per spec: In plain mode, auth data is bootstrapped from auth.json file
Format: {"users":[...], "permissions":[...]}
––– comment –––
––– block: ../base/start-searchd-with-auth –––
––– comment –––
––– 6.3.1 Bootstrap from auth.json –––
EXPECTED per spec: Admin user from auth.json is loaded
––– comment –––
––– input –––
MYSQL_PWD=adminpass mysql -E -uadmin -h0 -P9306 -e "SELECT COUNT(*) AS cnt FROM system.auth_users WHERE username='admin';"
––– output –––
*************************** 1. row ***************************
cnt: 1
––– input –––
MYSQL_PWD=adminpass mysql -E -uadmin -h0 -P9306 -e "SELECT COUNT(*) AS cnt FROM system.auth_permissions WHERE username='admin';"
––– output –––
*************************** 1. row ***************************
cnt: 6
––– comment –––
––– 6.3.2 JSON format matches specification –––
EXPECTED per spec: auth.json has users array and permissions array
––– comment –––
––– input –––
cat /var/lib/manticore/auth.json | python3 -c "import sys,json; d=json.load(sys.stdin); print('users' in d and 'permissions' in d)"
––– output –––
True
––– input –––
cat /var/lib/manticore/auth.json | python3 -c "import sys,json; d=json.load(sys.stdin); u=d['users'][0]; print('username' in u and 'salt' in u and 'hashes' in u)"
––– output –––
True
––– input –––
cat /var/lib/manticore/auth.json | python3 -c "import sys,json; d=json.load(sys.stdin); h=d['users'][0]['hashes']; print('password_sha1_no_salt' in h and 'password_sha256' in h)"
––– output –––
True
