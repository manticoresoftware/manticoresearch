––– block: ../base/start-searchd –––
––– input –––
apt-get install jq -y > /dev/null; echo $?
––– output –––
debconf: delaying package configuration, since apt-utils is not installed
0
––– input –––
mysql -h0 -P9306 -e "CREATE TABLE t (id INT, value TEXT, value_attr STRING) min_infix_len = '3' min_prefix_len = '3'; INSERT INTO t VALUES (1, 'example', 'example'), (2, 'test', 'test');"
––– output –––
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "SELECT * FROM t; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 1,
"value": "example",
"value_attr": "example"
},
{
"id": 2,
"value": "test",
"value_attr": "test"
}
],
"total": 2,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "2"
},
{
"Variable_name": "total_found",
"Value": "2"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "select * from t; show meta"; echo
––– output –––
[{
"columns":[{"id":{"type":"long long"}},{"value":{"type":"string"}},{"value_attr":{"type":"string"}}],
"data":[
{"id":1,"value":"example","value_attr":"example"},
{"id":2,"value":"test","value_attr":"test"}
],
"total":2,
"error":"",
"warning":""
},
{
"columns":[{"Variable_name":{"type":"string"}},{"Value":{"type":"string"}}],
"data":[
{"Variable_name":"total","Value":"2"},
{"Variable_name":"total_found","Value":"2"},
{"Variable_name":"total_relation","Value":"eq"},
{"Variable_name":"time","Value":"#!/[0-9]{1}.[0-9]{3}/!#"}
],
"total":4,
"error":"",
"warning":""
}]
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "select * from t; show meta"; echo
––– output –––
[{
"columns":[{"id":{"type":"long long"}},{"value":{"type":"string"}},{"value_attr":{"type":"string"}}],
"data":[
{"id":1,"value":"example","value_attr":"example"},
{"id":2,"value":"test","value_attr":"test"}
],
"total":2,
"error":"",
"warning":""
},
{
"columns":[{"Variable_name":{"type":"string"}},{"Value":{"type":"string"}}],
"data":[
{"Variable_name":"total","Value":"2"},
{"Variable_name":"total_found","Value":"2"},
{"Variable_name":"total_relation","Value":"eq"},
{"Variable_name":"time","Value":"#!/[0-9]{1}.[0-9]{3}/!#"}
],
"total":4,
"error":"",
"warning":""
}]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT value_attr, COUNT(*) FROM t GROUP BY value_attr; SHOW META" | awk '!/row.*in set/'; echo
––– output –––
[{
"columns":[{"value_attr":{"type":"string"}},{"count(*)":{"type":"long long"}}],
"data":[
{"value_attr":"example","count(*)":1},
{"value_attr":"test","count(*)":1}
],
"total":2,
"error":"",
"warning":""
},
{
"columns":[{"Variable_name":{"type":"string"}},{"Value":{"type":"string"}}],
"data":[
{"Variable_name":"total","Value":"2"},
{"Variable_name":"total_found","Value":"2"},
{"Variable_name":"total_relation","Value":"eq"},
{"Variable_name":"time","Value":"#!/[0-9]{1}.[0-9]{3}/!#"}
],
"total":4,
"error":"",
"warning":""
}]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "select * from t where match('example'); select * from t where match('test')" | awk '!/row.*in set/'; echo
––– output –––
[{
"columns":[{"id":{"type":"long long"}},{"value":{"type":"string"}},{"value_attr":{"type":"string"}}],
"data":[
{"id":1,"value":"example","value_attr":"example"}
],
"total":1,
"error":"",
"warning":""
},
{
"columns":[{"id":{"type":"long long"}},{"value":{"type":"string"}},{"value_attr":{"type":"string"}}],
"data":[
{"id":2,"value":"test","value_attr":"test"}
],
"total":1,
"error":"",
"warning":""
}]
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "select * from t where match('example'); select * from t where match('test')" | awk '!/row.*in set/'; echo
––– output –––
[{
"columns":[{"id":{"type":"long long"}},{"value":{"type":"string"}},{"value_attr":{"type":"string"}}],
"data":[
{"id":1,"value":"example","value_attr":"example"}
],
"total":1,
"error":"",
"warning":""
},
{
"columns":[{"id":{"type":"long long"}},{"value":{"type":"string"}},{"value_attr":{"type":"string"}}],
"data":[
{"id":2,"value":"test","value_attr":"test"}
],
"total":1,
"error":"",
"warning":""
}]
––– input –––
curl -s "http://localhost:9308/cli" -d "SELECT * FROM t; SHOW META" | awk '!/row.*in set/'; echo
––– output –––
+----+---------+------------+
| id | value   | value_attr |
+----+---------+------------+
| 1  | example | example    |
| 2  | test    | test       |
+----+---------+------------+
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "SELECT value_attr, COUNT(*) FROM t GROUP BY value_attr; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"value_attr": {
"type": "string"
}
},
{
"count(*)": {
"type": "long long"
}
}
],
"data": [
{
"value_attr": "example",
"count(*)": 1
},
{
"value_attr": "test",
"count(*)": 1
}
],
"total": 2,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "2"
},
{
"Variable_name": "total_found",
"Value": "2"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT value_attr, COUNT(*) FROM t GROUP BY value_attr; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"value_attr": {
"type": "string"
}
},
{
"count(*)": {
"type": "long long"
}
}
],
"data": [
{
"value_attr": "example",
"count(*)": 1
},
{
"value_attr": "test",
"count(*)": 1
}
],
"total": 2,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "2"
},
{
"Variable_name": "total_found",
"Value": "2"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT * FROM t WHERE MATCH('example'); SELECT * FROM t WHERE MATCH('test'); SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 1,
"value": "example",
"value_attr": "example"
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 2,
"value": "test",
"value_attr": "test"
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "1"
},
{
"Variable_name": "total_found",
"Value": "1"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
},
{
"Variable_name": "keyword[0]",
"Value": "test"
},
{
"Variable_name": "docs[0]",
"Value": "1"
},
{
"Variable_name": "hits[0]",
"Value": "1"
}
],
"total": 7,
"error": "",
"warning": ""
}
]
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "SELECT * FROM t WHERE MATCH('example'); SELECT * FROM t WHERE MATCH('test'); SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 1,
"value": "example",
"value_attr": "example"
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 2,
"value": "test",
"value_attr": "test"
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "1"
},
{
"Variable_name": "total_found",
"Value": "1"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
},
{
"Variable_name": "keyword[0]",
"Value": "test"
},
{
"Variable_name": "docs[0]",
"Value": "1"
},
{
"Variable_name": "hits[0]",
"Value": "1"
}
],
"total": 7,
"error": "",
"warning": ""
}
]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT * FROM t ORDER BY id DESC LIMIT 1; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 2,
"value": "test",
"value_attr": "test"
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "1"
},
{
"Variable_name": "total_found",
"Value": "2"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "SELECT * FROM t ORDER BY id DESC LIMIT 1; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 2,
"value": "test",
"value_attr": "test"
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "1"
},
{
"Variable_name": "total_found",
"Value": "2"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT AVG(id) FROM t; SELECT COUNT(*) FROM t; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"avg(id)": {
"type": "double"
}
}
],
"data": [
{
"avg(id)": 1.5
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"count(*)": {
"type": "long long"
}
}
],
"data": [
{
"count(*)": 2
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "1"
},
{
"Variable_name": "total_found",
"Value": "1"
},
{
"Variable_name": "total_relation",
"Value": "gte"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "SELECT AVG(id) FROM t; SELECT COUNT(*) FROM t; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"avg(id)": {
"type": "double"
}
}
],
"data": [
{
"avg(id)": 1.5
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"count(*)": {
"type": "long long"
}
}
],
"data": [
{
"count(*)": 2
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "1"
},
{
"Variable_name": "total_found",
"Value": "1"
},
{
"Variable_name": "total_relation",
"Value": "gte"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
mysql -h0 -P9306 -e "CREATE TABLE empty_table (id INT, value TEXT);"
––– output –––
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT * FROM empty_table; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
}
],
"data": [],
"total": 0,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "0"
},
{
"Variable_name": "total_found",
"Value": "0"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "SELECT * FROM empty_table; SHOW META" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
}
],
"data": [],
"total": 0,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "0"
},
{
"Variable_name": "total_found",
"Value": "0"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
}
]
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT * FROM t; SHOW META; SELECT COUNT(*) FROM t; SELECT AVG(id) FROM t; SELECT * FROM t WHERE MATCH('example'); SELECT * FROM t WHERE MATCH('test')" | jq .
––– output –––
[
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 1,
"value": "example",
"value_attr": "example"
},
{
"id": 2,
"value": "test",
"value_attr": "test"
}
],
"total": 2,
"error": "",
"warning": ""
},
{
"columns": [
{
"Variable_name": {
"type": "string"
}
},
{
"Value": {
"type": "string"
}
}
],
"data": [
{
"Variable_name": "total",
"Value": "2"
},
{
"Variable_name": "total_found",
"Value": "2"
},
{
"Variable_name": "total_relation",
"Value": "eq"
},
{
"Variable_name": "time",
"Value": "#!/[0-9]{1}.[0-9]{3}/!#"
}
],
"total": 4,
"error": "",
"warning": ""
},
{
"columns": [
{
"count(*)": {
"type": "long long"
}
}
],
"data": [
{
"count(*)": 2
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"avg(id)": {
"type": "double"
}
}
],
"data": [
{
"avg(id)": 1.5
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 1,
"value": "example",
"value_attr": "example"
}
],
"total": 1,
"error": "",
"warning": ""
},
{
"columns": [
{
"id": {
"type": "long long"
}
},
{
"value": {
"type": "string"
}
},
{
"value_attr": {
"type": "string"
}
}
],
"data": [
{
"id": 2,
"value": "test",
"value_attr": "test"
}
],
"total": 1,
"error": "",
"warning": ""
}
]
––– input –––
curl -s -X POST "http://localhost:9308/sql" -d "SELECT * FROM t; SELECT * FROM t WHERE MATCH('example')"; echo
––– output –––
{"error":"only FACET multiple queries supported"}
––– input –––
curl -s -X POST "http://localhost:9308/sql" -d "FACET value_attr; FACET id"; echo
––– output –––
{"error":"P02: syntax error, unexpected identifier near 'FACET value_attr; FACET id'"}
––– input –––
curl -s "http://localhost:9308/cli_json" -d "select * from t; select * from nonexistent_table" | awk '!/row.*in set/'; echo
––– output –––
{"error":"unknown local table(s) 'nonexistent_table' in search request"}
––– input –––
curl -s "http://localhost:9308/cli_json" -d "select * from nonexistent_table; select * from t;" | awk '!/row.*in set/'; echo
––– output –––
{"error":"unknown local table(s) 'nonexistent_table' in search request"}
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "select * from t; select * from nonexistent_table" | awk '!/row.*in set/'; echo
––– output –––
{"error":"unknown local table(s) 'nonexistent_table' in search request"}
––– input –––
curl -s "http://localhost:9308/cli_json" -d "SELECT * FROM nonexistent_table; SELECT * FROM t" | awk '!/row.*in set/'; echo
––– output –––
{"error":"unknown local table(s) 'nonexistent_table' in search request"}
