––– block: ../base/start-searchd-with-buddy –––
––– input –––
mysql -h0 -P9306 -e "CREATE TABLE t (id INT, value TEXT, value_attr STRING) min_infix_len = '3' min_prefix_len = '3'; INSERT INTO t VALUES (1, 'example', 'example'), (2, 'test', 'test');"
––– output –––
––– comment –––
Test multi-queries on different HTTP endpoints according to documentation
––– input –––
curl -s "http://localhost:9308/cli?show%20version;show%20queries" | grep -v 'rows affected'
––– output –––
––– input –––
curl -s "http://localhost:9308/cli?select%20*%20from%20t%20limit%201;show%20meta"
––– output –––
––– input –––
curl -s "http://localhost:9308/cli?show%20full%20tables;show%20fields%20from%20t" | grep -v 'rows affected'
––– output –––
{"error":"You have an error in your query. Please, double-check it."}
––– comment –––
BUG: Multi-queries on /cli_json should work according to documentation (HTTP keep-alive support)
––– input –––
curl -s "http://localhost:9308/cli_json?select%20*%20from%20t%20limit%201;show%20version"
––– output –––
[{"total":1,"error":"","warning":"","columns":[{"id":{"type":"bigint"}},{"value":{"type":"text"}},{"value_attr":{"type":"string"}}],"data":[{"id":1,"value":"example","value_attr":"example"}]},{"total":6,"error":"","warning":"","columns":[{"Component":{"type":"string"}},{"Version":{"type":"string"}}],"data":[{"Component":"Daemon","Version":"%{VERSION}"},{"Component":"Columnar","Version":"columnar %{VERSION}"},{"Component":"Secondary","Version":"secondary %{VERSION}"},{"Component":"Knn","Version":"knn %{VERSION}"},{"Component":"Embeddings","Version":"embeddings %{VERSION}"},{"Component":"Buddy","Version":"buddy %{VERSION}"}]}]
––– comment –––
BUG: Multi-queries on /cli_json should work according to documentation (HTTP keep-alive support)
––– input –––
curl -s "http://localhost:9308/cli_json?show%20buddy%20plugins;show%20full%20tables" | head -c 500
––– output –––
[{"total":27,"error":"","warning":"","columns":[{"Package":{"type":"string"}},{"Plugin":{"type":"string"}},{"Version":{"type":"string"}},{"Type":{"type":"string"}},{"Info":{"type":"string"}}],"data":[{"Package":"manticoresoftware/buddy-plugin-empty-string","Plugin":"empty-string","Version":"%{VERSION}","Type":"core","Info":"Handles empty queries, which can occur when trimming comments or dealing with specific SQL protocol instructions in comments that are not supported"},{"Package":"manticoresoftware/buddy-plugin-backup","Plugin":"backup","Vers
––– comment –––
BUG: Multi-queries on /cli_json should work according to documentation (HTTP keep-alive support)
––– input –––
curl -s "http://localhost:9308/cli_json?select%20*%20from%20t%20where%20match('exmaple')%20option%20fuzzy=1;show%20meta"
––– output –––
[{"total":1,"error":"","warning":"","columns":[{"id":{"type":"long long"}},{"value":{"type":"string"}},{"value_attr":{"type":"string"}}],"data":[{"id":1,"value":"example","value_attr":"example"}]},{"total":4,"error":"","warning":"","columns":[{"Variable_name":{"type":"string"}},{"Value":{"type":"string"}}],"data":[{"Variable_name":"total","Value":"1"},{"Variable_name":"total_found","Value":"1"},{"Variable_name":"total_relation","Value":"gte"},{"Variable_name":"time","Value":"0.000"}]}]
––– comment –––
Multi-queries on /sql are not documented as supported
––– input –––
curl -s -X POST "http://localhost:9308/sql" -d "select * from t limit 1;show version"
––– output –––
{"error":"P01: syntax error, unexpected identifier, expecting VARIABLES near 'version'"}
––– input –––
curl -s -X POST "http://localhost:9308/sql" -d "show buddy plugins;select * from t where match('test')"
––– output –––
{"error":"P01: syntax error, unexpected identifier, expecting VARIABLES near 'buddy plugins;select * from t where match('test')'"}
––– comment –––
BUG: Multi-queries on /sql?mode=raw should work according to documentation and return raw format
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "select * from t limit 1;show meta"
––– output –––
––– comment –––
BUG: Multi-queries on /sql?mode=raw should work according to documentation and return raw format
––– input –––
curl -s -X POST "http://localhost:9308/sql?mode=raw" -d "show version;select count(*) from t"
––– output –––
Component	Version
Daemon	%{VERSION}
Columnar	columnar %{VERSION}
Secondary	secondary %{VERSION}
Knn	knn %{VERSION}
Embeddings	embeddings %{VERSION}
Buddy	buddy %{VERSION}
count(*)
2
