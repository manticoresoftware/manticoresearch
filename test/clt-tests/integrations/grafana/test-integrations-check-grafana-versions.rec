â€“â€“â€“ block: ../../base/start-searchd-with-buddy â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
set -b
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
export PATH=/usr/bin:/usr/local/bin:/usr/sbin:/sbin:/bin
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
apt-get update > /dev/null 2>&1 && apt-get install -y curl jq > /dev/null 2>&1; echo $?
â€“â€“â€“ output â€“â€“â€“
0
â€“â€“â€“ input â€“â€“â€“
bash << 'SCRIPT'
# Static list of TESTED versions
TESTED_VERSIONS="10.0
10.1
10.2
10.3
10.4
11.0
11.1
11.2
11.3
12.0
12.1
12.2"

# Check for NEW versions (after latest tested)
# WARNING: Also update GRAFANA_LATEST below when changing this!
LATEST_TESTED_VERSION="12.2"
NEW_VERSIONS=$(curl -s "https://hub.docker.com/v2/repositories/grafana/grafana/tags/?page_size=100" \
| jq -r ".results[].name" \
| grep "^[0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*$" \
| sed "s/\.[0-9]*$//" \
| awk '!/rc|beta|alpha/' \
| sort -t. -k1,1n -k2,2n | uniq \
| awk -v latest="$LATEST_TESTED_VERSION" '
function version_compare(v1, v2) {
    split(v1, a, ".")
    split(v2, b, ".")
    if (a[1] != b[1]) return a[1] - b[1]
    return a[2] - b[2]
}
version_compare($0, latest) > 0')

if [ -n "$NEW_VERSIONS" ]; then
    echo "ğŸ†• NEW Grafana versions detected: $NEW_VERSIONS"
    echo ""
    echo "ğŸ“ Update required:"
    echo "  1. test-integrations-check-grafana-versions.rec - Update TESTED_VERSIONS and LATEST_TESTED_VERSION"
    echo "  2. test-integrations-test-grafana-versions.rec - Add test for new version"
    echo "  3. manual/english/Changelog.md - Add release note"
    echo "  4. site repo: blog/manticoresearch-grafana-integration/index.md"
    echo ""
    exit 1
else
    echo "âœ… No new versions found after $LATEST_TESTED_VERSION"
fi

# Use static list for testing
echo "Using tested versions:"
echo "$TESTED_VERSIONS"
SCRIPT
â€“â€“â€“ output â€“â€“â€“
âœ… No new versions found after 12.2
Using tested versions:
10.0
10.1
10.2
10.3
10.4
11.0
11.1
11.2
11.3
12.0
12.1
12.2
â€“â€“â€“ input â€“â€“â€“
bash << 'SCRIPT'
# Check blog post for Grafana version
echo "Checking Grafana version in blog post..."
echo ""

# Must match LATEST_TESTED_VERSION above
GRAFANA_LATEST="12.2"

echo "=== Checking website blog post ==="
BLOG_URL="https://manticoresearch.com/blog/manticoresearch-grafana-integration/"
echo "âœ“ Fetching $BLOG_URL"

BLOG_CONTENT=$(curl -s "$BLOG_URL")

if [ -z "$BLOG_CONTENT" ]; then
    echo "âš ï¸  WARNING: Blog fetch failed - skipping" >&2
elif echo "$BLOG_CONTENT" | grep -q "Grafana versions.*${GRAFANA_LATEST}"; then
    FOUND_FORMAT=$(echo "$BLOG_CONTENT" | grep -o "Grafana versions [0-9.-]*${GRAFANA_LATEST}" | head -1)
    echo "âœ… Blog: $FOUND_FORMAT"
else
    BLOG_VERSION=$(echo "$BLOG_CONTENT" | grep -o "Grafana versions [0-9.-]*" | head -1)
    echo "âš ï¸  WARNING: Blog does NOT contain ${GRAFANA_LATEST}" >&2
    echo "   Found: $BLOG_VERSION" >&2
    echo "   Expected: Grafana versions 10.0-${GRAFANA_LATEST}" >&2
fi
SCRIPT
â€“â€“â€“ output â€“â€“â€“
Checking Grafana version in blog post...
=== Checking website blog post ===
âœ“ Fetching https://manticoresearch.com/blog/manticoresearch-grafana-integration/
âœ… Blog: Grafana versions 10.0-12.2
