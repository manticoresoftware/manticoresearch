––– block: ../../base/dind/init –––
––– input –––
docker network create app-network --driver bridge > /dev/null; echo $?
––– output –––
0
––– input –––
docker run -it --network=app-network --platform linux/amd64 --name manticore -d ghcr.io/manticoresoftware/manticoresearch:test-kit-latest bash > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
docker exec manticore sed -i '/data_dir = \/var\/lib\/manticore/a\    buddy_path = manticore-executor -n /usr/share/manticore/modules/manticore-buddy/src/main.php --debugvv\n' /etc/manticoresearch/manticore.conf
––– output –––
––– input –––
docker exec manticore stdbuf -oL searchd
––– output –––
Manticore %{VERSION} (columnar %{VERSION}) (secondary %{VERSION}) (knn %{VERSION})
Copyright (c) 2001-2016, Andrew Aksyonoff
Copyright (c) 2008-2016, Sphinx Technologies Inc (http://sphinxsearch.com)
Copyright (c) 2017-%{YEAR}, Manticore Software LTD (https://manticoresearch.com)
[#!/[a-zA-Z]{3}\s[a-zA-Z]{3}\s+[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] using config file '/etc/manticoresearch/manticore.conf' (%{NUMBER} chars)...
starting daemon version '%{VERSION} (columnar %{VERSION}) (secondary %{VERSION}) (knn %{VERSION})' ...
listening on %{IPADDR}:9312 for sphinx and http(s)
listening on %{IPADDR}:9306 for mysql
listening on %{IPADDR}:9308 for sphinx and http(s)
––– input –––
docker run -it -d --network=app-network --name kafka -e KAFKA_CFG_NODE_ID=0 -e KAFKA_CFG_PROCESS_ROLES=controller,broker -e KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka:9093 -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093 -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://:9092 -e KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT -e KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER -e KAFKA_CFG_INTER_BROKER_LISTENER_NAME=PLAINTEXT bitnami/kafka:3.7.0 > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
docker exec kafka kafka-topics.sh --create --topic my-data --partitions 2 --bootstrap-server localhost:9092 2>&1 | grep -o 'Created topic my-data\.' | head -n 1
––– output –––
Created topic my-data.
––– input –––
docker exec kafka kafka-topics.sh --describe --topic my-data --bootstrap-server localhost:9092
––– output –––
Topic: my-data	TopicId: %{UUID}	PartitionCount: 2	ReplicationFactor: 1	Configs:
	Topic: my-data	Partition: 0	Leader: 0	Replicas: 0	Isr: 0
	Topic: my-data	Partition: 1	Leader: 0	Replicas: 0	Isr: 0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "CREATE SOURCE kafka_p1 (id bigint, term text, isActive bool, acronym text, abbrev text, GlossDef json) type='kafka' broker_list='kafka:9092' topic_list='my-data' consumer_group='manticore' num_consumers='1' partition_list='0' batch=50;"; echo $?
––– output –––
0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "CREATE SOURCE kafka_p2 (id bigint, term text, isActive bool, acronym text, abbrev text, GlossDef json) type='kafka' broker_list='kafka:9092' topic_list='my-data' consumer_group='manticore' num_consumers='1' partition_list='1' batch=50;"; echo $?
––– output –––
0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "CREATE TABLE destination_shard_1 (id bigint, name text, active bool, short_name text, received_at text, size multi);"; echo $?
––– output –––
0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "CREATE TABLE destination_shard_2 (id bigint, name text, active bool, short_name text, received_at text, size multi);"; echo $?
––– output –––
0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "CREATE MATERIALIZED VIEW mv_1 TO destination_shard_1 AS SELECT id, term AS name, isActive AS active, acronym AS short_name, UTC_TIMESTAMP() AS received_at, GlossDef.size AS size FROM kafka_p1;"; echo $?
––– output –––
0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "CREATE MATERIALIZED VIEW mv_2 TO destination_shard_2 AS SELECT id, term AS name, isActive AS active, acronym AS short_name, UTC_TIMESTAMP() AS received_at, GlossDef.size AS size FROM kafka_p2;"; echo $?
––– output –––
0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SHOW SOURCES;"
––– output –––
+----------+
| name     |
+----------+
| kafka_p1 |
| kafka_p2 |
+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SHOW MVS;"
––– output –––
+------+
| name |
+------+
| mv_1 |
| mv_2 |
+------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SHOW SOURCE kafka_p1;"
––– output –––
+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
| Source   | Create Table                                                                                                                                        |
+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
| kafka_p1 | CREATE SOURCE kafka_p1
(id bigint, term text, isActive bool, acronym text, abbrev text, GlossDef json)
type='kafka'
broker_list='kafka:9092'
topic_list='my-data'
consumer_group='manticore'
num_consumers='1'
partition_list='0'
 batch=50 |
+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SHOW SOURCE kafka_p2;"
––– output –––
+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
| Source   | Create Table                                                                                                                                        |
+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
| kafka_p2 | CREATE SOURCE kafka_p2
(id bigint, term text, isActive bool, acronym text, abbrev text, GlossDef json)
type='kafka'
broker_list='kafka:9092'
topic_list='my-data'
consumer_group='manticore'
num_consumers='1'
partition_list='1'
 batch=50 |
+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
––– input –––
docker exec kafka bash -c 'cat > /tmp/dump.json << '"'"'EOF'"'"'
1:{"id": 1, "isActive": true, "term": "The Quick Brown Fox", "acronym": "TQBF", "abbrev": "ISO 12345:6789", "GlossDef": {"para": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "size": [20, 25, 30]}}
2:{"id": 2, "isActive": false, "term": "Jumped Over The Lazy Dog", "acronym": "JOTLD", "abbrev": "ISO 98765:4321", "GlossDef": {"para": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "size": [20, 25, 30]}}
3:{"id": 3, "isActive": true, "term": "A Stitch In Time Saves Nine", "acronym": "ASITSN", "abbrev": "ISO 24680:1357", "GlossDef": {"para": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "size": [20, 25, 30]}}
4:{"id": 4, "isActive": false, "term": "An Apple A Day Keeps The Doctor Away", "acronym": "AADKTDA", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "size": [20, 25, 30]}}
5:{"id": 5, "isActive": true, "term": "Actions Speak Louder Than Words", "acronym": "ASTWTW", "abbrev": "ISO 56789:12345", "GlossDef": {"para": "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "size": [20, 25, 30]}}
6:{"id": 6, "isActive": false, "term": "Every Cloud Has A Silver Lining", "acronym": "ECHAASL", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit.", "size": [20, 25, 30]}}
7:{"id": 7, "isActive": true, "term": "Beauty Is In The Eye Of The Beholder", "acronym": "BIITEOTB", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit.", "size": [20, 25, 30]}}
8:{"id": 8, "isActive": false, "term": "Birds Of A Feather Flock Together", "acronym": "BOAFFT", "abbrev": "ISO 97531:24680", "GlossDef": {"para": "At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident.", "size": [20, 25, 30]}}
9:{"id": 9, "isActive": true, "term": "You Can'"'"'t Judge A Book By Its Cover", "acronym": "YCJABBICT", "abbrev": "ISO 56789:86420", "GlossDef": {"para": "Similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga.", "size": [20, 25, 30]}}
10:{"id": 10, "isActive": false, "term": "Two Heads Are Better Than One", "acronym": "THABTO", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Et harum quidem rerum facilis est et expedita distinctio.", "size": [20, 25, 30]}}
11:{"id": 11, "isActive": true, "term": "The Early Bird Catches The Worm", "acronym": "TEBCTW", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "size": [20, 25, 30]}}
12:{"id": 12, "isActive": false, "term": "All That Glitters Is Not Gold", "acronym": "ATGING", "abbrev": "ISO 24680:1357", "GlossDef": {"para": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "size": [20, 2, 3]}}
13:{"id": 13, "isActive": true, "term": "A Penny For Your Thoughts", "acronym": "APFYT", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "size": [20, 25, 30]}}
14:{"id": 14, "isActive": false, "term": "Bite The Bullet", "acronym": "BTB", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "size": [20, 25, 30]}}
15:{"id": 15, "isActive": true, "term": "Break A Leg", "acronym": "BAL", "abbrev": "ISO 56789:12345", "GlossDef": {"para": "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "size": [20, 25, 30]}}
16:{"id": 16, "isActive": false, "term": "A Picture Is Worth A Thousand Words", "acronym": "APIWATW", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit.", "size": [20, 25, 30]}}
17:{"id": 17, "isActive": true, "term": "Curiosity Killed The Cat", "acronym": "CKTC", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit.", "size": [20, 25, 30]}}
18:{"id": 18, "isActive": false, "term": "Don'"'"'t Count Your Chickens Before They Hatch", "acronym": "DCYCBTTH", "abbrev": "ISO 97531:24680", "GlossDef": {"para": "At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident.", "size": [20, 25, 30]}}
19:{"id": 19, "isActive": true, "term": "Every Dog Has His Day", "acronym": "EDHHD", "abbrev": "ISO 56789:86420", "GlossDef": {"para": "Similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga.", "size": [20, 25, 30]}}
20:{"id": 20, "isActive": false, "term": "Haste Makes Waste", "acronym": "HMW", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Et harum quidem rerum facilis est et expedita distinctio.", "size": [20, 25, 30]}}
21:{"id": 21, "isActive": true, "term": "Ignorance Is Bliss", "acronym": "IIB", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "size": [20, 25, 30]}}
22:{"id": 22, "isActive": false, "term": "The Best Things In Life Are Free", "acronym": "TBTILAF", "abbrev": "ISO 24680:1357", "GlossDef": {"para": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "size": [20, 25, 30]}}
23:{"id": 23, "isActive": true, "term": "Money Doesn'"'"'t Grow On Trees", "acronym": "MDGOT", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "size": [20, 25, 30]}}
24:{"id": 24, "isActive": false, "term": "No Pain, No Gain", "acronym": "NPNJG", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "size": [20, 25, 30]}}
25:{"id": 25, "isActive": true, "term": "When In Rome, Do As The Romans Do", "acronym": "WIRDAATRD", "abbrev": "ISO 56789:12345", "GlossDef": {"para": "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "size": [20, 25, 30]}}
26:{"id": 26, "isActive": false, "term": "Better Late Than Never", "acronym": "BLTN", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit.", "size": [20, 25, 30]}}
27:{"id": 27, "isActive": true, "term": "All'"'"'s Well That Ends Well", "acronym": "AWTEW", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit.", "size": [20, 25, 30]}}
28:{"id": 28, "isActive": false, "term": "Cutting Corners", "acronym": "CC", "abbrev": "ISO 97531:24680", "GlossDef": {"para": "At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident.", "size": [20, 25, 30]}}
29:{"id": 29, "isActive": true, "term": "Barking Up The Wrong Tree", "acronym": "BUTWT", "abbrev": "ISO 56789:86420", "GlossDef": {"para": "Similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga.", "size": [20, 25, 30]}}
30:{"id": 30, "isActive": false, "term": "Rome Wasn'"'"'t Built In A Day", "acronym": "RWBIAD", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Et harum quidem rerum facilis est et expedita distinctio.", "size": [20, 25, 30]}}
31:{"id": 31, "isActive": true, "term": "Don'"'"'t Put All Your Eggs In One Basket", "acronym": "DPAYEIOB", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "size": [20, 25, 30]}}
32:{"id": 32, "isActive": false, "term": "A Bird In The Hand Is Worth Two In The Bush", "acronym": "ABITHIWTITB", "abbrev": "ISO 24680:1357", "GlossDef": {"para": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "size": [20, 25, 30]}}
33:{"id": 33, "isActive": true, "term": "The Grass Is Always Greener On The Other Side", "acronym": "TGIAGOOTOS", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "size": [20, 25, 30]}}
34:{"id": 34, "isActive": false, "term": "Every Rose Has Its Thorn", "acronym": "ERHIIT", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "size": [20, 25, 30]}}
35:{"id": 35, "isActive": true, "term": "All That Glitters Is Not Gold", "acronym": "ATGING", "abbrev": "ISO 56789:12345", "GlossDef": {"para": "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "size": [20, 25, 30]}}
36:{"id": 36, "isActive": false, "term": "A Penny For Your Thoughts", "acronym": "APFYT", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit.", "size": [20, 25, 30]}}
37:{"id": 37, "isActive": true, "term": "Bite The Bullet", "acronym": "BTB", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit.", "size": [20, 25, 30]}}
38:{"id": 38, "isActive": false, "term": "Break A Leg", "acronym": "BAL", "abbrev": "ISO 56789:12345", "GlossDef": {"para": "Similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga.", "size": [20, 25, 30]}}
39:{"id": 39, "isActive": true, "term": "A Picture Is Worth A Thousand Words", "acronym": "APIWATW", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident.", "size": [20, 25, 30]}}
40:{"id": 40, "isActive": false, "term": "Curiosity Killed The Cat", "acronym": "CKTC", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "size": [20, 25, 30]}}
41:{"id": 41, "isActive": true, "term": "Don'"'"'t Count Your Chickens Before They Hatch", "acronym": "DCYCBTTH", "abbrev": "ISO 97531:24680", "GlossDef": {"para": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "size": [20, 25, 30]}}
42:{"id": 42, "isActive": false, "term": "Every Dog Has His Day", "acronym": "EDHHD", "abbrev": "ISO 56789:86420", "GlossDef": {"para": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "size": [20, 25, 30]}}
43:{"id": 43, "isActive": true, "term": "Haste Makes Waste", "acronym": "HMW", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "size": [20, 25, 30]}}
44:{"id": 44, "isActive": false, "term": "Ignorance Is Bliss", "acronym": "IIB", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit.", "size": [20, 25, 30]}}
45:{"id": 45, "isActive": true,"term": "The Best Things In Life Are Free", "acronym": "TB'"'"'TILAF", "abbrev": "ISO 24680:1357", "GlossDef": {"para": "Excepteur sint occa'"'"'ecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "size": [20, 25, 30]}}
46:{"id": 46, "isActive": false, "term": "Money Doesn'"'"'t Grow On \"Trees", "acronym": "MD\"GOT", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "size": [20, 25, 30]}}
47:{"id": 47, "isActive": true, "term": "No Pain, No \\Gain", "acronym": "NP\\NJG", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "size": [20, 25, 30]}}
48:{"id": 48, "isActive": false, "term": "When In Rome, Do As The Romans Do", "acronym": "WIRDAATRD", "abbrev": "ISO 56789:12345", "GlossDef": {"para": "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", "size": [20, 25, 30]}}
49:{"id": 49, "isActive": true, "term": "Better Late Than Never", "acronym": "BLTN", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit.", "size": [20, 25, 30]}}
50:{"id": 50, "isActive": false, "term": "All'"'"'s Well That Ends Well", "acronym": "AWTEW", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit.", "size": [20, 25, 30]}}
51:{"id": 51, "isActive": true, "term": "Cutting Corners", "acronym": "CC", "abbrev": "ISO 97531:24680", "GlossDef": {"para": "At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident.", "size": [20, 25, 30]}}
52:{"id": 52, "isActive": false, "term": "Barking Up The Wrong Tree", "acronym": "BUTWT", "abbrev": "ISO 56789:86420", "GlossDef": {"para": "Similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga.", "size": [20, 25, 30]}}
53:{"id": 53, "isActive": true, "term": "Rome Wasn'"'"'t Built In A Day", "acronym": "RWBIAD", "abbrev": "ISO 86420:97531", "GlossDef": {"para": "Et harum quidem rerum facilis est et expedita distinctio.", "size": [20, 25, 30]}}
54:{"id": 54, "isActive": false, "term": "Don'"'"'t Put All Your Eggs In One Basket", "acronym": "DPAYEIOB", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "size": [20, 25, 30]}}
55:{"id": 55, "isActive": true, "term": "A Bird In The Hand Is Worth Two In The Bush", "acronym": "ABITHIWTITB", "abbrev": "ISO 24680:1357", "GlossDef": {"para": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", "size": [20, 25, 30]}}
56:{"id": 56, "isActive": false, "term": "The Grass Is Always Greener On The Other Side", "acronym": "TGIAGOOTOS", "abbrev": "ISO 97531:86420", "GlossDef": {"para": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.", "size": [20, 25, 30]}}
57:{"id": 57, "isActive": true, "acronym": "ERHIIT", "abbrev": "ISO 13579:86420", "GlossDef": {"para": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.", "size": [20, 25, 30]}}
EOF'; echo $?
––– output –––
0
––– input –––
docker exec kafka bash -c 'cat > /import.sh << '"'"'EOF'"'"'
#!/bin/bash
bootstrap_servers="localhost:9092"
kafka_topic="my-data"
json_file_path="/tmp/dump.json"

echo "Starting Kafka import with key-value pairs..."

/opt/bitnami/kafka/bin/kafka-console-producer.sh \
  --broker-list "$bootstrap_servers" \
  --property parse.key=true \
  --property "key.separator=:" \
  --topic "$kafka_topic" < "$json_file_path"

echo "Import completed!"
kafka-topics.sh --bootstrap-server "$bootstrap_servers" --describe --topic "$kafka_topic"
EOF'; echo $?
––– output –––
0
––– input –––
docker exec kafka chmod +x /import.sh; docker exec kafka /import.sh; echo $?
––– output –––
0
––– input –––
timeout 60 bash -c 'docker exec manticore bash -c "tail -f /var/log/manticore/searchd.log" | grep -m2 "REPLACE%20INTO%20destination_shard" > /dev/null && echo "Data processing completed."' || echo "Data processing failed."
––– output –––
Data processing completed.
––– input –––
docker exec kafka kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group manticore
––– output –––
GROUP     TOPIC   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG  CONSUMER-ID                                           HOST            CLIENT-ID
manticore my-data 0          29              29              0    manticore-0-ea7e1a3e-bd9f-4c3d-8f2b-1a2b3c4d5e6f  /172.18.0.3     manticore-0
manticore my-data 1          28              28              0    manticore-1-fa8f2b4f-ce0g-5d4e-9g3c-2b3c4d5e6f7g  /172.18.0.3     manticore-1
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM destination_shard_1;"
––– output –––
+----------+
| count(*) |
+----------+
|       29 |
+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM destination_shard_2;"
––– output –––
+----------+
| count(*) |
+----------+
|       28 |
+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT 'Total records' as metric, (SELECT COUNT(*) FROM destination_shard_1) + (SELECT COUNT(*) FROM destination_shard_2) as count;"
––– output –––
+---------------+-------+
| metric        | count |
+---------------+-------+
| Total records |    57 |
+---------------+-------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT 'Partition 0 sample' as source, id, name, active, short_name, size FROM destination_shard_1 ORDER BY id LIMIT 5;"
––– output –––
+-------------------+------+---------------------------------------------+--------+------------+----------+
| source            | id   | name                                        | active | short_name | size     |
+-------------------+------+---------------------------------------------+--------+------------+----------+
| Partition 0 sample|    2 | Jumped Over The Lazy Dog                    |      0 | JOTLD      | 20,25,30 |
| Partition 0 sample|    4 | An Apple A Day Keeps The Doctor Away       |      0 | AADKTDA    | 20,25,30 |
| Partition 0 sample|    6 | Every Cloud Has A Silver Lining            |      0 | ECHAASL    | 20,25,30 |
| Partition 0 sample|    8 | Birds Of A Feather Flock Together          |      0 | BOAFFT     | 20,25,30 |
| Partition 0 sample|   10 | Two Heads Are Better Than One              |      0 | THABTO     | 20,25,30 |
+-------------------+------+---------------------------------------------+--------+------------+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT 'Partition 1 sample' as source, id, name, active, short_name, size FROM destination_shard_2 ORDER BY id LIMIT 5;"
––– output –––
+-------------------+------+---------------------------------------------+--------+-------------+----------+
| source            | id   | name                                        | active | short_name  | size     |
+-------------------+------+---------------------------------------------+--------+-------------+----------+
| Partition 1 sample|    1 | The Quick Brown Fox                         |      1 | TQBF        | 20,25,30 |
| Partition 1 sample|    3 | A Stitch In Time Saves Nine                |      1 | ASITSN      | 20,25,30 |
| Partition 1 sample|    5 | Actions Speak Louder Than Words             |      1 | ASTWTW      | 20,25,30 |
| Partition 1 sample|    7 | Beauty Is In The Eye Of The Beholder       |      1 | BIITEOTB    | 20,25,30 |
| Partition 1 sample|    9 | You Can't Judge A Book By Its Cover         |      1 | YCJABBICT   | 20,25,30 |
+-------------------+------+---------------------------------------------+--------+-------------+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "ALTER MATERIALIZED VIEW mv_1 suspended=1;"; echo $?
––– output –––
0
––– input –––
docker exec kafka /import.sh; echo $?
––– output –––
0
––– input –––
timeout 60 bash -c 'docker exec manticore bash -c "tail -f /var/log/manticore/searchd.log" | grep -m1 "REPLACE%20INTO%20destination_shard_2" > /dev/null && echo "Data processing completed."' || echo "Data processing failed."
––– output –––
Data processing completed.
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM destination_shard_1;"
––– output –––
+----------+
| count(*) |
+----------+
|       29 |
+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM destination_shard_2;"
––– output –––
+----------+
| count(*) |
+----------+
|       56 |
+----------+
# Resume first materialized view
––– input –––
docker exec manticore mysql -h0 -P9306 -e "ALTER MATERIALIZED VIEW mv_1 suspended=0;"; echo $?
––– output –––
0
––– input –––
timeout 60 bash -c 'while [[ $(docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM destination_shard_1;" | grep -o "[0-9]*") -ne 58 ]]; do sleep 1; done && echo "Catch-up processing completed."'
––– output –––
Catch-up processing completed.
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM destination_shard_1;"
––– output –––
+----------+
| count(*) |
+----------+
|       58 |
+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM destination_shard_2;"
––– output –––
+----------+
| count(*) |
+----------+
|       56 |
+----------+
––– input –––
docker exec kafka kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group manticore
––– output –––
GROUP     TOPIC   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG  CONSUMER-ID                                           HOST            CLIENT-ID
manticore my-data 0          60              60              0    manticore-0-ea7e1a3e-bd9f-4c3d-8f2b-1a2b3c4d5e6f  /172.18.0.3     manticore-0
manticore my-data 1          54              54              0    manticore-1-fa8f2b4f-ce0g-5d4e-9g3c-2b3c4d5e6f7g  /172.18.0.3     manticore-1
––– input –––
docker exec manticore mysql -h0 -P9306 -e "DROP SOURCE kafka_p1;"; echo $?
––– output –––
0
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SHOW SOURCES;"
––– output –––
+----------+
| name     |
+----------+
| kafka_p2 |
+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SHOW MV mv_1;" | grep suspended
––– output –––
| 1         |
––– input –––
docker exec kafka /import.sh; echo $?
––– output –––
0
––– input –––
timeout 60 bash -c 'docker exec manticore bash -c "tail -f /var/log/manticore/searchd.log" | grep -m1 "REPLACE%20INTO%20destination_shard_2" > /dev/null && echo "Single partition processing completed."' || echo "Single partition processing failed."
––– output –––
Single partition processing completed.
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT 'Final shard_1' as table_name, COUNT(*) as count FROM destination_shard_1 UNION SELECT 'Final shard_2' as table_name, COUNT(*) as count FROM destination_shard_2;"
––– output –––
+---------------+-------+
| table_name    | count |
+---------------+-------+
| Final shard_1 |    60 |
| Final shard_2 |    81 |
+---------------+-------+
