â€“â€“â€“ input â€“â€“â€“
set -e
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
apt-get update > /dev/null 2>&1 && apt-get install -y curl jq > /dev/null 2>&1; echo $?
â€“â€“â€“ output â€“â€“â€“
0
â€“â€“â€“ input â€“â€“â€“
bash << 'SCRIPT'
# Static list of TESTED versions
TESTED_VERSIONS="7.17
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
8.8
8.9
8.10
8.11
8.12
8.13
8.14
8.15
8.16
8.17
8.18
8.19
9.0
9.1
9.2
9.3"

# Check for NEW versions (after latest tested)
# WARNING: Also update LOGSTASH_LATEST below when changing this!
LATEST_TESTED_VERSION="9.3"
NEW_VERSIONS=$(curl -s "https://hub.docker.com/v2/repositories/library/logstash/tags/?page_size=100" \
| jq -r ".results[].name" \
| grep "^[0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*$" \
| sed "s/\.[0-9]*$//" \
| awk '!/rc|beta|alpha/' \
| sort -t. -k1,1n -k2,2n | uniq \
| awk -v latest="$LATEST_TESTED_VERSION" '
function version_compare(v1, v2) {
    split(v1, a, ".")
    split(v2, b, ".")
    if (a[1] != b[1]) return a[1] - b[1]
    return a[2] - b[2]
}
version_compare($0, latest) > 0')

if [ -n "$NEW_VERSIONS" ]; then
    echo "ğŸ†• NEW Logstash versions detected: $NEW_VERSIONS"
    echo ""
    echo "ğŸ“ Update required:"
    echo "  1. test-integrations-check-logstash-versions.rec - Update TESTED_VERSIONS and LATEST_TESTED_VERSION"
    echo "  2. test-integrations-test-logstash-versions.rec - Add test for new version"
    echo "  3. manual/english/Integration/Logstash.md - Update version range (e.g., 7.6-[NEW_VERSION])"
    echo "  4. site repo: blog/integration-of-manticore-with-logstash-filebeat/index.md"
    echo ""
    exit 1
else
    echo "âœ… No new versions found after $LATEST_TESTED_VERSION"
fi

# Use static list for testing
echo "Using tested versions:"
echo "$TESTED_VERSIONS"
SCRIPT
â€“â€“â€“ output â€“â€“â€“
âœ… No new versions found after 9.3
Using tested versions:
7.17
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
8.8
8.9
8.10
8.11
8.12
8.13
8.14
8.15
8.16
8.17
8.18
8.19
9.0
9.1
9.2
9.3
â€“â€“â€“ input â€“â€“â€“
bash << 'SCRIPT'
# Check documentation versions for Logstash
echo "Checking Logstash version references in documentation..."
echo ""

# Must match LATEST_TESTED_VERSION above
LOGSTASH_LATEST="9.3"

# 1. Check manual documentation (local file mounted via workflow)
echo "=== Checking manual documentation ==="
LOGSTASH_MANUAL="/manual/english/Integration/Logstash.md"
if [ -f "$LOGSTASH_MANUAL" ]; then
    echo "âœ“ Checking $LOGSTASH_MANUAL"
    FOUND_VERSION=$(grep -o "versions [0-9.â€“-]* are supported" "$LOGSTASH_MANUAL" | head -1)
    if echo "$FOUND_VERSION" | grep -q "${LOGSTASH_LATEST}"; then
        echo "âœ… Manual: $FOUND_VERSION"
    else
        echo "âŒ Manual must contain version ${LOGSTASH_LATEST}" >&2
        echo "   Current: $FOUND_VERSION" >&2
        echo "   Update to: versions 7.6-${LOGSTASH_LATEST} are supported" >&2
        exit 1
    fi
else
    echo "âŒ Manual not found at $LOGSTASH_MANUAL" >&2
    echo "Manual must be mounted via workflow: -v \$(pwd)/manual:/manual" >&2
    exit 1
fi

echo ""
echo "=== Checking website blog post ==="

# 2. Check website blog post
BLOG_URL="https://manticoresearch.com/blog/integration-of-manticore-with-logstash-filebeat/"
echo "âœ“ Fetching $BLOG_URL"

# Try curl first, fallback to wget
if command -v curl > /dev/null 2>&1; then
    BLOG_CONTENT=$(curl -s "$BLOG_URL")
elif command -v wget > /dev/null 2>&1; then
    BLOG_CONTENT=$(wget -qO- "$BLOG_URL")
else
    echo "âŒ Neither curl nor wget available" >&2
    exit 1
fi
if [ -z "$BLOG_CONTENT" ]; then
    echo "âš ï¸  WARNING: Blog fetch failed - skipping" >&2
elif echo "$BLOG_CONTENT" | grep -E "Logstash versions.*(up to |-|â€“)${LOGSTASH_LATEST}" > /dev/null; then
    echo "âœ… Blog: contains ${LOGSTASH_LATEST}"
else
    BLOG_VERSION=$(echo "$BLOG_CONTENT" | grep -o "Logstash versions [0-9.â€“-]* " | head -1 | sed 's/Logstash versions //')
    echo "âš ï¸  WARNING: Blog does NOT contain ${LOGSTASH_LATEST} (found: ${BLOG_VERSION})" >&2
    echo "   Update: site/content/english/blog/integration-of-manticore-with-logstash-filebeat/index.md" >&2
fi

echo ""
echo "âœ… Documentation validation complete"
SCRIPT
â€“â€“â€“ output â€“â€“â€“
Checking Logstash version references in documentation...
=== Checking manual documentation ===
âœ“ Checking /manual/english/Integration/Logstash.md
âœ… Manual: versions 7.6-9.3 are supported
=== Checking website blog post ===
âœ“ Fetching https://manticoresearch.com/blog/integration-of-manticore-with-logstash-filebeat/
âœ… Blog: contains 9.3
âœ… Documentation validation complete
