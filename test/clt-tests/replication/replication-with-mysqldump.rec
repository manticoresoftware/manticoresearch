––– input –––
export INSTANCE=1
––– output –––
––– block: ../base/replication/start-searchd-precach –––
––– input –––
export INSTANCE=2
––– output –––
––– block: ../base/replication/start-searchd-precach –––
––– input –––
export INSTANCE=3
––– output –––
––– block: ../base/replication/start-searchd-precach –––
––– input –––
export CLUSTER_NAME=c
––– output –––
––– block: ../base/replication/create-cluster –––
––– input –––
echo 'the, and, of' > /tmp/stopwords.txt
––– output –––
––– input –––
echo 'cat => feline' > /tmp/exceptions.txt
––– output –––
––– input –––
mysql -h0 -P1306 -e "CREATE TABLE tbl1 (id BIGINT, f TEXT, a INT, b FLOAT, j JSON, m MULTI, s STRING, e BOOL, d TIMESTAMP, v MULTI64, fv FLOAT_VECTOR KNN_TYPE='hnsw' KNN_DIMS='4' HNSW_SIMILARITY='l2') ENGINE='columnar' morphology='stem_en' stopwords='/tmp/stopwords.txt' exceptions='/tmp/exceptions.txt' rt_mem_limit='256M';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "INSERT INTO tbl1 VALUES (1, 'The cat runs', 42, 3.14, '{\"key\":\"value\"}', (1,2,3), 'test', 1, '2024-12-16 12:00:00', (123456789012345678, 987654321098765432), (0.1, 0.2, 0.3, 0.4));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "ALTER CLUSTER c ADD tbl1;"
––– output –––
––– input –––
for n in `seq 2 $INSTANCE`; do mysql -h0 -P${n}306 -e "join cluster ${CLUSTER_NAME} at '127.0.0.1:1312'"; done;
––– output –––
––– input –––
mysql -h0 -P${INSTANCE}306 -e "show status like 'cluster_${CLUSTER_NAME}_status'\G"
––– output –––
*************************** 1. row ***************************
Counter: cluster_#!/[a-z]+/!#_status
Value: primary
––– input –––
echo 'fast => faster' > /tmp/wordforms.txt
––– output –––
––– input –––
mysql -h0 -P2306 -e "CREATE TABLE tbl2 (id BIGINT, f TEXT, a INT, b FLOAT, j JSON, m MULTI, s STRING, e BOOL, d TIMESTAMP, v MULTI64, fv FLOAT_VECTOR KNN_TYPE='hnsw' KNN_DIMS='4' HNSW_SIMILARITY='l2') ENGINE='rowwise' morphology='stem_ru' wordforms='/tmp/wordforms.txt' rt_mem_limit='512M';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "INSERT INTO tbl2 VALUES (1, 'Русский fast текст', 84, 2.71, '{\"ключ\":\"значение\"}', (4,5,6), 'строка', 0, '2023-11-15 08:30:00', (987654321098765432, 123456789012345678), (0.4, 0.3, 0.2, 0.1));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "INSERT INTO tbl2 VALUES (2, 'Быстрый прыжок', 19, 1.62, '{\"действие\":\"прыжок\",\"число\":3}', (7,8,9), 'пример', 1, '2024-06-10 15:45:00', (345678901234567890, 567890123456789012), (0.8, 0.7, 0.6, 0.5));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "ALTER CLUSTER c ADD tbl2;"
––– output –––
––– input –––
mysql -h0 -P3306 -e "CREATE TABLE tbl3 (id BIGINT, f TEXT, a INT, b FLOAT, j JSON, m MULTI, s STRING, e BOOL, d TIMESTAMP, v MULTI64, fv FLOAT_VECTOR KNN_TYPE='hnsw' KNN_DIMS='4' HNSW_SIMILARITY='l2') ENGINE='rowwise' rt_mem_limit='512M';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P3306 -e "INSERT INTO tbl3 (id, f, a, b, j, m, s, e, d, v, fv) VALUES (1, 'Plain example', 42, 3.14, '{\"key\":\"value\"}', (1,2,3), 'plain_string', 1, '2024-12-16 12:00:00', (123456789012345678, 987654321098765432), (0.1, 0.2, 0.3, 0.4));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P3306 -e "ALTER CLUSTER c ADD tbl3;"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "SHOW STATUS LIKE 'cluster_c_indexes';"
––– output –––
+-------------------+----------------+
| Counter           | Value          |
+-------------------+----------------+
| cluster_c_indexes | tbl1,tbl2,tbl3 |
+-------------------+----------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f            | a    | b        | j               | m     | s    | e    | d    | v                                     | fv                                  |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | The cat runs |   42 | 3.140000 | {"key":"value"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f            | a    | b        | j               | m     | s    | e    | d    | v                                     | fv                                  |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | The cat runs |   42 | 3.140000 | {"key":"value"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f            | a    | b        | j               | m     | s    | e    | d    | v                                     | fv                                  |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | The cat runs |   42 | 3.140000 | {"key":"value"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl2 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl2 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl2 on port 1306:
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                                                  | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Русский fast текст             |   84 | 2.710000 | {"ключ":"значение"}                                | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Быстрый прыжок                 |   19 | 1.620000 | {"действие":"прыжок","число":3}                    | 7,8,9 | пример       |    1 |    0 | 345678901234567890,567890123456789012 | 0.800000,0.700000,0.600000,0.500000 |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 2306:
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                                                  | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Русский fast текст             |   84 | 2.710000 | {"ключ":"значение"}                                | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Быстрый прыжок                 |   19 | 1.620000 | {"действие":"прыжок","число":3}                    | 7,8,9 | пример       |    1 |    0 | 345678901234567890,567890123456789012 | 0.800000,0.700000,0.600000,0.500000 |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 3306:
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                                                  | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Русский fast текст             |   84 | 2.710000 | {"ключ":"значение"}                                | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Быстрый прыжок                 |   19 | 1.620000 | {"действие":"прыжок","число":3}                    | 7,8,9 | пример       |    1 |    0 | 345678901234567890,567890123456789012 | 0.800000,0.700000,0.600000,0.500000 |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl3 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl3 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl3 on port 1306:
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f             | a    | b        | j               | m     | s            | e    | d    | v                                     | fv                                  |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example |   42 | 3.140000 | {"key":"value"} | 1,2,3 | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 2306:
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f             | a    | b        | j               | m     | s            | e    | d    | v                                     | fv                                  |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example |   42 | 3.140000 | {"key":"value"} | 1,2,3 | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 3306:
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f             | a    | b        | j               | m     | s            | e    | d    | v                                     | fv                                  |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example |   42 | 3.140000 | {"key":"value"} | 1,2,3 | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
mysql -h0 -P1306 -e "REPLACE INTO c:tbl1 VALUES (1, 'Updated feline runs', 42, 3.14, '{\"key\":\"updated\"}', (1,2,3), 'test', 1, '2024-12-16 12:00:00', (123456789012345678, 987654321098765432), (0.1, 0.2, 0.3, 0.4));"; echo $?
––– output –––
0
––– input –––
mysqldump -etc --replace -u cluster -h0 -P1306 --skip-comments manticore c:tbl1 | mysql -h0 -P1306; echo $?
––– output –––
-- Warning: version string returned by server is incorrect.
-- Warning: column statistics not supported by the server.
0
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do mysql -h0 -P$port -e "SET GLOBAL cluster_user = 'new_username';"; done
––– output –––
––– input –––
for port in 1306 2306 3306; do timeout 10 bash -c "while ! mysql -h0 -P$port -e \"SHOW VARIABLES LIKE 'cluster_user';\" | grep -q '| cluster_user  | new_username |'; do sleep 1; done" && echo "Port $port: cluster_user is new_username." || { echo "Port $port: cluster_user is not new_username."; exit 1; }; done
––– output –––
Port 1306: cluster_user is new_username.
Port 2306: cluster_user is new_username.
Port 3306: cluster_user is new_username.
––– input –––
mysql -h0 -P2306 -e "DELETE FROM c:tbl2 WHERE id = 2;"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P3306 -e "INSERT INTO c:tbl3 (id, f, a, b, j, m, s, e, d, v, fv) VALUES (2, 'New plain entry', 50, 5.5, '{\"new\":\"entry\"}', (10,11,12), 'new_string', 0, '2025-03-02 10:00:00', (111222333444555666, 777888999000111222), (0.6, 0.7, 0.8, 0.9));"; echo $?
––– output –––
0
––– input –––
mysqldump -etc --replace --net-buffer-length=16M -u new_username -h0 -P2306 --skip-comments manticore c:tbl1 c:tbl2 c:tbl3 | mysql -h0 -P3306; echo $?
––– output –––
-- Warning: version string returned by server is incorrect.
-- Warning: column statistics not supported by the server.
0
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl2 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl2 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl2 on port 1306:
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                               | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Русский fast текст             |   84 | 2.710000 | {"ключ":"значение"}             | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 2306:
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                               | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Русский fast текст             |   84 | 2.710000 | {"ключ":"значение"}             | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 3306:
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                               | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Русский fast текст             |   84 | 2.710000 | {"ключ":"значение"}             | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl3 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl3 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl3 on port 1306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 2306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 3306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
mysql -h0 -P1306 -e "SHOW STATUS LIKE 'cluster_c_indexes';"
––– output –––
+-------------------+----------------+
| Counter           | Value          |
+-------------------+----------------+
| cluster_c_indexes | tbl1,tbl2,tbl3 |
+-------------------+----------------+
––– input –––
mysqldump -etc --replace --ignore-table=manticore.tbl2 --net-buffer-length=16M -u new_username -h0 -P2306 --skip-comments manticore c:tbl1 c:tbl2 c:tbl3 > dump.sql
––– output –––
-- Warning: version string returned by server is incorrect.
-- Warning: column statistics not supported by the server.
––– input –––
mysql -h0 -P1306 -e "ALTER CLUSTER c DROP tbl2;"; echo $?
––– output –––
0
––– input –––
for port in 1306 2306 3306; do mysql -h0 -P$port -e "DROP TABLE tbl2;"; done
––– output –––
––– input –––
for port in 1306 2306 3306; do mysql -h0 -P$port -e "SHOW TABLES LIKE 'tbl2';" | grep -q 'tbl2' && echo "Port $port: tbl2 EXISTS" || echo "Port $port: tbl2 NOT FOUND"; done
––– output –––
Port 1306: tbl2 NOT FOUND
Port 2306: tbl2 NOT FOUND
Port 3306: tbl2 NOT FOUND
––– input –––
mysql -h0 -P1306 -u new_username < dump.sql
––– output –––
ERROR 1064 (42000) at line 21: table 'tbl2' absent
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl2 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl2 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl2 on port 1306:
ERROR 1064 (42000) at line 1: unknown local table(s) 'tbl2' in search request
Data from c:tbl2 on port 2306:
ERROR 1064 (42000) at line 1: unknown local table(s) 'tbl2' in search request
Data from c:tbl2 on port 3306:
ERROR 1064 (42000) at line 1: unknown local table(s) 'tbl2' in search request
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl3 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl3 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl3 on port 1306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 2306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 3306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
rm -f /tmp/stopwords.txt /tmp/exceptions.txt /tmp/wordforms.txt /var/lib/manticore/tbl3.conf dump.sql
––– output –––
