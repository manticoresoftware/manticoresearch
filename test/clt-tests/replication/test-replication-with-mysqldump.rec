––– input –––
export INSTANCE=1
––– output –––
––– block: ../base/replication/start-searchd-precach –––
––– input –––
export INSTANCE=2
––– output –––
––– block: ../base/replication/start-searchd-precach –––
––– input –––
export INSTANCE=3
––– output –––
––– block: ../base/replication/start-searchd-precach –––
––– input –––
export CLUSTER_NAME=c
––– output –––
––– block: ../base/replication/create-cluster –––
––– input –––
echo 'the, and, of' > /tmp/stopwords.txt
––– output –––
––– input –––
echo 'cat => feline' > /tmp/exceptions.txt
––– output –––
––– input –––
mysql -h0 -P1306 -e "CREATE TABLE tbl1 (id BIGINT, f TEXT, a INT, b FLOAT, j JSON, m MULTI, s STRING, e BOOL, d TIMESTAMP, v MULTI64, fv FLOAT_VECTOR KNN_TYPE='hnsw' KNN_DIMS='4' HNSW_SIMILARITY='l2') ENGINE='columnar' morphology='stem_en' stopwords='/tmp/stopwords.txt' exceptions='/tmp/exceptions.txt' rt_mem_limit='256M';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "SHOW TABLE tbl1 SETTINGS\G;"
––– output –––
*************************** 1. row ***************************
Variable_name: settings
Value: engine = columnar
exceptions = /var/log/manticore-1/tbl1/exceptions_chunk0_0.txt
morphology = stem_en
stopwords = /var/log/manticore-1/tbl1/stopwords_chunk0_0.txt
rt_mem_limit = 268435456
––– input –––
mysql -h0 -P1306 -e "INSERT INTO tbl1 VALUES (1, 'The cat runs', 42, 3.14, '{\"key\":\"value\"}', (1,2,3), 'test', 1, '2024-12-16 12:00:00', (123456789012345678, 987654321098765432), (0.1, 0.2, 0.3, 0.4));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "ALTER CLUSTER c ADD tbl1;"
––– output –––
––– input –––
for n in `seq 2 $INSTANCE`; do mysql -h0 -P${n}306 -e "join cluster ${CLUSTER_NAME} at '127.0.0.1:1312'"; done;
––– output –––
––– input –––
mysql -h0 -P${INSTANCE}306 -e "show status like 'cluster_${CLUSTER_NAME}_status'\G"
––– output –––
*************************** 1. row ***************************
Counter: cluster_#!/[a-z]+/!#_status
Value: primary
––– input –––
echo '=> faster' > /tmp/wordforms.txt
––– output –––
––– input –––
mysql -h0 -P2306 -e "CREATE TABLE tbl2 (id BIGINT, f TEXT, a INT, b FLOAT, j JSON, m MULTI, s STRING, e BOOL, d TIMESTAMP, v MULTI64, fv FLOAT_VECTOR KNN_TYPE='hnsw' KNN_DIMS='4' HNSW_SIMILARITY='l2') ENGINE='rowwise' morphology='stem_ru' wordforms='/tmp/wordforms.txt' rt_mem_limit='512M';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "SHOW TABLE tbl2 SETTINGS\G;"
––– output –––
*************************** 1. row ***************************
Variable_name: settings
Value: engine = rowwise
morphology = stem_ru
wordforms = /var/log/manticore-2/tbl2/wordforms_chunk0_0.txt
rt_mem_limit = 536870912
––– input –––
mysql -h0 -P2306 -e "INSERT INTO tbl2 VALUES (1, 'Текст на русском', 84, 2.71, '{\"ключ\":\"значение\"}', (4,5,6), 'строка', 0, '2023-11-15 08:30:00', (987654321098765432, 123456789012345678), (0.4, 0.3, 0.2, 0.1));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "INSERT INTO tbl2 VALUES (2, 'Прыжок', 19, 1.62, '{\"движение\":\"прыжок\",\"число\":3}', (7,8,9), 'пример', 1, '2024-06-10 15:45:00', (345678901234567890, 567890123456789012), (0.8, 0.7, 0.6, 0.5));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "ALTER CLUSTER c ADD tbl2;"
––– output –––
––– input –––
mysql -h0 -P3306 -e "CREATE TABLE tbl3 (id BIGINT, f TEXT, a INT, b FLOAT, j JSON, m MULTI, s STRING, e BOOL, d TIMESTAMP, v MULTI64, fv FLOAT_VECTOR KNN_TYPE='hnsw' KNN_DIMS='4' HNSW_SIMILARITY='l2') ENGINE='rowwise' rt_mem_limit='512M';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P3306 -e "SHOW TABLE tbl3 SETTINGS\G;"
––– output –––
*************************** 1. row ***************************
Variable_name: settings
Value: engine = rowwise
rt_mem_limit = 536870912
––– input –––
mysql -h0 -P3306 -e "INSERT INTO tbl3 (id, f, a, b, j, m, s, e, d, v, fv) VALUES (1, 'Plain example', 42, 3.14, '{\"key\":\"value\"}', (1,2,3), 'plain_string', 1, '2024-12-16 12:00:00', (123456789012345678, 987654321098765432), (0.1, 0.2, 0.3, 0.4));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P3306 -e "ALTER CLUSTER c ADD tbl3;"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "SHOW STATUS LIKE 'cluster_c_indexes';"
––– output –––
+-------------------+----------------+
| Counter           | Value          |
+-------------------+----------------+
| cluster_c_indexes | tbl1,tbl2,tbl3 |
+-------------------+----------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f            | a    | b        | j               | m     | s    | e    | d    | v                                     | fv                                  |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | The cat runs |   42 | 3.140000 | {"key":"value"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f            | a    | b        | j               | m     | s    | e    | d    | v                                     | fv                                  |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | The cat runs |   42 | 3.140000 | {"key":"value"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f            | a    | b        | j               | m     | s    | e    | d    | v                                     | fv                                  |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | The cat runs |   42 | 3.140000 | {"key":"value"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+--------------+------+----------+-----------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl2 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl2 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl2 on port 1306:
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                                                  | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском               |   84 | 2.710000 | {"ключ":"значение"}                                | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Прыжок                         |   19 | 1.620000 | {"движение":"прыжок","число":3}                    | 7,8,9 | пример       |    1 |    0 | 345678901234567890,567890123456789012 | 0.800000,0.700000,0.600000,0.500000 |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 2306:
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                                                  | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском               |   84 | 2.710000 | {"ключ":"значение"}                                | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Прыжок                         |   19 | 1.620000 | {"движение":"прыжок","число":3}                    | 7,8,9 | пример       |    1 |    0 | 345678901234567890,567890123456789012 | 0.800000,0.700000,0.600000,0.500000 |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 3306:
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                                                  | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском               |   84 | 2.710000 | {"ключ":"значение"}                                | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Прыжок                         |   19 | 1.620000 | {"движение":"прыжок","число":3}                    | 7,8,9 | пример       |    1 |    0 | 345678901234567890,567890123456789012 | 0.800000,0.700000,0.600000,0.500000 |
+------+--------------------------------+------+----------+----------------------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl3 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl3 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl3 on port 1306:
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f             | a    | b        | j               | m     | s            | e    | d    | v                                     | fv                                  |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example |   42 | 3.140000 | {"key":"value"} | 1,2,3 | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 2306:
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f             | a    | b        | j               | m     | s            | e    | d    | v                                     | fv                                  |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example |   42 | 3.140000 | {"key":"value"} | 1,2,3 | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 3306:
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f             | a    | b        | j               | m     | s            | e    | d    | v                                     | fv                                  |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example |   42 | 3.140000 | {"key":"value"} | 1,2,3 | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------+------+----------+-----------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
mysql -h0 -P1306 -e "REPLACE INTO c:tbl1 VALUES (1, 'Updated feline runs', 42, 3.14, '{\"key\":\"updated\"}', (1,2,3), 'test', 1, '2024-12-16 12:00:00', (123456789012345678, 987654321098765432), (0.1, 0.2, 0.3, 0.4));"; echo $?
––– output –––
0
––– input –––
mysqldump -etc --replace -u cluster -h0 -P1306 --skip-comments manticore c:tbl1 | mysql -h0 -P1306; echo $?
––– output –––
-- Warning: version string returned by server is incorrect.
-- Warning: column statistics not supported by the server.
0
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do mysql -h0 -P$port -e "SET GLOBAL cluster_user = 'new_username';"; done
––– output –––
––– input –––
for port in 1306 2306 3306; do timeout 10 bash -c "while ! mysql -h0 -P$port -e \"SHOW VARIABLES LIKE 'cluster_user';\" | grep -q '| cluster_user  | new_username |'; do sleep 1; done" && echo "Port $port: cluster_user is new_username." || { echo "Port $port: cluster_user is not new_username."; exit 1; }; done
––– output –––
Port 1306: cluster_user is new_username.
Port 2306: cluster_user is new_username.
Port 3306: cluster_user is new_username.
––– input –––
mysql -h0 -P2306 -e "DELETE FROM c:tbl2 WHERE id = 2;"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P3306 -e "INSERT INTO c:tbl3 (id, f, a, b, j, m, s, e, d, v, fv) VALUES (2, 'New plain entry', 50, 5.5, '{\"new\":\"entry\"}', (10,11,12), 'new_string', 0, '2025-03-02 10:00:00', (111222333444555666, 777888999000111222), (0.6, 0.7, 0.8, 0.9));"; echo $?
––– output –––
0
––– input –––
mysqldump -etc --replace --net-buffer-length=16M -u new_username -h0 -P2306 --skip-comments manticore c:tbl1 c:tbl2 c:tbl3 | mysql -h0 -P3306; echo $?
––– output –––
-- Warning: version string returned by server is incorrect.
-- Warning: column statistics not supported by the server.
0
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl2 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl2 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl2 on port 1306:
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                               | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском               |   84 | 2.710000 | {"ключ":"значение"}             | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 2306:
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                               | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском               |   84 | 2.710000 | {"ключ":"значение"}             | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 3306:
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                              | a    | b        | j                               | m     | s            | e    | d    | v                                     | fv                                  |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском               |   84 | 2.710000 | {"ключ":"значение"}             | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
+------+--------------------------------+------+----------+---------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl3 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl3 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl3 on port 1306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 2306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl3 on port 3306:
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f               | a    | b        | j               | m        | s            | e    | d    | v                                     | fv                                  |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Plain example   |   42 | 3.140000 | {"key":"value"} | 1,2,3    | plain_string |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | New plain entry |   50 | 5.500000 | {"new":"entry"} | 10,11,12 | new_string   |    0 |    0 | 111222333444555666,777888999000111222 | 0.600000,0.700000,0.800000,0.900000 |
+------+-----------------+------+----------+-----------------+----------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
mysql -h0 -P1306 -e "ALTER CLUSTER c DROP tbl1;"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "SHOW STATUS LIKE 'cluster_c_indexes';"
––– output –––
+-------------------+-----------+
| Counter           | Value     |
+-------------------+-----------+
| cluster_c_indexes | tbl2,tbl3 |
+-------------------+-----------+
––– input –––
echo 'new, stop, words' > /tmp/new_stopwords.txt; echo $?
––– output –––
0
––– input –––
echo 'dog => canine' > /tmp/new_exceptions.txt; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "ALTER TABLE tbl1 stopwords='/tmp/new_stopwords.txt' exceptions='/tmp/new_exceptions.txt';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "SHOW TABLE tbl1 SETTINGS\G;"
––– output –––
*************************** 1. row ***************************
Variable_name: settings
Value: engine = columnar
exceptions = /var/log/manticore-1/tbl1/exceptions_chunk0_1.txt
morphology = stem_en
stopwords = /var/log/manticore-1/tbl1/stopwords_chunk0_1.txt
rt_mem_limit = 268435456
––– input –––
mysql -h0 -P1306 -e "REPLACE INTO tbl1 VALUES (1, 'Updated feline runs', 42, 3.14, '{\"key\":\"updated\"}', (1,2,3), 'test', 1, '2024-12-16 12:00:00', (123456789012345678, 987654321098765432), (0.1, 0.2, 0.3, 0.4));"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "ALTER CLUSTER c ADD tbl1;"; echo $?
––– output –––
0
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
mysql -h0 -P2306 -e "SHOW TABLE c:tbl1 SETTINGS\G;"
––– output –––
*************************** 1. row ***************************
Variable_name: settings
Value: engine = columnar
exceptions = /var/log/manticore-2/tbl1/exceptions_chunk0_1.txt
morphology = stem_en
stopwords = /var/log/manticore-2/tbl1/stopwords_chunk0_1.txt
rt_mem_limit = 268435456
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT id, f, HIGHLIGHT() FROM c:tbl1 WHERE MATCH('new runs');"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+----------------------------+
| id   | f                   | highlight()                |
+------+---------------------+----------------------------+
|    1 | Updated feline runs | Updated feline <b>runs</b> |
+------+---------------------+----------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+----------------------------+
| id   | f                   | highlight()                |
+------+---------------------+----------------------------+
|    1 | Updated feline runs | Updated feline <b>runs</b> |
+------+---------------------+----------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+----------------------------+
| id   | f                   | highlight()                |
+------+---------------------+----------------------------+
|    1 | Updated feline runs | Updated feline <b>runs</b> |
+------+---------------------+----------------------------+
––– input –––
mysql -h0 -P1306 -e "INSERT INTO c:tbl1 (id, f, a, b, j, m, s, e, d, v, fv) VALUES (2, 'The dog barks', 10, 2.5, '{\"animal\":\"dog\"}', (4,5), 'bark', 1, '2025-01-01 10:00:00', (111222333444555, 666777888999000), (0.5, 0.6, 0.7, 0.8));"; echo $?
––– output –––
0
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT id, f, HIGHLIGHT() FROM c:tbl1 WHERE MATCH('canine');"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------+----------------------+
| id   | f             | highlight()          |
+------+---------------+----------------------+
|    2 | The dog barks | The <b>dog</b> barks |
+------+---------------+----------------------+
Data from c:tbl1 on port 2306:
+------+---------------+----------------------+
| id   | f             | highlight()          |
+------+---------------+----------------------+
|    2 | The dog barks | The <b>dog</b> barks |
+------+---------------+----------------------+
Data from c:tbl1 on port 3306:
+------+---------------+----------------------+
| id   | f             | highlight()          |
+------+---------------+----------------------+
|    2 | The dog barks | The <b>dog</b> barks |
+------+---------------+----------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl1 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl1 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl1 on port 1306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | The dog barks       |   10 | 2.500000 | {"animal":"dog"}  | 4,5   | bark |    1 |    0 | 111222333444555,666777888999000       | 0.500000,0.600000,0.700000,0.800000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 2306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | The dog barks       |   10 | 2.500000 | {"animal":"dog"}  | 4,5   | bark |    1 |    0 | 111222333444555,666777888999000       | 0.500000,0.600000,0.700000,0.800000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl1 on port 3306:
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
| id   | f                   | a    | b        | j                 | m     | s    | e    | d    | v                                     | fv                                  |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
|    1 | Updated feline runs |   42 | 3.140000 | {"key":"updated"} | 1,2,3 | test |    1 |    0 | 123456789012345678,987654321098765432 | 0.100000,0.200000,0.300000,0.400000 |
|    2 | The dog barks       |   10 | 2.500000 | {"animal":"dog"}  | 4,5   | bark |    1 |    0 | 111222333444555,666777888999000       | 0.500000,0.600000,0.700000,0.800000 |
+------+---------------------+------+----------+-------------------+-------+------+------+------+---------------------------------------+-------------------------------------+
––– input –––
mysql -h0 -P2306 -e "ALTER CLUSTER c DROP tbl2;"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "SHOW STATUS LIKE 'cluster_c_indexes';"
––– output –––
+-------------------+-----------+
| Counter           | Value     |
+-------------------+-----------+
| cluster_c_indexes | tbl3,tbl1 |
+-------------------+-----------+
––– input –––
ls /usr/share/manticore/ru.pak
––– output –––
/usr/share/manticore/ru.pak
––– input –––
mysql -h0 -P2306 -e "ALTER TABLE tbl2 morphology='lemmatize_ru';"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "SHOW TABLE tbl2 SETTINGS\G;"
––– output –––
*************************** 1. row ***************************
Variable_name: settings
Value: engine = rowwise
morphology = lemmatize_ru
wordforms = /var/log/manticore-2/tbl2/wordforms_chunk0_0.txt
rt_mem_limit = 536870912
––– input –––
mysqldump -etc --replace -u new_username -h0 -P2306 --skip-comments manticore tbl2 | mysql -P2306 -h0; echo $?
––– output –––
-- Warning: version string returned by server is incorrect.
-- Warning: column statistics not supported by the server.
0
––– input –––
mysql -h0 -P2306 -e "ALTER CLUSTER c ADD tbl2;"; echo $?
––– output –––
0
––– input –––
mysql -h0 -P2306 -e "INSERT INTO c:tbl2 (id, f, a, b, j, m, s, e, d, v, fv) VALUES (2, 'Кот прыжки делает', 5, 1.1, '{\"движение\":\"прыжки\"}', (10,11), 'кот', 1, '2025-03-11 12:00:00', (111111111, 222222222), (0.9, 0.8, 0.7, 0.6));"; echo $?
––– output –––
0
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl2 on port $port:"; mysql -h0 -P$port -e "SELECT id, f, HIGHLIGHT() FROM c:tbl2 WHERE MATCH('прыжок');"; done
––– output –––
Data from c:tbl2 on port 1306:
+------+----------------------------------+-----------------------------------------+
| id   | f                                | highlight()                             |
+------+----------------------------------+-----------------------------------------+
|    2 | Кот прыжки делает                | Кот <b>прыжки</b> делает                |
+------+----------------------------------+-----------------------------------------+
Data from c:tbl2 on port 2306:
+------+----------------------------------+-----------------------------------------+
| id   | f                                | highlight()                             |
+------+----------------------------------+-----------------------------------------+
|    2 | Кот прыжки делает                | Кот <b>прыжки</b> делает                |
+------+----------------------------------+-----------------------------------------+
Data from c:tbl2 on port 3306:
+------+----------------------------------+-----------------------------------------+
| id   | f                                | highlight()                             |
+------+----------------------------------+-----------------------------------------+
|    2 | Кот прыжки делает                | Кот <b>прыжки</b> делает                |
+------+----------------------------------+-----------------------------------------+
––– input –––
for port in 1306 2306 3306; do echo "Data from c:tbl2 on port $port:"; mysql -h0 -P$port -e "SELECT * FROM c:tbl2 ORDER BY id ASC;"; done
––– output –––
Data from c:tbl2 on port 1306:
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                                | a    | b        | j                                   | m     | s            | e    | d    | v                                     | fv                                  |
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском                 |   84 | 2.710000 | {"ключ":"значение"}                 | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Кот прыжки делает                |    5 | 1.100000 | {"движение":"прыжки"}               | 10,11 | кот          |    1 |    0 | 111111111,222222222                   | 0.900000,0.800000,0.700000,0.600000 |
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 2306:
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                                | a    | b        | j                                   | m     | s            | e    | d    | v                                     | fv                                  |
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском                 |   84 | 2.710000 | {"ключ":"значение"}                 | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Кот прыжки делает                |    5 | 1.100000 | {"движение":"прыжки"}               | 10,11 | кот          |    1 |    0 | 111111111,222222222                   | 0.900000,0.800000,0.700000,0.600000 |
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
Data from c:tbl2 on port 3306:
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
| id   | f                                | a    | b        | j                                   | m     | s            | e    | d    | v                                     | fv                                  |
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
|    1 | Текст на русском                 |   84 | 2.710000 | {"ключ":"значение"}                 | 4,5,6 | строка       |    0 |    0 | 123456789012345678,987654321098765432 | 0.400000,0.300000,0.200000,0.100000 |
|    2 | Кот прыжки делает                |    5 | 1.100000 | {"движение":"прыжки"}               | 10,11 | кот          |    1 |    0 | 111111111,222222222                   | 0.900000,0.800000,0.700000,0.600000 |
+------+----------------------------------+------+----------+-------------------------------------+-------+--------------+------+------+---------------------------------------+-------------------------------------+
––– input –––
rm -f /tmp/stopwords.txt /tmp/exceptions.txt /tmp/wordforms.txt /var/lib/manticore/tbl3.conf dump.sql
––– output –––
