––– input –––
export INSTANCE=1
––– output –––
––– block: ../../base/replication/start-searchd-precach –––
––– input –––
export INSTANCE=2
––– output –––
––– block: ../../base/replication/start-searchd-precach –––
––– input –––
export INSTANCE=3
––– output –––
––– block: ../../base/replication/start-searchd-precach –––
––– input –––
mkdir -p /var/lib/manticore/a /var/lib/manticore/b
––– output –––
––– input –––
chown manticore:manticore /var/lib/manticore/{a,b}
––– output –––
––– input –––
mysql -h0 -P1306 -e "CREATE CLUSTER a"
––– output –––
––– input –––
sleep 5; mysql -h0 -P1306 -e "CREATE CLUSTER b" &
––– output –––
[%{NUMBER}] %{NUMBER}
––– input –––
mysql -h0 -P2306 -e "JOIN CLUSTER a AT '127.0.0.1:1312'" &
––– output –––
[%{NUMBER}] %{NUMBER}
––– input –––
mysql -h0 -P3306 -e "JOIN CLUSTER a AT '127.0.0.1:1312'" &
––– output –––
[%{NUMBER}] %{NUMBER}
––– input –––
wait 1>/dev/null 2>&1; echo $?
––– output –––
0
––– input –––
for i in 1 2 3; do grep -q 'FATAL:' /var/log/manticore-${i}/searchd.log ; echo "#$i – $?"; done
––– output –––
#1 – 1
#2 – 1
#3 – 1
––– input –––
for i in 1 2 3; do mysql -h0 -P${i}306 -e "SHOW STATUS LIKE 'cluster_a_nodes_view'\G" | grep Value | sed 's/Value: //' | tr ',' '\n' | sort | tr '\n' ',' | sed 's/,$/\n/' | sed 's/^/Value: /'; done
––– output –––
Value:   127.0.0.1:1312,127.0.0.1:1322:replication,127.0.0.1:2312,127.0.0.1:2322:replication,127.0.0.1:3312,127.0.0.1:3322:replication
Value:   127.0.0.1:1312,127.0.0.1:1322:replication,127.0.0.1:2312,127.0.0.1:2322:replication,127.0.0.1:3312,127.0.0.1:3322:replication
Value:   127.0.0.1:1312,127.0.0.1:1322:replication,127.0.0.1:2312,127.0.0.1:2322:replication,127.0.0.1:3312,127.0.0.1:3322:replication
