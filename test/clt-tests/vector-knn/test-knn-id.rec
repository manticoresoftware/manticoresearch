––– block: ../base/start-searchd-with-buddy –––
––– input –––
mysql -h0 -P9306 -e "create table test ( title text, image_vector float_vector knn_type='hnsw' knn_dims='4' hnsw_similarity='l2' );"
––– output –––
––– input –––
mysql -h0 -P9306 -e "insert into test values ( 1, 'yellow bag', (0.653448,0.192478,0.017971,0.339821) ), ( 2, 'white bag', (-0.148894,0.748278,0.091892,-0.095406) );"
––– output –––
––– input –––
mysql -h0 -P9306 -e "select id, knn_dist() from test where knn ( image_vector, 5, (0.286569,-0.031816,0.066684,0.032926), {ef=2000} );"
––– output –––
+------+------------+
| id   | knn_dist() |
+------+------------+
|    1 | 0.28146550 |
|    2 | 0.81527930 |
+------+------------+
––– input –––
mysql -h0 -P9306 -e "select id, knn_dist() from test where knn ( image_vector, 5, 1 );"
––– output –––
+------+------------+
| id   | knn_dist() |
+------+------------+
|    2 | 1.14755321 |
+------+------------+
––– input –––
mysql -h0 -P9306 -e "select * from test where knn ( image_vector, 5, 1 );"
––– output –––
+------+-----------+---------------------------------------+------------+
| id   | title     | image_vector                          | @knn_dist  |
+------+-----------+---------------------------------------+------------+
|    2 | white bag | -0.148894,0.748278,0.091892,-0.095406 | 1.14755321 |
+------+-----------+---------------------------------------+------------+
––– input –––
mysql -h0 -P9306 -e "select count(*) from test where knn ( image_vector, 5, 1 );"
––– output –––
+----------+
| count(*) |
+----------+
|        2 |
+----------+
––– input –––
mysql -h0 -P9306 -e "CREATE TABLE knn_test (id BIGINT, model TEXT, color TEXT, sold BOOL, date_added BIGINT, storage_capacity UINT, release_year UINT, price FLOAT, discounted_price FLOAT, product_codes JSON, values JSON, additional_info JSON, vector float_vector knn_type='hnsw' knn_dims='4' hnsw_similarity='l2');"
––– output –––
––– input –––
mysql -h0 -P9306 -e "INSERT INTO knn_test (id, model, color, sold, date_added, storage_capacity, release_year, price, discounted_price, product_codes, values, additional_info, vector) VALUES (1, 'Model_1', 'Color_1', 1, 1620590570251, 512, 2022, 654.19, 855.34, '[81,56,60]', '[96,389,27]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (0.1, 0.2, 0.3, 0.4)), (2, 'Model_2', 'Color_2', 1, 1689374130160, 128, 2020, 663.70, 767.99, '[12,39,30]', '[226,305,123]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (0.286569, -0.031816, 0.066684, 0.032926)), (3, 'Model_3', 'Color_3', 0, 1640782021529, 512, 2020, 676.46, 847.08, '[62,13,4]', '[707,601,608]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (-0.5, 0.7, -0.1, 0.2)), (4, 'Model_4', 'Color_4', 0, 1615319697581, 128, 2020, 424.23, 883.90, '[98,96,89]', '[166,252,510]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (0.7, -0.8, 0.1, -0.2)), (5, 'Model_5', 'Color_5', 1, 1671157942660, 128, 2021, 1173.29, 977.33, '[27,12,37]', '[988,87,21]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (0.3, 0.4, 0.5, 0.6)), (6, 'Model_6', 'Color_6', 0, 1609876342571, 256, 2021, 755.99, 665.49, '[5,15,25]', '[15,100,500]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (-0.2, 0.4, -0.6, 0.8)), (7, 'Model_7', 'Color_7', 1, 1648765432160, 64, 2019, 299.99, 199.99, '[77,88,99]', '[99,888,555]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (0.5, -0.3, 0.9, -0.1)), (8, 'Model_8', 'Color_8', 0, 1654876543130, 256, 2019, 800.99, 699.99, '[22,33,44]', '[66,333,999]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (0.8, 0.6, 0.2, -0.4)), (9, 'Model_9', 'Color_9', 1, 1631567882541, 128, 2022, 499.99, 399.99, '[11,22,33]', '[111,222,333]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (-0.1, 0.3, -0.5, 0.7)), (10, 'Model_10', 'Color_10', 0, 1678956543120, 512, 2022, 1299.99, 1099.99, '[9,8,7]', '[555,444,333]', '{\"features\": [\"Feature_1\", \"Feature_2\", \"Feature_3\"]}', (0.9, 0.1, 0.8, -0.2));"
––– output –––
––– input –––
mysql -h0 -P9306 -e "SELECT id, knn_dist() FROM knn_test WHERE knn(vector, 5, 1);"
––– output –––
+------+------------+
| id   | knn_dist() |
+------+------------+
|    5 | 0.16000001 |
|    2 | 0.27772635 |
|    9 | 0.78000003 |
|    3 | 0.81000006 |
|    7 |   1.020000 |
|    6 |   1.100000 |
|   10 |   1.260000 |
|    8 |   1.300000 |
|    4 | 1.75999987 |
+------+------------+
––– input –––
mysql -h0 -P9306 -e "SELECT id, knn_dist() FROM knn_test WHERE knn(vector, 5, 1);"
––– output –––
+------+------------+
| id   | knn_dist() |
+------+------------+
|    5 | 0.16000001 |
|    2 | 0.27772635 |
|    9 | 0.78000003 |
|    3 | 0.81000006 |
|    7 |   1.020000 |
|    6 |   1.100000 |
|   10 |   1.260000 |
|    8 |   1.300000 |
|    4 | 1.75999987 |
+------+------------+
––– input –––
mysql -h0 -P9306 -e "SELECT * FROM knn_test WHERE knn(vector, 5, 1)\G"
––– output –––
*************************** 1. row ***************************
              id: 5
           model: Model_5
           color: Color_5
            sold: 1
      date_added: 1671157942660
storage_capacity: 128
    release_year: 2021
           price: 1173.290039
discounted_price: 977.330017
   product_codes: [27,12,37]
          values: [988,87,21]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: 0.300000,0.400000,0.500000,0.600000
       @knn_dist: 0.16000001
*************************** 2. row ***************************
              id: 2
           model: Model_2
           color: Color_2
            sold: 1
      date_added: 1689374130160
storage_capacity: 128
    release_year: 2020
           price: 663.700012
discounted_price: 767.989990
   product_codes: [12,39,30]
          values: [226,305,123]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: 0.286569,-0.031816,0.066684,0.032926
       @knn_dist: 0.27772635
*************************** 3. row ***************************
              id: 9
           model: Model_9
           color: Color_9
            sold: 1
      date_added: 1631567882541
storage_capacity: 128
    release_year: 2022
           price: 499.989990
discounted_price: 399.989990
   product_codes: [11,22,33]
          values: [111,222,333]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: -0.100000,0.300000,-0.500000,0.700000
       @knn_dist: 0.78000003
*************************** 4. row ***************************
              id: 3
           model: Model_3
           color: Color_3
            sold: 0
      date_added: 1640782021529
storage_capacity: 512
    release_year: 2020
           price: 676.460022
discounted_price: 847.080017
   product_codes: [62,13,4]
          values: [707,601,608]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: -0.500000,0.700000,-0.100000,0.200000
       @knn_dist: 0.81000006
*************************** 5. row ***************************
              id: 7
           model: Model_7
           color: Color_7
            sold: 1
      date_added: 1648765432160
storage_capacity: 64
    release_year: 2019
           price: 299.989990
discounted_price: 199.990005
   product_codes: [77,88,99]
          values: [99,888,555]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: 0.500000,-0.300000,0.900000,-0.100000
       @knn_dist: 1.020000
*************************** 6. row ***************************
              id: 6
           model: Model_6
           color: Color_6
            sold: 0
      date_added: 1609876342571
storage_capacity: 256
    release_year: 2021
           price: 755.989990
discounted_price: 665.489990
   product_codes: [5,15,25]
          values: [15,100,500]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: -0.200000,0.400000,-0.600000,0.800000
       @knn_dist: 1.100000
*************************** 7. row ***************************
              id: 10
           model: Model_10
           color: Color_10
            sold: 0
      date_added: 1678956543120
storage_capacity: 512
    release_year: 2022
           price: 1299.989990
discounted_price: 1099.989990
   product_codes: [9,8,7]
          values: [555,444,333]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: 0.900000,0.100000,0.800000,-0.200000
       @knn_dist: 1.260000
*************************** 8. row ***************************
              id: 8
           model: Model_8
           color: Color_8
            sold: 0
      date_added: 1654876543130
storage_capacity: 256
    release_year: 2019
           price: 800.989990
discounted_price: 699.989990
   product_codes: [22,33,44]
          values: [66,333,999]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: 0.800000,0.600000,0.200000,-0.400000
       @knn_dist: 1.300000
*************************** 9. row ***************************
              id: 4
           model: Model_4
           color: Color_4
            sold: 0
      date_added: 1615319697581
storage_capacity: 128
    release_year: 2020
           price: 424.230011
discounted_price: 883.900024
   product_codes: [98,96,89]
          values: [166,252,510]
 additional_info: {"features":["Feature_1","Feature_2","Feature_3"]}
          vector: 0.700000,-0.800000,0.100000,-0.200000
       @knn_dist: 1.75999987
––– input –––
mysql -h0 -P9306 -e "SELECT count(*) FROM knn_test WHERE knn(vector, 5, 1);"
––– output –––
+----------+
| count(*) |
+----------+
|       10 |
+----------+
