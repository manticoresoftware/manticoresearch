<test>
<name>MySQL IN vs filter order</name>

<config>
indexer
{
	mem_limit = 16M
}

searchd
{
	<searchd_settings/>
}

source test
{
	type = mysql
	<sql_settings/>
	sql_query = SELECT * FROM test_table
	sql_attr_uint	= idd
}

index test
{
	source			= test
	path			= <data_path/>/test
}

source src_test_logic
{
	type = mysql
	<sql_settings/>
	sql_query = SELECT id, a, b, c FROM test_logic
	sql_attr_uint	= a
    sql_attr_uint	= b
    sql_attr_uint	= c
}

index test_logic
{
	source			= src_test_logic
	path			= <data_path/>/test_logic
}

source src_test_ranges
{
	type = mysql
	<sql_settings/>
	sql_query = SELECT id, v FROM test_ranges
	sql_attr_uint	= v
}

index test_ranges
{
	source			= src_test_ranges
	path			= <data_path/>/test_ranges
}

</config>

<db_create>
CREATE TABLE test_table
(
	id INT NOT NULL,
	body VARCHAR(2048) NOT NULL,
	idd INT NOT NULL
);
</db_create>

<db_drop>drop table if exists test_table;</db_drop>

<db_insert>insert into test_table values ( 1, 'test', 10 );</db_insert>
<db_insert>insert into test_table values ( 2, 'test', 20 );</db_insert>
<db_insert>insert into test_table values ( 3, 'test', 30 );</db_insert>
<db_insert>insert into test_table values ( 4, 'test', 40 );</db_insert>
<db_insert>insert into test_table values ( 5, 'test', 50 );</db_insert>
<db_insert>insert into test_table values ( 6, 'test', 60 );</db_insert>
<db_insert>insert into test_table values ( 7, 'test', 70 );</db_insert>

<db_create>
CREATE TABLE test_logic(
id INT NOT NULL,
a INT, b INT, c INT
);
</db_create>
<db_drop>DROP TABLE IF EXISTS test_logic;</db_drop>
<db_insert>
INSERT INTO test_logic (id, a, b, c) VALUES
(1, 0, 0, 0),
(2, 0, 1, 0),
(3, 1, 0, 0),
(4, 1, 1, 0),
(5, 0, 0, 1),
(6, 1, 1, 1);
</db_insert>

<db_create>CREATE TABLE test_ranges (
id INT NOT NULL,
v INT
);
</db_create>
<db_drop>DROP TABLE IF EXISTS test_ranges</db_drop>
<db_insert>
INSERT INTO test_ranges (id, v) VALUES
(1, 10),
(2, 11),
(3, 12),
(4, 13),
(5, 14);
</db_insert>

<queries><sphinxql>
	select * from test;
	select * from test where id IN (1,3,6,7);
	select * from test where id IN (1,1000,3,6,7);
	select * from test where id IN (1000,1,3,6,7);
	select * from test where id IN (1,3,6,1000,7);
	select * from test where idd IN (875,321,60,1010,20,457,20,311,20,750,70,10);
	select * from test where idd NOT IN (60,1010,20,457,20,311,20,750,70,10);
	<!-- here is regression broken NOT IN @global -->
	set global @attr_filter=(10,20,30,70);
	select * from test where idd IN @attr_filter;
	select * from test where idd NOT IN @attr_filter;
</sphinxql>


<!-- the root NOT node at filters -->
<sphinxql>
SELECT * FROM test_logic WHERE NOT a=1;
SELECT * FROM test_logic WHERE NOT a!=1;
SELECT * FROM test_logic WHERE NOT (a=1 AND b=1);
SELECT * FROM test_logic WHERE NOT (a=0 OR b=0);
SELECT * FROM test_logic WHERE NOT (a=1 AND (b=1 OR c=1));
SELECT * FROM test_logic WHERE NOT (NOT (a=1 AND b=1));
SELECT * FROM test_logic WHERE a=0 AND NOT (b=1 AND c=1);
SELECT * FROM test_logic WHERE a=1 OR NOT (b=0 OR c=0);

SELECT * FROM test_ranges WHERE NOT (v &gt;= 11 AND v &lt;= 13);
SELECT * FROM test_ranges WHERE NOT v BETWEEN 11 AND 13;
SELECT * FROM test_ranges WHERE NOT ((v &gt;= 10 AND v &lt;= 11) OR (v &gt;= 13 AND v &lt;= 14));
</sphinxql>
   
</queries>


</test>
