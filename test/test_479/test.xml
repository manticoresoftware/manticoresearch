<?xml version="1.0" encoding="utf-8"?>
<test>
<name>percentiles and MAD aggregations</name>

<requires>
	<http/>
</requires>

<skip_indexer/>

<config>
searchd
{
	<Searchd_Settings/>
	binlog_path =
}

index agg_td
{
	type			= rt
	path			= <data_path/>/agg_td
	rt_field		= data
	rt_attr_float	= latency
	columnar_attrs	= latency
}

index agg_td2
{
	type			= rt
	path			= <data_path/>/agg_td2
	rt_field		= data
	rt_attr_float	= latency
	columnar_attrs	= latency
}

index dist_agg
{
	type			= distributed
	local			= agg_td
	local			= agg_td2
}
</config>

<queries>
	<sphinxql>truncate rtindex agg_td</sphinxql>
	<sphinxql>insert into agg_td (id,data,latency) values (1,'v',10),(2,'v',20),(3,'v',30),(4,'v',40),(5,'v',50)</sphinxql>
	<sphinxql>truncate rtindex agg_td2</sphinxql>
	<sphinxql>insert into agg_td2 (id,data,latency) values (6,'v',60),(7,'v',70),(8,'v',80)</sphinxql>

	<query endpoint="json/search">{"table":"agg_td","size":0,"aggs":{"latency_percentiles":{"percentiles":{"field":"latency","values":[0,100],"keyed":true}}}}</query>
	<query endpoint="json/search">{"table":"agg_td","size":0,"aggs":{"latency_ranks":{"percentile_ranks":{"field":"latency","values":[-1,999],"keyed":true}}}}</query>
	<query endpoint="json/search">{"table":"agg_td","size":0,"aggs":{"latency_mad":{"median_absolute_deviation":{"field":"latency"}}}}</query>

	<query endpoint="json/search">{"table":"dist_agg","size":0,"aggs":{"latency_percentiles":{"percentiles":{"field":"latency","values":[0,100],"keyed":true}}}}</query>
	<query endpoint="json/search">{"table":"dist_agg","size":0,"aggs":{"latency_ranks":{"percentile_ranks":{"field":"latency","values":[-1,999],"keyed":true}}}}</query>
	<query endpoint="json/search">{"table":"dist_agg","size":0,"aggs":{"latency_mad":{"median_absolute_deviation":{"field":"latency"}}}}</query>
</queries>
</test>
